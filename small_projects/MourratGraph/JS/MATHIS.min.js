var __extends=this&&this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};var webSocketAddress="ws://92.222.90.196:1234";var mathis;(function(e){var t;(function(t){var i=function(){function e(e,t,i,r){var s=this;this.$leftButton=e;this.$rightButton=t;this.$left=i;this.$right=r;this.state=0;this.max=4;this.min=-4;this.leftIsFullPage=false;this.$leftButton.on("click touch",function(){s.onclickLeft()});this.$rightButton.on("click touch",function(){s.onclickRight()})}e.prototype.onclickLeft=function(){if(this.state>this.min){this.state--;this.onStateChange()}};e.prototype.onclickRight=function(){if(this.state<this.max){this.state++;this.onStateChange()}};e.prototype.equilibrate=function(){if(this.state!=0){this.state=0;this.onStateChange()}};e.prototype.leftToFullPageTemporarily=function(){if(!this.leftIsFullPage){this.$left.css({width:"100%"});this.$right.css({width:0,left:"100%"});this.leftIsFullPage=true}this.$leftButton.hide();this.$rightButton.hide()};e.prototype.endOfTemporarily=function(){if(this.leftIsFullPage){this.leftIsFullPage=false;this.$leftButton.show();this.$rightButton.show();this.onStateChange()}};e.prototype.onStateChange=function(){var e=Math.round(this.state-this.min)/(this.max-this.min)*100;var t=100-e;this.$left.css({width:e+"%"});this.$right.css({width:t+"%",left:e+"%"});this.$leftButton.css({right:t+"%"});this.$rightButton.css({left:e+"%"})};return e}();t.Enlarger=i;var r=function(){function r(r,s){this.identification=null;this.callbacksCatalogue=new e.StringMap;this.testMode=s;this.severalPages=new t.SeveralPages(s);this.mathisFrame=r;this.enlarger=new i($("#enlargeLeft"),$("#enlargeRight"),$("#mainLeftCol"),$("#mainRightCol"));this.navigator=new a(this.severalPages,this);this.eventManager=new o(this)}r.prototype.go=function(){var e=this;this.build();this.navigator.registerAllPieceOfCodes();window.onpopstate=function(t){if(t.state!=null)e.navigator.goTo(t.state)};if(this.testMode){this.connectToServerForTest();setTimeout(function(){e.sendMessage(false,{type:"checkClientCanSendMessage"})},1e3);this.identification=new s(this);if(this.identification.getUsername()==null)this.identification.activateLoginBoxes();else this.afterIdentification()}else this.afterIdentification()};r.prototype.afterIdentification=function(){var e=this;if(this.testMode&&this.identification.getUsername()!=null)this.identification.activateAlreadyLoggedBox(this.identification.getUsername());if(location.hash.length>0){setTimeout(function(){e.navigator.goTo(location.hash)},500)}else{this.showMainIndex(false)}$("#logoMathis").on("click touch",function(){e.showMainIndex(false)})};r.prototype.connectToServerForTest=function(){var e=this;this.ws=new WebSocket(webSocketAddress,"echo-protocol");this.ws.addEventListener("message",function(t){var i=JSON.parse(t.data);var r=i.type+"|"+i.timeMillis;if(e.callbacksCatalogue.getValue(r)!=null){console.log("message reçu du server avec callback",i);e.callbacksCatalogue.getValue(r)(i);e.callbacksCatalogue.removeKey(r)}else console.log("message reçu du server sans callback",i)})};r.prototype.sendMessage=function(e,t){if(e){var i=this.identification.getPassword();var r=this.identification.getUsername();if(i==null||r==null)throw"password and username was not yet initialized";t.username=r;t.password=i}console.log("message envoyé par le client:",t);this.ws.send(JSON.stringify(t))};r.prototype.sendMessageAndWaitForReply=function(e,t,i){t.timeMillis=(new Date).getTime();this.sendMessage(e,t);console.log(""+t.type+"|"+t.timeMillis);this.callbacksCatalogue.putValue(t.type+"|"+t.timeMillis,i)};r.prototype.build=function(){throw"to override"};r.prototype.showMainIndex=function(e){this.eventManager.fireEvent(new n("showMainIndex"));if(!e){this.navigator.pushState({type:"index"})}var i=$("#pageTitle").empty().text("Main menu");this.enlarger.endOfTemporarily();var r=$("#pageContent").empty();if(this.testMode){r.append(this.severalPages.$visual);this.severalPages.remakeHandlers();var s=$('<button class="clickable">FIRE ALL TESTS</button>').on("click touch",function(){r.empty();var e=new t.DoAllTestAndShowProblems;e.$visual.appendTo(r);e.doAllTest()}).prependTo(r)}else{r.empty().append(this.severalPages.$visual);this.severalPages.remakeHandlers();t.startDemo(this.mathisFrame)}};return r}();t.IndexPage=r;var s=function(){function e(e){this.indexPage=e}e.prototype.activateLoginBoxes=function(){var e=$("#pageContent");e.empty();this.loginBox(e,false);this.loginBox(e,true);this.indexPage.navigator.pushState({type:"login"})};e.prototype.loginBox=function(e,t){var i=this;var r=$("<div>").appendTo(e);if(t){$("<div>").appendTo(r).append("Create new user.").append('<span style="color: red"> Passwords are not hashed :-(</span>')}else $("<div>").text("login as existing user:").appendTo(r);var s=$('<input content="text">').attr("placeholder","username");s.appendTo(r);var a=$('<input content="text">').attr("placeholder","password");a.appendTo(r);var n;if(t){n=$('<input content="text">').attr("placeholder","email");n.appendTo(r)}$("<button>").text("send").on("click touch",function(){var r;if(!t){r={type:"loginExisting",username:s.val(),password:a.val()}}else{r={type:"loginNewUser",username:s.val(),password:a.val(),email:n.val()}}i.indexPage.sendMessageAndWaitForReply(false,r,function(s){if(t){if(s.status=="ok"){i.setUsername(r.username);i.setPassword(r.password);i.indexPage.afterIdentification()}else{e.empty();e.append($('<div style="background-color: red">').text(s.status));i.loginBox(e,false);i.loginBox(e,true)}}else{if(s.status=="noSuchUser"){e.empty();e.append($('<div style="background-color: red">').text("NO SUCH USER"));i.loginBox(e,false);i.loginBox(e,true)}else if(s.status=="passwordNonOK"){e.empty();e.append($('<div style="background-color: red">').text("PASSWORD NON OK"));i.loginBox(e,false);i.loginBox(e,true)}else{i.setUsername(r.username);i.setPassword(r.password);i.indexPage.afterIdentification()}}})}).appendTo(r)};e.prototype.activateAlreadyLoggedBox=function(e){var t=this;var i=$('<div class="alreadyLoggedBox">').appendTo($("body"));$("<span>").text("logged as: "+e).appendTo(i);$("<button>").text("change").on("click touch",function(){i.remove();localStorage.setItem("username",null);localStorage.setItem("password",null);t.activateLoginBoxes()}).appendTo(i)};e.prototype.getUsername=function(){if(localStorage.getItem("username")==null||localStorage.getItem("username")=="undefined"||localStorage.getItem("username")=="null")return null;return localStorage.getItem("username")};e.prototype.getPassword=function(){if(localStorage.getItem("password")==null||localStorage.getItem("password")=="undefined"||localStorage.getItem("password")=="null")return null;return localStorage.getItem("password")};e.prototype.setUsername=function(e){localStorage.setItem("username",e.toLowerCase())};e.prototype.setPassword=function(e){localStorage.setItem("password",e)};e.prototype.canAccess=function(e){var t=this.getUsername();if(t=="vincent")return true;if(t==null)return false;if(t==e)return true};return e}();t.Identification=s;var a=function(){function i(t,i){this.severalPages=t;this.indexPage=i;this.idToParts=new e.StringMap}i.prototype.pushState=function(e){var t="#"+JSON.stringify(e);history.pushState(t,t,t)};i.prototype.registerAllPieceOfCodes=function(){for(var e=0,t=this.severalPages.idToPage.allValues();e<t.length;e++){var i=t[e];var r=i.severalParts;if(i.severalParts!=null){for(var s=0,a=r.allParts;s<a.length;s++){var n=a[s];if(n.pieceOfCode!=null)this.idToParts.putValue(n.name,n)}}}};i.prototype.goTo=function(e){t.indexPage.mathisFrame.cleanAllPeriodicActions();var i=JSON.parse(e.slice(1));if(i.type==null)throw"in navigator, action :"+e+", has no type";else if(i.type=="part"){this.goToPartWithSomeConfiguration(i.name,i.configuration)}else if(i.type=="page"){this.goToPage(i.name)}else if(i.type=="index"||i.type=="login"){this.indexPage.showMainIndex(true)}else console.log("no action for state:"+i.type)};i.prototype.goToPage=function(e){for(var t=0,i=this.severalPages.idToPage.allValues();t<i.length;t++){var r=i[t];if(r.pageIdAndTitle==e){this.severalPages.goToPage(r,true,true)}}};i.prototype.goToPartWithSomeConfiguration=function(e,t){for(var i=0,r=this.severalPages.idToPage.allValues();i<r.length;i++){var s=r[i];var a=s.severalParts;if(s.severalParts!=null){for(var n=0,o=a.allParts;n<o.length;n++){var h=o[n];if(h.name==e){this.severalPages.goToPage(s,true,false);if(t!=null){for(var l in t){h.pieceOfCode[l]=t[l]}}else{for(var u=0,c=h.pieceOfCode.COMMAND_DICO.allKeys();u<c.length;u++){var l=c[u];h.pieceOfCode[l]=h.pieceOfCode.COMMAND_DICO.getValue(l).initialValueMemorized}}a.clickInOnePlayButton(h,true,true)}}}}};return i}();t.Navigator=a;var n=function(){function e(e,t){this.name=e;this.precision=t;this.from="inside"}return e}();t.Event=n;var o=function(){function e(e){this.indexPage=e}e.prototype.fireEvent=function(e){var i=e.precision||"";cc("new event:",e.name,i);switch(e.name){case"changeDemo":{this.fireEvent(new n("theViewChange"))}break;case"goToPage":{$("#demoChoice").empty();this.fireEvent(new n("theViewChange"))}break;case"clickInOnePlayButton":{this.fireEvent(new n("theViewChange"))}break;case"showMainIndex":{$("#demoChoice").empty();this.fireEvent(new n("theViewChange"))}break;case"theViewChange":{this.indexPage.mathisFrame.messageDiv.empty();this.indexPage.mathisFrame.emptyAllCorner();t.indexPage.mathisFrame.cleanAllPeriodicActions()}break}};return e}();t.EventManager=o})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){(function(e){e[e["select"]=0]="select";e[e["button"]=1]="button"})(t.ChoicesOptionsType||(t.ChoicesOptionsType={}));var i=t.ChoicesOptionsType;var r=function(){function e(e,t){if(t===void 0){t=null}this.$select=null;this.$button=null;this.values=e;if(t!=null)this.options=t;else this.options={}}e.prototype.changePossibleValues=function(e,i){if(i===void 0){i=null}if(i!=null&&e.length!=i.length)throw"values.length and visualValues.length must be equal for:"+this.key;this.values=e;if(i!=null)this.options.visualValues=i;if(this.$select!=null){for(var r=0;r<this.$select.options.length;r++){this.$select.options[r]=null}for(var r=0;r<this.values.length;r++){var s=document.createElement("option");s.value=this.values[r];var a="";if(t.indexPage&&t.indexPage.testMode)a=this.key+":";if(this.options.visualValues!=null){a+=this.options.visualValues[r]}else a+=this.values[r];s.text=a;this.$select.appendChild(s)}}else if(this.$button!=null){if(this.options.visualValues!=null)this.$button.visualValues=this.options.visualValues;else for(var r=0;r<this.values.length;r++){this.$button.visualValues.push(this.values[r])}}};e.prototype.show=function(){this.$parent.show()};e.prototype.hide=function(){this.$parent.hide()};return e}();t.Choices=r;function s(i){if(i.COMMAND_DICO!=null)throw"command dico was already made for the piece of code:"+i.NAME;var s=new e.StringMap;for(var a in i){if(i.hasOwnProperty(a)&&a.slice(0,3)==t.conv.$$$){var n=a.slice(3);var o=i[a];if($.isArray(o)){o=new r(o);i[a]=o}else if(!(o instanceof r))throw"the attribute '$$$"+n+"'  must be an array or of Type Choices because it start by 3$";o.key=n;if(s.getValue(n)!=null)throw"a configuration attribute is duplicated ";s.putValue(n,o)}}for(var h=0,l=s.allKeys();h<l.length;h++){var n=l[h];if(i[n]===undefined)throw"no attribute associate to  $$$"+n}i.COMMAND_DICO=s}t.buildCommandDico=s;var a=function(){function r(t,i,r){this.pieceOfCode=t;this.defaultContainer=i;this.mathisFrame=r;this.selectAndAroundClassName=null;this.keyTo$select=new e.StringMap;this.keyTo$button=new e.StringMap;this.containersToPutCommand=new e.StringMap;this.pushState=false;this.go_fired=false;if(i!=null){if(!(i instanceof jQuery))throw"defaultContainer must be null or a jQuery object";if(i.length!=1)throw"defaultContainer must contain a unique HTMLElement"}if(t.COMMAND_DICO==null)s(this.pieceOfCode)}r.prototype.setAllSelectsAccordingToPieceOfCode=function(){for(var e=0,t=this.pieceOfCode.COMMAND_DICO.allKeys();e<t.length;e++){var i=t[e];var r=null;var s=this.pieceOfCode.COMMAND_DICO.getValue(i);for(var a=0;a<s.values.length;a++){if(s.values[a]===null||this.pieceOfCode[i]===null){if(s.values[a]===null&&this.pieceOfCode[i]===null)r=a}else{if(JSON.stringify(s.values[a])==JSON.stringify(this.pieceOfCode[i]))r=a}}if(r!=null){var n=this.keyTo$select.getValue(i);if(n!=null)n.selectedIndex=r;else{var o=this.keyTo$button.getValue(i);if(o!=null){o.selectedIndex=r;o.updateVisual()}}}else{var h="";for(var l=0,u=s.values;l<u.length;l++){var c=u[l];h+=JSON.stringify(c)+","}throw"in the pieceOfCode:"+this.pieceOfCode.NAME+", for the configuration-attribute:"+i+", the value:"+JSON.stringify(this.pieceOfCode[i])+" does not appear in the possible choices:"+h}}};r.prototype.go=function(){var e=this;if(this.go_fired)throw"Binder.go can be fired only once";this.go_fired=true;if(this.defaultContainer!=null){this.containersToPutCommand.putValue("default",this.defaultContainer)}if(this.mathisFrame!=null){this.containersToPutCommand.putValue("NW",this.mathisFrame.subWindow_NW.$visual);this.containersToPutCommand.putValue("NE",this.mathisFrame.subWindow_NE.$visual);this.containersToPutCommand.putValue("N",this.mathisFrame.subWindow_N.$visual);this.containersToPutCommand.putValue("SW",this.mathisFrame.subWindow_SW.$visual);this.containersToPutCommand.putValue("SE",this.mathisFrame.subWindow_SE.$visual);this.containersToPutCommand.putValue("S",this.mathisFrame.subWindow_S.$visual);this.containersToPutCommand.putValue("W",this.mathisFrame.subWindow_W.$visual);this.containersToPutCommand.putValue("E",this.mathisFrame.subWindow_E.$visual);if(this.containersToPutCommand.getValue("default")==null)this.containersToPutCommand.putValue("default",this.mathisFrame.subWindow_NW.$visual)}var t=function(t){var s=r.pieceOfCode.COMMAND_DICO.getValue(t);s.initialValueMemorized=r.pieceOfCode[t];var a=void 0;var o=void 0;if(s.options.containerName!=null){o=r.containersToPutCommand.getValue(s.options.containerName);if(o==null||o.length==0)throw"the container name:"+s.options.containerName+" has no corresponding container"}else o=r.containersToPutCommand.getValue("default");var h=o.find("."+t);if(h==null||h.length==0){h=$("<span>").addClass(t);o.append($("<div>").append(h));a=true}else if(h.length>1)throw"several places for the element with name:"+t;else if(h.length==1){a=false}if(r.selectAndAroundClassName!=null){h.addClass(r.selectAndAroundClassName)}s.$parent=h;var l=$("<span>");var u=s.options.before==null?"":s.options.before;var c=s.options.label==null?t+":":s.options.label;if(a)l.append(c).append(u);else l.append(u);if(s.options.type==null||s.options.type==i.select){s.$select=document.createElement("select");r.keyTo$select.putValue(t,s.$select);h.append(l);h.append(s.$select);s.changePossibleValues(s.values);s.$select.onchange=function(){e.pieceOfCode[s.key]=s.values[s.$select.selectedIndex];e.whenSelectOrButtonChange(s)}}else if(s.options.type==i.button){s.$button=new n;r.keyTo$button.putValue(t,s.$button);h.append(s.$button.$visual);s.changePossibleValues(s.values);s.$button.onclick=function(){s.$button.increment();s.$button.updateVisual();e.pieceOfCode[s.key]=s.values[s.$button.selectedIndex];e.whenSelectOrButtonChange(s)}}};var r=this;for(var s=0,a=this.pieceOfCode.COMMAND_DICO.allKeys();s<a.length;s++){var o=a[s];t(o)}this.setAllSelectsAccordingToPieceOfCode()};r.prototype.whenSelectOrButtonChange=function(e){if(t.indexPage!=null&&this.pushState){t.indexPage.navigator.pushState({type:"part",name:this.pieceOfCode.NAME,configuration:t.pieceOfCodeToConfiguration(this.pieceOfCode)})}if(e.options.onchange!=null)e.options.onchange();else this.pieceOfCode.go();if(this.onConfigChange!=null)this.onConfigChange()};return r}();t.Binder=a;var n=function(){function e(){var e=this;this.visualValues=[];this.selectedIndex=0;this.$visual=$('<div class="clickable appliButton" "></div>');this.$visual.on("click touch",function(){e.onclick()})}e.prototype.increment=function(){this.selectedIndex=(this.selectedIndex+1)%this.visualValues.length};e.prototype.updateVisual=function(){this.$visual.empty().append(this.visualValues[this.selectedIndex])};return e}();t.$Button=n})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i;(function(e){e.$$$="$$$";e.spacesToSuppress="                ";e.toIncludeAtTheBeginOfTheFirstHiddenPiece=["var mathisFrame=new mathis.MathisFrame()"];e.traitementsForEachLine=[function(e){return e.replace(/this.mathisFrame\./g,"mathisFrame.")}];e.begin=["$$$begin","$$$b"];e.beginHidden=["$$$beginHidden","$$$bh"];e.end=["$$$end","$$$e"];e.endHidden=["$$$endHidden","$$$eh"]})(i=t.conv||(t.conv={}));function r(e){var t={};for(var r in e){if(r.slice(0,3)==i.$$$){var s=r.slice(3);if(s!="name"&&s!="title"&&s!="creator"&&s!="keyWords"){t[s]=e[s]}}}return t}t.pieceOfCodeToConfiguration=r;function s(e){var t=[];for(var r in e){if(r.slice(0,3)==i.$$$){var s=r.slice(3);if(s!="name"&&s!="title"&&s!="creator"&&s!="keyWords"){t.push(s)}}}return t.sort()}t.pieceOfCodeToSrotedConfigurationAttributes=s;var a=function(){function r(e){this.pieceOfCode=e}r.prototype.checkPieceOfCode=function(t){for(var i=0,r=this.pieceOfCode.COMMAND_DICO.allKeys();i<r.length;i++){var s=r[i];var a=new RegExp("\\bthis."+s+"\\b","g");var n=t.match(a);if(n==null)e.logger.c("the configuration parameter:"+s+" never appears in the piece of code:"+this.pieceOfCode.NAME);else if(n.length>1)throw"the configuration parameter:"+s+" appears more than on time in the piece of code:"+this.pieceOfCode.NAME}};r.prototype.go=function(){t.buildCommandDico(this.pieceOfCode);var e=this.extractPiecesToShow();var r=$("<div></div>");for(var s=0;s<e.length;s++){var a=e[s];if(s==0){var o=this.pieceOfCode.toIncludeAtTheBeginOfTheFirstHiddenPiece;if(o==null)o=i.toIncludeAtTheBeginOfTheFirstHiddenPiece;if(o!=null){if(!(o instanceof Array)||typeof o[0]!="string")throw"must be an array of string";var h=[];for(var l=0;l<o.length;l++){h[l]=i.spacesToSuppress+o[l]}if(a.type=="hidden"){a.piece=h.concat(a.piece)}else{var u=new n(false,"");u.$squizable.append(this.transformOnePiece(h));r.append(u.$visual)}}}if(a.type=="show")r.append(this.transformOnePiece(a.piece));else if(a.type=="test"&&t.indexPage.testMode){r.append(this.transformOnePiece(a.piece,true))}else if(a.type=="hidden"){var u=new n(false,a.title);u.$squizable.append(this.transformOnePiece(a.piece));r.append(u.$visual)}}return r};r.prototype.transformOnePiece=function(e,t){if(t===void 0){t=false}var r=[];for(var s=0,a=e;s<a.length;s++){var n=a[s];r.push(n.slice(16))}for(var o=0;o<r.length;o++){if(r[o].slice(0,3)=="//n"){r[o]=" "}for(var h=0,l=i.traitementsForEachLine;h<l.length;h++){var u=l[h];r[o]=u(r[o])}}var c=r.join("\n");for(var m=0,d=this.pieceOfCode.COMMAND_DICO.allKeys();m<d.length;m++){var f=d[m];var p=new RegExp("\\bthis."+f+"\\b","g");var v=c.split(p);c=v.join('<div class="selectableAttribute '+f+'"></div>')}var g=$('<pre class="prettyprint">'+c+"</pre>");if(t){g.css({backgroundColor:"#f4ee78"})}return g};r.prototype.extractPiecesToShow=function(){var e=this.pieceOfCode.go.toString();this.checkPieceOfCode(e);var t=e.split("\n");var i=[];var r=[];for(var s=0;s<t.length;s++){var a=t[s];var n=/^                \/\/\$\$\$(beginHidden|bh) *./g.test(a);if(/^                \/\/\$\$\$(begin|b)$/g.test(a))i.push({index:s,type:"show"});if(n||/^                \/\/\$\$\$(beginHidden|bh)$/g.test(a)){var o="";if(n){var h=/^                \/\/\$\$\$(beginHidden|bh) *./g;h.exec(a);o=a.slice(h.lastIndex-1)}i.push({index:s,type:"hidden",title:o})}if(/^                \/\/\$\$\$(end|e)$/g.test(a))r.push({index:s,type:"show"});if(/^                \/\/\$\$\$(endHidden|eh)$/g.test(a))r.push({index:s,type:"hidden"});if(/^                \/\/\$\$\$(beginTest|bt)$/g.test(a))i.push({index:s,type:"test"});if(/^                \/\/\$\$\$(endTest|et)$/g.test(a))r.push({index:s,type:"test"})}if(i.length!=r.length)throw"not the same number of $$$begin and $$$end";var l=[];for(var s=0;s<i.length;s++){var u=i[s].index;var c=i[s].type;var o=i[s].title;var m=r[s].index;var d=r[s].type;if(m<=u)throw"an end before a begin";if(c!=d)throw"$$$begin has type:"+c+" while $$$end has type:"+d;var f=t.slice(u+1,m);l.push({piece:f,type:c,title:o})}return l};return r}();t.PieceOfCodeTransformer=a;var n=function(){function e(e,t){var i=this;this.isOpen=e;this.$visual=$("<div></div>");this.$squizable=$('<div class="squizable"></div>').appendTo(this.$visual);this.$title=$('<div class="ocGrey" style="display:inline-block"></div>').append(t);this.$squizButton=$('<div class="fa squizButton ocGrey"></div>');this.$allTheHead=$('<div class="docuPink"></div>');var r=$('<div class="clickable inline"></div>').on("click touch",function(){i.toggle()}).append(this.$squizButton).append(this.$title);this.$allTheHead.append(r).prependTo(this.$visual);if(this.isOpen)this.open(false);else this.close(false)}e.prototype.getVisual=function(){return this.$visual};e.prototype.close=function(e){if(e)this.$squizable.slideUp();else this.$squizable.hide();this.isOpen=false;this.$squizButton.removeClass("fa-compress").addClass("fa-expand")};e.prototype.open=function(e){if(e)this.$squizable.slideDown();else this.$squizable.show();this.isOpen=true;this.$squizButton.removeClass("fa-expand").addClass("fa-compress")};e.prototype.toggle=function(){if(this.isOpen)this.close(true);else this.open(true)};return e}();var o=function(){function i(){this.NAME="part1";this.TITLE="Bonjour ici c'est ça";this.a=0;this.$$$a=new t.Choices([0,1,2,3,4]);this.aaa=new e.XYZ(12,2,3);this.$$$aaa=new t.Choices([new e.XYZ(12,2,3),new e.XYZ(0,0,3)]);this.mlkajert="toto";this.$$$mlkajert=new t.Choices(["a","b","c","b","toto"])}i.prototype.goForTheFirstTime=function(){console.log("we goChanging for the first time");this.go()};i.prototype.go=function(){var t=1234;var i=this.a;var r=this.mlkajert;var s=this.aaa;var a=0;var n="mathis.";var o=new e.Bilan;for(var h=0;h<4;h++){a+=h}function l(){return 4}console.log(i,r,s)};return i}();t.APieceOfCodeForTest=o})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){(function(e){e[e["basic"]=0]="basic";e[e["tool"]=1]="tool";e[e["math"]=2]="math";e[e["forDeveloper"]=3]="forDeveloper";e[e["proba"]=4]="proba"})(t.Keywords||(t.Keywords={}));var i=t.Keywords;var r=function(){function e(){this.isVariant=false}e.prototype.fromComment=function(e,t){this.$comment=e;this.name=t;return this};e.prototype.fromPieceOfCode=function(e,t){if(t===void 0){t=false}this.pieceOfCode=e;this.isVariant=t;this.name=e.NAME;return this};return e}();t.OnePart=r;var s=function(){function i(t){this.testMode=t;this.nbPages=0;this.idToPage=new e.StringMap;this.idToLine=new e.StringMap;this.$visual=$("<div></div>")}i.prototype.addPage=function(e,t){if(t===void 0){t=false}if(t&&!this.testMode)return;this.nbPages++;var i=$('<div class="mainMenuLine"></div>');i.text(this.nbPages+" : "+e.pageIdAndTitle);if(t)i.css({color:"red"});this.$visual.append(i);if(this.idToPage.getValue(e.pageIdAndTitle)!=null)throw"two OnePage have the same pageIdAndTitle:"+e.pageIdAndTitle;this.idToPage.putValue(e.pageIdAndTitle,e);this.idToLine.putValue(e.pageIdAndTitle,i)};i.prototype.addSeparator=function(e,t){if(t===void 0){t=false}if(t&&!this.testMode)return;$('<div style="margin-top: 3em;border-top: solid 2px red; border-bottom: dashed 1px red"></div>').text(e).appendTo(this.$visual)};i.prototype.goToPage=function(e,i,r){t.indexPage.eventManager.fireEvent(new t.Event("goToPage",e.pageIdAndTitle));$("#pageTitle").empty().text(e.pageIdAndTitle);if(!i)t.indexPage.navigator.pushState({type:"page",name:e.pageIdAndTitle});var s=e.go();if(r){if(e.severalParts!=null)e.severalParts.activateMyFirstPart()}$("#pageContent").empty().append(s);prettyPrint()};i.prototype.remakeHandlers=function(){var e=this;var t=function(t){i.idToLine.getValue(t).on("click touch",function(){e.goToPage(e.idToPage.getValue(t),false,true)})};var i=this;for(var r=0,s=this.idToPage.allKeys();r<s.length;r++){var a=s[r];t(a)}};return i}();t.SeveralPages=s;var a=function(){function e(){this.allParts=[];this.numberOrParts=0}e.prototype.go=function(){var e=$("<div></div>");e.empty();for(var t=0,i=this.allParts;t<i.length;t++){var r=i[t];if(r.pieceOfCode!=null)e.append(this.createPartWithPieceOfCode(r));else e.append(r.$comment)}return e};e.prototype.activateMyFirstPart=function(){for(var e=0,t=this.allParts;e<t.length;e++){var i=t[e];if(i.pieceOfCode!=null){this.clickInOnePlayButton(i,true,false);break}}};e.prototype.addPart=function(e,t){if(t===void 0){t=false}this.allParts.push((new r).fromPieceOfCode(e,t))};e.prototype.createPartWithPieceOfCode=function(e){var i=this;this.numberOrParts++;var r=e.isVariant?$('<div class="ChoicesPartVariante"></div>'):$('<div class="ChoicesPart"></div>');var s=$('<div class="ChoicesPartHead"></div>');var a=$('<div class="ChoicesPartContent"></div>');r.append(s).append(a);e.$playButton=$('<div class="fa fa-play playButton"></div>').on("click touch",function(){i.clickInOnePlayButton(e,false,false)});if(t.indexPage.testMode)s.append($('<span style="color: red">').text(e.pieceOfCode.NAME+":"));s.append(e.pieceOfCode.TITLE);s.append(e.$playButton);var n=new t.PieceOfCodeTransformer(e.pieceOfCode);e.$transformedPieceOfCode=n.go();e.binder=new t.Binder(e.pieceOfCode,e.$transformedPieceOfCode,t.indexPage.mathisFrame);e.binder.pushState=true;e.binder.go();a.append(e.$transformedPieceOfCode);if(t.indexPage.testMode&&e.pieceOfCode.NO_TEST==null){a.append(new t.InteractiveTestBox(n.pieceOfCode.COMMAND_DICO,e).getVisual())}if(e.isVariant)e.$transformedPieceOfCode.hide();return r};e.prototype.addComment=function(e,t){var i=$('<div class="commentBetweenParts"></div>').append(e);this.allParts.push((new r).fromComment(e,t))};e.prototype.clickInOnePlayButton=function(e,i,r){t.indexPage.eventManager.fireEvent(new t.Event("clickInOnePlayButton",e.name));for(var s=0,a=this.allParts;s<a.length;s++){var n=a[s];if(n.pieceOfCode!=null){n.$transformedPieceOfCode.find("select").prop("disabled",true);n.$playButton.css("opacity","0.5");if(n.endTest!=null)n.endTest()}}if(t.indexPage.testMode&&e.actionTest!=null)e.actionTest();e.$playButton.css("opacity","1");e.$transformedPieceOfCode.find("select").prop("disabled",false);if(e.isVariant)e.$transformedPieceOfCode.show();if(r)e.binder.setAllSelectsAccordingToPieceOfCode();e.pieceOfCode.goForTheFirstTime();if(!i){t.indexPage.navigator.pushState({type:"part",name:e.name,configuration:t.pieceOfCodeToConfiguration(e.pieceOfCode)})}else{var o=void 0;if(e.pieceOfCode!=null)o=e.$transformedPieceOfCode;else o=e.$comment;$("html, body").animate({scrollTop:o.offset().top-50},1e3)}};return e}();t.SeveralParts=a})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){function i(e){if(e===null)return"green";if(typeof e==="undefined")return"grey";if(typeof e==="number")return"blue";if(typeof e==="string")return"black";if(typeof e==="boolean")return"orange";else return"violet"}function r(e){if(e===null)return"null";if(typeof e==="undefined")return"undefined";return e}function s(e){var t=$('<div style="margin-top: 1em;border-top:solid 1px black"></div>');for(var s in e){var a=$("<div></div>");a.appendTo(t);$("<span></span>").text(s+" : ").appendTo(a);$("<span></span>").text(r(e[s])).css({color:i(e[s])}).appendTo(a)}return t}function a(e,i,r,s,a,n,o,h,l,u){if(u===void 0){u=null}var c=$('<div style="margin-top:1em"></div>');c.appendTo(n);if(JSON.stringify(s)!=JSON.stringify(a)){var m=$("<div></div>");m.appendTo(c);$('<span style="color:red"></span>').text(r).appendTo(m);$('<span style="color:blue"></span>').text(" by "+i+":").appendTo(m);if(e)$("<span></span>").text("Configurations-attributes are different:").appendTo(m);else $("<span></span>").text("Saved-attributes are different:").appendTo(m);$("<div></div>").text("JS:"+JSON.stringify(s)).appendTo(c);$("<div></div>").text("DB:"+JSON.stringify(a)).appendTo(c);if(t.indexPage.identification.canAccess(i)){var d=$("<button>CLEAR EXISTING TESTS</button>");d.on("click touch",function(){t.indexPage.sendMessageAndWaitForReply(true,{type:"suppressTheWholePieceOfCode",name:r},function(){c.hide();d.addClass("clickable");h()})});d.appendTo(c);var f=$("<div>RENAME IN DB:</div>");f.appendTo(c);var p=$('<input type="text">').val(r+"_old");p.appendTo(f);var v=$("<button> GO </button>");v.appendTo(f);v.on("click touch",function(){t.indexPage.sendMessage(true,{type:"renameTheWholePieceOfCode",name:r,newName:p.val()});c.hide();h()}).addClass("clickable");if(!e){var g=$("<div></div>");g.appendTo(c);$('<button class="clickable">FIX THE DB</button>').on("click touch",function(){t.indexPage.sendMessageAndWaitForReply(true,{type:"remakeSavedAttributes",name:r,goodSavedAttributes:s},function(){c.hide();if(o!=null)o()})}).appendTo(g)}}else $('<div style="color: red"></div>').text("only creator can edit").appendTo(c);if(u!=null)c.append(u)}else{l()}}function n(e,i){var r=$("<div>");var s=$("<span>");s.appendTo(r);var a="";if(t.indexPage.identification.getUsername()==e)a+="=YOU";$('<span style="color:blue">').text(e+a).appendTo(s);$("<span>").text(" initialized the series. ").appendTo(s);var n=$("<span>");n.appendTo(r);if(i!=null){var o="";if(t.indexPage.identification.getUsername()==i)o+="=YOU";$('<span style="color:blue">').text(i+o).appendTo(n);$("<span>").text(" created this test").appendTo(n)}else{$('<span style="color:blue">').text("NOBODY").appendTo(n);$("<span>").text(" created this test. DO IT !").appendTo(n)}return r}var o=function(){function o(t,i){var r=this;this.$$$keys=new e.StringMap;this.pieceOfCode=i.pieceOfCode;this.onePart=i;for(var s=0,a=t.allValues();s<a.length;s++){var n=a[s];this.$$$keys.putValue(n.key,true)}this.$divToCreateTest=$('<div style="border-top: solid 1px black; margin-top: 1em"></div>');this.onePart.actionTest=function(){r.start()};this.onePart.endTest=function(){r.$divToCreateTest.empty()};this.onePart.binder.onConfigChange=function(){r.start()}}o.prototype.getVisual=function(){return this.$divToCreateTest};o.prototype.start=function(){this.$divToCreateTest.empty();this.createMainButton()};o.prototype.createMainButton=function(){var e=this;t.indexPage.sendMessageAndWaitForReply(false,{type:"checkExisting",name:this.pieceOfCode.NAME},function(t){if(t.status=="nonExisting"){$('<button class="clickable">INITIALIZE TEST</button>').on("click touch",function(){e.$divToCreateTest.empty().append(e.initialize())}).appendTo(e.$divToCreateTest)}else if(t.status=="existing"){var i=[];for(var r=0,s=e.$$$keys.allKeys();r<s.length;r++){var n=s[r];i.push(n)}a(true,t.username,e.pieceOfCode.NAME,i.sort(),t.configurationAttributes,e.$divToCreateTest,function(){e.emptyAndRestart()},function(){e.emptyAndRestart()},function(){var i=[];for(var r in e.pieceOfCode){if(r.substring(0,1)=="_")i.push(r)}a(false,t.username,e.pieceOfCode.NAME,i.sort(),t.savedAttributes,e.$divToCreateTest,function(){e.emptyAndRestart()},function(){e.emptyAndRestart()},function(){e.$divToCreateTest.empty().append(e.retrieveThenDevelopp())})})}else throw"hoho"})};o.prototype.emptyAndRestart=function(){this.$divToCreateTest.empty();this.onePart.$transformedPieceOfCode.find("select").prop("disabled",false);this.onePart.$playButton.addClass("activePlayButton");this.start()};o.prototype.initialize=function(){var e=this;var i=[];for(var r=0,s=this.$$$keys.allKeys();r<s.length;r++){var a=s[r];i.push(a)}var n=[];for(var a in this.pieceOfCode){if(a.substring(0,1)=="_")n.push(a)}t.indexPage.sendMessageAndWaitForReply(true,{savedAttributes:n,type:"initializeTest",name:this.pieceOfCode.NAME,creator:this.pieceOfCode.CREATOR,configurationAttributes:i},function(t){e.$divToCreateTest.empty().append(e.retrieveThenDevelopp())})};o.prototype.getConfiguration=function(){var e={};for(var t=0,i=this.$$$keys.allKeys();t<i.length;t++){var r=i[t];e[r]=this.pieceOfCode[r];if(typeof this.pieceOfCode[r]=="function")throw"for test, a configuration value can not be a function"}return e};o.prototype.retrieveThenDevelopp=function(){var e=this;t.indexPage.sendMessageAndWaitForReply(false,{type:"retrieveSavedValues",name:this.pieceOfCode.NAME,configuration:this.getConfiguration()},function(t){e.$divToCreateTest.append(e.developp(t))})};o.prototype.developp=function(e){var a=this;var o=e.saved;if(o==null)o={};var h=$("<div></div>");h.append(n(e.username_initializer,e.username_config));var l=e.username_config==null||t.indexPage.identification.canAccess(e.username_initializer)||t.indexPage.identification.canAccess(e.username_config);s(this.getConfiguration()).appendTo(h);var u=$("<div>").appendTo(h);var c=function(e){if(m.pieceOfCode[e]==null){var i=$("<div></div>").text(" '"+e+"' is in DB but not in JS");i.appendTo(h);var r=$('<button class="clickable"></button>').text("remove attribute in DB").on("click touch",function(){t.indexPage.sendMessage(true,{type:"removeAttribute",attrib:e,name:a.pieceOfCode.NAME});r.hide()});r.appendTo(i)}};var m=this;for(var d in o){c(d)}var f=[];var p=$('<button class="clickable">SEND</button>').hide();var v=$('<button class="clickable">CANSEL</button>').hide();var g=$('<div class="lineAttribute"></div>').appendTo(u);$('<div class="firstColumn"></div>').text("attribute name").appendTo(g);$('<div class="otherColumn"></div>').text("JS").appendTo(g);$('<div class="otherColumn"></div>').text("DB").appendTo(g);for(var d in this.pieceOfCode){if(this.pieceOfCode.hasOwnProperty(d)&&d.substring(0,1)=="_"){var w=$('<div class="lineAttribute"></div>').appendTo(u);var y=$('<div class="firstColumn"></div>');y.appendTo(w);var b=$('<input type="checkbox"/>').appendTo(y).val(d).change(function(){p.show();v.show()});$("<span>").text(d).appendTo(y);f.push(b);var T=this.pieceOfCode[d];var M=o[d];var C=$('<div class="otherColumn"></div>').text(r(T)).appendTo(w);var S=$('<div class="otherColumn"></div>').text(r(M)).appendTo(w);if(JSON.stringify(M)!==JSON.stringify(T))w.css({backgroundColor:"red"});C.css({color:i(T)});S.css({color:i(M)})}}p.on("click touch",function(){for(var e=0,i=f;e<i.length;e++){var r=i[e];var s=r.val();if(r.is(":checked")){o[s]=a.pieceOfCode[s]}}t.indexPage.sendMessageAndWaitForReply(true,{type:"saveOneTest",name:a.pieceOfCode.NAME,configuration:a.getConfiguration(),saved:o},function(e){a.emptyAndRestart()})});v.on("click touch",function(){a.emptyAndRestart()});var x=$('<div class="lineAttribute"></div>').appendTo(h);if(l){v.appendTo(x);p.appendTo(x)}else $('<span style="color: red"></span>').text("only initializer and creator can edit").appendTo(x);return h};return o}();t.InteractiveTestBox=o;var h=function(){function s(){this.$visual=$("<div></div>")}s.prototype.showException=function(e,i,r){var s=$("<div></div>");s.appendTo(this.$visual);var a=$("<div>");a.appendTo(s);var n=r==null?" ":" with this config:"+JSON.stringify(r);$('<span style="color:red"></span>').text(i+": exception"+n).appendTo(a);$('<button class="clickable">').text("details in console").on("click touch",function(){console.log(e)}).appendTo(a);var o=r==null?"see pieceOfCode":"see this configuration";$('<button class="clickable">').text(o).on("click touch",function(){t.indexPage.navigator.goToPartWithSomeConfiguration(i,r)}).appendTo(a)};s.prototype.doAllTest=function(){var i=this;var r=(new Date).getTime();var s=$("<div>");s.appendTo(this.$visual);var n=new e.EmptyMathisFrameForFastTest;e.deconnectViewerForTest=true;var o=new e.StringMap;var h=new e.StringMap;for(var l=0,u=t.indexPage.navigator.idToParts.allKeys();l<u.length;l++){var c=u[l];var m=t.indexPage.navigator.idToParts.getValue(c).pieceOfCode;if(m.NO_TEST!=true){h.putValue(c,true);try{m.goForTheFirstTime()}catch(e){this.showException(e,m.NAME,null)}}}t.indexPage.sendMessageAndWaitForReply(false,{type:"retrieveAllSavedValues"},function(r){var s={countOK:0,countKO:0};var n=function(e){var r=t.indexPage.navigator.idToParts.getValue(e._id);if(r==null){o.putValue(e._id,e.username)}else{var n=r.pieceOfCode;h.putValue(e._id,false);var l=[];for(var u in n){if(u.substring(0,3)=="$$$"){l.push(u.slice(3))}}a(true,e.username,n.NAME,l.sort(),e.configurationAttributes,i.$visual,function(){},function(){},function(){var r=[];for(var o in n){if(o.substring(0,1)=="_")r.push(o)}a(false,e.username,n.NAME,r.sort(),e.savedAttributes,i.$visual,null,function(){},function(){i.whenAttributesCoincide(e,n,s)},$('<button class="clickable"> see the pieceOfCode</button>').on("click touch",function(){t.indexPage.navigator.goToPartWithSomeConfiguration(e._id,null)}))},$('<button class="clickable"> see the pieceOfCode</button>').on("click touch",function(){t.indexPage.navigator.goToPartWithSomeConfiguration(e._id,null)}))}};for(var l=0,u=r.items;l<u.length;l++){var c=u[l];n(c)}e.deconnectViewerForTest=false;$('<div style="border-top: solid 1px black"></div>').text("bilan: test OK:"+s.countOK+" | tests KO:"+s.countKO).prependTo(i.$visual);var m=0;var d=$("<div></div>");var f=function(e){m++;var i=$("<div></div>").text(e+", by:");$('<span style="color: blue">').text(o.getValue(e));i.appendTo(d);if(t.indexPage.identification.canAccess(o.getValue(e))){var r=$('<button class="clickable">suppress from DB</button>').on("click touch",function(){t.indexPage.sendMessageAndWaitForReply(true,{type:"suppressTheWholePieceOfCode",name:e},function(){r.hide()})});r.appendTo(i)}};for(var p=0,v=o.allKeys();p<v.length;p++){var g=v[p];f(g)}if(m>0){var w=$('<div style="border-top: solid 1px black;margin-top:1em"></div>').text(m+" pieceOfCode was registered in DB, but no such pieceOfCode in JS").appendTo(i.$visual);w.append(d)}var y=0;var b=$("<div></div>");var T=function(e){if(h.getValue(e)){y++;var i=$("<div></div>").text(e);i.appendTo(b);$('<button class="clickable"> see the pieceOfCode</button>').on("click touch",function(){t.indexPage.navigator.goToPartWithSomeConfiguration(e,null)}).appendTo(i)}};for(var M=0,C=h.allKeys();M<C.length;M++){var g=C[M];T(g)}if(y>0){var S=$('<div style="border-top:solid 1px black;margin-top:1em"></div>').text(y+" pieceOfCode was in JS, but no corresponding tests in DB").appendTo(i.$visual);S.append(b)}});var d=(new Date).getTime()-r;s.text("duration in millis:"+d)};s.prototype.whenAttributesCoincide=function(e,s,a){var n=function(n){if(n.substring(0,3)=="ZZZ"){var h=e[n];for(var l in h.configuration){s[l]=h.configuration[l]}try{s.goForTheFirstTime();var u=0;for(var l in s){if(l.substring(0,1)=="_"){if(JSON.stringify(s[l])===JSON.stringify(h.saved[l]))a.countOK++;else{a.countKO++;u++;if(u==1){var c=$('<div style="border-top: dashed 1px black"></div>');c.appendTo(o.$visual);$('<span style="color:red"></span>').text(e._id).appendTo(c);$('<span style="color:blue"></span>').text(" by "+e.username+" and "+h.username).appendTo(c);$("<span></span>").text(", config:"+JSON.stringify(h.configuration)).appendTo(c)}var m=$("<div></div>").appendTo(o.$visual);$("<span></span>").text(l+" -> DB:").appendTo(m);$("<span></span>").text(r(h.saved[l])).css({color:i(h.saved[l])}).appendTo(m);$("<span></span>").text(" JS:").appendTo(m);$("<span></span>").text(r(s[l])).css({color:i(s[l])}).appendTo(m)}}}if(u>0){var c=$("<div></div>");c.appendTo(o.$visual);$('<button class="clickable"> go to see this config</button>').on("click touch",function(){t.indexPage.navigator.goToPartWithSomeConfiguration(e._id,h.configuration)}).appendTo(c)}}catch(t){o.showException(t,e._id,h.configuration)}}};var o=this;for(var h in e){n(h)}};return s}();t.DoAllTestAndShowProblems=h})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function i(i){var r=this;this.mathisFrame=i;this.NAME="InfiniteWordOnIndex";this.nameOfResau3d=e.infiniteWorlds.NameOfReseau3D.cube;this.$$$nameOfResau3d=new t.Choices(e.allIntegerValueOfEnume(e.infiniteWorlds.NameOfReseau3D),{visualValues:e.allStringValueOfEnume(e.infiniteWorlds.NameOfReseau3D)});this.seeFromInside=true;this.$$$seeFromInside=new t.Choices([true,false],{before:"view from:",visualValues:["inside","outside"],onchange:function(){r.go2()}})}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.infinite=new e.infiniteWorlds.InfiniteCartesian(this.mathisFrame);this.infinite.buildLightCameraSkyboxAndFog=true;this.common()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false,false);this.infinite.buildLightCameraSkyboxAndFog=false;this.common()};i.prototype.common=function(){this.infinite.nameOfResau3d=this.nameOfResau3d;this.infinite.go()};i.prototype.go2=function(){if(this.seeFromInside)this.infinite.seeWorldFromInside();else this.infinite.seeWorldFromOutside()};return i}();t.InfiniteWordOnIndex=i;var r=function(){function i(e){this.mathisFrame=e;this.NAME="IsingOnIndex";this.beta=.5;this.$$$beta=new t.Choices([0,.5,1,3],{before:"repulsion force:"});this.q=1;this.$$$q=new t.Choices([.1,.5,1,3],{before:"density:"});this.nbDicho=4;this.$$$nbDicho=new t.Choices([2,3,4],{before:"nb particles:"})}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();var t=new e.mecaStat.IsingOnMesh(this.mathisFrame);t.defineLightAndCamera=true;this.common(t)};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.mecaStat.IsingOnMesh(this.mathisFrame);t.defineLightAndCamera=false;this.common(t)};i.prototype.common=function(e){e.beta=this.beta;e.q=this.q;e.nbDicho=this.nbDicho;e.go()};return i}();t.IsingOnIndex=r;var s=function(){function i(e){this.mathisFrame=e;this.NAME="DifferentialOnIndex";this.vectorField=2;this.$$$vectorField=new t.Choices([0,1,2],{label:"vector field:"});this.noiseIntensity=0;this.$$$noiseIntensity=new t.Choices([0,.01,.02,.05,.1],{onchange:this.changeNoise,label:"noise"})}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.common(true)};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);this.common(false)};i.prototype.changeNoise=function(){var e=this;if(this.diffsyst!=null){this.diffsyst.vectorFieldForNoise=function(t,i,r){r.copyFromFloats(e.noiseIntensity,e.noiseIntensity,0)};this.diffsyst.loadVectorFields()}};i.prototype.common=function(t){var i=this;var r;{var s=function(e){return.4*Math.sin(.5*e)};var a=function(e){return.2*Math.sin(.5*e)};var n=function(e){return 0};var o=function(e){return 0};var h=function(e){return 0};var l=function(e){return 0};r=function(e,t,i){var r=(t.x-.5)*2;var u=(t.y-.5)*4;i.x=-r*u*u;i.y=-r*r*u;i.x+=t.x*(s(e)+n(e)*t.x+o(e)*t.y);i.y+=t.y*(a(e)+h(e)*t.x+l(e)*t.y)}}var u;{var c=function(e){return.4*Math.sin(e)};var m=function(e){return.2*Math.sin(.5*e)};var d=function(e){return.1*Math.sin(e)};var f=function(e){return-.1*Math.sin(e)};var p=function(e){return-.1*Math.sin(e)};var v=function(e){return.1*Math.sin(e)};u=function(e,t,i){var r=(t.x-.5)*2;var s=(t.y-.5)*4;i.x=-r*s*s;i.y=-r*r*s;i.x+=t.x*(c(e)+d(e)*t.x+f(e)*t.y);i.y+=t.y*(m(e)+p(e)*t.x+v(e)*t.y)}}var g;{var w=function(e){return.4*Math.sin(.5*e)};var y=function(e){return.2*Math.sin(.3*e)};var b=function(e){return 0};var T=function(e){return 0};var M=function(e){return 0};var C=function(e){return.1*Math.sin(e)};g=function(e,t,i){var r=(t.x-.5)*2;var s=(t.y-.5)*4;i.x=-r*s*s;i.y=-r*r*s;i.x+=t.x*(w(e)+b(e)*t.x+T(e)*t.y);i.y+=t.y*(y(e)+M(e)*t.x+C(e)*t.y)}}var S;if(this.vectorField==0)S=r;else if(this.vectorField==1)S=u;else if(this.vectorField==2)S=g;var x=function(e,t,r){r.copyFromFloats(i.noiseIntensity,i.noiseIntensity,0)};this.diffsyst=new e.differentialSystem.TwoDim(S,this.mathisFrame);this.diffsyst.originView=new e.XYZ(-1,-1,0);this.diffsyst.endView=new e.XYZ(1,1,0);this.diffsyst.vectorFieldForNoise=x;this.diffsyst.makeLightAndCamera=t;this.diffsyst.go()};return i}();t.DifferentialOnIndex=s;var a=function(){function i(e){this.mathisFrame=e;this.NAME="FractalOnIndex";this.alpha=1.2;this.$$$alpha=new t.Choices([.8,1,1.2,1.5,1.7,1.9],{label:"alpha"});this.beta=0;this.$$$beta=new t.Choices([-1,-.7,-.5,-.2,0,.2,.5,.7,1],{label:"beta"});this.nbDicho=4;this.$$$nbDicho=new t.Choices([2,3,4,5],{label:"nb dichotomy"});this.showLine=false;this.$$$showLine=new t.Choices([true,false],{label:"showLines:"});this.shape="plan";this.$$$shape=new t.Choices(["sphere","plan"],{label:"shape:"})}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.mathisFrame.getGrabberCamera().changePosition(new e.XYZ(0,0,-7));this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t;if(this.shape=="sphere"){var i=new e.creation3D.Polyhedron(e.creation3D.PolyhedronType.Dodecahedron);t=i.go()}else{var r=new e.reseau.BasisForRegularReseau;r.squareMailleInsteadOfTriangle=false;r.origin=new e.XYZ(-1,-1,0);r.end=new e.XYZ(1,1,0);r.nbI=4;r.nbJ=4;var i=new e.reseau.Regular(r);t=i.go()}for(var s=0;s<this.nbDicho;s++)new e.mameshModification.TriangleDichotomer(t).go();if(this.shape=="sphere")for(var a=0,n=t.vertices;a<n.length;a++){var o=n[a];o.position.normalize()}var h=new e.fractal.StableRandomFractal(t);h.referenceDistanceBetweenVertexWithZeroDichoLevel=.005;h.alpha=this.alpha;h.beta=this.beta;h.deformationFromCenterVersusFromDirection=this.shape=="sphere";h.go();if(this.shape=="plan"){var l=new e.Positioning;l.upVector=new e.XYZ(0,0,1);l.applyToVertices(t.vertices)}var u=new e.visu3d.SurfaceViewer(t,this.mathisFrame.scene);u.alpha=1;u.sideOrientation=BABYLON.Mesh.DOUBLESIDE;u.go();if(this.showLine){var c=new e.visu3d.LinesViewer(t,this.mathisFrame.scene);c.interpolationOption.interpolationStyle=e.geometry.InterpolationStyle.none;c.isThin=true;c.color=e.color.thema.defaultLinkColor;c.go()}};return i}();t.FractalOnIndex=a;var n=function(){function e(e){this.mathisFrame=e;this.NAME="SeveralDemo";this.demoChoice=4;this.$$$demoChoice=new t.Choices([0,1,2,3,4],{visualValues:["infinite world","ising model","2d differential","alpha fractal","spacial random graph"]})}e.prototype.goForTheFirstTime=function(){this.go()};e.prototype.go=function(){var e;if(this.demoChoice==0)e=new i(this.mathisFrame);else if(this.demoChoice==1)e=new r(this.mathisFrame);else if(this.demoChoice==2)e=new s(this.mathisFrame);else if(this.demoChoice==3)e=new a(this.mathisFrame);else throw"boum";t.indexPage.eventManager.fireEvent(new t.Event("changeDemo",e.NAME));var n=new t.Binder(e,this.mathisFrame.subWindow_NW.$visual,this.mathisFrame);n.pushState=false;n.selectAndAroundClassName="spanForDemoSelects";n.go();e.goForTheFirstTime()};return e}();t.SeveralDemo=n;function o(e){var i=new n(e);var r=new t.Binder(i,$("#demoChoice"),this.mathisFrame);r.pushState=false;r.go();i.goForTheFirstTime()}t.startDemo=o})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="Mameshes, vertices, links and lines";var i=new t.SeveralParts;i.addPart(new r(this.mathisFrame));i.addPart(new s(this.mathisFrame));i.addPart(new a(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.BasicDocu=i;var r=function(){function i(e){this.mathisFrame=e;this.NAME="SimpleMamesh";this.TITLE="A simple Mamesh with polygons and links";this.link=true;this.$$$link=new t.Choices([true,false]);this._nbLinks=0;this.mathisFrame=e}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();var t=this.mathisFrame.getGrabberCamera();t.changePosition(new e.XYZ(0,0,-5));this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=this.link;var i=(new e.Vertex).setPosition(-1,-1,0);var r=(new e.Vertex).setPosition(-1,1,0);var s=(new e.Vertex).setPosition(0,1.5,0);var a=(new e.Vertex).setPosition(0,-.5,0);var n=(new e.Vertex).setPosition(1,-1,0);var o=(new e.Vertex).setPosition(1,1,0);var h=new e.Mamesh;h.vertices.push(i,r,s,a,n,o);h.addATriangle(i,s,r).addATriangle(i,a,s);h.addASquare(s,a,n,o);if(t){h.addSimpleLinksAroundPolygons()}var l=new e.visu3d.VerticesViewer(h,this.mathisFrame.scene);l.go();var u=new e.visu3d.LinksViewer(h,this.mathisFrame.scene);u.go();var c=new e.visu3d.SurfaceViewer(h,this.mathisFrame.scene);c.go();var m=0;for(var d=0,f=h.vertices;d<f.length;d++){var p=f[d];m+=p.links.length}this._nbLinks=m};return i}();var s=function(){function i(e){this.mathisFrame=e;this.NAME="SimpleMameshLine";this.TITLE="the same mamesh, but we also add lines";this.link=true;this.$$$link=new t.Choices([true,false]);this._nbLines=0;this.mathisFrame=e}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();var t=this.mathisFrame.getGrabberCamera();t.changePosition(new e.XYZ(0,0,-5));this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=(new e.Vertex).setPosition(-1,-1,0);var i=(new e.Vertex).setPosition(-1,1,0);var r=(new e.Vertex).setPosition(0,1.5,0);var s=(new e.Vertex).setPosition(0,-.5,0);var a=(new e.Vertex).setPosition(1,-1,0);var n=(new e.Vertex).setPosition(1,1,0);var o=new e.Mamesh;o.vertices.push(t,i,r,s,a,n);o.addATriangle(t,r,i).addATriangle(t,s,r);o.addASquare(r,s,a,n);var h=this.link;if(h){o.addOppositeLinksAroundPolygons()}else{o.addSimpleLinksAroundPolygons()}var l=new e.visu3d.VerticesViewer(o,this.mathisFrame.scene);l.go();if(h){new e.spacialTransformations.Similitude(o.vertices,.001).goChanging();var u=new e.visu3d.LinesViewer(o,this.mathisFrame.scene);u.go()}else{var c=new e.visu3d.LinksViewer(o,this.mathisFrame.scene);c.go()}var m=new e.visu3d.SurfaceViewer(o,this.mathisFrame.scene);m.go();o.fillLineCatalogue();this._nbLines=o.lines.length};return i}();var a=function(){function i(i){this.mathisFrame=i;this.NAME="LineDocu";this.TITLE="Defining lines joining vertices";this.makeLoop=false;this.$$$makeLoop=new t.Choices([true,false]);this.nb=9;this.$$$nb=new t.Choices([5,7,9,15]);this.interpolationStyle=e.geometry.InterpolationStyle.octavioStyle;this.$$$interpolationStyle=new t.Choices(e.allIntegerValueOfEnume(e.geometry.InterpolationStyle),{before:"geometry.InterpolationStyle.",visualValues:e.allStringValueOfEnume(e.geometry.InterpolationStyle)});this._nbLoopLines=0;this._nbStraightLines=0}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=this.makeLoop;var i=this.interpolationStyle;var r=this.nb;var s=new e.Mamesh;for(var a=0;a<r;a++){var n=new e.Vertex;var o=2*Math.PI*a/r;n.position=new e.XYZ(Math.cos(o),Math.sin(o),0);s.vertices.push(n)}for(var a=1;a<r-1;a++){s.vertices[a].setTwoOppositeLinks(s.vertices[a-1],s.vertices[a+1])}if(t){s.vertices[0].setTwoOppositeLinks(s.vertices[1],s.vertices[r-1]);s.vertices[r-1].setTwoOppositeLinks(s.vertices[r-2],s.vertices[0])}else{s.vertices[0].setOneLink(s.vertices[1]);s.vertices[r-1].setOneLink(s.vertices[r-2])}var h=new e.visu3d.LinesViewer(s,this.mathisFrame.scene);h.interpolationOption.interpolationStyle=i;h.interpolationOption.loopLine=t;h.go();new e.visu3d.VerticesViewer(s,this.mathisFrame.scene).go();this._nbLoopLines=0;this._nbStraightLines=0;for(var l=0,u=s.lines;l<u.length;l++){var c=u[l];if(c.isLoop)this._nbLoopLines++;else this._nbStraightLines++}};return i}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="Dichotomy";var i=new t.SeveralParts;i.addPart(new r(this.mathisFrame));i.addPart(new s(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.DichoDocu=i;var r=function(){function t(e){this.mathisFrame=e;this.NAME="ReseauDicho";this.TITLE="we do dichotomy on some square or triangle net";this.nbTrianglesCut=2;this.$$$nbTrianglesCut=[1,2,3,4,5,10,16,32,50];this.squareVersusTriangle=true;this.$$$squareVersusTriangle=[true,false];this.nbInitialDicho=1;this.$$$nbInitialDicho=[0,1,2,3,4];this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=this.squareVersusTriangle;var i=new e.reseau.Regular;i.nbI=3;i.nbJ=3;i.origine=new e.XYZ(-1,-1,0);i.squareVersusTriangleMaille=t;var r=i.go();var s=this.nbInitialDicho;for(var a=0;a<s;a++){var n=void 0;if(t)n=new e.mameshModification.SquareDichotomer(r);else n=new e.mameshModification.TriangleDichotomer(r);n.go()}var o=this.nbTrianglesCut;var h;if(t){h=new e.mameshModification.SquareDichotomer(r);h.squareToCut=r.smallestSquares.slice(0,4*o)}else{h=new e.mameshModification.TriangleDichotomer(r);h.trianglesToCut=r.smallestTriangles.slice(0,3*o)}h.go();var l=[];for(var a=0;a<r.vertices.length;a++){var u=r.vertices[a];var c=u.dichoLevel;if(l[c]==null)l[c]=[];l[c].push(u)}var m=l.length;var d=[e.Color.names.black,e.Color.names.whitesmoke,e.Color.names.blue,e.Color.names.red,e.Color.names.orange,e.Color.names.violet,e.Color.names.beige];for(var c=0;c<m;c++){var f=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);f.color=new e.Color(d[c]);f.vertices=l[c];f.go()}new e.visu3d.LinksViewer(r,this.mathisFrame.scene).go();new e.visu3d.SurfaceViewer(r,this.mathisFrame.scene).go();this._nbSquares=r.smallestSquares.length/4;this._nbTriangles=r.smallestTriangles.length/3};return t}();var s=function(){function i(i){this.mathisFrame=i;this.NAME="SolideDicho";this.TITLE="we do dichotomy on some solid";this.polyhedronType=e.creation3D.PolyhedronType.Dodecahedron;this.$$$polyhedronType=new t.Choices(e.allIntegerValueOfEnume(e.creation3D.PolyhedronType),{visualValues:e.allStringValueOfEnume(e.creation3D.PolyhedronType)});this.nbInitialDicho=1;this.$$$nbInitialDicho=[0,1,2,3,4];this.mathisFrame=i}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.creation3D.Polyhedron(this.polyhedronType);var i=t.go();var r=this.nbInitialDicho;for(var s=0;s<r;s++){if(i.smallestTriangles.length>0)new e.mameshModification.TriangleDichotomer(i).go()}var a=[];for(var s=0;s<i.vertices.length;s++){var n=i.vertices[s];var o=n.dichoLevel;if(a[o]==null)a[o]=[];a[o].push(n)}var h=a.length;var l=[e.Color.names.black,e.Color.names.whitesmoke,e.Color.names.blue,e.Color.names.red,e.Color.names.orange,e.Color.names.violet,e.Color.names.beige];for(var o=0;o<h;o++){var u=new e.visu3d.VerticesViewer(i,this.mathisFrame.scene);u.color=new e.Color(l[o]);u.vertices=a[o];u.go()}new e.visu3d.LinksViewer(i,this.mathisFrame.scene).go();new e.visu3d.SurfaceViewer(i,this.mathisFrame.scene).go()};return i}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="Distances, geodesics and connectivity in graphs";var i=new t.SeveralParts;i.addPart(new r(this.mathisFrame));i.addPart(new s(this.mathisFrame));i.addPart(new n(this.mathisFrame));i.addPart(new o(this.mathisFrame));i.addPart(new a(this.mathisFrame));i.addPart(new h(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.GraphDistance=i;var r=function(){function t(e){this.mathisFrame=e;this.NAME="GeodesicDocu";this.TITLE="Compute distances and geodesics between vertices";this.nbSides=4;this.$$$nbSides=[4,6,8,10];this.nbSubdivisionInARadius=7;this.$$$nbSubdivisionInARadius=[3,5,7,9,11];this.randomSeed=38434;this.$$$randomSeed=[38434,984651,3481,9846513,684123];this.onlyOneGeodesic=false;this.$$$onlyOneGeodesic=[true,false];this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=this.mathisFrame;var i=new e.reseau.TriangulatedPolygone(this.nbSides);i.origin=new e.XYZ(-1,-1,0);i.end=new e.XYZ(1,1,0);i.nbSubdivisionInARadius=this.nbSubdivisionInARadius;var r=i.go();var s=new e.graph.DistancesBetweenAllVertices(r.vertices);s.go();var a=new e.proba.Random(this.randomSeed);var n=r.vertices[a.pseudoRandInt(r.vertices.length)];var o=r.vertices[a.pseudoRandInt(r.vertices.length)];t.messageDiv.append("distance between vertex0 and vertex1:"+s.OUT_distance(n,o));t.messageDiv.append("graph diameter:"+s.OUT_diameter);var h=this.onlyOneGeodesic;var l=s.OUT_allGeodesics(n,o,h);for(var u=0;u<l.length;u++){var c=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);c.vertices=l[u];c.color=new e.Color(new e.HSV_01(u/l.length*.7,1,1));c.go()}new e.visu3d.LinksViewer(r,this.mathisFrame.scene).go();this._graphDiameter=s.OUT_diameter;this._distanceBetweenSelectedVertices=s.OUT_distance(n,o);this._nbVerticesInSelectedGeodesics=0;for(var m=0;m<l.length;m++){this._nbVerticesInSelectedGeodesics+=l[m].length}};return t}();var s=function(){function t(e){this.mathisFrame=e;this.NAME="GeodesicGroupDocu";this.TITLE="Compute distances and geodesics from a set of vertices";this.nbSides=4;this.$$$nbSides=[4,6,8,10];this.nbSubdivisionInARadius=7;this.$$$nbSubdivisionInARadius=[3,5,7,9,11];this.onlyOneGeodesic=false;this.$$$onlyOneGeodesic=[true,false];this.left=-.3;this.$$$left=[-.9,-.7,-.5,-.3,-.1];this.right=.3;this.$$$right=[.1,.3,.5,.7,.9];this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=this.mathisFrame;var i=new e.reseau.TriangulatedPolygone(this.nbSides);i.origin=new e.XYZ(-1,-1,0);i.end=new e.XYZ(1,1,0);i.nbSubdivisionInARadius=this.nbSubdivisionInARadius;var r=i.go();var s=[];var a;for(var n=0;n<r.vertices.length;n++){var o=r.vertices[n];if(o.position.x<this.left)s.push(o);if(o.position.x>this.right)a=o}var h=new e.graph.DistancesFromAGroup(s);h.go();t.messageDiv.append("distance between vertex and group:"+h.OUT_distance(a));var l=this.onlyOneGeodesic;var u=h.OUT_allGeodesics(a,l);for(var c=0;c<u.length;c++){var m=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);m.vertices=u[c];m.color=new e.Color(new e.HSV_01(c/u.length*.7,1,1));m.go()}var d=new e.visu3d.LinksViewer(r,this.mathisFrame.scene);d.segmentOrientationFunction=function(e,t){if(s.indexOf(e)!=-1&&s.indexOf(t)!=-1)return 1;else return 0};d.color=new e.Color(e.Color.names.red);d.lateralScalingProp=.08;d.go();new e.visu3d.LinksViewer(r,this.mathisFrame.scene).go();this._distance=u.length-1;this._nbVerticesInSelectedGeodesics=0;for(var f=0;f<u.length;f++){this._nbVerticesInSelectedGeodesics+=u[f].length}};return t}();var a=function(){function t(e){this.mathisFrame=e;this.NAME="DiameterDocu";this.TITLE="Two methods to find the diameter of polygones. 1/ compute all distances between vertices which is long.\n            2/ an heuristic iterative method. Be aware : If the graph is non-connected, this second method only look at the component of the first vertex.\n            But if the graph is connected, it is hard to find a counter-example where the second method fails. \n            You can see such counter-example by fitting 4/9/0.3 as the three first parameters. ";this.nbSides=4;this.$$$nbSides=[4,6,8,10];this.nbSubdivisionInARadius=2;this.$$$nbSubdivisionInARadius=[2,3,5,7,9,11];this.percolationProba=.5;this.$$$percolationProba=[.2,.3,.4,.5,.6,.7,.8];this.methodChoice=true;this.$$$methodChoice=[true,false];this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=this.mathisFrame;var i=new e.reseau.TriangulatedPolygone(this.nbSides);i.origin=new e.XYZ(-1,-1,0);i.end=new e.XYZ(1,1,0);i.nbSubdivisionInARadius=this.nbSubdivisionInARadius;var r=i.go();var s=new e.proba.Random;for(var a=0;a<r.vertices.length;a++){var n=r.vertices[a];for(var o=0;o<n.links.length;o++){if(s.pseudoRand()<this.percolationProba)e.Vertex.separateTwoVoisins(n,n.links[o].to)}}var h;var l;var u=window.performance.now();var c;if(this.methodChoice){var m=new e.graph.DistancesBetweenAllVertices(r.vertices);m.go();c=window.performance.now()-u;h=m.OUT_diameter;l=m.OUT_allExtremeVertex}else{var d=new e.graph.HeuristicDiameter(r.vertices);h=d.go();c=window.performance.now()-u;l=d.OUT_twoChosenExtremeVertices}t.messageDiv.append("diameter:"+h+", computed in:"+c+" ms");var f=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);f.vertices=l;f.color=new e.Color(e.Color.names.indianred);f.go();new e.visu3d.LinksViewer(r,this.mathisFrame.scene).go()};return t}();var n=function(){function i(i){this.mathisFrame=i;this.NAME="CornerBorderCenterForPolygone";this.TITLE="find some marked vertices and their Neighbors ";this.nbSides=6;this.$$$nbSides=[4,6,8,10];this.nbSubdivisionInARadius=5;this.$$$nbSubdivisionInARadius=[3,5,7,9,11];this.marker=e.Vertex.Markers.border;this.$$$marker=new t.Choices([e.Vertex.Markers.border,e.Vertex.Markers.corner,e.Vertex.Markers.center],{before:"Vertex.Markers.",visualValues:["border","corner","center"]});this.justOneTime=true;this.$$$justOneTime=[true,false];this.polygoneVersusReseau=true;this.$$$polygoneVersusReseau=[true,false];this.squareVersusTriangleMaille=false;this.$$$squareVersusTriangleMaille=[true,false];this.nbI=7;this.$$$nbI=[3,7,15,30];this.mathisFrame=i}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t;if(this.polygoneVersusReseau){t=new e.reseau.TriangulatedPolygone(this.nbSides);t.origin=new e.XYZ(-1,-1,0);t.end=new e.XYZ(1,1,0);t.nbSubdivisionInARadius=this.nbSubdivisionInARadius}else{var i=new e.reseau.BasisForRegularReseau;i.origin=new e.XYZ(-1,-1,0);i.end=new e.XYZ(1,1,0);i.nbI=this.nbI;i.set_nbJ_toHaveRegularReseau=true;i.squareMailleInsteadOfTriangle=this.squareVersusTriangleMaille;t=new e.reseau.Regular(i)}var r=t.go();var s=[];for(var a=0;a<r.vertices.length;a++){var n=r.vertices[a];if(n.hasMark(this.marker))s.push(n)}var o=[];o.push(s);if(this.justOneTime){o.push(e.graph.getEdge(s))}else{var h=new e.HashMap;var l=s;while(l.length>0){l=e.graph.getEdge(l,h);o.push(l)}}for(var u=0;u<o.length;u++){var c=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);c.vertices=o[u];c.color=new e.Color(u);c.go()}new e.visu3d.LinksViewer(r,this.mathisFrame.scene).go();this._strateLengths=[];for(var m=0;m<o.length;m++){this._strateLengths[m]=o[m].length}};return i}();var o=function(){function i(i){this.mathisFrame=i;this.NAME="TwoGraphDistances";this.TITLE="For reseaux with squares, considering or not considering the diagonals lead to two different notions of distances : ";this.useDiago=true;this.$$$useDiago=[true,false];this.marker=e.Vertex.Markers.center;this.$$$marker=new t.Choices([e.Vertex.Markers.border,e.Vertex.Markers.corner,e.Vertex.Markers.center],{before:"Vertex.Markers.",visualValues:["border","corner","center"]});this.nbI=7;this.$$$nbI=[3,7,15,30];this.justOneTime=true;this.$$$justOneTime=[true,false];this.mathisFrame=i}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.BasisForRegularReseau;t.origin=new e.XYZ(-1,-1,0);t.end=new e.XYZ(1,1,0);t.nbI=this.nbI;t.set_nbJ_toHaveRegularReseau=true;var i=new e.reseau.Regular(t);var r=i.go();var s=this.useDiago;var a=[];for(var n=0;n<r.vertices.length;n++){var o=r.vertices[n];if(o.hasMark(this.marker))a.push(o)}var h=[];h.push(a);if(this.justOneTime){if(s)h.push(e.graph.getEdgeConsideringAlsoDiagonalVoisin(a));else h.push(e.graph.getEdge(a))}else{var l=new e.HashMap;var u=a;while(u.length>0){if(s)u=e.graph.getEdgeConsideringAlsoDiagonalVoisin(u,l);else u=e.graph.getEdge(u,l);h.push(u)}}for(var c=0;c<h.length;c++){var m=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);m.vertices=h[c];m.color=new e.Color(c);m.go()}new e.visu3d.LinksViewer(r,this.mathisFrame.scene).go();this._strateLengths=[];for(var d=0;d<h.length;d++){this._strateLengths[d]=h[d].length}console.log(this._strateLengths)};return i}();var h=function(){function t(e){this.mathisFrame=e;this.NAME="PercoForReseau";this.TITLE="get a connected component ";this.squareVersusTriangleMaille=false;this.$$$squareVersusTriangleMaille=[true,false];this.nbI=7;this.$$$nbI=[3,7,15,30];this.probaToKeep=.5;this.$$$probaToKeep=[0,.4,.45,.5,.55,.6,.8,1];this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.BasisForRegularReseau;t.origin=new e.XYZ(-1,-1,0);t.end=new e.XYZ(1,1,0);t.nbI=this.nbI;t.set_nbJ_toHaveRegularReseau=true;t.squareMailleInsteadOfTriangle=this.squareVersusTriangleMaille;var i=new e.reseau.Regular(t);var r=i.go();var s=this.probaToKeep;var a=new e.HashMap(true);var n=[];for(var o=0;o<r.vertices.length;o++){var h=r.vertices[o];if(Math.random()<s)a.putValue(h,true);if(h.hasMark(e.Vertex.Markers.center)){n.push(h);a.putValue(h,true)}}var l=e.graph.getGroup(n,a);var u=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);u.vertices=l;u.radiusProp=.5;u.go()};return t}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="Grating and gluing";var i=new t.SeveralParts;i.addPart(new a(this.mathisFrame));i.addPart(new r(this.mathisFrame));i.addPart(new s(this.mathisFrame),true);i.addPart(new n(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.GrateMergeStick=i;var r=function(){function t(e){this.mathisFrame=e;this.NAME="GrateMamesh";this.TITLE="When two mameshes overlap (they are concurrent), we could want to grate them to suppress overlapping.  \n            Grating process starts from seeds: each concurrent have some given (or computed) seeds which are keep (and represented here as red bullet). \n            Around these seeds, we compute strates, and we keep their cell, until strates of concurrent overlap";this.nbSides0=6;this.$$$nbSides0=[4,6,8,10];this.nbSides1=6;this.$$$nbSides1=[4,6,8,10];this.nbSubdivisionInARadius0=9;this.$$$nbSubdivisionInARadius0=[3,5,7,9,11];this.nbSubdivisionInARadius1=5;this.$$$nbSubdivisionInARadius1=[3,5,7,9,11];this.grate=true;this.$$$grate=[true,false];this.neighborhoodCoefficient0=.7;this.$$$neighborhoodCoefficient0=[.5,.7,1,2];this.neighborhoodCoefficient1=.7;this.$$$neighborhoodCoefficient1=[.5,.7,1,2];this.proportionOfSeed0=.1;this.$$$proportionOfSeed0=[.01,.1,.3,.5,.7];this.proportionOfSeed1=.1;this.$$$proportionOfSeed1=[.1,.3,.5,.7];this.seedComputedFromBarycentersVersusFromAllPossibleCells=true;this.$$$seedComputedFromBarycentersVersusFromAllPossibleCells=[true,false];this.addAsymetry=false;this.$$$addAsymetry=[true,false];this.asyDirection0=-1;this.$$$asyDirection0=[-1,1];this.asyDirection1=-1;this.$$$asyDirection1=[-1,1];this.asyInfluence0=.5;this.$$$asyInfluence0=[.1,.5,1];this.asyInfluence1=.5;this.$$$asyInfluence1=[.1,.5,1];this.modulo0=null;this.$$$modulo0=[null,1.5,.7];this.modulo1=null;this.$$$modulo1=[null,1.5,.7];this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.TriangulatedPolygone(this.nbSides0);t.origin=new e.XYZ(-1,-1,0);t.end=new e.XYZ(.5,.5,0);t.nbSubdivisionInARadius=this.nbSubdivisionInARadius0;var i=t.go();var r=new e.reseau.TriangulatedPolygone(this.nbSides1);r.origin=new e.XYZ(-.5,-.5,0);r.end=new e.XYZ(1,1,0);r.nbSubdivisionInARadius=this.nbSubdivisionInARadius1;var s=r.go();var a=null;if(this.grate){a=new e.grateAndGlue.GraphGrater;a.IN_graphFamily.push(i.vertices,s.vertices);a.proximityCoefToGrate=[this.neighborhoodCoefficient0,this.neighborhoodCoefficient1];a.seedComputedFromBarycentersVersusFromAllPossibleCells=this.seedComputedFromBarycentersVersusFromAllPossibleCells;a.proportionOfSeeds=[this.proportionOfSeed0,this.proportionOfSeed1];if(this.addAsymetry){a.asymmetriesForSeeds=[{direction:new e.XYZ(this.asyDirection0,0,0),influence:this.asyInfluence0,modulo:this.modulo0},{direction:new e.XYZ(0,this.asyDirection1,0),influence:this.asyInfluence1,modulo:this.modulo1}]}var n=a.go();i=new e.grateAndGlue.SubMameshExtractor(i,n[0]).go();i.isolateMameshVerticesFromExteriorVertices();s=new e.grateAndGlue.SubMameshExtractor(s,n[1]).go();s.isolateMameshVerticesFromExteriorVertices()}if(a!=null){var o=new e.visu3d.VerticesViewer(i,this.mathisFrame.scene);o.vertices=a.OUT_allSeeds[0];o.color=new e.Color(e.Color.names.red);o.go();var h=new e.visu3d.VerticesViewer(s,this.mathisFrame.scene);h.vertices=a.OUT_allSeeds[1];h.color=new e.Color(e.Color.names.red);h.go()}var l=new e.visu3d.LinksViewer(i,this.mathisFrame.scene);l.color=new e.Color(e.Color.names.darkseagreen);l.go();var u=new e.visu3d.LinksViewer(s,this.mathisFrame.scene);u.color=new e.Color(e.Color.names.blueviolet);u.go()};return t}();var s=function(){function t(e){this.mathisFrame=e;this.NAME="GrateMameshConcentric";this.TITLE="Variant with two concentric mameshes";this.nbSides0=6;this.$$$nbSides0=[4,6,8,10];this.nbSides1=6;this.$$$nbSides1=[4,6,8,10];this.nbSubdivisionInARadius0=9;this.$$$nbSubdivisionInARadius0=[3,5,7,9,11];this.nbSubdivisionInARadius1=5;this.$$$nbSubdivisionInARadius1=[3,5,7,9,11];this.grate=true;this.$$$grate=[true,false];this.neighborhoodCoefficient0=.7;this.$$$neighborhoodCoefficient0=[.5,.7,1,2];this.neighborhoodCoefficient1=.7;this.$$$neighborhoodCoefficient1=[.5,.7,1,2];this.proportionOfSeed0=.1;this.$$$proportionOfSeed0=[.1,.3,.5,.7];this.proportionOfSeed1=.1;this.$$$proportionOfSeed1=[.1,.3,.5,.7];this.seedComputedFromBarycentersVersusFromAllPossibleCells=true;this.$$$seedComputedFromBarycentersVersusFromAllPossibleCells=[true,false];this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.TriangulatedPolygone(this.nbSides0);t.origin=new e.XYZ(-1,-1,0);t.end=new e.XYZ(1,1,0);t.nbSubdivisionInARadius=this.nbSubdivisionInARadius0;var i=t.go();var r=new e.reseau.TriangulatedPolygone(this.nbSides1);r.origin=new e.XYZ(-.5,-.5,0);r.end=new e.XYZ(.5,.5,0);r.nbSubdivisionInARadius=this.nbSubdivisionInARadius1;var s=r.go();var a=null;if(this.grate){a=new e.grateAndGlue.GraphGrater;a.IN_graphFamily.push(i.vertices,s.vertices);a.proximityCoefToGrate=[this.neighborhoodCoefficient0,this.neighborhoodCoefficient1];a.seedComputedFromBarycentersVersusFromAllPossibleCells=this.seedComputedFromBarycentersVersusFromAllPossibleCells;a.proportionOfSeeds=[this.proportionOfSeed0,this.proportionOfSeed1];var n=a.go();i=new e.grateAndGlue.SubMameshExtractor(i,n[0]).go();i.isolateMameshVerticesFromExteriorVertices();s=new e.grateAndGlue.SubMameshExtractor(s,n[1]).go();s.isolateMameshVerticesFromExteriorVertices()}if(a!=null){var o=new e.visu3d.VerticesViewer(i,this.mathisFrame.scene);o.vertices=a.OUT_allSeeds[0];o.color=new e.Color(e.Color.names.red);o.go();var h=new e.visu3d.VerticesViewer(s,this.mathisFrame.scene);h.vertices=a.OUT_allSeeds[1];h.color=new e.Color(e.Color.names.red);h.go()}var l=new e.visu3d.LinksViewer(i,this.mathisFrame.scene);l.color=new e.Color(e.Color.names.darkseagreen);l.go();var u=new e.visu3d.LinksViewer(s,this.mathisFrame.scene);u.color=new e.Color(e.Color.names.blueviolet);u.go()};return t}();var a=function(){function t(e){this.mathisFrame=e;this.NAME="GrateGluedMamesh";this.TITLE="When two mameshes overlap (they are concurrent), we could want to grate them and to stick them.  \n            Techniques for grating and Sticking are detail further on.";this.nbSides0=6;this.$$$nbSides0=[4,6,8,10];this.nbSides1=6;this.$$$nbSides1=[4,6,8,10];this.nbSubdivisionInARadius0=9;this.$$$nbSubdivisionInARadius0=[3,5,7,9,11];this.nbSubdivisionInARadius1=5;this.$$$nbSubdivisionInARadius1=[3,5,7,9,11];this.toleranceToBeOneOfTheClosest=.5;this.$$$toleranceToBeOneOfTheClosest=[0,.1,.2,.3,.4,.5,.6,.7];this.proportionOfSeed0=.1;this.$$$proportionOfSeed0=[.1,.3,.5,.7];this.proportionOfSeed1=.1;this.$$$proportionOfSeed1=[.1,.3,.5,.7];this.proximityCoefToStick=2;this.$$$proximityCoefToStick=[1,1.5,2,3];this.suppressLinksAngularlyTooClose=false;this.$$$suppressLinksAngularlyTooClose=[true,false];this.propAngle=.1;this.$$$propAngle=[.01,.05,.1,.2,.3];this.justGrateDoNotStick=false;this.$$$justGrateDoNotStick=[true,false];this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.TriangulatedPolygone(this.nbSides0);t.origin=new e.XYZ(-1,-1,0);t.end=new e.XYZ(.5,.5,0);t.nbSubdivisionInARadius=this.nbSubdivisionInARadius0;var i=t.go();var r=new e.reseau.TriangulatedPolygone(this.nbSides1);r.origin=new e.XYZ(-.5,-.5,0);r.end=new e.XYZ(1,1,0);r.nbSubdivisionInARadius=this.nbSubdivisionInARadius1;var s=r.go();var a=new e.grateAndGlue.ConcurrentMameshesGraterAndSticker;a.IN_mameshes.push(i,s);a.justGrateDoNotStick=this.justGrateDoNotStick;a.SUB_grater.proportionOfSeeds=[this.proportionOfSeed0,this.proportionOfSeed1];a.proximityCoefToStick=[this.proximityCoefToStick];a.toleranceToBeOneOfTheClosest=this.toleranceToBeOneOfTheClosest;a.suppressLinksAngularlyTooClose=this.suppressLinksAngularlyTooClose;a.SUB_linkCleanerByAngle.suppressLinksAngularParam=2*Math.PI*this.propAngle;var n=a.goChanging();var o=new e.visu3d.LinksViewer(n,this.mathisFrame.scene);o.go();var h=new e.visu3d.VerticesViewer(n,this.mathisFrame.scene);h.vertices=a.OUT_stickingMap.allKeys();h.color=new e.Color(e.Color.names.blueviolet);h.go();var l=new e.visu3d.VerticesViewer(n,this.mathisFrame.scene);l.vertices=[];for(var u=0,c=a.OUT_stickingMap.allValues();u<c.length;u++){var m=c[u];l.vertices=l.vertices.concat(m)}l.go()};return t}();var n=function(){function t(e){this.mathisFrame=e;this.NAME="MergeVersusStick";this.TITLE="Merging or Sticking mameshes";this.oneVersusTwoMameshes=false;this.$$$oneVersusTwoMameshes=[true,false];this.toleranceToBeOneOfTheClosest=.05;this.$$$toleranceToBeOneOfTheClosest=[0,.05,.1,.2,.5,1,1.5,2];this.suppressLinksAngularlyTooClose=false;this.$$$suppressLinksAngularlyTooClose=[true,false];this.stickOrMerge=true;this.$$$stickOrMerge=[true,false];this.proximityCoef=1.2;this.$$$proximityCoef=[.2,.5,.8,1,1.2,1.5,2,3];this.angle=.01;this.$$$angle=[0,.005,.01,.02,.05];this.slow=true;this.$$$slow=[true,false];this.resolution=10;this.$$$resolution=[5,10,15,20];this.hole=.97;this.$$$hole=[.8,.9,.95,.97,.99,1];this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=this.oneVersusTwoMameshes;var i=[];var r=[];var s;var a;if(t){var n=new e.reseau.BasisForRegularReseau;n.origin=new e.XYZ(0,-.7,0);n.end=new e.XYZ(2*Math.PI,.7,0);n.nbI=20;n.nbJ=10;n.nbHorizontalDecays=2;s=new e.reseau.Regular(n).go();a=s;for(var o=0,h=s.vertices;o<h.length;o++){var l=h[o];if(l.param.x==0)i.push(l);else if(l.param.x==n.nbI-1)r.push(l)}for(var u=0;u<s.vertices.length;u++){var c=s.vertices[u].position;var m=c.x*this.hole;c.x=Math.cos(m-Math.PI/2);c.z=Math.sin(m-Math.PI/2)}}else{var d=new e.reseau.BasisForRegularReseau;d.origin=new e.XYZ(-1,-.9,0);d.end=new e.XYZ(-.05,1.1,0);d.nbI=5;d.nbJ=10;s=new e.reseau.Regular(d).go();var f=new e.reseau.BasisForRegularReseau;f.origin=new e.XYZ(.05,-1,0);f.end=new e.XYZ(1,1,0);f.nbI=5;f.nbJ=10;a=new e.reseau.Regular(f).go();i=s.vertices;r=a.vertices;new e.spacialTransformations.Similitude(a.vertices,2*Math.PI*this.angle).goChanging()}var p;if(this.slow){var v=new e.grateAndGlue.FindSickingMapFromVertices(i,r);v.proximityCoef=this.proximityCoef;v.toleranceToBeOneOfTheClosest=this.toleranceToBeOneOfTheClosest;p=v.go()}else{var v=new e.grateAndGlue.FindCloseVerticesFast(i,r);v.nbDistinctPoint=this.resolution;p=v.go()}if(this.stickOrMerge){var g=new e.grateAndGlue.Sticker(s,a,p);g.goChanging()}else{var w=new e.grateAndGlue.Merger(s,a,p);w.goChanging()}if(this.suppressLinksAngularlyTooClose){new e.linkModule.LinksSorterAndCleanerByAngles(s).goChanging()}var y=new e.visu3d.LinksViewer(s,this.mathisFrame.scene);y.go();new e.visu3d.SurfaceViewer(s,this.mathisFrame.scene).go()};return t}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="Lines viewing";var i=new t.SeveralParts;i.addPart(new o(this.mathisFrame));i.addPart(new r(this.mathisFrame));i.addPart(new h(this.mathisFrame));i.addPart(new l(this.mathisFrame));i.addComment("The lineViewer call the method mamesh.fillLineCatalogue() which compute\n                   all lines passing throw vertices of the mamesh. But you can decide to fill the catalogue before\n                   to call the viewer, and to not add all the lines. Here is some examples.","The lineViewer call the method mamesh");i.addPart(new s(this.mathisFrame));i.addPart(new a(this.mathisFrame),true);i.addPart(new n(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.LinesViewingDocu=i;var r=function(){function i(i){this.mathisFrame=i;this.NO_TEST=true;this.NAME="JustTheSizeOfLines";this.TITLE="We change radius and interpolation style";this.nbSides=4;this.$$$nbSides=[4,7,10];this.nbSubdivisionInARadius=3;this.$$$nbSubdivisionInARadius=[2,3,5];this.radiusProp=.05;this.$$$radiusProp=[.01,.05,.1];this.constantRadius=null;this.$$$constantRadius=[null,.01,.02,.05];this.isThin=false;this.$$$isThin=[true,false];this.radiusFunction=null;this.$$$radiusFunction=[null,function(e,t){return.02*Math.sin(2*Math.PI*t)}];this.interpolationStyle=e.geometry.InterpolationStyle.octavioStyle;this.$$$interpolationStyle=new t.Choices(e.allIntegerValueOfEnume(e.geometry.InterpolationStyle),{before:"geometry.InterpolationStyle.",visualValues:e.allStringValueOfEnume(e.geometry.InterpolationStyle)})}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.TriangulatedPolygone(this.nbSides);t.nbSubdivisionInARadius=this.nbSubdivisionInARadius;var i=t.go();var r=new e.visu3d.LinesViewer(i,this.mathisFrame.scene);r.interpolationOption.interpolationStyle=this.interpolationStyle;r.isThin=this.isThin;r.radiusFunction=this.radiusFunction;r.constantRadius=this.constantRadius;r.radiusProp=this.radiusProp;r.go();var s=new e.visu3d.VerticesViewer(i,this.mathisFrame.scene);s.radiusProp=.1;s.go()};return i}();var s=function(){function t(e){this.mathisFrame=e;this.NAME="DoNotDrawAllTheLines";this.TITLE="We construct only the lines starting from selected vertices.";this.nbI=10;this.$$$nbI=[5,10,12,15,20];this.selectionChoice=0;this.$$$selectionChoice=[0,1,2]}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.BasisForRegularReseau;t.nbI=this.nbI;t.nbJ=t.nbI;t.origin=new e.XYZ(-.7,-.7,0);t.end=new e.XYZ(+.7,+.7,0);var i=new e.reseau.Regular(t);var r=i.go();var s=new e.lineModule.LineComputer(r);s.startingVertices=[];var a=this.selectionChoice;for(var n=0;n<r.vertices.length;n++){var o=r.vertices[n];if(a==0){if(o.param.x%3==0&&o.param.y==0)s.startingVertices.push(o)}else if(a==1){if(o.param.x%3==0&&o.param.y==0)s.startingVertices.push(o);if(o.param.x==0&&o.param.y%3==0)s.startingVertices.push(o)}else if(a==2){if(o.position.length()<.15)s.startingVertices.push(o)}}r.lines=s.go();var h=new e.visu3d.LinesViewer(r,this.mathisFrame.scene);h.go();var l=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);l.radiusProp=.1;l.go();this._nbLines=r.lines.length};return t}();var a=function(){function t(e){this.mathisFrame=e;this.NAME="DoNotDrawAllTheLines3d";this.TITLE="variant with 3d cartesian reseau";this.nbI=10;this.$$$nbI=[5,10,12,15,20];this.selectionChoice=0;this.$$$selectionChoice=[0,1,2]}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.Regular3D;t.nbI=this.nbI;t.nbJ=t.nbI;t.nbK=t.nbI;t.Vi=new e.XYZ(.1,0,0);t.Vj=new e.XYZ(0,.1,0);t.Vk=new e.XYZ(0,0,.1);var i=t.go();var r=new e.lineModule.LineComputer(i);r.startingVertices=[];var s=this.selectionChoice;for(var a=0;a<i.vertices.length;a++){var n=i.vertices[a];if(s==0){if(n.param.x%3==0&&n.param.y==0)r.startingVertices.push(n)}else if(s==1){if(n.param.x%3==0&&n.param.y==0&&n.param.z==0)r.startingVertices.push(n);if(n.param.x==0&&n.param.y%3==0&&n.param.z==0)r.startingVertices.push(n);if(n.param.x==0&&n.param.y==0&&n.param.z%3==0)r.startingVertices.push(n)}else if(s==2){if(n.position.length()<.25)r.startingVertices.push(n)}}i.lines=r.go();var o=new e.visu3d.LinesViewer(i,this.mathisFrame.scene);o.go();var h=new e.visu3d.VerticesViewer(i,this.mathisFrame.scene);h.radiusProp=.1;h.go();this._nbLines=i.lines.length};return t}();var n=function(){function t(e){this.mathisFrame=e;this.NAME="DrawOnlyLinePassingInside";this.TITLE="We draw lines only passing inside selected vertices";this.nbI=10;this.$$$nbI=[5,10,12,15,20];this.selectionChoice=0;this.$$$selectionChoice=[0,1,2]}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.BasisForRegularReseau;t.nbI=this.nbI;t.nbJ=t.nbI;t.origin=new e.XYZ(-.7,-.7,0);t.end=new e.XYZ(+.7,+.7,0);var i=new e.reseau.Regular(t);var r=i.go();var s=new e.lineModule.LineComputer(r);s.restrictLinesToTheseVertices=[];var a=this.selectionChoice;for(var n=0;n<r.vertices.length;n++){var o=r.vertices[n];if(a==0){if(o.param.x<=3&&(o.param.y<=3||o.param.y>5))s.restrictLinesToTheseVertices.push(o)}else if(a==1){if(o.position.length()>.5)s.restrictLinesToTheseVertices.push(o)}else if(a==2){if(o.position.length()<.5)s.restrictLinesToTheseVertices.push(o)}}r.lines=s.go();var h=new e.visu3d.LinesViewer(r,this.mathisFrame.scene);h.go();var l=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);l.radiusProp=.1;l.go();this._nbLines=r.lines.length};return t}();var o=function(){function i(e){this.mathisFrame=e;this.NO_TEST=true;this.NAME="ChoseColorOfLinesAccordingToLevel";this.TITLE="colors of vertical lines are chosen via lineToColor. color of horizontal lines are chosen via a lineToLevel";this.nbI=11;this.$$$nbI=new t.Choices([11,5,15])}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.BasisForRegularReseau;t.nbI=this.nbI;t.nbJ=11;t.origin=new e.XYZ(-1,-1,0);t.end=new e.XYZ(1,1,0);var i=new e.reseau.Regular(t);var r=i.go();r.fillLineCatalogue();var s=new e.visu3d.LinesViewer(r,this.mathisFrame.scene);s.lineToLevel=new e.HashMap;var a=new e.visu3d.LinesViewer(r,this.mathisFrame.scene);a.lineToColor=new e.HashMap;for(var n=0;n<r.lines.length;n++){var o=r.lines[n];var h=o.getVertex(0).param.y==o.getVertex(1).param.y;if(h){s.lineToLevel.putValue(o,o.getVertex(0).param.y)}else{if(o.getVertex(0).param.x%2==0)a.lineToColor.putValue(o,new e.Color(e.Color.names.black));else a.lineToColor.putValue(o,new e.Color(e.Color.names.whitesmoke))}}s.go();a.go();var l=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);l.radiusProp=.1;l.go()};return i}();var h=function(){function t(e){this.mathisFrame=e;this.NAME="ChoseColorOfLinesAccordingToSymmetries";this.TITLE="We color symmetric lines with the same color";this.selectionChoice=0;this.$$$selectionChoice=[0,1,2];this.nbSubdivisionInARadius=4;this.$$$nbSubdivisionInARadius=[3,4,6,8];this.nbSides=4;this.$$$nbSides=[4,6,8,10]}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.TriangulatedPolygone(this.nbSides);t.nbSubdivisionInARadius=this.nbSubdivisionInARadius;var i=t.go();i.fillLineCatalogue();var r=new e.lineModule.CreateAColorIndexRespectingBifurcationsAndSymmetries(i);var s=this.selectionChoice;if(s==0){r.symmetries=[function(t){return new e.XYZ(-t.x,t.y,t.z)}]}else if(s==1){r.symmetries=[function(t){return new e.XYZ(-t.x,t.y,t.z)},function(t){return new e.XYZ(t.x,-t.y,t.z)}]}else if(s==2){r.symmetries=[function(t){return new e.XYZ(-t.x,t.y,t.z)},function(t){return new e.XYZ(t.x,-t.y,t.z)},function(t){return new e.XYZ(-t.x,-t.y,t.z)}]}var a=new e.visu3d.LinesViewer(i,this.mathisFrame.scene);a.lineToLevel=r.go();a.go();var n=new e.visu3d.VerticesViewer(i,this.mathisFrame.scene);n.radiusProp=.1;n.go()};return t}();var l=function(){function t(e){this.mathisFrame=e;this.NAME="ChoseColorOfLinesBifurcation";this.TITLE="We color bifurcation with the same color";this.nbSides=7;this.$$$nbSides=[4,7,10];this.nbSubdivisionInARadius=3;this.$$$nbSubdivisionInARadius=[2,3,5]}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.TriangulatedPolygone(this.nbSides);t.nbSubdivisionInARadius=this.nbSubdivisionInARadius;var i=t.go();var r=new e.proba.Random(6537);for(var s=0;s<i.vertices.length;s++){var a=i.vertices[s];for(var n=0;n<a.links.length;n++){if(r.pseudoRand()<.4){e.Vertex.separateTwoVoisins(a,a.links[n].to)}}}i.clearOppositeInLinks();var o=new e.linkModule.OppositeLinkAssocierByAngles(i.vertices);o.canCreateBifurcations=true;o.goChanging();var h=new e.lineModule.LineComputer(i);h.lookAtBifurcation=true;i.lines=h.go();var l=new e.visu3d.LinesViewer(i,this.mathisFrame.scene);var u=new e.lineModule.CreateAColorIndexRespectingBifurcationsAndSymmetries(i);l.lineToLevel=u.go();l.go();var c=new e.visu3d.VerticesViewer(i,this.mathisFrame.scene);c.radiusProp=.1;c.go();this._nbLevels=e.tab.maxValue(l.lineToLevel.allValues())+1};return t}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="Simple links and opposite links";var i=new t.SeveralParts;i.addPart(new a(this.mathisFrame));i.addPart(new n(this.mathisFrame));i.addPart(new r(this.mathisFrame));i.addPart(new s(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.LinksDocu=i;var r=function(){function t(e){this.mathisFrame=e;this.NAME="WhatAreLinks";this.TITLE="Several ways to create manually links (without association of opposite)";this.technicChoice=0;this.$$$technicChoice=[0,1,2];this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();var t=this.mathisFrame.getGrabberCamera();t.changePosition(new e.XYZ(0,0,-5));this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=(new e.Vertex).setPosition(-1,-1,0);var i=(new e.Vertex).setPosition(-1,1,0);var r=(new e.Vertex).setPosition(0,1.5,0);var s=(new e.Vertex).setPosition(0,-.5,0);var a=(new e.Vertex).setPosition(1,-1,0);var n=(new e.Vertex).setPosition(1,1,0);var o=new e.Mamesh;o.vertices.push(t,i,r,s,a,n);o.addATriangle(t,r,i).addATriangle(t,s,r);o.addASquare(r,s,a,n);var h=this.technicChoice;if(h==0){o.addSimpleLinksAroundPolygons()}else if(h==1){r.setOneLink(i).setOneLink(n);i.setOneLink(r);n.setOneLink(r)}else if(h==2){t.links.push(new e.Link(i),new e.Link(r));i.links.push(new e.Link(t));r.links.push(new e.Link(t))}var l=new e.visu3d.VerticesViewer(o,this.mathisFrame.scene);l.go();var u=new e.visu3d.LinksViewer(o,this.mathisFrame.scene);u.go();var c=new e.visu3d.SurfaceViewer(o,this.mathisFrame.scene);c.go();this._nbLinks=0;for(var m=0,d=o.vertices;m<d.length;m++){var f=d[m];this._nbLinks+=f.links.length}};return t}();var s=function(){function t(e){this.mathisFrame=e;this.NAME="WhatAreOppositeLinks";this.TITLE="several ways to associate manually opposite links";this.technicChoice=0;this.$$$technicChoice=[0,1,2];this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();var t=this.mathisFrame.getGrabberCamera();t.changePosition(new e.XYZ(0,0,-5));this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=(new e.Vertex).setPosition(-1,-1,0);var i=(new e.Vertex).setPosition(-1,1,0);var r=(new e.Vertex).setPosition(0,1.5,0);var s=(new e.Vertex).setPosition(0,-.5,0);var a=(new e.Vertex).setPosition(1,-1,0);var n=(new e.Vertex).setPosition(1,1,0);var o=new e.Mamesh;o.vertices.push(t,i,r,s,a,n);o.addATriangle(t,r,i).addATriangle(t,s,r);o.addASquare(r,s,a,n);var h=this.technicChoice;if(h==0){o.addOppositeLinksAroundPolygons()}else if(h==1){s.setTwoOppositeLinks(t,a);t.setOneLink(s);a.setOneLink(s)}else if(h==2){var l=new e.Link(i);var u=new e.Link(n);l.opposites=[u];u.opposites=[l];r.links.push(l,u);i.links.push(new e.Link(r));n.links.push(new e.Link(r))}var c=new e.visu3d.VerticesViewer(o,this.mathisFrame.scene);c.go();var m=new e.visu3d.LinesViewer(o,this.mathisFrame.scene);m.go();var d=new e.visu3d.SurfaceViewer(o,this.mathisFrame.scene);d.go();this._nbLines=o.lines.length};return t}();var a=function(){function i(e){this.mathisFrame=e;this.NAME="AutomaticLink";this.TITLE="We create some random links. Then we associate opposite-links using an automatic process based on angles. "+"This can create bifurcation";this.createBifurcation=true;this.$$$createBifurcation=[true,false];this.nbLinks=30;this.$$$nbLinks=[20,30,50,100];this.maxAngleToAssociateLinks=Math.PI*.3;this.$$$maxAngleToAssociateLinks=new t.Choices([Math.PI*.1,Math.PI*.3,Math.PI*.5,Math.PI*.8],{visualValues:["PI*0.1","PI*0.3","PI*0.5","PI*0.8"]});this.mathisFrame=e}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();var t=this.mathisFrame.getGrabberCamera();t.changePosition(new e.XYZ(0,0,-5));this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.BasisForRegularReseau;t.nbI=8;t.nbJ=8;var i=new e.reseau.Regular(t);i.makeLinks=false;i.makeTriangleOrSquare=false;var r=i.go();var s=this.nbLinks;var a=46765474657;var n=new e.proba.Random(a);var o=0;while(o<s){var h=r.vertices[n.pseudoRandInt(r.vertices.length)];var l=r.vertices[n.pseudoRandInt(r.vertices.length)];if(Math.abs(h.param.x-l.param.x)==1&&Math.abs(h.param.y-l.param.y)<3){h.setOneLink(l);l.setOneLink(h);o++}}var u=this.maxAngleToAssociateLinks;var c=new e.linkModule.OppositeLinkAssocierByAngles(r.vertices);c.canCreateBifurcations=this.createBifurcation;c.maxAngleToAssociateLinks=u;c.goChanging();var m=new e.visu3d.LinesViewer(r,this.mathisFrame.scene);if(c.canCreateBifurcations){r.fillLineCatalogue();var d=new e.lineModule.CreateAColorIndexRespectingBifurcationsAndSymmetries(r);m.lineToLevel=d.go()}m.constantRadius=.01;m.go();var f=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);f.constantRadius=.03;f.go();this._nbColor=e.tab.maxValue(m.lineToLevel.allValues())+1;this._nbLines=r.lines.length};return i}();var n=function(){function t(e){this.mathisFrame=e;this.NAME="AutomaticPolygonLink";this.TITLE="We associate opposite-links using an automatic process based on polygons.";this.seed=3534;this.$$$seed=[3534,7654,909123,58912307];this.squareMailleInsteadOfTriangle=true;this.$$$squareMailleInsteadOfTriangle=[true,false];this.randomization=true;this.$$$randomization=[true,false];this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();var t=this.mathisFrame.getGrabberCamera();t.changePosition(new e.XYZ(0,0,-5));this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.BasisForRegularReseau;t.nbI=5;t.nbJ=5;t.squareMailleInsteadOfTriangle=this.squareMailleInsteadOfTriangle;var i=new e.reseau.Regular(t);i.makeLinks=false;var r=i.go();if(this.randomization){var s=this.seed;var a=new e.proba.Random(s);for(var n=0;n<r.vertices.length;n++){r.vertices[n].position.add(new e.XYZ(a.pseudoRand(),a.pseudoRand(),a.pseudoRand()).scale(.25))}}r.addSimpleLinksAroundPolygons();var o=new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(r);o.goChanging();var h=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);h.constantRadius=.05;h.go();var l=new e.visu3d.LinesViewer(r,this.mathisFrame.scene);l.constantRadius=.02;l.go();new e.visu3d.SurfaceViewer(r,this.mathisFrame.scene).go();this._nbLines=r.lines.length};return t}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="Links viewing";var i=new t.SeveralParts;i.addPart(new r(this.mathisFrame));i.addPart(new s(this.mathisFrame));i.addComment("In the sequel we explain how to finely adjust the links-representation.","In the sequel we explain how to finely adjust the links-representation");i.addPart(new a(this.mathisFrame));i.addPart(new n(this.mathisFrame));i.addPart(new o(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.LinksViewingDocu=i;var r=function(){function i(i){this.mathisFrame=i;this.NAME="JustTheSizeOfLinks";this.TITLE="As a simple usage, you can specified  the color and the lateral-size of links. This size can be relative or absolute.";this.nbSides=4;this.$$$nbSides=[4,7,10];this.nbSubdivisionInARadius=3;this.$$$nbSubdivisionInARadius=[2,3,5];this.color=e.Color.names.rebeccapurple;this.$$$color=new t.Choices([e.Color.names.rebeccapurple,e.Color.names.rosybrown,e.Color.names.darkorange],{before:"Color.names.",visualValues:["rebeccapurple","rosybrown","darkorange"]});this.lateralScalingProp=.05;this.$$$lateralScalingProp=[.01,.05,.1];this.lateralScalingConstant=null;this.$$$lateralScalingConstant=[null,.05,.1,.2]}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.TriangulatedPolygone(this.nbSides);t.nbSubdivisionInARadius=this.nbSubdivisionInARadius;var i=t.go();var r=new e.visu3d.LinksViewer(i,this.mathisFrame.scene);r.color=new e.Color(this.color);r.lateralScalingConstant=this.lateralScalingConstant;r.lateralScalingProp=this.lateralScalingProp;r.go()};return i}();var s=function(){function i(i){this.mathisFrame=i;this.NAME="OrientationLinksViewing";this.TITLE="Now we specify a model (here an arrow), and indicate which links must be drawn and in which direction.";this.polyhedronType=e.creation3D.PolyhedronType.Cube;this.$$$polyhedronType=new t.Choices([e.creation3D.PolyhedronType.Tetrahedron,e.creation3D.PolyhedronType.Cube,e.creation3D.PolyhedronType.Dodecahedron],{before:"creation3D.PolyhedronType.",visualValues:["Tetrahedron","Cube","Dodecahedron"]});this.methodChoice=-1;this.$$$methodChoice=[-1,0,1,2,3]}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.creation3D.Polyhedron(this.polyhedronType);var i=t.go();var r=new e.creation3D.ArrowCreator(this.mathisFrame.scene);r.arrowFootAtOrigin=false;r.bodyDiameterProp=1;r.headDiameterProp=2;var s=r.go();var a=new BABYLON.StandardMaterial("",this.mathisFrame.scene);a.diffuseColor=new BABYLON.Color3(0,0,1);s.material=a;s.convertToFlatShadedMesh();var n;var o=this.methodChoice;if(o==-1){n=null}else if(o==0){n=function(t,i){if(e.geo.almostEquality(t.position.y,i.position.y))return 0;return t.position.y-i.position.y}}else if(o==1){n=function(t,i){if(e.geo.almostEquality(t.position.y,i.position.y))return 0;return-t.position.y+i.position.y}}else if(o==2){n=function(t,i){if(e.geo.almostEquality(t.position.z,i.position.z))return 0;return t.position.z-i.position.z}}else if(o==3){n=function(t,i){if(t.hasMark(e.Vertex.Markers.polygonCenter)||i.hasMark(e.Vertex.Markers.polygonCenter))return 0;return t.position.z-i.position.z}}var h=new e.visu3d.LinksViewer(i,this.mathisFrame.scene);h.meshModel=s;h.segmentOrientationFunction=n;h.go()};return i}();var a=function(){function i(i){this.mathisFrame=i;this.NAME="Elongate";this.TITLE="Links viewing is made via an 'elongator'. This elongator take a vertical mesh (eg cylinder, arrow...) "+"and place its between two positions. Lateral-direction and lateral-scaling can be given.";this.upVector=new e.XYZ(0,0,1);this.$$$upVector=new t.Choices([new e.XYZ(0,0,1),new e.XYZ(0,1,1),new e.XYZ(0,.5,1)],{before:"new XYZ"});this.endPos=new e.XYZ(1,0,0);this.$$$endPos=new t.Choices([new e.XYZ(1,0,0),new e.XYZ(-1,.5,0),new e.XYZ(1,1,0)],{before:"new XYZ"});this.modelChoice=0;this.$$$modelChoice=[0,1,2];this.lateralScaling=.1;this.$$$lateralScaling=[.05,.1,.5];this.justSeeModels=false;this.$$$justSeeModels=[true,false];this.showLateralDirection=true;this.$$$showLateralDirection=[true,false]}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=this.modelChoice;var i;if(t==0){i=BABYLON.Mesh.CreateBox("",1,this.mathisFrame.scene)}else if(t==1){i=BABYLON.Mesh.CreateCylinder("",1,1,1,3,3,this.mathisFrame.scene)}else if(t==2){var r=new e.creation3D.ArrowCreator(this.mathisFrame.scene);r.arrowFootAtOrigin=false;r.bodyDiameterProp=1;r.headDiameterProp=2;i=r.go()}var s=new BABYLON.StandardMaterial("",this.mathisFrame.scene);s.diffuseColor=new BABYLON.Color3(0,0,1);i.material=s;i.convertToFlatShadedMesh();var a=this.justSeeModels;var n=this.endPos;var o=this.upVector;if(!a){var h=new e.visu3d.ElongateAMeshFromBeginToEnd(new e.XYZ(-1,0,0),n,i);h.lateralDirection=o;h.lateralScaling=this.lateralScaling;h.goChanging()}var l=this.showLateralDirection;if(l){var u=new e.creation3D.ArrowCreator(this.mathisFrame.scene).go();var c=new e.XYZW(0,0,0,0);e.geo.axisAngleToQuaternion(new e.XYZ(0,0,1),-Math.PI/2,c);u.rotationQuaternion=c;u.bakeCurrentTransformIntoVertices();if(!a){var m=new e.visu3d.ElongateAMeshFromBeginToEnd(new e.XYZ(-1,0,0),n,u);m.lateralDirection=o;m.lateralScaling=1;m.goChanging()}}};return i}();var n=function(){function i(i){this.mathisFrame=i;this.NAME="DefaultLinksViewing";this.TITLE="The links are drawn using the default method to compute lateral directions (these direction are illustrated by the white arrows)";this.modelChoice=0;this.$$$modelChoice=[-1,0,1,2];this.lateralScalingProp=.05;this.$$$lateralScalingProp=[.01,.05,.1];this.lateralScalingConstant=null;this.$$$lateralScalingConstant=[null,.05,.1,.2];this.justSeeModels=false;this.$$$justSeeModels=[true,false];this.polyhedronType=e.creation3D.PolyhedronType.Cube;this.$$$polyhedronType=new t.Choices([e.creation3D.PolyhedronType.Tetrahedron,e.creation3D.PolyhedronType.Cube,e.creation3D.PolyhedronType.Dodecahedron],{before:"creation3D.PolyhedronType.",visualValues:["Tetrahedron","Cube","Dodecahedron"]});this.showLateralDirection=true;this.$$$showLateralDirection=[true,false]}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.creation3D.Polyhedron(this.polyhedronType);var i=t.go();var r=this.modelChoice;var s;if(r==-1){s=null}else if(r==0){s=BABYLON.Mesh.CreateBox("",1,this.mathisFrame.scene)}else if(r==1){s=BABYLON.Mesh.CreateCylinder("",1,1,1,3,3,this.mathisFrame.scene)}else if(r==2){var a=new e.creation3D.ArrowCreator(this.mathisFrame.scene);a.arrowFootAtOrigin=false;a.bodyDiameterProp=1;a.headDiameterProp=2;s=a.go()}if(s!=null){var n=new BABYLON.StandardMaterial("",this.mathisFrame.scene);n.diffuseColor=new BABYLON.Color3(0,0,1);s.material=n;s.convertToFlatShadedMesh()}var o=this.justSeeModels;if(!o){var h=new e.visu3d.LinksViewer(i,this.mathisFrame.scene);h.meshModel=s;h.lateralScalingConstant=this.lateralScalingConstant;h.lateralScalingProp=this.lateralScalingProp;h.go()}var l=this.showLateralDirection;if(l){var u=new e.creation3D.ArrowCreator(this.mathisFrame.scene).go();var c=new e.XYZW(0,0,0,0);e.geo.axisAngleToQuaternion(new e.XYZ(0,0,1),-Math.PI/2,c);u.rotationQuaternion=c;u.bakeCurrentTransformIntoVertices();if(!o){var h=new e.visu3d.LinksViewer(i,this.mathisFrame.scene);h.meshModel=u;h.lateralScalingConstant=.3;h.go()}}};return i}();var o=function(){function i(i){this.mathisFrame=i;this.NAME="CustomLinksViewing";this.TITLE="The links are drawn using some methods to compute lateral directions (these direction are illustrated by the white arrows)";this.modelChoice=0;this.$$$modelChoice=[-1,0,1,2];this.justSeeModels=false;this.$$$justSeeModels=[true,false];this.polyhedronType=e.creation3D.PolyhedronType.Cube;this.$$$polyhedronType=new t.Choices([e.creation3D.PolyhedronType.Tetrahedron,e.creation3D.PolyhedronType.Cube,e.creation3D.PolyhedronType.Dodecahedron],{before:"creation3D.PolyhedronType.",visualValues:["Tetrahedron","Cube","Dodecahedron"]});this.showLateralDirection=true;this.$$$showLateralDirection=[true,false];this.methodChoice=0;this.$$$methodChoice=[-1,0,1]}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.creation3D.Polyhedron(this.polyhedronType);var i=t.go();var r=this.modelChoice;var s;if(r==-1){s=null}else if(r==0){s=BABYLON.Mesh.CreateBox("",1,this.mathisFrame.scene)}else if(r==1){s=BABYLON.Mesh.CreateCylinder("",1,1,1,3,3,this.mathisFrame.scene)}else if(r==2){var a=new e.creation3D.ArrowCreator(this.mathisFrame.scene);a.arrowFootAtOrigin=false;a.bodyDiameterProp=1;a.headDiameterProp=2;s=a.go()}if(s!=null){var n=new BABYLON.StandardMaterial("",this.mathisFrame.scene);n.diffuseColor=new BABYLON.Color3(0,0,1);s.material=n;s.convertToFlatShadedMesh()}var o=this.justSeeModels;var h;var l=this.methodChoice;if(l==-1){h=null}if(l==0){var u=new e.XYZ(0,0,0);var c=new e.XYZ(0,1,0);var m=new e.XYZ(1,0,0);h=function(t,i){u.copyFrom(t.position).substract(i.position);if(e.geo.almostParallel(u,c))return m;else return c}}else{var d=new e.mameshAroundComputations.PositioningComputerForMameshVertices(i);d.computeTangent=false;d.computeSizes=false;d.computeNormal=true;var f=d.go();h=function(t,i){var r=new e.XYZ(0,0,0);return r.copyFrom(f.getValue(t).upVector).add(f.getValue(i).upVector)}}if(!o){var p=new e.visu3d.LinksViewer(i,this.mathisFrame.scene);p.meshModel=s;p.pairVertexToLateralDirection=h;p.go()}var v=this.showLateralDirection;if(v){var g=new e.creation3D.ArrowCreator(this.mathisFrame.scene).go();var w=new e.XYZW(0,0,0,0);e.geo.axisAngleToQuaternion(new e.XYZ(0,0,1),-Math.PI/2,w);g.rotationQuaternion=w;g.bakeCurrentTransformIntoVertices();if(!o){var p=new e.visu3d.LinksViewer(i,this.mathisFrame.scene);p.meshModel=g;p.lateralScalingConstant=.3;p.pairVertexToLateralDirection=h;p.go()}}};return i}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="Camera";var i=new t.SeveralParts;i.addComment($("<div>The default mathis-camera is called the GrabberCamera. For real 3d viewing of single object the ideal grabber is a sphere "+"(it is the white sphere which appear then you grab with your mouse). With the first piece of code, observe that :  <br>"+"- outside the grabber when you grab, the grabber seems to turn on itself ; but actually, it is the camera (so yourself) that turning around.  <br>"+"- inside the grabber  your are in a 'free mode rotation'<br> "+" - close to the surface of the grabber, the movement is an interpolation between the two previous movement ; which give the impression to roll on the grabber surface.<br> "+"Observe also that, by default, when it go back, the camera recenter on the grabber center. All these behaviour can be parametrized (see further pieces of code) </div>"),"The default mathis-camera is called the GrabberCamera");i.addPart(new s(this.mathisFrame));i.addPart(new a(this.mathisFrame));i.addPart(new r(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.MacamDocu=i;var r=function(){function t(e){this.mathisFrame=e;this.NO_TEST=true;this.NAME="TwoGrabberCameraDocu";this.TITLE="Several grabbers. Usually used  for several for several meshes of interest. Here, two better show the process, we add only on mesh of"+"interest in the middle of two grabbers that we never hide.";this.toIncludeAtTheBeginOfTheFirstHiddenPiece=["var mathisFrame=new MathisFrame(false) // false so no default light and camera"];this.useFreeModeWhenCursorOutOfGrabber=false;this.$$$useFreeModeWhenCursorOutOfGrabber=[true,false];this.useOnlyFreeMode=false;this.$$$useOnlyFreeMode=[true,false];this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.go()};t.prototype.go=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultLight();var t=new e.macamera.SphericalGrabber(this.mathisFrame.scene);t.mesh.position=new e.XYZ(2,0,0);t.referenceCenter=new e.XYZ(2,0,0);t.material.diffuseColor=new BABYLON.Color3(1,0,0);t.showGrabberOnlyWhenGrabbing=false;t.focusOnMyCenterWhenCameraGoDownWard=false;var i=new e.macamera.SphericalGrabber(this.mathisFrame.scene);i.mesh.position=new e.XYZ(-2,0,0);i.referenceCenter=new e.XYZ(-2,0,0);i.material.diffuseColor=new BABYLON.Color3(0,1,0);i.showGrabberOnlyWhenGrabbing=false;i.focusOnMyCenterWhenCameraGoDownWard=false;var r=new e.macamera.GrabberCamera(this.mathisFrame,t);r.grabbers=[t,i];r.useFreeModeWhenCursorOutOfGrabber=this.useFreeModeWhenCursorOutOfGrabber;r.useOnlyFreeMode=this.useOnlyFreeMode;r.attachControl(this.mathisFrame.canvas);r.changePosition(new e.XYZ(0,0,-10));var s=new e.creation3D.Polyhedron(e.creation3D.PolyhedronType.Cube);var a=s.go();new e.visu3d.LinksViewer(a,this.mathisFrame.scene).go()};return t}();var s=function(){function t(e){this.mathisFrame=e;this.NO_TEST=true;this.NAME="SphericalGrabberCameraDocu";this.TITLE="Mathis camera with spherical grabber";this.cameraOptionChoice=0;this.$$$cameraOptionChoice=[0,1];this.toIncludeAtTheBeginOfTheFirstHiddenPiece=["var mathisFrame=new MathisFrame(false) // false so no default light and camera"];this.useFreeModeWhenCursorOutOfGrabber=false;this.$$$useFreeModeWhenCursorOutOfGrabber=[true,false];this.useOnlyFreeMode=false;this.$$$useOnlyFreeMode=[true,false];this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.go()};t.prototype.go=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultLight();var t=this.cameraOptionChoice;var i;if(t==0){i=new e.macamera.SphericalGrabber(this.mathisFrame.scene)}else if(t==1){i=new e.macamera.SphericalGrabber(this.mathisFrame.scene);i.mesh.scaling.x=1.5;i.radius=1.5}var r=new e.macamera.GrabberCamera(this.mathisFrame,i);r.useFreeModeWhenCursorOutOfGrabber=this.useFreeModeWhenCursorOutOfGrabber;r.useOnlyFreeMode=this.useOnlyFreeMode;r.attachControl(this.mathisFrame.canvas);var s=new e.creation3D.Polyhedron(e.creation3D.PolyhedronType.Cube);var a=s.go();new e.visu3d.LinksViewer(a,this.mathisFrame.scene).go()};return t}();var a=function(){function t(e){this.mathisFrame=e;this.NO_TEST=true;this.NAME="PlanarGrabberCameraDocu";this.TITLE="Mathis camera with planar grabber";this.cameraOptionChoice=0;this.$$$cameraOptionChoice=[0,1];this.toIncludeAtTheBeginOfTheFirstHiddenPiece=["var mathisFrame=new MathisFrame(false) // false so no default light and camera"];this.useFreeModeWhenCursorOutOfGrabber=false;this.$$$useFreeModeWhenCursorOutOfGrabber=[true,false];this.useOnlyFreeMode=false;this.$$$useOnlyFreeMode=[true,false];this.changeMaterial=true;this.$$$changeMaterial=[true,false];this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.go()};t.prototype.go=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultLight();var t=this.cameraOptionChoice;var i=new e.macamera.PlanarGrabber(this.mathisFrame.scene);if(t==0){i.mesh.scaling.x=2}else if(t==1){i.mesh.dispose();i.mesh=BABYLON.Mesh.CreateDisc("",1,20,this.mathisFrame.scene);i.mesh.material=i.material}if(this.changeMaterial){i.material.diffuseColor=new BABYLON.Color3(1,0,0);i.material.alpha=.5}var r=new e.macamera.GrabberCamera(this.mathisFrame,i);r.useFreeModeWhenCursorOutOfGrabber=this.useFreeModeWhenCursorOutOfGrabber;r.useOnlyFreeMode=this.useOnlyFreeMode;r.attachControl(this.mathisFrame.canvas);console.log(this.mathisFrame.scene.activeCamera);console.log(this.mathisFrame.scene.activeCameras);var s=new e.creation3D.Polyhedron(e.creation3D.PolyhedronType.Cube);var a=s.go();new e.visu3d.LinksViewer(a,this.mathisFrame.scene).go()};return t}();var n=function(){function t(e){this.mathisFrame=e;this.NO_TEST=true;this.NAME="SeveralGrabber";this.TITLE=" ";this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.creation3D.Polyhedron(e.creation3D.PolyhedronType.Rhombicuboctahedron);var i=t.go()};return t}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="Positioning objects";var i=new t.SeveralParts;i.addPart(new r(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.MathisFrameDocu=i;var r=function(){function t(e){this.mathisFrame=e;this.NO_TEST=true;this.NAME="AxisAndSomeMesh";this.TITLE="We position some mesh on space";this.move=true;this.$$$move=[true,false];this.upTranslation=true;this.$$$upTranslation=[true,false]}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.creation3D.TwoOrTreeAxis(this.mathisFrame.scene);t.addLabelsXYZ=true;t.go();var i=BABYLON.Mesh.CreateBox("",.1,this.mathisFrame.scene);i.position=new e.XYZ(.5,.5,.5);var r=new e.creation3D.TwoOrTreeAxis(this.mathisFrame.scene).go();var s=BABYLON.Mesh.CreateCylinder("",.5,0,.5,20,3,this.mathisFrame.scene);r.push(s);if(this.upTranslation){s.position.y=.5;s.bakeCurrentTransformIntoVertices()}if(this.move){var a=new e.Positioning;a.setOrientation(new e.XYZ(-1,1,0),new e.XYZ(1,1,0));a.scaling=new e.XYZ(.2,.2,.2);a.position=new e.XYZ(-.5,.5,0);a.applyToMeshes(r)}};return t}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="Reseaux (=nets)";var i=new t.SeveralParts;i.addPart(new r(this.mathisFrame));i.addPart(new s(this.mathisFrame));i.addPart(new a(this.mathisFrame));i.addPart(new n(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.ReseauDocu=i;var r=function(){function i(i){this.mathisFrame=i;this.NAME="RegularReseauDocu";this.TITLE="Regular Reseau (=net)";this.nbI=3;this.$$$nbI=[3,5,7];this.oneMoreVertexForOddLine=false;this.$$$oneMoreVertexForOddLine=[true,false];this.squareMaille=true;this.$$$squareMaille=[true,false];this.Vj=new e.XYZ(0,.2,0);this.$$$Vj=new t.Choices([new e.XYZ(0,.2,0),new e.XYZ(.05,.2,0)],{before:"new mathis.XYZ"})}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.Regular;t.nbI=this.nbI;t.nbJ=4;t.Vi=new e.XYZ(.2,0,0);t.Vj=this.Vj;t.origine=new e.XYZ(-.7,-.7,0);t.squareVersusTriangleMaille=this.squareMaille;t.oneMoreVertexForOddLine=this.oneMoreVertexForOddLine;var i=t.go();new e.visu3d.VerticesViewer(i,this.mathisFrame.scene).go();new e.visu3d.LinksViewer(i,this.mathisFrame.scene).go();new e.visu3d.SurfaceViewer(i,this.mathisFrame.scene).go();this._nbVertices=i.vertices.length;this._nbSquares=i.smallestSquares.length;this._nbTriangles=i.smallestTriangles.length};return i}();var s=function(){function i(i){this.mathisFrame=i;this.NAME="RegularBasisDocu";this.TITLE="Often we want to draw a reseau which starts from an given point, ends at a given point. So we can use the class which compute the right  Basis (ie: the rights kVi and Vj) ";this.nbI=3;this.$$$nbI=new t.Choices([3,5,7]);this.squareMaille=true;this.$$$squareMaille=new t.Choices([true,false]);this.end=new e.XYZ(.7,.7,0);this.$$$end=new t.Choices([new e.XYZ(.7,.7,0),new e.XYZ(0,0,0),new e.XYZ(.5,1,0)],{before:"new mathis.XYZ"});this.setNBJ=true;this.$$$setNBJ=[true,false]}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.BasisForRegularReseau;t.nbI=this.nbI;t.set_nbJ_toHaveRegularReseau=this.setNBJ;t.nbJ=4;t.origin=new e.XYZ(-.7,-.7,0);t.end=this.end;t.squareMailleInsteadOfTriangle=this.squareMaille;var i=new e.reseau.Regular(t);var r=i.go();this._nbVertices=r.vertices.length;new e.visu3d.VerticesViewer(r,this.mathisFrame.scene).go();new e.visu3d.LinksViewer(r,this.mathisFrame.scene).go();new e.visu3d.SurfaceViewer(r,this.mathisFrame.scene).go()};return i}();var a=function(){function i(e){this.mathisFrame=e;this.nbSides=7;this.$$$nbSides=new t.Choices([3,4,5,6,7,9,11]);this.nbSubdivisionsInARadius=3;this.$$$nbSubdivisionsInARadius=new t.Choices([1,2,3,4,5]);this.NAME="PolygonalResauDocu";this.TITLE="Polygonal reseau"}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.TriangulatedPolygone(this.nbSides);t.nbSubdivisionInARadius=this.nbSubdivisionsInARadius;t.origin=new e.XYZ(-1,-1,0);t.end=new e.XYZ(1,1,0);var i=t.go();this._nbVertices=i.vertices.length;new e.visu3d.VerticesViewer(i,this.mathisFrame.scene).go();new e.visu3d.LinksViewer(i,this.mathisFrame.scene).go();new e.visu3d.SurfaceViewer(i,this.mathisFrame.scene).go()};return i}();var n=function(){function i(i){this.mathisFrame=i;this.NAME="Regular3dReseauDocu";this.TITLE="A 3d reseau now";this.Vj=new e.XYZ(0,.2,0);this.$$$Vj=new t.Choices([new e.XYZ(0,.2,0),new e.XYZ(.05,.2,0)],{before:"new mathis.XYZ"});this.nbI=4;this.$$$nbI=new t.Choices([4,6,8]);this.decayOddStrates=false;this.$$$decayOddStrates=new t.Choices([true,false]);this.interStrateMailleAreSquareVersusTriangle=true;this.$$$interStrateMailleAreSquareVersusTriangle=new t.Choices([true,false]);this.strateHaveSquareMailleVersusTriangleMaille=true;this.$$$strateHaveSquareMailleVersusTriangleMaille=new t.Choices([true,false])}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.Regular3D;t.nbI=this.nbI;t.nbJ=4;t.nbK=5;t.Vi=new e.XYZ(.2,0,0);t.Vj=this.Vj;t.Vk=new e.XYZ(0,0,.2);t.origine=new e.XYZ(-.7,-.7,-.7);t.decayOddStrates=this.decayOddStrates;t.interStrateMailleAreSquareVersusTriangle=this.interStrateMailleAreSquareVersusTriangle;t.strateHaveSquareMailleVersusTriangleMaille=this.strateHaveSquareMailleVersusTriangleMaille;var i=t.go();this._nbVertices=i.vertices.length;this._nbLinks=0;for(var r=0,s=i.vertices;r<s.length;r++){var a=s[r];this._nbLinks+=a.links.length}new e.visu3d.VerticesViewer(i,this.mathisFrame.scene).go();new e.visu3d.LinksViewer(i,this.mathisFrame.scene).go();new e.visu3d.SurfaceViewer(i,this.mathisFrame.scene).go()};return i}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="Famous solids";var i=new t.SeveralParts;i.addPart(new r(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.SolidsDocu=i;var r=function(){function i(i){this.mathisFrame=i;this.NAME="SimplestSolids";this.TITLE="Platonic, Archimedian, and other simple solids";this.polyhedronType=e.creation3D.PolyhedronType.TruncatedIcosidodecahedron;this.$$$polyhedronType=new t.Choices(e.allIntegerValueOfEnume(e.creation3D.PolyhedronType),{visualValues:e.allStringValueOfEnume(e.creation3D.PolyhedronType)});this.mathisFrame=i}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();var t=this.mathisFrame.scene.activeCamera;t.changePosition(new e.XYZ(0,0,-5));this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.creation3D.Polyhedron(this.polyhedronType);var i=t.go();var r=[];for(var s=0;s<i.vertices.length;s++){var a=i.vertices[s];if(!a.hasMark(e.Vertex.Markers.polygonCenter))r.push(a)}var n=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);n.go();var o=new e.visu3d.LinksViewer(i,this.mathisFrame.scene);o.segmentOrientationFunction=function(t,i){if(t.hasMark(e.Vertex.Markers.polygonCenter)||i.hasMark(e.Vertex.Markers.polygonCenter))return 0;return 1};o.go();var h=new e.visu3d.SurfaceViewer(i,this.mathisFrame.scene);h.go()};return i}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="Surfaces from reseaux";var i=new t.SeveralParts;i.addPart(new s(this.mathisFrame));i.addPart(new r(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.SurfaceDocu=i;var r=function(){function t(e){this.mathisFrame=e;this.NO_TEST=true;this.NAME="DeformedReseau";this.TITLE="Pushing up a reseau to make a surface";this.linesVersusLinks=true;this.$$$linesVersusLinks=[true,false];this.functionChoice=0;this.$$$functionChoice=[0,1,2];this._toto=3}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.TriangulatedPolygone(10);t.nbSubdivisionInARadius=5;t.origin=new e.XYZ(-1,-1,0);t.end=new e.XYZ(1,1,0);var i=t.go();var r=this.functionChoice;if(r==0)var s=function(t){return new e.XYZ(t.x,t.x*t.y,t.y)};else if(r==1)var s=function(t){return new e.XYZ(t.x,.5*Math.sin(5*t.x),t.y)};else if(r==2)var s=function(t){return new e.XYZ(Math.cos(t.x)-1,.5*Math.sin(5*t.x),t.y)};for(var a=0;a<i.vertices.length;a++){var n=i.vertices[a];n.position=s(n.position)}var o=this.linesVersusLinks;if(o){new e.visu3d.LinesViewer(i,this.mathisFrame.scene).go()}else{new e.visu3d.LinksViewer(i,this.mathisFrame.scene).go()}new e.visu3d.SurfaceViewer(i,this.mathisFrame.scene).go()};return t}();var s=function(){function t(e){this.mathisFrame=e;this.NO_TEST=true;this.NAME="HelicoidDocu";this.TITLE="We create an hellicoid. Best representation can de done with more vertices, but in this case, "+"to be esthetic, do not draw all the lines (see section in line visualization for line selection)";this.a=.2;this.$$$a=[.1,.2,1];this.nbI=10;this.$$$nbI=[5,10,20];this.nbJ=20;this.$$$nbJ=[10,20,40]}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.BasisForRegularReseau;t.nbI=this.nbI;t.nbJ=this.nbJ;t.origin=new e.XYZ(-Math.PI,-1,0);t.end=new e.XYZ(Math.PI,1,0);var i=new e.reseau.Regular(t);var r=i.go();var s=this.a;for(var a=0;a<r.vertices.length;a++){var n=r.vertices[a];var o=n.position.x;var h=n.position.y;n.position.x=h*Math.cos(o);n.position.y=s*o;n.position.z=h*Math.sin(o)}new e.visu3d.LinesViewer(r,this.mathisFrame.scene).go();new e.visu3d.SurfaceViewer(r,this.mathisFrame.scene).go()};return t}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="Surface viewing";var i=new t.SeveralParts;i.addPart(new r(this.mathisFrame));i.addPart(new s(this.mathisFrame));i.addPart(new a(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.SurfaceViewerDocu=i;var r=function(){function i(i){this.mathisFrame=i;this.NAME="BackFaceCullingDocu";this.TITLE="We observe the effect of the side orientation and the back-face-culling";this.alpha=.5;this.$$$alpha=[.1,.3,.5,.8,1];this.color=e.Color.names.rebeccapurple;this.$$$color=new t.Choices([e.Color.names.rebeccapurple,e.Color.names.rosybrown,e.Color.names.darkorange],{before:"Color.names.",visualValues:["rebeccapurple","rosybrown","darkorange"]});this.backFaceCulling=true;this.$$$backFaceCulling=[true,false];this.sideOrientation=BABYLON.Mesh.FRONTSIDE;this.$$$sideOrientation=new t.Choices([BABYLON.Mesh.DOUBLESIDE,BABYLON.Mesh.BACKSIDE,BABYLON.Mesh.FRONTSIDE],{visualValues:["DOUBLESIDE","BACKSIDE","FRONTSIDE"],before:"BABYLON.Mesh."});this.toIncludeAtTheBeginOfTheFirstHiddenPiece=["var mathisFrame=new mathis.MathisFrame()","/**back the camera*/","this.mathisFrame.getGrabberCamera().changePosition(new XYZ(0,0,-7))"]}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.mathisFrame.getGrabberCamera().changePosition(new e.XYZ(0,0,-7));this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.TriangulatedPolygone(10);t.nbSubdivisionInARadius=5;t.origin=new e.XYZ(-Math.PI*.8,-1,0);t.end=new e.XYZ(+Math.PI*.8,1,0);var i=t.go();for(var r=0,s=i.vertices;r<s.length;r++){var a=s[r];var n=a.position.x;var o=a.position.y;a.position.x=Math.cos(n);a.position.y=Math.sin(n);a.position.z=o}var h=new e.Positioning;h.frontDir.copyFromFloats(1,0,1);h.applyToVertices(i.vertices);new e.visu3d.LinksViewer(i,this.mathisFrame.scene).go();var l=new e.visu3d.SurfaceViewer(i,this.mathisFrame.scene);l.alpha=this.alpha;l.color=new e.Color(this.color);l.backFaceCulling=this.backFaceCulling;l.sideOrientation=this.sideOrientation;l.go()};return i}();var s=function(){function i(i){this.mathisFrame=i;this.NAME="DuplicateNormalDocu";this.TITLE="WebGL need normals to reflect light. But, what a pity, normal was positioned at points (while mathematically, a better choice would be to put one normal per triangle)."+"So if you want to see sharp angle, you have du duplicate points in order to duplicate normals. ";this.alpha=1;this.$$$alpha=[.1,.3,.5,.8,1];this.backFaceCulling=true;this.$$$backFaceCulling=[true,false];this.sideOrientation=BABYLON.Mesh.DOUBLESIDE;this.$$$sideOrientation=new t.Choices([BABYLON.Mesh.DOUBLESIDE,BABYLON.Mesh.BACKSIDE,BABYLON.Mesh.FRONTSIDE],{visualValues:["DOUBLESIDE","BACKSIDE","FRONTSIDE"],before:"BABYLON.Mesh."});this.toIncludeAtTheBeginOfTheFirstHiddenPiece=["var mathisFrame=new mathis.MathisFrame()","/**back the camera*/","this.mathisFrame.getGrabberCamera().changePosition(new XYZ(0,0,-7))"];this.letBabylonDoTheJob=false;this.$$$letBabylonDoTheJob=[true,false];this.normalDuplication=e.visu3d.NormalDuplication.duplicateVertex;this.$$$normalDuplication=new t.Choices(e.allIntegerValueOfEnume(e.visu3d.NormalDuplication),{visualValues:e.allStringValueOfEnume(e.visu3d.NormalDuplication),before:"visu3d.NormalDuplication."})}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.mathisFrame.getGrabberCamera().changePosition(new e.XYZ(0,0,-7));this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.creation3D.Polyhedron(e.creation3D.PolyhedronType.PentagonalDipyramid);var i=t.go();var r=new e.visu3d.SurfaceViewer(i,this.mathisFrame.scene);r.normalDuplication=this.normalDuplication;r.maxAngleBetweenNormals=Math.PI/6;r.backFaceCulling=this.backFaceCulling;r.sideOrientation=this.sideOrientation;r.alpha=this.alpha;var s=r.go();var a=this.letBabylonDoTheJob;if(a)s.convertToFlatShadedMesh()};return i}();var a=function(){function i(i){this.mathisFrame=i;this.NAME="MoebiusBandDocu";this.TITLE="Here is the moebius band, this is a non orientable surface. In this case, to duplicate  normal-vectors have a bad effect at the place where the band is glued ! "+"To see this bad effect, look at the white triangle alternating with red-triangles this is due to the reflection of the specular light";this.alpha=1;this.$$$alpha=[.1,.3,.5,.8,1];this.backFaceCulling=true;this.$$$backFaceCulling=[true,false];this.sideOrientation=BABYLON.Mesh.DOUBLESIDE;this.$$$sideOrientation=new t.Choices([BABYLON.Mesh.DOUBLESIDE,BABYLON.Mesh.BACKSIDE,BABYLON.Mesh.FRONTSIDE],{visualValues:["DOUBLESIDE","BACKSIDE","FRONTSIDE"],before:"BABYLON.Mesh."});this.toIncludeAtTheBeginOfTheFirstHiddenPiece=["var mathisFrame=new mathis.MathisFrame()","/**back the camera*/","this.mathisFrame.getGrabberCamera().changePosition(new XYZ(0,0,-7))"];this.vertexDuplication=e.visu3d.NormalDuplication.duplicateVertex;this.$$$vertexDuplication=new t.Choices(e.allIntegerValueOfEnume(e.visu3d.NormalDuplication),{visualValues:e.allStringValueOfEnume(e.visu3d.NormalDuplication),before:"visu3d.NormalDuplication."})}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.mathisFrame.getGrabberCamera().changePosition(new e.XYZ(0,0,-7));this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.BasisForRegularReseau;t.origin=new e.XYZ(0,-1,0);t.end=new e.XYZ(2*Math.PI,1,0);t.nbI=20;t.nbJ=10;var i=new e.reseau.Regular(t);var r=i.go();for(var s=0,a=r.vertices;s<a.length;s++){var n=a[s];var o=n.position.x;var h=n.position.y;n.position.x=(2-h*Math.sin(o/2))*Math.sin(o);n.position.y=(2-h*Math.sin(o/2))*Math.cos(o);n.position.z=h*Math.cos(o/2)}var l=new e.Positioning;l.frontDir.copyFromFloats(1,0,1);l.applyToVertices(r.vertices);new e.visu3d.LinksViewer(r,this.mathisFrame.scene).go();var u=new e.visu3d.SurfaceViewer(r,this.mathisFrame.scene);u.normalDuplication=this.vertexDuplication;u.backFaceCulling=this.backFaceCulling;u.sideOrientation=this.sideOrientation;u.alpha=this.alpha;u.go()};return i}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="Torus";var i=new t.SeveralParts;i.addPart(new r(this.mathisFrame));i.addPart(new s(this.mathisFrame));i.addPart(new a(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.TorusPlatonicDocu=i;var r=function(){function t(e){this.mathisFrame=e;this.NAME="BoySurface";this.TITLE="The Boy surface";this.nbI=10;this.$$$nbI=[5,10,20,30];this.nbJ=10;this.$$$nbJ=[5,10,20,30]}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.BasisForRegularReseau;t.nbI=this.nbI;t.nbJ=this.nbJ;t.origin=new e.XYZ(-.035,-.035,0);t.end=new e.XYZ(Math.PI,Math.PI,0);var i=new e.reseau.Regular(t);var r=i.go();r.vertices.forEach(function(e){var t=e.position.x;var i=e.position.y;e.position.x=2/3*(Math.cos(t)*Math.cos(2*i)+Math.sqrt(2)*Math.sin(t)*Math.cos(i))*Math.cos(t)/(Math.sqrt(2)-Math.sin(2*t)*Math.sin(3*i));e.position.y=2/3*(Math.cos(t)*Math.sin(2*i)-Math.sqrt(2)*Math.sin(t)*Math.sin(i))*Math.cos(t)/(Math.sqrt(2)-Math.sin(2*t)*Math.sin(3*i));e.position.z=-Math.sqrt(2)*Math.cos(t)*Math.cos(t)/(Math.sqrt(2)-Math.sin(2*t)*Math.sin(3*i))});var s=new e.visu3d.LinksViewer(r,this.mathisFrame.scene);s.lateralScalingConstant=.02;s.go();var a=new e.visu3d.SurfaceViewer(r,this.mathisFrame.scene);a.alpha=.7;a.go()};return t}();var s=function(){function t(e){this.mathisFrame=e;this.NAME="TorusPart";this.TITLE="A twisted torus from a skewed reseau";this.nbVerticalDecays=2;this.$$$nbVerticalDecays=[0,1,2,3,4];this.nbHorizontalDecays=1;this.$$$nbHorizontalDecays=[0,1,2,3,4];this.bent=false;this.$$$bent=[true,false];this.nbI=5;this.$$$nbI=[4,5,6,7,8];this.nbJ=20;this.$$$nbJ=[15,16,20,30]}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.BasisForRegularReseau;t.nbI=this.nbI;t.nbJ=this.nbJ;t.origin=new e.XYZ(0,0,0);t.end=new e.XYZ(2*Math.PI,2*Math.PI,0).scale(.1);t.nbVerticalDecays=this.nbVerticalDecays;t.nbHorizontalDecays=this.nbHorizontalDecays;var i=new e.reseau.Regular(t);var r=i.go();var s=this.bent;if(s){var a=.3;var n=.75;r.vertices.forEach(function(e){var t=e.position.x*10;var i=e.position.y*10;e.position.x=(a*Math.cos(t)+n)*Math.cos(i);e.position.y=(a*Math.cos(t)+n)*Math.sin(i);e.position.z=a*Math.sin(t)})}var o=new e.visu3d.LinksViewer(r,this.mathisFrame.scene);o.lateralScalingConstant=.02;o.go();var h=new e.visu3d.SurfaceViewer(r,this.mathisFrame.scene);h.alpha=.7;h.go()};return t}();var a=function(){function i(i){this.mathisFrame=i;this.NAME="TorusPartLines";this.TITLE="Problem : lines of the flat reseau behave badly on the torus. \nSolution : merge the vertices and remake links";this.nbVerticalDecays=2;this.$$$nbVerticalDecays=[0,1,2,3,4];this.nbHorizontalDecays=1;this.$$$nbHorizontalDecays=[0,1,2,3,4];this.bent=true;this.$$$bent=[true,false];this.merge=false;this.$$$merge=[true,false];this.nbI=5;this.$$$nbI=[4,5,6,7,8];this.nbJ=20;this.$$$nbJ=[15,16,20,30];this.interpolationStyle=e.geometry.InterpolationStyle.hermite;this.$$$interpolationStyle=new t.Choices([e.geometry.InterpolationStyle.none,e.geometry.InterpolationStyle.octavioStyle,e.geometry.InterpolationStyle.hermite],{before:"geometry.InterpolationStyle.",visualValues:["none","octavioStyle","hermite"]})}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.BasisForRegularReseau;t.nbI=this.nbI;t.nbJ=this.nbJ;t.origin=new e.XYZ(0,0,0);t.end=new e.XYZ(2*Math.PI,2*Math.PI,0).scale(.1);t.nbVerticalDecays=this.nbVerticalDecays;t.nbHorizontalDecays=this.nbHorizontalDecays;var i=new e.reseau.Regular(t);var r=i.go();var s=this.bent;if(s){var a=.3;var n=.75;r.vertices.forEach(function(e){var t=e.position.x*10;var i=e.position.y*10;e.position.x=(a*Math.cos(t)+n)*Math.cos(i);e.position.y=(a*Math.cos(t)+n)*Math.sin(i);e.position.z=a*Math.sin(t)});var o=this.merge;if(o){var h=new e.grateAndGlue.Merger(r,null,null);h.mergeLink=true;h.goChanging();var l=new e.linkModule.OppositeLinkAssocierByAngles(r.vertices);l.maxAngleToAssociateLinks=Math.PI;l.goChanging()}}var u=this.interpolationStyle;var c=new e.visu3d.LinesViewer(r,this.mathisFrame.scene);c.interpolationOption.interpolationStyle=u;c.go()};return i}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(e){var t=function(){function t(){this.pageIdAndTitle="hello world in pure javascript";this.severalParts=null}t.prototype.go=function(){e.indexPage.enlarger.leftToFullPageTemporarily();$("#pageContent").height("100%").empty();var t=$('<div class="aWholeDiv" style="margin: auto"></div>');t.append('<a target="_blank" href="https://drive.google.com/open?id=0B5ZYbxojmGIaMVFvdkZSVVFDY3M">Codes for this tuto and for the next one</a>');var i=$('<iframe src="https://docs.google.com/document/d/1tqyLj66D4xKTPKeXS81GCZJwV_WHKH9PNywTrozmfM0/pub?embedded=true" style="overflow:hidden;height:100%;width:100%" height="100%" width="100%"></iframe>');t.append(i);return t};return t}();e.PureJavascriptTuto=t;var i=function(){function t(){this.pageIdAndTitle="hello typescript";this.severalParts=null}t.prototype.go=function(){e.indexPage.enlarger.leftToFullPageTemporarily();$("#pageContent").height("100%").empty();var t=$('<div class="aWholeDiv"></div>');t.append('<a target="_blank" href="https://drive.google.com/open?id=0B5ZYbxojmGIaMVFvdkZSVVFDY3M">Codes for this tuto and for the next one</a>');var i=$('<iframe src="https://docs.google.com/document/d/1p6Ch4wyT9qVzLzdRSVumNRRB6CcpfrtNcJ_wbRku_94/pub?embedded=true" style="overflow:hidden;height:100%;width:100%" height="100%" width="100%"></iframe>');t.append(i);return t};return t}();e.TypescriptTuto=i;var r=function(){function t(){this.pageIdAndTitle="Collaborate via github";this.severalParts=null}t.prototype.go=function(){e.indexPage.enlarger.leftToFullPageTemporarily();$("#pageContent").height("100%").empty();var t=$('<div class="aWholeDiv"></div>');var i=$('<iframe src="https://docs.google.com/document/d/1TQnS7Xw1LbnqhtgphO020ljo3dA43Gg-wch42v0spAs/pub?embedded=true"  style="overflow:hidden;height:100%;width:100%" height="100%" width="100%"></iframe>');t.append(i);return t};return t}();e.ColaborateWithGit=r;var s=function(){function t(){this.pageIdAndTitle="PieceOfCode and tests";this.severalParts=null}t.prototype.go=function(){e.indexPage.enlarger.leftToFullPageTemporarily();$("#pageContent").height("100%").empty();var t=$('<div class="aWholeDiv"></div>');var i=$('<iframe src="https://docs.google.com/document/d/1ASn11sa2vpkabUXnbVOSnXe7DhIN_die0DZLn3ny9I0/pub?embedded=true"  style="overflow:hidden;height:100%;width:100%" height="100%" width="100%"></iframe>');t.append(i);return t};return t}();e.DocutestTuto=s;var a=function(){function t(){this.pageIdAndTitle="PieceOfCode and tests (advanced)";this.severalParts=null}t.prototype.go=function(){e.indexPage.enlarger.leftToFullPageTemporarily();$("#pageContent").height("100%").empty();var t=$('<div class="aWholeDiv"></div>');var i=$('<iframe src="https://docs.google.com/document/d/1fC0cMkL9y1TclKGaz6hHjpW24ieR245oWTGVQETyyw8/pub?embedded=true"  style="overflow:hidden;height:100%;width:100%" height="100%" width="100%"></iframe>');t.append(i);return t};return t}();e.DocutestTutoAdvanced=a})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="Vertices viewing";var i=new t.SeveralParts;i.addPart(new r(this.mathisFrame));i.addPart(new s(this.mathisFrame));i.addPart(new a(this.mathisFrame));i.addPart(new n(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.VerticesViewingDocu=i;var r=function(){function t(e){this.mathisFrame=e;this.NO_TEST=true;this.NAME="DefaultVerticesViewing";this.TITLE="By default : Each vertices is represented by a sphere. "+"Sizes can be given or computed according to distances between vertices.";this.radiusProportion=.1;this.$$$radiusProportion=[.1,.25,.5,1];this.squareMailleInsteadOfTriangle=true;this.$$$squareMailleInsteadOfTriangle=[true,false];this.constantRadius=null;this.$$$constantRadius=[null,.05,.1,.2]}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.BasisForRegularReseau;t.nbI=3;t.set_nbJ_toHaveRegularReseau=true;t.squareMailleInsteadOfTriangle=this.squareMailleInsteadOfTriangle;t.origin=new e.XYZ(-.7,-.7,0);t.end=new e.XYZ(.7,.7,0);var i=new e.reseau.Regular(t);var r=i.go();var s=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);s.constantRadius=this.constantRadius;s.radiusProp=this.radiusProportion;s.color=new e.Color(e.Color.names.indianred);s.go();new e.visu3d.LinksViewer(r,this.mathisFrame.scene).go()};return t}();var s=function(){function t(e){this.mathisFrame=e;this.NO_TEST=true;this.NAME="ModelVerticesViewing";this.TITLE="we use  babylonJS meshes as model for vertices";this.radiusProportion=.25;this.$$$radiusProportion=[.1,.25,.5,1];this.squareMailleInsteadOfTriangle=false;this.$$$squareMailleInsteadOfTriangle=[true,false];this.constantRadius=null;this.$$$constantRadius=[null,.1,.2,.3];this.modelChoice=0;this.$$$modelChoice=[0,1,2,3];this.justShowTheModel=false;this.$$$justShowTheModel=[true,false]}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.BasisForRegularReseau;t.nbI=3;t.set_nbJ_toHaveRegularReseau=true;t.squareMailleInsteadOfTriangle=this.squareMailleInsteadOfTriangle;t.origin=new e.XYZ(-.7,-.7,0);t.end=new e.XYZ(.7,.7,0);var i=new e.reseau.Regular(t);var r=i.go();var s=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);s.constantRadius=this.constantRadius;s.radiusProp=this.radiusProportion;var a=this.modelChoice;if(a==0){s.meshModel=BABYLON.Mesh.CreateCylinder("",2,0,2,20,2,this.mathisFrame.scene)}else if(a==1){s.meshModels=[BABYLON.Mesh.CreateBox("",1,this.mathisFrame.scene),BABYLON.Mesh.CreateCylinder("",1,0,1,20,2,this.mathisFrame.scene)];s.meshModels[0].position.y=-.5;s.meshModels[1].position.y=+.5;s.color=new e.Color(e.Color.names.deeppink)}else if(a==2){s.meshModel=BABYLON.Mesh.CreateDisc("",1,20,this.mathisFrame.scene);var n=new BABYLON.StandardMaterial("",this.mathisFrame.scene);n.backFaceCulling=false;n.diffuseColor=new BABYLON.Color3(0,0,1);s.meshModel.material=n}else if(a==3){s.meshModels=new e.creation3D.TwoOrTreeAxis(this.mathisFrame.scene).go()}var o=this.justShowTheModel;if(!o){s.go();new e.visu3d.LinksViewer(r,this.mathisFrame.scene).go()}};return t}();var a=function(){function t(e){this.mathisFrame=e;this.NO_TEST=true;this.NAME="ModelPositioning";this.TITLE="we specify the positioning of the models";this.squareMailleInsteadOfTriangle=false;this.$$$squareMailleInsteadOfTriangle=[true,false];this.modelChoice=3;this.$$$modelChoice=[0,1,2,3];this.justShowTheModel=false;this.$$$justShowTheModel=[true,false]}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.BasisForRegularReseau;t.nbI=5;t.set_nbJ_toHaveRegularReseau=true;t.squareMailleInsteadOfTriangle=this.squareMailleInsteadOfTriangle;t.origin=new e.XYZ(-.7,-.7,0);t.end=new e.XYZ(.7,.7,0);var i=new e.reseau.Regular(t);var r=i.go();var s=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);var a=this.modelChoice;if(a==0){s.meshModel=BABYLON.Mesh.CreateCylinder("",2,0,2,20,2,this.mathisFrame.scene)}else if(a==1){s.meshModels=[BABYLON.Mesh.CreateBox("",1,this.mathisFrame.scene),BABYLON.Mesh.CreateCylinder("",1,0,1,20,2,this.mathisFrame.scene)];s.meshModels[0].position.y=-.5;s.meshModels[1].position.y=+.5;s.color=new e.Color(e.Color.names.deeppink)}else if(a==2){s.meshModel=BABYLON.Mesh.CreateDisc("",1,20,this.mathisFrame.scene);var n=new BABYLON.StandardMaterial("",this.mathisFrame.scene);n.backFaceCulling=false;n.diffuseColor=new BABYLON.Color3(0,0,1);s.meshModel.material=n}else if(a==3){var o=new e.creation3D.TwoOrTreeAxis(this.mathisFrame.scene);o.threeVersusTwoAxis=false;s.meshModels=o.go()}var h=new e.HashMap;for(var l=0;l<r.vertices.length;l++){var u=new e.Positioning;var c=Math.random()*Math.PI*2;u.setOrientation(new e.XYZ(0,0,-1),new e.XYZ(Math.cos(c),Math.sin(c),0));u.scaling=new e.XYZ(.2,.2,.2);h.putValue(r.vertices[l],u)}s.positionings=h;var m=this.justShowTheModel;if(!m){s.go();new e.visu3d.LinksViewer(r,this.mathisFrame.scene).go()}};return t}();var n=function(){function i(i){this.mathisFrame=i;this.NO_TEST=true;this.NAME="ModelAutoPositioning";this.TITLE="Positionings are computed from mamesh : "+"FrontDir is aligned to the link which has the direction the closest as possible from the give 'attractionForTangent'.  "+"UpVector is the normal of the surface, which is the mean of the normal of triangle/quad around.";this.modelChoice=3;this.$$$modelChoice=[0,1,2,3];this.attractionForTangent=new e.XYZ(100,10,0);this.$$$attractionForTangent=new t.Choices([new e.XYZ(100,10,0),new e.XYZ(-100,0,0),new e.XYZ(0,100,0),new e.XYZ(0,0,100)],{before:"new mathis.XYZ"});this.cylinderVersusSphere=true;this.$$$cylinderVersusSphere=[true,false]}i.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};i.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=this.cylinderVersusSphere;var i;if(t){var r=new e.reseau.BasisForRegularReseau;r.origin=new e.XYZ(0,-1,0);r.end=new e.XYZ(Math.PI,+1,0);r.nbI=5;r.nbJ=7;i=new e.reseau.Regular(r).go();for(var s=0;s<i.vertices.length;s++){var a=e.XYZ.newFrom(i.vertices[s].position);i.vertices[s].position.x=Math.cos(a.x);i.vertices[s].position.z=Math.sin(a.x)}}else{var n=new e.creation3D.Polyhedron(e.creation3D.PolyhedronType.Dodecahedron);i=n.go();new e.mameshModification.TriangleDichotomer(i).go();for(var s=0;s<i.vertices.length;s++){i.vertices[s].position.normalize()}}var o=new e.visu3d.VerticesViewer(i,this.mathisFrame.scene);var h=this.modelChoice;if(h==0){o.meshModel=BABYLON.Mesh.CreateCylinder("",2,0,2,20,2,this.mathisFrame.scene)}else if(h==1){o.meshModels=[BABYLON.Mesh.CreateBox("",1,this.mathisFrame.scene),BABYLON.Mesh.CreateCylinder("",1,0,1,20,2,this.mathisFrame.scene)];o.meshModels[0].position.y=-.5;o.meshModels[1].position.y=+.5;o.color=new e.Color(e.Color.names.deeppink)}else if(h==2){o.meshModel=BABYLON.Mesh.CreateDisc("",1,20,this.mathisFrame.scene);var l=new BABYLON.StandardMaterial("",this.mathisFrame.scene);l.backFaceCulling=false;l.diffuseColor=new BABYLON.Color3(0,0,1);o.meshModel.material=l}else if(h==3){var u=new e.creation3D.TwoOrTreeAxis(this.mathisFrame.scene);u.threeVersusTwoAxis=false;o.meshModels=u.go()}var c=new e.mameshAroundComputations.PositioningComputerForMameshVertices(i);c.attractionOfTangent=this.attractionForTangent;i.vertexToPositioning=c.go();o.positionings=i.vertexToPositioning;console.log(i.vertexToPositioning);o.go();var m=new e.visu3d.LinksViewer(i,this.mathisFrame.scene);m.lateralScalingConstant=.01;m.go()};return i}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(e){var t=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="mathis, what ?";this.severalParts=null}e.prototype.go=function(){var e="../../MATHIS/finalized/gauss/gauss.html";var t="http://92.222.18.63/MATHIS/finalized/gauss/gauss.html";var i='<div style="padding:2em">A young library to easily construct math objets inside browser. \n                Targeted: teachers (pedagogic tools), researchers (simulations, portfolio), and all math lovers (amazing). \n                For any comments: vincent #point vigon #hatte math #point unistra #point fr </div>';var r='<div style="padding:2em">As example, <a target="_blank" href="http://92.222.18.63/MATHIS/finalized/gauss/gauss.html">here is a mathis-application</a>,\n                illustrating the Gauss-map and the Gauss-curvature.</div>';return $("<div></div>").append(i).append(r)};return e}();e.WhyBlabla=t})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="The first page made by Toto ";var i=new t.SeveralParts;i.addPart(new r(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.TotoPage1=i;var r=function(){function t(e){this.mathisFrame=e;this.NAME="TotoTryReseau";this.TITLE="In this first part, we try to make a simple reseau";this.nbI=3;this.$$$nbI=[3,5,7];this.squareMaille=true;this.$$$squareMaille=[true,false]}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.Regular;t.nbI=this.nbI;t.nbJ=4;t.Vi=new e.XYZ(.2,0,0);t.Vj=new e.XYZ(0,.2,0);t.origine=new e.XYZ(-.7,-.7,0);t.squareVersusTriangleMaille=this.squareMaille;var i=t.go();new e.visu3d.VerticesViewer(i,this.mathisFrame.scene).go();new e.visu3d.LinksViewer(i,this.mathisFrame.scene).go();new e.visu3d.SurfaceViewer(i,this.mathisFrame.scene).go();this._nbVertices=i.vertices.length};return t}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(e){__extends(i,e);function i(t,i){e.call(this,t,i)}i.prototype.build=function(){this.severalPages.addPage(new t.BidonPage1(this.mathisFrame));this.severalPages.addPage(new t.BidonPage2(this.mathisFrame),true)};return i}(t.IndexPage);function r(){var r=new e.MathisFrame("placeForMathis");t.indexPage=new i(r,false);t.indexPage.go()}t.startTestDocuTestBidon=r})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="bidon page 1";var i=new t.SeveralParts;i.addPart(new r(this.mathisFrame));i.addPart(new s(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.BidonPage1=i;var r=function(){function t(e){this.mathisFrame=e;this.NAME="BidonPartA";this.TITLE="BidonPartA";this.CREATOR="vincent";this.nbSides=7;this.$$$nbSides=[4,7,9];this.configA1=7;this.$$$configA1=[5,6,7];this.configA2="toto_default";this.$$$configA2=["toto_default","tre",null];this.configA3=true;this.$$$configA3=[true,false];this._savedA1=5;this._saved_A2=7;this._saved_A3="bou";this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=this.mathisFrame;var i=this.configA2;var r=new e.reseau.TriangulatedPolygone(this.nbSides);r.origin=new e.XYZ(-1,-1,0);r.end=new e.XYZ(1,1,0);r.nbSubdivisionInARadius=4;var s=Math.pow(this.configA1,3);this._saved_A2=s;var a=r.go();var n=this.configA3;var o=new e.graph.DistancesBetweenAllVertices(a.vertices);o.go();var h=new e.proba.Random;var l=a.vertices[h.pseudoRandInt(a.vertices.length)];var u=a.vertices[h.pseudoRandInt(a.vertices.length)];t.messageDiv.append("distance between vertex0 and vertex1:"+o.OUT_distance(l,u));t.messageDiv.append("graph diameter:"+o.OUT_diameter);new e.visu3d.LinksViewer(a,this.mathisFrame.scene).go()};return t}();var s=function(){function t(e){this.mathisFrame=e;this.NAME="BidonPartB";this.TITLE="BidonPartB";this.CREATOR="vincent";this.configB1=5;this.$$$configB1=[5,6,7];this._savedB1=5;this._savedB2=7;this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=this.mathisFrame;var i=new e.reseau.TriangulatedPolygone(5);i.origin=new e.XYZ(-1,-1,0);i.end=new e.XYZ(1,1,0);i.nbSubdivisionInARadius=4;var r=this.configB1;var s=i.go();var a=new e.graph.DistancesBetweenAllVertices(s.vertices);a.go();var n=new e.proba.Random;var o=s.vertices[n.pseudoRandInt(s.vertices.length)];var h=s.vertices[n.pseudoRandInt(s.vertices.length)];t.messageDiv.append("distance between vertex0 and vertex1:"+a.OUT_distance(o,h));t.messageDiv.append("graph diameter:"+a.OUT_diameter);new e.visu3d.LinksViewer(s,this.mathisFrame.scene).go()};return t}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(e){var t=function(){function t(t){this.mathisFrame=t;this.pageIdAndTitle="BidonPage2";var r=new e.SeveralParts;r.addPart(new i(this.mathisFrame));this.severalParts=r}t.prototype.go=function(){return this.severalParts.go()};return t}();e.BidonPage2=t;var i=function(){function e(e){this.mathisFrame=e;this.NAME="BidonPartCbis";this.TITLE="BidonPartC";this.configC1=5;this.$$$configC1=[5,6,7];this.configC2=5;this.$$$configC2=[5,6,7];this._savedC1=5;this._savedC2=7;this._savedC3=12;this.mathisFrame=e}e.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();var e=this.mathisFrame.getGrabberCamera();this.go()};e.prototype.go=function(){var e=this.configC1};return e}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="Creation2dDocu";var i=new t.SeveralParts;i.addPart(new r(this.mathisFrame));i.addPart(new a(this.mathisFrame));i.addPart(new s(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.Creation2dDocu=i;var r=function(){function t(e){this.mathisFrame=e;this.NAME="OctavioConcentricBoard";this.TITLE="OctavioConcentricBoard";this._linesAsSortedString="";this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t;var i=new e.creation2D.Concentric(12,12);i.nbPatches=2;i.shapes=[e.creation2D.PartShape.square,e.creation2D.PartShape.polygon6];i.individualTranslation=[new e.XYZ(-.3,0,0),new e.XYZ(.3,0,0)];i.forceToGrate=[.5,.1];t=i.go();e.spacialTransformations.adjustInASquare(t,new e.XYZ(-.7,-.7,0),new e.XYZ(.7,.7,0));t.fillLineCatalogue();this._linesAsSortedString=t.allLinesAsASortedString();var r=new e.lineModule.CreateAColorIndexRespectingBifurcationsAndSymmetries(t);r.packSymmetricLines=false;var s=r.go();var a=new e.visu3d.LinesViewer(t,this.mathisFrame.scene);a.interpolationOption=new e.geometry.InterpolationOption;a.lineToLevel=s;a.interpolationOption.interpolationStyle=e.geometry.InterpolationStyle.octavioStyle;a.go()};return t}();var s=function(){function t(e){this.mathisFrame=e;this.NAME="PercoAndAssociate";this.TITLE="octavio board";this.keywords="perco";this.$$$keywords=["perco","heu","chu","ans","gag","choli","hopla","miro","3 squares","4 squares"];this._linesAsSortedString="";this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t;switch(this.keywords){case"perco":{var i=new e.reseau.TriangulatedPolygone(6);i.nbSubdivisionInARadius=7;t=i.go();var r=new e.mameshModification.PercolationOnLinks(t);r.percolationProba=.3;r.goChanging();t.isolateMameshVerticesFromExteriorVertices();var s=new e.linkModule.OppositeLinkAssocierByAngles(t.vertices);s.clearAllExistingOppositeBefore=true;s.doNotBranchOnBorder=true;s.goChanging();var a=new e.mameshModification.MameshCleaner(t);a.suppressLinkWithoutOppositeFunction=function(t){return!t.hasMark(e.Vertex.Markers.border)};a.goChanging();cc("associer.OUT_nbBranching",s.OUT_nbBranching)}break;case"heu":{var i=new e.creation2D.Concentric(7,12);i.nbPatches=3;i.shapes=[e.creation2D.PartShape.square,e.creation2D.PartShape.polygon6,e.creation2D.PartShape.square];i.propBeginToRound=[0];i.propEndToRound=[0,.5];i.individualTranslation=[new e.XYZ(-.3,0,0),new e.XYZ(0,0,0),new e.XYZ(.3,0,0)];t=i.go()}break;case"chu":{var i=new e.creation2D.Patchwork(6,6,2,2);i.patchesInQuinconce=true;i.shapes=[e.creation2D.PartShape.square];i.individualRotations=[0,Math.PI/4,0];i.individualScales=[new e.UV(1.2,1.2)];i.integerBeginToRound=[0];i.integerEndToRound=[-2];t=i.go()}break;case"ans":{var i=new e.creation2D.Patchwork(6,6,3,3);i.patchesInQuinconce=true;i.shapes=[e.creation2D.PartShape.square];i.individualRotations=[0,Math.PI/4,0];i.individualScales=[new e.UV(1.2,1.2)];i.SUB_mameshCleaner.suppressLinkWithoutOppositeFunction=function(t){return!t.hasMark(e.Vertex.Markers.border)};t=i.go()}break;case"gag":{var i=new e.creation2D.Concentric(12,12);i.nbPatches=2;i.shapes=[e.creation2D.PartShape.square,e.creation2D.PartShape.triangulatedTriangle];i.proportions=[new e.UV(1,1),new e.UV(.4,.4)];i.individualScales=[new e.UV(1,1),new e.UV(1.2,1.2)];i.SUB_mameshCleaner.suppressLinkWithoutOppositeFunction=function(t){return!t.hasMark(e.Vertex.Markers.border)};t=i.go()}break;case"choli":{var i=new e.creation2D.Concentric(7,7);i.individualTranslation=[new e.XYZ(0,0,0),new e.XYZ(.3,0,0)];i.individualRotations=[0,Math.PI/4];t=i.go()}break;case"hopla":{var i=new e.creation2D.Concentric(6,6);i.nbPatches=3;i.shapes=[e.creation2D.PartShape.square];i.proportions=[new e.UV(1,1)];i.SUB_gratAndStick.proximityCoefToStick=[2];i.SUB_gratAndStick.SUB_grater.proportionOfSeeds=[.09];var n=[0,Math.PI/3,-Math.PI/3];i.individualRotations=n;var o=.5;i.individualTranslation=[new e.XYZ(Math.cos(n[0])+1,Math.sin(n[0]),0).scale(o),new e.XYZ(Math.cos(n[1]),Math.sin(n[1]),0).scale(o),new e.XYZ(Math.cos(n[2]),Math.sin(n[2]),0).scale(o)];t=i.go()}break;case"miro":{var i=new e.creation2D.Patchwork(7,7,2,2);i.shapes=[e.creation2D.PartShape.polygon4];i.individualScales=[new e.UV(1.2,1.2)];i.patchesInQuinconce=true;i.oddPatchLinesAreTheSameVersusLongerVersusShorter=2;i.integerBeginToRound=[1];i.integerEndToRound=[-1];i.SUB_gratAndStick.SUB_grater.proportionOfSeeds=[.2];i.SUB_oppositeLinkAssocierByAngles.canCreateBifurcations=false;t=i.go()}break;case"3 squares":{var i=new e.creation2D.Patchwork(7,7,2,2);i.shapes=[e.creation2D.PartShape.polygon4];i.individualScales=[new e.UV(1.2,1.2)];i.patchesInQuinconce=true;i.oddPatchLinesAreTheSameVersusLongerVersusShorter=2;i.SUB_gratAndStick.SUB_grater.proportionOfSeeds=[.2];i.SUB_oppositeLinkAssocierByAngles.canCreateBifurcations=false;i.SUB_mameshCleaner.suppressLinkWithoutOppositeFunction=null;t=i.go()}break;case"4 squares":{var i=new e.creation2D.Patchwork(4,4,2,2);i.shapes=[e.creation2D.PartShape.polygon4];i.individualScales=[new e.UV(1,1)];i.SUB_gratAndStick.SUB_grater.seedComputedFromBarycentersVersusFromAllPossibleCells=false;t=i.go();var h=[];for(var l=0,u=i.SUB_gratAndStick.SUB_grater.OUT_allSeeds;l<u.length;l++){var c=u[l];h=h.concat(c)}}break;default:throw"keyword not known"}e.spacialTransformations.adjustInASquare(t,new e.XYZ(-.7,-.7,0),new e.XYZ(.7,.7,0));t.fillLineCatalogue();this._linesAsSortedString=t.allLinesAsASortedString();var m=new e.lineModule.CreateAColorIndexRespectingBifurcationsAndSymmetries(t);m.packSymmetricLines=false;var d=m.go();var f=new e.visu3d.LinesViewer(t,this.mathisFrame.scene);f.interpolationOption=new e.geometry.InterpolationOption;f.lineToLevel=d;f.interpolationOption.interpolationStyle=e.geometry.InterpolationStyle.octavioStyle;f.go()};return t}();var a=function(){function t(e){this.mathisFrame=e;this.NAME="SimpleTube";this.TITLE="Babylon tube function had a bug : exactly vertical lines was not draw. but it was fixed";this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=new e.reseau.Regular3D;t.origine=new e.XYZ(-.7,-.7,-.7);t.nbI=5;t.nbJ=7;var i=t.go();var r=new e.reseau.Regular;var s=r.go();i.fillLineCatalogue();i.fillLineCatalogue();var a=new e.visu3d.LinesViewer(i,this.mathisFrame.scene);a.go();var n=new e.visu3d.LinesViewer(s,this.mathisFrame.scene);n.go()};return t}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function e(e){this.mathisFrame=e;this.pageIdAndTitle="Find triangles/square from links";var i=new t.SeveralParts;i.addPart(new r(this.mathisFrame));this.severalParts=i}e.prototype.go=function(){return this.severalParts.go()};return e}();t.ConnectorTest=i;var r=function(){function t(e){this.mathisFrame=e;this.NAME="ConnectorPieceDocu";this.TITLE="How connect surfaces";this.mathisFrame=e}t.prototype.goForTheFirstTime=function(){this.mathisFrame.clearScene();this.mathisFrame.addDefaultCamera();this.mathisFrame.addDefaultLight();var t=this.mathisFrame.scene.activeCamera;t.changePosition(new e.XYZ(0,0,-5));this.go()};t.prototype.go=function(){this.mathisFrame.clearScene(false,false);var t=(new e.Vertex).setPosition(-4,-.5,0);var i=(new e.Vertex).setPosition(-3,1,0);var r=(new e.Vertex).setPosition(-1,2.5,0);var s=(new e.Vertex).setPosition(2,2,0);var a=(new e.Vertex).setPosition(3,-.5,0);var n=(new e.Vertex).setPosition(3,-2,0);var o=(new e.Vertex).setPosition(2,-3,-1);var h=(new e.Vertex).setPosition(-.5,-3,0);var l=(new e.Vertex).setPosition(-2.5,-3,0);var u=(new e.Vertex).setPosition(-2.5,-1,0);var c=(new e.Vertex).setPosition(-0,0,0);var m=(new e.Vertex).setPosition(1.5,-1.5,0);var d=new e.Mamesh;d.vertices.push(t,i,r,s,a,n,o,h,l,u,c,m);t.setOneLink(i);i.setOneLink(t);i.setOneLink(r);r.setOneLink(i);r.setOneLink(s);s.setOneLink(r);s.setOneLink(a);a.setOneLink(s);a.setOneLink(n);n.setOneLink(a);n.setOneLink(o);o.setOneLink(n);o.setOneLink(h);h.setOneLink(o);h.setOneLink(l);l.setOneLink(h);l.setOneLink(t);t.setOneLink(l);u.setOneLink(t);t.setOneLink(u);u.setOneLink(i);i.setOneLink(u);u.setOneLink(l);l.setOneLink(u);c.setOneLink(s);s.setOneLink(c);c.setOneLink(h);h.setOneLink(c);c.setOneLink(u);u.setOneLink(c);m.setOneLink(n);n.setOneLink(m);m.setOneLink(h);h.setOneLink(m);var f=new e.surfaceConnection.SurfaceConnectionProcess(d);d=f.go();var p=0;if(p==0){var v=new e.visu3d.VerticesViewer(d,this.mathisFrame.scene);v.go()}var g=new e.visu3d.LinksViewer(d,this.mathisFrame.scene);g.go();var w=new e.visu3d.SurfaceViewer(d,this.mathisFrame.scene);w.go()};return t}()})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){var t=BABYLON.Color3;var i;(function(i){var r=BABYLON.StandardMaterial;function s(){var t=document.getElementById("mainDiv");var i=new e.MathisFrame("surfaceMathisFrame",false);var r=new e.MathisFrame("sphereMathisFrame",false);var s=e.legend("30px",t,false);new o(i,r,s)}i.start=s;var a=function(){function i(i,r,s,a,n){this.sizes=new e.XYZ(1,1,1);this.arrowColor=new t(1,0,0);this.planeColor=new t(0,0,1);this.planeRadius=.2;this.tangentDiameter=.1;this.cartes=i;this.surfaceScene=r;this.cam=a;this.sphereScene=s;this.surface=n}i.prototype.checkOrientation=function(t,i,r){var s=e.XYZ.newFrom(this.cam.trueCamPos.position).substract(r.X(t,i));if(e.geo.dot(s,r.newN(t,i))<0)r.orientationCoef*=-1};i.prototype.oneArrowOnOneScene=function(t,i,r,s){var a=new e.creation3D.ArrowCreator(r);var n=a.go();n.position=t;n.rotationQuaternion=i;var o=new BABYLON.StandardMaterial("",r);o.diffuseColor=this.arrowColor;n.material=o;n.scaling=s;return n};i.prototype.drawNormalVectors=function(t,i,r){this.checkOrientation(t,i,r);var s=new e.Positioning;s.upVector=r.newN(t,i);var a=s.quaternion();var n=this.oneArrowOnOneScene(r.X(t,i),a,this.surfaceScene,this.sizes);var o=this.oneArrowOnOneScene(new e.XYZ(0,0,0),a.clone(),this.sphereScene,new e.XYZ(this.sizes.x,1,this.sizes.z));return{initial:n,onSphere:o}};i.prototype.oneTangentPlane=function(t,i,r,s,a){if(a===void 0){a=null}var n=BABYLON.Mesh.CreateDisc("",this.planeRadius,60,s);var o=new e.XYZW(0,0,0,0);e.geo.aQuaternionMovingABtoCD(new e.XYZ(0,0,1),new e.XYZ(1,0,0),t.scale(-1),i,o,false);n.rotationQuaternion=o;n.position=r;var h=new BABYLON.StandardMaterial("",s);h.sideOrientation=BABYLON.Mesh.DOUBLESIDE;h.diffuseColor=this.planeColor;h.backFaceCulling=false;n.material=h;if(a!=null){n.onClick=a}return n};i.prototype.drawOneTangentVector=function(i,s,a){if(e.geo.distance(i,s)<2*e.geo.epsilon)return;var n=new e.creation3D.ArrowCreator(a);n.arrowFootAtOrigin=false;var o=n.go();var h=new r("",a);h.diffuseColor=new t(1,0,0);o.material=h;var l=new e.visu3d.ElongateAMeshFromBeginToEnd(i,s,o);l.lateralScaling=this.tangentDiameter*2;l.goChanging();return o};i.prototype.drawTangentPlanes=function(t,i,r,s,a){var n=this;this.checkOrientation(t,i,r);var o=null;if(s){this.surface.isPickable=false;o=function(s){a.push(n.drawOneTangentVector(r.X(t,i),s,n.surfaceScene));var o=e.XYZ.newFrom(s).substract(r.X(t,i));var h=r.dNaction(t,i,o);var l=r.newN(t,i);var u=e.XYZ.newFrom(l).add(h);a.push(n.drawOneTangentVector(l,u,n.sphereScene))}}a.push(this.oneTangentPlane(r.newN(t,i),r.Xu(t,i),r.X(t,i),this.surfaceScene,o));a.push(this.oneTangentPlane(r.newN(t,i),r.Xu(t,i),r.newN(t,i),this.sphereScene))};return i}();var n;(function(e){e[e["vue_libre"]=0]="vue_libre";e[e["vue_de_face"]=1]="vue_de_face";e[e["vue_de_dos"]=2]="vue_de_dos";e[e["vue_de_gauche"]=3]="vue_de_gauche";e[e["vue_de_droite"]=4]="vue_de_droite";e[e["vue_du_haut"]=5]="vue_du_haut";e[e["vue_du_bas"]=6]="vue_du_bas"})(n||(n={}));var o=function(){function i(t,i,r){var s=this;this.meshesToDispose=[];this.normalize=false;this.mode=0;this.$tangentSpace=null;this.$surfaceName=null;this.$pointOfVue=null;this.$courbure=null;this.recul=-3;this.pointOfViewToPos=[null,new e.XYZ(0,0,this.recul),new e.XYZ(0,0,-this.recul),new e.XYZ(this.recul,0,0),new e.XYZ(-this.recul,0,0),new e.XYZ(0,this.recul,0),new e.XYZ(0,-this.recul,0)];this.pointOfViewToUpVector=[null,new e.XYZ(0,1,0),new e.XYZ(0,1,0),new e.XYZ(0,1,0),new e.XYZ(0,1,0),new e.XYZ(0,0,1),new e.XYZ(0,0,1)];this.surfaceScene=t.scene;this.sphereScene=i.scene;this.surfaceMathisFrame=t;this.localButtonPlace=r;this.createGaussSphereScene(i);this.createSurfaceScene(t);this.createSurface(e.riemann.SurfaceName.torus);this.drawNormalVector=new a(this.surface.cartes,this.surfaceScene,this.sphereScene,this.surfaceCamera,this.meshSurf);this.drawNormalVector.sizes=new e.XYZ(.1,.1,.1);this.resetInitialClick();this.addControlButton();this.surfaceCamera.onPositioningChange=function(e){s.onPositioningChange(e)}}i.prototype.createSurface=function(t){var i=new e.riemann.SurfaceMaker(t);this.surface=i.go();this.drawMesh(this.surface.wholeSurfaceMesh)};i.prototype.onPositioningChange=function(e){{var t=this.sphereCamera.trueCamPos.position.length();e.position.normalize().scale(t);this.sphereCamera.trueCamPos.copyFrom(e);this.sphereCamera.whishedCamPos.copyFrom(e);this.$pointOfVue.selectedIndex=0}};i.prototype.setMapMode=function(){this.mode=0;this.normalize=false};i.prototype.setDifferenceMode=function(){this.mode=1;this.normalize=false};i.prototype.setNormalisedDifferenceMode=function(){this.mode=2;this.normalize=true};i.prototype.setDeriveMode=function(){this.mode=3;this.normalize=false;this.$tangentSpace.selectedIndex=2};i.prototype.addControlButton=function(){var t=this;window.onload=function(){{var i=e.allStringValueOfEnume(e.riemann.SurfaceName);t.$surfaceName=document.createElement("select");t.localButtonPlace.appendChild(t.$surfaceName);for(var r=0;r<i.length;r++){var s=document.createElement("option");s.value=i[r];s.text=i[r];t.$surfaceName.appendChild(s)}t.$surfaceName.onchange=function(){t.clearAll();t.createSurface(t.$surfaceName.selectedIndex);t.drawNormalVector=new a(t.surface.cartes,t.surfaceScene,t.sphereScene,t.surfaceCamera,t.meshSurf);t.drawNormalVector.sizes=new e.XYZ(.1,.1,.1)}}{var o=e.allStringValueOfEnume(n);t.$pointOfVue=document.createElement("select");t.localButtonPlace.appendChild(t.$pointOfVue);for(var r=0;r<o.length;r++){var s=document.createElement("option");s.value=o[r];s.text=o[r];t.$pointOfVue.appendChild(s)}t.$pointOfVue.onchange=function(i){if(t.$pointOfVue.selectedIndex>0){var r=e.XYZ.newFrom(t.pointOfViewToPos[t.$pointOfVue.selectedIndex]);var s=e.XYZ.newFrom(t.pointOfViewToUpVector[t.$pointOfVue.selectedIndex]);var a=new e.Positioning;a.position=r;a.frontDir=e.XYZ.newFrom(r).scale(-1);a.upVector=s;t.surfaceCamera.trueCamPos.copyFrom(a);t.surfaceCamera.whishedCamPos.copyFrom(a);t.sphereCamera.trueCamPos.copyFrom(a);t.sphereCamera.whishedCamPos.copyFrom(a)}};t.$pointOfVue.selectedIndex=1;t.$pointOfVue.onchange(null)}{var h=["gauss map","difference","différence normalisé"];var l=document.createElement("select");t.localButtonPlace.appendChild(l);for(var r=0;r<h.length;r++){var s=document.createElement("option");s.value=h[r];s.text=h[r];l.appendChild(s)}l.onchange=function(){if(l.selectedIndex==0)t.setMapMode();else if(l.selectedIndex==1)t.setDifferenceMode();else if(l.selectedIndex==2)t.setNormalisedDifferenceMode();else if(l.selectedIndex==3)t.setDeriveMode()}}{var h=["pas d'espace tangent","petit espace tangent","grand espace tangent"];t.$tangentSpace=document.createElement("select");t.localButtonPlace.appendChild(t.$tangentSpace);for(var r=0;r<h.length;r++){var s=document.createElement("option");s.value=h[r];s.text=h[r];t.$tangentSpace.appendChild(s)}}{var u=document.createElement("button");u.classList.add("buttonClear");u.innerHTML='<i class="fa fa-eraser"></i>';u.onclick=function(){t.clearAllSecondaryMeshes()};t.localButtonPlace.appendChild(u);t.$courbure=document.createElement("span");t.localButtonPlace.appendChild(t.$courbure);t.$surfaceName.selectedIndex=e.riemann.SurfaceName.torus}}};i.prototype.clearAllSecondaryMeshes=function(){this.meshesToDispose.forEach(function(e){if(e!=null)e.dispose()});this.meshesToDispose=[];this.resetInitialClick()};i.prototype.resetInitialClick=function(){var e=this;this.meshSurf.isPickable=true;this.meshSurf.onClick=function(t){e.firstClick(t)}};i.prototype.clearAll=function(){this.clearAllSecondaryMeshes();this.meshSurf.dispose();this.linesOnSurf.forEach(function(e){return e.dispose()});this.$pointOfVue.selectedIndex=1;this.$pointOfVue.onchange(null)};i.prototype.firstClick=function(i){var r=this;var s=this.surface.findBestCarte(i);var a=s.uv;var n=s.carte;var o;if(this.mode==0)o=new t(Math.random(),Math.random(),Math.random());else o=new t(0,1,0);this.drawNormalVector.arrowColor=o;var h=this.drawNormalVector.drawNormalVectors(a.u,a.v,n);this.meshesToDispose.push(h.initial);this.meshesToDispose.push(h.onSphere);if(this.$tangentSpace.selectedIndex!=0){if(this.$tangentSpace.selectedIndex==1)this.drawNormalVector.planeRadius=.03;else if(this.$tangentSpace.selectedIndex==2)this.drawNormalVector.planeRadius=.1;this.drawNormalVector.drawTangentPlanes(a.u,a.v,n,this.mode==3,this.meshesToDispose)}if(this.mode==1||this.mode==2){this.meshSurf.onClick=function(e){var t=r.surface.findBestCarte(e);if(t.carte!=n){cc("the second click is too far from the first: they arrived on different cart-image")}else{r.secondClick(a,t.uv,t.carte)}r.resetInitialClick()}}var l=e.roundWithGivenPrecision(n.dNinTangentBasis(a.u,a.v).determinant(),1);this.$courbure.textContent=" Courbure:"+l};i.prototype.secondClick=function(t,i,r){var s=this;var a=e.geo.distance(r.X(t.u,t.v),r.X(i.u,i.v));var n=e.geo.distance(r.newN(t.u,t.v),r.newN(i.u,i.v));var o=[];var h=.01;var l=0;var u=this.mode==1?.8:.95;while(l<u){o.push(l);l+=h}var c=0;var m=r.X(t.u,t.v);var d=null;var f={initial:null,onSphere:null};var p=new e.PeriodicAction(function(){var h=new e.UV(0,0);e.geo.betweenUV(i,t,o[c],h);if(d!=null){d.initial.dispose();d.onSphere.dispose()}d=s.drawNormalVector.drawNormalVectors(h.u,h.v,r);c++;if(c!=o.length+1){if(f.initial!=null)f.initial.dispose();if(f.onSphere!=null)f.onSphere.dispose()}var l;var u;if(s.normalize){var p=r.X(h.u,h.v).substract(m);if(p.lengthSquared()<e.geo.epsilonSquare)return;p.normalize().scale(a);l=e.XYZ.newFrom(m).add(p);var v=r.newN(h.u,h.v).substract(r.newN(t.u,t.v));if(v.length()>e.geo.epsilon)v.normalize().scale(n);u=e.XYZ.newFrom(r.newN(t.u,t.v)).add(v)}else{l=r.X(h.u,h.v);u=r.newN(h.u,h.v)}f.initial=s.drawNormalVector.drawOneTangentVector(m,l,s.surfaceScene);f.onSphere=s.drawNormalVector.drawOneTangentVector(r.newN(t.u,t.v),u,s.sphereScene);s.meshesToDispose.push(f.initial);s.meshesToDispose.push(f.onSphere)});p.nbTimesThisActionMustBeFired=o.length+1;p.timeIntervalMilli=3e3/o.length;this.surfaceMathisFrame.pushPeriodicAction(p)};i.prototype.createGaussSphereScene=function(i){var r=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-1,1,-1),i.scene);r.diffuse=new BABYLON.Color3(1,1,1);r.specular=new BABYLON.Color3(1,1,1);r.groundColor=new BABYLON.Color3(0,0,0);var s=new e.macamera.SphericalGrabber(i.scene,new e.XYZ(1,1,1));s.endOfZone1=0;s.endOfZone2=0;s.mesh.visibility=1;s.showGrabberOnlyWhenGrabbing=false;var a=new BABYLON.StandardMaterial("",i.scene);a.alpha=.3;a.diffuseColor=new t(1,1,1);s.mesh.material=a;var n=new e.macamera.GrabberCamera(i,s);n.useFreeModeWhenCursorOutOfGrabber=false;this.sphereCamera=n};i.prototype.createSurfaceScene=function(t){var i=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-1,1,-1),t.scene);i.diffuse=new BABYLON.Color3(1,1,1);i.specular=new BABYLON.Color3(1,1,1);i.groundColor=new BABYLON.Color3(0,0,0);var r=new e.macamera.SphericalGrabber(t.scene,new e.XYZ(1,1,1));r.endOfZone1=2;r.endOfZone2=2;r.showGrabberOnlyWhenGrabbing=true;var s=new e.macamera.GrabberCamera(t,r);s.showPredefinedConsoleLog=false;s.useFreeModeWhenCursorOutOfGrabber=false;this.surfaceCamera=s};i.prototype.drawMesh=function(t){var i=new e.lineModule.LineComputer(t);i.startingVertices=[];for(var r=0,s=t.vertices;r<s.length;r++){var a=s[r];if(a.param.x%4==0&&a.param.y==0)i.startingVertices.push(a);if(a.param.x==0&&a.param.y%4==0)i.startingVertices.push(a)}i.go();var n=new e.visu3d.LinesViewer(t,this.surfaceScene);n.constantRadius=.004;this.linesOnSurf=n.go();this.linesOnSurf.forEach(function(e){return e.isPickable=false});var o=new e.visu3d.SurfaceViewer(t,this.surfaceScene);this.meshSurf=o.go();this.resetInitialClick()};return i}()})(i=e.gauss||(e.gauss={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){function i(){var e=Math.floor(Math.random()*3);if(e==0)s(document.getElementById("platonic"));else if(e==1)a(document.getElementById("platonic"));else if(e==2)n(document.getElementById("platonic"))}t.start=i;function r(e,t,i){var r=document.createElement("div");i.appendChild(r);r.style.display="inline-block";r.style.position="absolute";r.style.left="0";r.style.width="100%";r.style.height="30px";r.style.top="0";r.style.backgroundColor="indianred";r.style.zIndex="9";r.style.textAlign="center";r.innerHTML=e;var s=document.createElement("span");s.style.height="30px";s.textContent="(cliquez ici pour voir un texte de modélisation associé)";s.classList.add("clickable");r.appendChild(s);s.onclick=function(){window.open("agregAssets/"+t)};var a=document.createElement("div");i.appendChild(a);a.style.display="inline-block";a.style.position="absolute";a.style.top="0";a.style.right="0";a.style.width="30px";a.style.height="30px";a.style.lineHeight="30px";a.style.backgroundColor="indianred";a.style.zIndex="10";a.style.textAlign="center";a.textContent="+";a.style.fontSize="large";a.classList.add("clickable");function n(){r.style.visibility="visible";a.textContent="-";a.onclick=function(){o()}}function o(){r.style.visibility="hidden";a.textContent="+";a.onclick=function(){n()}}o()}function s(t){function i(t,i,r,s,a,n){var o=500;var h=.1;var l;{l=BABYLON.Mesh.CreatePlane("",1,n.scene);l.scaling=new e.XYZ(t,i,0);l.position=new e.XYZ(0,0,.06);l.bakeCurrentTransformIntoVertices();l.visibility=0;var u=new e.macamera.PlanarGrabber(n.scene,new e.XYZ(t,i,.061));u.mesh.visibility=0;var c=new e.macamera.GrabberCamera(n,u);c.checkCollisions=false;c.useFreeModeWhenCursorOutOfGrabber=false;c.changePosition(new e.XYZ(0,0,-2),false);c.attachControl(n.canvas);var m=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-1,1,-1),n.scene);m.diffuse=new BABYLON.Color3(.5,.5,.5);m.specular=new BABYLON.Color3(.7,.7,.7);m.groundColor=new BABYLON.Color3(1,1,1)}var d;var f;{var p=new e.reseau.BasisForRegularReseau;p.nbI=30;p.nbJ=10;p.origin=r;p.end=new e.XYZ(t/2,i/2,0);var v=new e.reseau.Regular(p);v.squareVersusTriangleMaille=false;d=v.go();var g=new e.mameshAroundComputations.PositioningComputerForMameshVertices(d);g.computeTangent=false;g.sizesProp=new e.XYZ(.15,.15,.15);f=g.go()}{var w=[];var y=BABYLON.Mesh.CreateCylinder("",2,0,1,6,null,n.scene);var b=new e.XYZW(0,0,0,0);e.geo.axisAngleToQuaternion(new e.XYZ(0,0,1),-Math.PI/2,b);y.rotationQuaternion=b;y.bakeCurrentTransformIntoVertices();var T=new BABYLON.StandardMaterial("",n.scene);T.diffuseColor=new BABYLON.Color3(0,0,1);y.material=T;var M=.03;for(var C=0;C<o;C++)w.push(a);var S=BABYLON.Mesh.CreateTube("",w,M,10,null,BABYLON.Mesh.CAP_ALL,n.scene,true);var x=new BABYLON.StandardMaterial("",n.scene);x.diffuseColor=e.myFavoriteColors.green;S.material=x;var F=BABYLON.Mesh.CreateSphere("",10,M*2.5,n.scene);var V=new BABYLON.StandardMaterial("",n.scene);V.diffuseColor=new BABYLON.Color3(1,0,0);F.material=V;F.position.copyFrom(a);d.vertices.forEach(function(e){s(0,e.position,f.getValue(e).frontDir)});var k=new e.visu3d.VerticesViewer(d,n.scene,f);k.meshModel=y;k.go();function O(e,t,i){s(t,e,i);i.scale(h);i.add(e)}var A=[];d.vertices.forEach(function(e){return A.push(e)});var P=function(e,t){return e.customerObject.squareLengthOfTangent-t.customerObject.squareLengthOfTangent};var L=f.getValue(d.vertices[0]).scaling.x;var B=0;var Y=0;var I=new e.PeriodicAction(function(){B+=h;Y++;var t=new e.XYZ(0,0,0);O(w[w.length-1],B,t);if(Y<o){for(var i=Y;i<o;i++)w[i]=t}else{w.splice(0,1);w.push(t)}S=BABYLON.Mesh.CreateTube("",w,M,null,null,null,null,true,null,S);F.position=t;d.vertices.forEach(function(e){e.customerObject.squareLengthOfTangent=f.getValue(e).frontDir.lengthSquared()});A.sort(P);for(var i=0;i<A.length;i++)A[i].customerObject.scaleFromOrder=i/A.length;d.vertices.forEach(function(e){var t=f.getValue(e);s(B,e.position,t.frontDir);t.scaling.x=2*L*(e.customerObject.scaleFromOrder+1/4);var i=L*Math.max(1,e.customerObject.scaleFromOrder+1/2);t.scaling.y=i;t.scaling.z=i});k.updatePositionings()});I.id="main action";n.pushPeriodicAction(I);l.onClick=function(t){var i=new e.PeriodicAction(function(){for(var e=0;e<o;e++)w[e]=t;Y=0;F.position=t});i.nbTimesThisActionMustBeFired=1;i.id="click action";i.passageOrderIndex=2;n.pushPeriodicAction(i)}}}r("<span> Trois systèmes dynamiques avec des coefficients périodiques </span>","public2014-B1.pdf",t);var s=5;var a=2;var n=new e.XYZ(-s/2,-a/2,0);function o(e,t){t.copyFrom(e);t.substract(n);t.x/=s;t.y/=a}function h(e,t){t.copyFrom(e);t.x*=s;t.y*=a;t.add(n)}var l;{var u=new e.XYZ(0,0,0);var c=function(e){return.4*Math.sin(.5*e)};var m=function(e){return.2*Math.sin(.5*e)};var d=function(e){return 0};var f=function(e){return 0};var p=function(e){return 0};var v=function(e){return 0};l=function(e,t,i){o(t,u);var r=(u.x-.5)*2;var s=(u.y-.5)*4;i.x=-r*s*s;i.y=-r*r*s;i.x+=u.x*(c(e)+d(e)*u.x+f(e)*u.y);i.y+=u.y*(m(e)+p(e)*u.x+v(e)*u.y)}}var g;{var w=new e.XYZ(0,0,0);var y=function(e){return.4*Math.sin(e)};var b=function(e){return.2*Math.sin(.5*e)};var T=function(e){return.1*Math.sin(e)};var M=function(e){return-.1*Math.sin(e)};var C=function(e){return-.1*Math.sin(e)};var S=function(e){return.1*Math.sin(e)};g=function(e,t,i){o(t,w);var r=(w.x-.5)*2;var s=(w.y-.5)*4;i.x=-r*s*s;i.y=-r*r*s;i.x+=w.x*(y(e)+T(e)*w.x+M(e)*w.y);i.y+=w.y*(b(e)+C(e)*w.x+S(e)*w.y)}}var x;{var F=new e.XYZ(0,0,0);var V=function(e){return.4*Math.sin(.5*e)};var k=function(e){return.2*Math.sin(.3*e)};var O=function(e){return 0};var A=function(e){return 0};var P=function(e){return 0};var L=function(e){return.1*Math.sin(e)};x=function(e,t,i){o(t,F);var r=(F.x-.5)*2;var s=(F.y-.5)*4;i.x=-r*s*s;i.y=-r*r*s;i.x+=F.x*(V(e)+O(e)*F.x+A(e)*F.y);i.y+=F.y*(k(e)+P(e)*F.x+L(e)*F.y)}}var B=[];var Y=[];var I=e.nDivInOneLine(3,t,"1px solid");for(var $=0;$<3;$++){var D=new e.MathisFrame(I[$],false);B.push(D);var N=e.legend("30px",D.canvasParent);Y.push(N)}i(s,a,n,l,new e.XYZ(s*.3,a*.2,0),B[0]);i(s,a,n,g,new e.XYZ(-s*.4,a*.1,0),B[1]);i(s,a,n,x,new e.XYZ(s*.3,a*.2,0),B[2])}function a(t){function i(t,i){var r=i.scene;var s=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-1,0,-.7),r);s.diffuse=new BABYLON.Color3(1,1,1);s.specular=new BABYLON.Color3(.5,.5,.5);s.groundColor=new BABYLON.Color3(0,0,0);var a=new e.macamera.SphericalGrabber(r,new e.XYZ(1,1,1));a.mesh.visibility=0;a.endOfZone1=0;a.endOfZone2=0;var n=new e.macamera.GrabberCamera(i,a);n.useFreeModeWhenCursorOutOfGrabber=false;n.changePosition(new e.XYZ(0,0,-4),false);var o=new BABYLON.Mesh("",r);var h=new e.creation3D.Polyhedron(t);var l=h.go();l.fillLineCatalogue();var u=BABYLON.Mesh.CreateCylinder("",1,1,1,20,null,r);u.convertToFlatShadedMesh();var c=new BABYLON.StandardMaterial("",r);c.diffuseColor=e.myFavoriteColors.green;u.material=c;var m=new e.visu3d.LinksViewer(l,r);m.meshModel=u;m.parentNode=o;m.segmentOrientationFunction=function(t,i){if(t.hasMark(e.Vertex.Markers.polygonCenter)||i.hasMark(e.Vertex.Markers.polygonCenter))return 0;return 1};m.go();var d=new e.visu3d.SurfaceViewer(l,r);d.parentNode=o;d.alpha=.7;d.go();var f=new e.mameshAroundComputations.PositioningComputerForMameshVertices(l);f.sizesProp=new e.XYZ(.2,.2,.2);var p=[];l.vertices.forEach(function(t){if(!t.hasMark(e.Vertex.Markers.polygonCenter))p.push(t)});var v=new e.visu3d.VerticesViewer(l,r,f.go());v.parentNode=o;v.vertices=p;v.go();return o}var r=e.nDivInOneLine(5,t,"1px solid");var s=[];var a=[];for(var n=0;n<5;n++){var o=new e.MathisFrame(r[n],false);s.push(o);var h=e.legend("30px",o.canvasParent);a.push(h)}var l=i(e.creation3D.PolyhedronType.Tetrahedron,s[0]);a[0].innerHTML="<p style='text-align: center'> tétraèdre </p>";var u=i(e.creation3D.PolyhedronType.Cube,s[1]);a[1].innerHTML="<p style='text-align: center'> cube </p>";var c=i(e.creation3D.PolyhedronType.Octahedron,s[2]);a[2].innerHTML="<p style='text-align: center'> octaèdre </p>";var m=i(e.creation3D.PolyhedronType.Dodecahedron,s[3]);a[3].innerHTML="<p style='text-align: center'> dodécaèdre </p>";var d=i(e.creation3D.PolyhedronType.Icosahedron,s[4]);a[4].innerHTML="<p style='text-align: center'> icosaèdre </p>"}function n(t){r("<span>plus beta est grand, et plus les particules de même couleur s'attirent </span>","public2009-A3.pdf",t);var i=e.nDivInOneLine(3,t,"1px solid");var s=5;var a=1.1;var n=[a,a,a];var o=[0,.5,1];for(var h=0;h<3;h++){var l=new e.MathisFrame(i[h],false);c(l,n[h],o[h],1);var u=e.legend("30px",l.canvasParent);u.innerHTML="<p style='text-align: center'>&beta;="+o[h]+"</p>"}function c(t,i,r,a){var n=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-1,1,-1),t.scene);n.diffuse=new BABYLON.Color3(1,1,1);n.specular=new BABYLON.Color3(1,1,1);n.groundColor=new BABYLON.Color3(0,1,0);var o=new e.XYZ(0,0,0);var h=new e.macamera.SphericalGrabber(t.scene,new e.XYZ(a,a,a),o);h.mesh.material.alpha=1;h.endOfZone1=0;h.endOfZone2=0;var l=new e.macamera.GrabberCamera(t,h);l.useFreeModeWhenCursorOutOfGrabber=false;l.changePosition(new e.XYZ(0,0,-4),false);l.attachControl(t.canvas);var u=new e.creation3D.Polyhedron(e.creation3D.PolyhedronType.Dodecahedron);var c=u.go();new e.mameshModification.TriangleDichotomer(c).go();new e.mameshModification.TriangleDichotomer(c).go();new e.mameshModification.TriangleDichotomer(c).go();c.vertices.forEach(function(e){e.position.normalize().scale(a).add(o)});var m=new e.metropolis.IsingModel(c.vertices);m.beta=r;m.q=i;m.nbActionsPerIteration=100;m.go();function d(i){var r=BABYLON.Mesh.CreateSphere("",6,1,t.scene);var s=new BABYLON.StandardMaterial("",t.scene);s.diffuseColor=i;r.material=s;var a=new e.XYZW(0,0,0,0);e.geo.axisAngleToQuaternion(new e.XYZ(1,0,0),Math.PI/2,a);r.rotationQuaternion=a;return r}function f(i){var r=BABYLON.Mesh.CreateDisc("",.5,6,t.scene,false,BABYLON.Mesh.BACKSIDE);var s=new BABYLON.StandardMaterial("",t.scene);s.diffuseColor=i;r.material=s;var a=new e.XYZW(0,0,0,0);e.geo.axisAngleToQuaternion(new e.XYZ(1,0,0),Math.PI/2,a);r.rotationQuaternion=a;return r}function p(e){var i=BABYLON.Mesh.CreateCylinder("",.1,1,1,6,null,t.scene);var r=new BABYLON.StandardMaterial("",t.scene);r.diffuseColor=e;i.material=r;return i}var v=d(new BABYLON.Color3(1,0,0));var g=d(new BABYLON.Color3(0,0,1));var w=new e.mameshAroundComputations.PositioningComputerForMameshVertices(c);w.sizesProp=new e.XYZ(1,1,1);var y=w.go();var b=new e.HashMap;c.vertices.forEach(function(t){var i=new e.Positioning;i.copyFrom(y.getValue(t));i.scaling.copyFromFloats(0,0,0);b.putValue(t,i)});var T=new e.HashMap;c.vertices.forEach(function(t){var i=new e.Positioning;i.copyFrom(y.getValue(t));i.scaling.copyFromFloats(0,0,0);T.putValue(t,i)});var M=new e.visu3d.VerticesViewer(c,t.scene);M.positionings=b;M.meshModel=v;M.go();var C=new e.visu3d.VerticesViewer(c,t.scene);C.positionings=T;C.meshModel=g;C.go();var S=y.getValue(c.vertices[0]).scaling;var x=0;var F=new e.PeriodicAction(function(){var e=m.iterateAndGetChangedVertices();e.allKeys().forEach(function(e){if(e.customerObject.value==0){b.getValue(e).scaling.copyFromFloats(0,0,0);T.getValue(e).scaling.copyFromFloats(0,0,0)}else if(e.customerObject.value==1){b.getValue(e).scaling.copyFrom(S);T.getValue(e).scaling.copyFromFloats(0,0,0)}else if(e.customerObject.value==-1){T.getValue(e).scaling.copyFrom(S);b.getValue(e).scaling.copyFromFloats(0,0,0)}});M.updatePositionings();C.updatePositionings()});F.frameInterval=s;t.pushPeriodicAction(F)}}})(t=e.siteAgreg||(e.siteAgreg={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){function i(){var t=new e.MathisFrame(null,false);t.resetScene();t.addDefaultCamera();t.addDefaultLight();var i=BABYLON.Mesh.CreateBox("",1,t.scene);var r=new BABYLON.StandardMaterial("",t.scene);r.diffuseColor=new BABYLON.Color3(1,0,0);i.material=r}t.start=i;function r(t){var i=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-1,1,-1),t.scene);i.diffuse=new BABYLON.Color3(1,1,1);i.specular=new BABYLON.Color3(1,1,1);i.groundColor=new BABYLON.Color3(.5,.5,.5);var r=new e.XYZ(3,0,0);var s=2;var a=new e.macamera.SphericalGrabber(t.scene,new e.XYZ(s,s,s),r);a.mesh.material.alpha=.6;a.showGrabberOnlyWhenGrabbing=false;a.endOfZone1=0;a.endOfZone2=0;var n=new e.macamera.GrabberCamera(t,a);n.useFreeModeWhenCursorOutOfGrabber=false;n.changePosition(new e.XYZ(-1,-1,-10),false);n.attachControl(t.canvas);var o=BABYLON.Mesh.CreateBox("",1,t.scene);var h=new BABYLON.StandardMaterial("",t.scene);h.diffuseColor=new BABYLON.Color3(1,0,0);o.material=h}function s(t){var i=5;var r=2;var s=new e.XYZ(-i/2,-r/2,0);function a(e,t){t.copyFrom(e);t.substract(s);t.x/=i;t.y/=r}function n(e,t){t.copyFrom(e);t.x*=i;t.y*=r;t.add(s)}var o;{var h=new e.XYZ(0,0,0);var l=function(e){return.4*Math.sin(.5*e)};var u=function(e){return.2*Math.sin(.5*e)};var c=function(e){return 0};var m=function(e){return 0};var d=function(e){return 0};var f=function(e){return 0};o=function(e,t,i){a(t,h);var r=(h.x-.5)*2;var s=(h.y-.5)*4;i.x=-r*s*s;i.y=-r*r*s;i.x+=h.x*(l(e)+c(e)*h.x+m(e)*h.y);i.y+=h.y*(u(e)+d(e)*h.x+f(e)*h.y)}}var p=new e.differentialSystem.TwoDim(o,t);p.go()}function a(t){var i=new e.mecaStat.IsingOnMesh(t);i.go()}function n(t){var i=new e.infiniteWorlds.InfiniteCartesian(t);i.nbRepetition=8;i.nbSubdivision=3;i.fondamentalDomainSize=6;i.nbHorizontalDecays=1;i.nbVerticalDecays=1;i.nameOfResau3d=e.infiniteWorlds.NameOfReseau3D.cube;i.collisionForCamera=true;i.collisionOnLinks=true;i.collisionOnVertices=true;var r=BABYLON.Mesh.CreateSphere("",5,10,t.scene);r.position=new e.XYZ(1,1,1);i.go();i.seeWorldFromInside()}})(t=e.testFront||(e.testFront={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(e){__extends(i,e);function i(t,i){e.call(this,t,i)}i.prototype.build=function(){this.severalPages.addPage(new t.WhyBlabla(this.mathisFrame));this.severalPages.addPage(new t.PureJavascriptTuto);this.severalPages.addPage(new t.TypescriptTuto);this.severalPages.addPage(new t.MathisFrameDocu(this.mathisFrame));this.severalPages.addPage(new t.BasicDocu(this.mathisFrame));this.severalPages.addPage(new t.ReseauDocu(this.mathisFrame));this.severalPages.addPage(new t.SurfaceDocu(this.mathisFrame));this.severalPages.addPage(new t.LinksDocu(this.mathisFrame));this.severalPages.addPage(new t.MacamDocu(this.mathisFrame));this.severalPages.addPage(new t.VerticesViewingDocu(this.mathisFrame));this.severalPages.addPage(new t.LinesViewingDocu(this.mathisFrame));this.severalPages.addPage(new t.LinksViewingDocu(this.mathisFrame));this.severalPages.addPage(new t.SurfaceViewerDocu(this.mathisFrame));this.severalPages.addPage(new t.GraphDistance(this.mathisFrame));this.severalPages.addPage(new t.GrateMergeStick(this.mathisFrame));this.severalPages.addPage(new t.DichoDocu(this.mathisFrame));this.severalPages.addSeparator("CONSTRUCTIONS EXAMPlE");this.severalPages.addPage(new t.SolidsDocu(this.mathisFrame));this.severalPages.addPage(new t.TorusPlatonicDocu(this.mathisFrame));this.severalPages.addSeparator("FOR COLLABORATORS");this.severalPages.addPage(new t.ColaborateWithGit);this.severalPages.addPage(new t.DocutestTuto);this.severalPages.addPage(new t.DocutestTutoAdvanced);this.severalPages.addSeparator("PURE TEST (NO DOCU)",true);this.severalPages.addPage(new t.Creation2dDocu(this.mathisFrame),true);this.severalPages.addSeparator("GUILLAUME'S PAGES",true);this.severalPages.addPage(new t.ConnectorTest(this.mathisFrame),true)};return i}(t.IndexPage);function r(){var r=new e.MathisFrame("placeForMathis");t.indexPage=new i(r,false);t.indexPage.go()}t.startSite=r})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){function t(){var t=true;if(t){var i=new e.MathisFrame(null,false);var r=new e.macamera.SphericalGrabber(i.scene);i.scene.activeCamera=new e.macamera.GrabberCamera(i,r);var s=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-1,1,-1),i.scene);s.diffuse=new BABYLON.Color3(1,1,1);s.specular=new BABYLON.Color3(1,1,1);s.groundColor=new BABYLON.Color3(0,0,0)}var a=new e.Bilan;a.add(e.linkerTest());a.add(e.testCreation3D(i));a.add(e.testCreation(i));a.add(e.testMameshModification(i));a.add(e.informatisTest());a.add(e.geometryTest());a.add(e.symmetriesTest());a.add(e.testRiemann(i));console.log("bilanGlobal",a.toString());return}e.doAllTest=t})(mathis||(mathis={}));var mathis;(function(e){function t(t){var i=new e.Bilan;{var r;var s;var a=function(t,i,a,n){if(n===void 0){n=false}var o=new e.reseau.BasisForRegularReseau;o.nbI=t;o.nbJ=i;var h=new e.reseau.Regular(o);h.oneMoreVertexForOddLine=a;h.squareVersusTriangleMaille=false;r=h.go();r.fillLineCatalogue();s=[];for(var l=0,u=r.vertices;l<u.length;l++){var c=u[l];if(!n&&c.isBorder())s.push(c);else if(n&&c.hasMark(e.Vertex.Markers.corner))s.push(c)}return s.length};i.assertTrue(a(3,4,false)==10);i.assertTrue(a(4,4,false)==12);i.assertTrue(a(3,3,false)==8);i.assertTrue(a(3,4,true)==11);i.assertTrue(a(3,3,true)==8);i.assertTrue(a(3,4,false,true)==4);i.assertTrue(a(4,4,false,true)==4);i.assertTrue(a(3,3,false,true)==4);i.assertTrue(a(3,3,true,true)==4);i.assertTrue(a(3,4,true,true)==4)}{var n=new e.reseau.TriangulatedPolygone(6);n.nbSubdivisionInARadius=4;var o=n.go();o=new e.grateAndGlue.ExtractCentralPart(o,1).go();o.isolateMameshVerticesFromExteriorVertices();var h=0;for(var l=0,u=o.vertices;l<u.length;l++){var c=u[l];if(c.hasMark(e.Vertex.Markers.border))h++}i.assertTrue(h==18)}{var n=new e.reseau.Regular;var o=n.go();e.Vertex.separateTwoVoisins(o.vertices[0],o.vertices[1]);o.fillLineCatalogue();i.assertTrue(o.allLinesAsASortedString()=='straightLines:["[0,3,6]","[1,2]","[1,4,7]","[2,5,8]","[3,4,5]","[6,7,8]"]')}{var n=new e.reseau.Regular;n.nbI=7;n.nbJ=7;var o=n.go();var m=[];for(var d=0;d<o.vertices.length;d++){if(d!=11)m.push(o.vertices[d])}var f=new e.grateAndGlue.SubMameshExtractor(o,m);f.addBorderPolygonInsteadOfSuppress=true;o=f.go();o.isolateMameshVerticesFromExteriorVertices();o.fillLineCatalogue();i.assertTrue(o.allLinesAsASortedString()=='straightLines:["[0,1,2,3,4,5,6]","[0,7,14,21,28,35,42]","[1,8,15,22,29,36,43]","[14,15,16,17,18,19,20]","[2,9,16,23,30,37,44]","[21,22,23,24,25,26,27]","[28,29,30,31,32,33,34]","[3,10,17,24,31,38,45]","[35,36,37,38,39,40,41]","[4,11,18,25,32,39,46]","[42,43,44,45,46,47,48]","[5,12,19,26,33,40,47]","[6,13,20,27,34,41,48]","[7,8,9,10,11,12,13]"]')}{var n=new e.reseau.Regular;n.nbI=7;n.nbJ=7;var o=n.go();var m=[];for(var d=0;d<o.vertices.length;d++){if(d!=11)m.push(o.vertices[d])}var f=new e.grateAndGlue.SubMameshExtractor(o,m);o=f.go();o.isolateMameshVerticesFromExteriorVertices();o.fillLineCatalogue();i.assertTrue(o.allLinesAsASortedString()=='straightLines:["[0,1,2,3]","[0,7,14,21,28,35,42]","[1,8,15,22,29,36,43]","[12,13]","[14,15,16,17,18,19,20]","[18,25,32,39,46]","[2,9,16,23,30,37,44]","[21,22,23,24,25,26,27]","[28,29,30,31,32,33,34]","[3,10,17,24,31,38,45]","[35,36,37,38,39,40,41]","[42,43,44,45,46,47,48]","[5,12,19,26,33,40,47]","[5,6]","[6,13,20,27,34,41,48]","[7,8,9,10]"]')}{var n=new e.reseau.Regular;n.nbI=7;n.nbJ=7;var o=n.go();var p=new e.grateAndGlue.ExtractCentralPart(o,2);p.suppressFromBorderVersusCorner=false;o=p.go();o.isolateMameshVerticesFromExteriorVertices();o.fillLineCatalogue();i.assertTrue(o.allLinesAsASortedString()=='straightLines:["[0,1,2]","[0,7,14,21,28,35,42]","[1,8,15,22,29,36,43]","[10,17,24,31,38]","[12,13,14,15,16,17,18]","[12,19,26]","[18,25,32]","[19,20,21,22,23,24,25]","[2,9,16,23,30,37,44]","[26,27,28,29,30,31,32]","[34,35,36,37,38]","[42,43,44]","[6,13,20,27,34]","[6,7,8,9,10]"]')}{var n=new e.reseau.Regular;n.nbI=5;n.nbJ=5;var o=n.go();var p=new e.grateAndGlue.ExtractCentralPart(o,1);p.suppressFromBorderVersusCorner=false;o=p.go();o.isolateMameshVerticesFromExteriorVertices();i.assertTrue(o.allSquareAndTrianglesAsSortedString()=='square:["[0,5,6,1]","[1,6,7,2]","[10,15,16,11]","[11,16,17,12]","[12,17,18,13]","[15,20,21,16]","[16,21,22,17]","[4,9,10,5]","[5,10,11,6]","[6,11,12,7]","[7,12,13,8]","[9,14,15,10]"]triangle:[]')}{var n=new e.reseau.TriangulatedTriangle;n.nbSubdivisionInSide=3;var o=n.go();var p=new e.grateAndGlue.ExtractCentralPart(o,1);p.suppressFromBorderVersusCorner=false;o=p.go();o.isolateMameshVerticesFromExteriorVertices();o.fillLineCatalogue();i.assertTrue(o.allLinesAsASortedString()=='straightLines:["[0,4,2]","[0,7,1]","[1,10,2]","[3,0,8]","[3,4,10,11]","[3,5]","[5,2,9]","[5,4,7,6]","[6,1,11]","[6,8]","[8,7,10,9]","[9,11]"]')}{var n=new e.reseau.TriangulatedPolygone(3);var o=n.go();o.vertices[0].setTwoOppositeLinks(o.vertices[1],o.vertices[3]);var v=new e.linkModule.OppositeLinkAssocierByAngles(o.vertices);v.clearAllExistingOppositeBefore=false;v.maxAngleToAssociateLinks=2*Math.PI*.4;v.goChanging();o.fillLineCatalogue();i.assertTrue(o.allLinesAsASortedString()=='straightLines:["[0,2]","[1,0,3]"]|loopLines:["[1,2,3]"]')}{var n=new e.reseau.TriangulatedPolygone(3);var o=n.go();o.vertices[0].setTwoOppositeLinks(o.vertices[2],o.vertices[3]);var v=new e.linkModule.OppositeLinkAssocierByAngles(o.vertices);v.clearAllExistingOppositeBefore=false;v.maxAngleToAssociateLinks=2*Math.PI*.4;v.goChanging();o.fillLineCatalogue();i.assertTrue(o.allLinesAsASortedString()=='straightLines:["[0,1]","[2,0,3]"]|loopLines:["[1,2,3]"]')}{var n=new e.reseau.TriangulatedPolygone(5);var o=n.go();var v=new e.linkModule.OppositeLinkAssocierByAngles(o.vertices);v.clearAllExistingOppositeBefore=true;v.goChanging();new e.mameshModification.MameshCleaner(o).goChanging();o.fillLineCatalogue();i.assertTrue(o.allLinesAsASortedString()=='straightLines:["[1,0,4]","[1,2]","[1,5]","[2,0,5]","[2,3]","[3,0,5]","[3,4]","[4,5]"]')}{var n=new e.reseau.TriangulatedPolygone(3);var o=n.go();new e.spacialTransformations.Similitude(o.vertices,.01).goChanging();var v=new e.linkModule.OppositeLinkAssocierByAngles(o.vertices);v.clearAllExistingOppositeBefore=true;v.maxAngleToAssociateLinks=2*Math.PI*.4;v.goChanging();o.fillLineCatalogue();i.assertTrue(o.allLinesAsASortedString()=='straightLines:["[1,0,2]","[1,0,3]"]|loopLines:["[1,2,3]"]')}{var g=new e.reseau.BasisForRegularReseau;g.nbI=3;g.nbJ=3;var n=new e.reseau.Regular(g);var o=n.go();o.vertices[4].setTwoOppositeLinks(o.vertices[1],o.vertices[5]);o.vertices[4].setTwoOppositeLinks(o.vertices[1],o.vertices[3]);o.fillLineCatalogue();i.assertTrue(o.allLinesAsASortedString()=='straightLines:["[0,1,2]","[0,3,6]","[1,4,3]","[1,4,5]","[1,4,7]","[2,5,8]","[3,4,5]","[6,7,8]"]')}{var n=new e.reseau.TriangulatedPolygone(3);var o=n.go();o.vertices[0].setTwoOppositeLinks(o.vertices[3],o.vertices[1]);o.vertices[0].setTwoOppositeLinks(o.vertices[1],o.vertices[2]);o.vertices[0].setTwoOppositeLinks(o.vertices[2],o.vertices[3]);o.fillLineCatalogue();i.assertTrue(o.allLinesAsASortedString()=='straightLines:["[1,0,2]","[1,0,3]","[1,2]","[1,3]","[2,0,3]","[2,3]"]')}{var g=new e.reseau.BasisForRegularReseau;g.nbI=3;g.nbJ=3;var n=new e.reseau.Regular(g);var o=n.go();o.vertices[4].setTwoOppositeLinks(o.vertices[1],o.vertices[5]);o.vertices[4].setTwoOppositeLinks(o.vertices[1],o.vertices[3]);o.vertices[4].setTwoOppositeLinks(o.vertices[7],o.vertices[5]);o.vertices[4].setTwoOppositeLinks(o.vertices[7],o.vertices[3]);o.fillLineCatalogue();i.assertTrue(o.allLinesAsASortedString()=='straightLines:["[0,1,2]","[0,3,6]","[1,4,3]","[1,4,5]","[1,4,7]","[2,5,8]","[3,4,5]","[3,4,7]","[5,4,7]","[6,7,8]"]')}{var g=new e.reseau.BasisForRegularReseau;g.nbI=3;g.nbJ=3;var n=new e.reseau.Regular(g);var o=n.go();o.vertices[4].setTwoOppositeLinks(o.vertices[7],o.vertices[5]);o.vertices[4].setTwoOppositeLinks(o.vertices[7],o.vertices[3]);o.fillLineCatalogue();i.assertTrue(o.allLinesAsASortedString()=='straightLines:["[0,1,2]","[0,3,6]","[1,4,7]","[2,5,8]","[3,4,5]","[3,4,7]","[5,4,7]","[6,7,8]"]')}{var o=new e.Mamesh;new e.creationFlat.SingleSquareWithOneDiag(o).go();var w=o.vertices[0];var y=o.vertices[1];var b=o.vertices[2];var T=o.vertices[3];w.setTwoOppositeLinks(y,T);y.setTwoOppositeLinks(b,w);b.setTwoOppositeLinks(T,y);T.setTwoOppositeLinks(w,b);o.fillLineCatalogue();i.assertTrue(o.allLinesAsASortedString()=='straightLines:["[1,3]"]|loopLines:["[0,1,2,3]"]')}{var n=new e.creation2D.Patchwork(7,7,2,2);n.shapes=[e.creation2D.PartShape.polygon4];n.individualScales=[new e.UV(1,1)];n.SUB_gratAndStick.SUB_grater.proportionOfSeeds=[.2];var o=n.go();var M=[];for(var C=0,S=n.SUB_gratAndStick.SUB_grater.OUT_allSeeds;C<S.length;C++){var x=S[C];M=M.concat(x)}i.assertTrue(M.length==36)}{var n=new e.creation2D.Patchwork(4,4,2,2);n.shapes=[e.creation2D.PartShape.polygon4];n.individualScales=[new e.UV(1.01,1.01)];n.SUB_gratAndStick.SUB_grater.proportionOfSeeds=[.5];var o=n.go();i.assertTrue(o.vertices.length==48)}{var n=new e.creation2D.Concentric(11,11);n.nbPatches=2;n.shapes=[e.creation2D.PartShape.polygon6,e.creation2D.PartShape.square];n.proportions=[new e.UV(1,1),new e.UV(.5,.5)];n.integerBeginToRound=[1];n.integerEndToRound=[-2];n.SUB_gratAndStick.SUB_grater.proportionOfSeeds=[.1];n.SUB_gratAndStick.SUB_grater.asymmetriesForSeeds=[{direction:new e.XYZ(0,1,0),influence:.5,modulo:Math.PI/2},{direction:new e.XYZ(1,0,0),influence:.5}];n.SUB_gratAndStick.SUB_grater.seedComputedFromBarycentersVersusFromAllPossibleCells=true;var o=n.go()}{var F=new e.reseau.TriangulatedTriangle;F.nbSubdivisionInSide=5;var o=F.go();o.fillLineCatalogue();i.assertTrue(o.allLinesAsASortedString()=='straightLines:["[11,0,16]","[11,35,36,34]","[12,0,37,6,33]","[12,15]","[15,0,35,3,21]","[16,37,36,20]","[18,21,20,34,33,27]","[20,3,25]","[21,24]","[24,3,36,6,30]","[25,35,37,29]","[29,6,34]","[30,33]","[9,12,11,25,24,18]","[9,15,16,29,30,27]"]')}{var F=new e.reseau.TriangulatedPolygone(5);F.nbSubdivisionInARadius=3;var o=F.go();o.fillLineCatalogue();i.assertTrue(o.allLinesAsASortedString()=='straightLines:["[0,108,33,111]","[0,134,40,137]","[0,51,16,56]","[0,53,18,57]","[0,82,26,85]","[110,107,108,134,159,162]","[111,136,138,137]","[112,33,133,40,161]","[55,16,159,40,138]","[55,52,53,82,107,112]","[56,162,161,137]","[56,55,58,57]","[57,84,86,85]","[58,18,81,26,110]","[58,52,51,134,133,136]","[84,18,52,16,162]","[84,81,82,108,133,138]","[85,110,112,111]","[86,26,107,33,136]","[86,81,53,51,159,161]"]')}{var F=new e.reseau.TriangulatedPolygone(4);F.nbSubdivisionInARadius=4;var o=F.go();o.fillLineCatalogue();i.assertTrue(o.allLinesAsASortedString()=='straightLines:["[1,16,6,21,2]","[1,18,5,13,0,23,9,26,3]","[1,40,12,37,4]","[16,17,14,15,23,29,34,35]","[16,18,39,38,33,35]","[2,19,7,15,0,30,11,33,4]","[2,24,8,28,3]","[21,19,25,27,26,31]","[21,20,14,13,30,29,32,31]","[24,19,20,17,18,40]","[24,25,22,23,30,36,39,40]","[28,26,32,34,33,37]","[28,27,22,15,13,36,38,37]","[3,31,10,35,4]","[6,17,5,36,11,34,10]","[6,20,7,22,9,32,10]","[8,25,7,14,5,39,12]","[8,27,9,29,11,38,12]"]')}{var V=new e.reseau.Regular;V.nbI=3;V.nbJ=3;var k=V.go();var O=[];for(var A=0,P=k.vertices;A<P.length;A++){var L=P[A];if(L.hasMark(e.Vertex.Markers.border))O.push(L)}var B=e.graph.ringify(O);i.assertTrue(B[0].length==8&&B[1].length==1)}{var V=new e.reseau.Regular;V.nbI=3;V.nbJ=4;var k=V.go();var O=[];for(var Y=0,I=k.vertices;Y<I.length;Y++){var L=I[Y];if(L.hasMark(e.Vertex.Markers.border))O.push(L)}var B=e.graph.ringify(O);i.assertTrue(B[0].length==10&&B[1].length==2)}{var V=new e.reseau.Regular;V.nbI=4;V.nbJ=4;var k=V.go();var O=[];for(var $=0,D=k.vertices;$<D.length;$++){var L=D[$];if(L.hasMark(e.Vertex.Markers.border))O.push(L)}var B=e.graph.ringify(O);i.assertTrue(B[0].length==12&&B[1].length==4)}{var V=new e.reseau.Regular;V.nbI=5;V.nbJ=5;var k=V.go();var O=[];for(var N=0,X=k.vertices;N<X.length;N++){var L=X[N];if(L.hasMark(e.Vertex.Markers.border))O.push(L)}var B=e.graph.ringify(O);i.assertTrue(B[0].length==16&&B[1].length==8&&B[2].length==1)}{var a=function(t){var i=new e.reseau.TriangulatedPolygone(t);var r=i.go();var s=2;for(var a=0;a<s;a++){var n=new e.mameshModification.TriangleDichotomer(r);n.makeLinks=false;n.go()}var o=new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(r);o.goChanging();return r};var o=a(3);var Z=0;for(var _=0,E=o.vertices;_<E.length;_++){var R=E[_];if(R.hasMark(e.Vertex.Markers.border))Z++}i.assertTrue(Z==12);o=a(4);Z=0;for(var q=0,z=o.vertices;q<z.length;q++){var R=z[q];if(R.hasMark(e.Vertex.Markers.border))Z++}i.assertTrue(Z==16);o=a(5);Z=0;for(var G=0,W=o.vertices;G<W.length;G++){var R=W[G];if(R.hasMark(e.Vertex.Markers.border))Z++}i.assertTrue(Z==20)}{var a=function(t,i){var r=new e.Mamesh;var s=new e.Vertex;s.param=new e.XYZ(Math.random(),0,0);s.position=new e.XYZ(0,0,0);r.addVertex(s);var a=[];var n=[];for(var o=0;o<1;o+=t)n.push(o);var h=1;for(var l=0,u=n;l<u.length;l++){var o=u[l];var c=2*Math.PI*o;var m=new e.Vertex;m.param=new e.XYZ(h++,0,0);m.position=new e.XYZ(Math.cos(c),Math.sin(c),0);a.push(m)}for(var d=0,f=a;d<f.length;d++){var m=f[d];s.setOneLink(m);m.setOneLink(s);r.addVertex(m)}var p=new e.linkModule.LinksSorterAndCleanerByAngles(r,new e.XYZ(0,0,1));p.suppressLinksAngularlyTooCloseVersusNot=true;p.suppressLinksAngularParam=2*Math.PI*i;p.goChanging();return r};var o=void 0;o=a(.25,.1);i.assertTrue(o.vertices[0].links.length==4);o=a(.1,.05);i.assertTrue(o.vertices[0].links.length==10)}{var a=function(t,i){var r=new e.Mamesh;var s=new e.Vertex;s.param=new e.XYZ(Math.random(),0,0);s.position=new e.XYZ(0,0,0);r.addVertex(s);var a=[];var n=[];for(var o=0;o<1;o+=1/t)n.push(o);var h=1;for(var l=0,u=n;l<u.length;l++){var o=u[l];var c=2*Math.PI*o;var m=2*Math.PI*(o+i);var d=new e.Vertex;var f=new e.Vertex;d.param=new e.XYZ(h++,0,0);f.param=new e.XYZ(h++,1,0);d.position=new e.XYZ(Math.cos(c),Math.sin(c),0);f.position=new e.XYZ(2*Math.cos(m),2*Math.sin(m),0);a.push(d);a.push(f)}e.shuffle(a);for(var p=0,v=a;p<v.length;p++){var d=v[p];s.setOneLink(d);d.setOneLink(s);r.addVertex(d)}var g=new e.linkModule.LinksSorterAndCleanerByAngles(r,new e.XYZ(0,0,1));g.suppressLinksAngularlyTooCloseVersusNot=true;g.suppressLinksAngularParam=2*Math.PI*.1;g.goChanging();return r};var o=void 0;o=a(4,.02);i.assertTrue(o.vertices[0].links.length==4);var U=true;o.vertices[0].links.forEach(function(e){U=U&&e.to.param.y==0});i.assertTrue(U);o=a(5,.09);i.assertTrue(o.vertices[0].links.length==5);o=a(8,.01);i.assertTrue(o.vertices[0].links.length==8);U=true;o.vertices[0].links.forEach(function(e){U=U&&e.to.param.y==0});i.assertTrue(U)}{i.assertTrue(e.modulo(3,4,true)==-1);i.assertTrue(e.modulo(5,4,true)==1);var H=new e.XYZ(1,0,0);var j=new e.XYZ(0,0,1);for(var d=-2;d<2;d+=.1){var J=2*Math.PI*d;var K=new e.XYZ(Math.cos(J),Math.sin(J),0);var Q=e.geo.angleBetweenTwoVectorsBetweenMinusPiAndPi(H,K,j);var ee=e.roundWithGivenPrecision(e.modulo(Q/Math.PI/2,1),1)==e.roundWithGivenPrecision(e.modulo(d,1),1);i.assertTrue(ee)}}return i}e.testCreation=t})(mathis||(mathis={}));var mathis;(function(e){function t(t){var i=new e.Bilan;{var r=new e.reseau.Regular3D;r.strateHaveSquareMailleVersusTriangleMaille=false;var s=r.go();s.fillLineCatalogue();i.assertTrue(s.allLinesAsASortedString()=='straightLines:["[0,1]","[0,3,6]","[0,4,5]","[0,9,18]","[1,10,19]","[1,2]","[1,4,7]","[10,11]","[10,13,16]","[11,13,12]","[11,14,17]","[12,16,17]","[14,16,15]","[18,19]","[18,21,24]","[18,22,23]","[19,20]","[19,22,25]","[2,11,20]","[2,4,3]","[2,5,8]","[20,22,21]","[20,23,26]","[21,25,26]","[23,25,24]","[3,12,21]","[3,7,8]","[4,13,22]","[5,14,23]","[5,7,6]","[6,15,24]","[7,16,25]","[8,17,26]","[9,10]","[9,12,15]","[9,13,14]"]');i.assertTrue(s.allSquareAndTrianglesAsSortedString()=='square:["[0,1,10,9]","[0,3,12,9]","[1,2,11,10]","[1,4,13,10]","[10,11,20,19]","[10,13,22,19]","[11,14,23,20]","[12,13,22,21]","[12,15,24,21]","[13,14,23,22]","[13,16,25,22]","[14,17,26,23]","[15,16,25,24]","[16,17,26,25]","[2,5,14,11]","[3,4,13,12]","[3,6,15,12]","[4,5,14,13]","[4,7,16,13]","[5,8,17,14]","[6,7,16,15]","[7,8,17,16]","[9,10,19,18]","[9,12,21,18]"]triangle:["[0,3,4]","[0,4,1]","[1,4,2]","[10,13,11]","[11,13,14]","[12,15,16]","[12,16,13]","[13,16,14]","[14,16,17]","[18,21,22]","[18,22,19]","[19,22,20]","[2,4,5]","[20,22,23]","[21,24,25]","[21,25,22]","[22,25,23]","[23,25,26]","[3,6,7]","[3,7,4]","[4,7,5]","[5,7,8]","[9,12,13]","[9,13,10]"]')}{var r=new e.reseau.Regular3D;r.strateHaveSquareMailleVersusTriangleMaille=true;var s=r.go();s.fillLineCatalogue();i.assertTrue(s.allLinesAsASortedString()=='straightLines:["[0,1,2]","[0,3,6]","[0,9,18]","[1,10,19]","[1,4,7]","[10,13,16]","[11,14,17]","[12,13,14]","[15,16,17]","[18,19,20]","[18,21,24]","[19,22,25]","[2,11,20]","[2,5,8]","[20,23,26]","[21,22,23]","[24,25,26]","[3,12,21]","[3,4,5]","[4,13,22]","[5,14,23]","[6,15,24]","[6,7,8]","[7,16,25]","[8,17,26]","[9,10,11]","[9,12,15]"]');i.assertTrue(s.allSquareAndTrianglesAsSortedString()=='square:["[0,1,10,9]","[0,3,12,9]","[0,3,4,1]","[1,2,11,10]","[1,4,13,10]","[1,4,5,2]","[10,11,20,19]","[10,13,14,11]","[10,13,22,19]","[11,14,23,20]","[12,13,22,21]","[12,15,16,13]","[12,15,24,21]","[13,14,23,22]","[13,16,17,14]","[13,16,25,22]","[14,17,26,23]","[15,16,25,24]","[16,17,26,25]","[18,21,22,19]","[19,22,23,20]","[2,5,14,11]","[21,24,25,22]","[22,25,26,23]","[3,4,13,12]","[3,6,15,12]","[3,6,7,4]","[4,5,14,13]","[4,7,16,13]","[4,7,8,5]","[5,8,17,14]","[6,7,16,15]","[7,8,17,16]","[9,10,19,18]","[9,12,13,10]","[9,12,21,18]"]triangle:[]')}{var r=new e.reseau.Regular3D;r.strateHaveSquareMailleVersusTriangleMaille=true;r.oneMoreVertexForOddLine=false;r.decayOddStrates=true;r.createJKSquares=true;r.createIKSquaresOrTriangles=true;r.interStrateMailleAreSquareVersusTriangle=false;var s=r.go();s.fillLineCatalogue();i.assertTrue(s.allLinesAsASortedString()=='straightLines:["[0,1,2]","[0,12,21]","[0,3,6]","[0,9]","[1,10]","[1,13,22]","[1,4,7]","[10,13,16]","[10,19]","[11,14,17]","[11,20]","[12,13,14]","[15,16,17]","[18,19,20]","[18,21,24]","[19,22,25]","[2,11]","[2,14,23]","[2,5,8]","[20,23,26]","[21,22,23]","[24,25,26]","[3,12,18]","[3,15,24]","[3,4,5]","[4,13,19]","[4,16,25]","[5,14,20]","[5,17,26]","[6,15,21]","[6,7,8]","[7,16,22]","[8,17,23]","[9,10,11]","[9,12,15]","[9,18]"]');i.assertTrue(s.allSquareAndTrianglesAsSortedString()=='square:["[0,1,10,9]","[0,3,4,1]","[1,2,11,10]","[1,4,5,2]","[10,11,20,19]","[10,13,14,11]","[12,13,22,21]","[12,15,16,13]","[13,14,23,22]","[13,16,17,14]","[15,16,25,24]","[16,17,26,25]","[18,21,22,19]","[19,22,23,20]","[21,24,25,22]","[22,25,26,23]","[3,4,13,12]","[3,6,7,4]","[4,5,14,13]","[4,7,8,5]","[6,7,16,15]","[7,8,17,16]","[9,10,19,18]","[9,12,13,10]"]triangle:["[0,12,9]","[0,3,12]","[1,13,10]","[1,4,13]","[10,13,19]","[11,14,20]","[12,15,21]","[12,21,18]","[13,16,22]","[13,22,19]","[14,17,23]","[14,23,20]","[15,24,21]","[16,25,22]","[17,26,23]","[2,14,11]","[2,5,14]","[3,15,12]","[3,6,15]","[4,16,13]","[4,7,16]","[5,17,14]","[5,8,17]","[9,12,18]"]')}return i}e.testCreation3D=t})(mathis||(mathis={}));var mathis;(function(e){function t(){var t=new e.Bilan;{var i=new e.XYZ(1,0,0);var r=new e.XYZ(10,0,0);var s=new e.XYZ(-10,0,0);t.assertTrue(e.geo.almostParallel(i,r,true));t.assertTrue(e.geo.almostParallel(i,s,true));t.assertTrue(!e.geo.almostParallel(i,s,false));var a=new e.creation3D.Polyhedron(e.creation3D.PolyhedronType.Cube);var n=a.go();var o=0;var h=0;var l=0;for(var u=0,c=n.segments;u<c.length;u++){var m=c[u];var d=e.XYZ.newFrom(m[0].position).substract(m[1].position);if(e.geo.almostParallel(d,new e.XYZ(1,0,0),true,.001))o++;if(e.geo.almostParallel(d,new e.XYZ(0,1,0)))h++;if(e.geo.almostParallel(d,new e.XYZ(0,0,1)))l++}t.assertTrue(o==4);t.assertTrue(h==4);t.assertTrue(l==4)}{var f=new e.XYZ(0,0,0);var p=new e.XYZ(2,2,0);var v=new e.XYZ(0,0,0);var g=new e.XYZ(.5,.5,0);var w=e.geo.affineTransformGenerator(f,p,v,g);var y=new e.XYZ(0,0,0);w(new e.XYZ(4,4,0),y);w(y,y);t.assertTrue(y.almostEqual(new e.XYZ(.25,.25,0)))}{var f=new e.XYZ(1,1,0);var p=new e.XYZ(2,2,0);var v=new e.XYZ(-1,-1,0);var g=new e.XYZ(.5,.5,0);var w=e.geo.affineTransformGenerator(f,p,v,g);var b=e.geo.affineTransformGenerator(v,g,f,p);var y=new e.XYZ(0,0,0);w(new e.XYZ(4,4,0),y);b(y,y);t.assertTrue(y.almostEqual(new e.XYZ(4,4,0)))}var T=e.XYZ.newZero();var M=e.XYZ.newZero();var C=e.XYZ.newZero();T.x=1;M.y=1;C.z=1;var S=e.XYZ.newZero();S.x=1;S.y=1;{var x=Math.random()*10;var F=e.MM.newZero();e.geo.axisAngleToMatrix(C,x,F);var V=e.MM.newZero();e.geo.axisAngleToMatrix(C,-x,V);t.assertTrue(e.MM.newFrom(F).inverse().almostEqual(V));var k=e.XYZ.newZero();e.geo.orthonormalizeKeepingFirstDirection(T,S,k,S);t.assertTrue(k.almostEqual(T)&&S.almostEqual(M));var O=e.MM.newRandomMat();t.assertTrue(e.MM.newFrom(O).transpose().transpose().almostEqual(O));var A=e.MM.newZero();var P=e.MM.newZero();var L=Math.random()*2*Math.PI;var B=e.XYZ.newRandom();e.geo.axisAngleToMatrix(B,L,A);e.geo.axisAngleToMatrix(B,-L,P);t.assertTrue(e.MM.newFrom(A).transpose().almostEqual(P));t.assertTrue(e.MM.newFrom(A).inverse().almostEqual(P))}{var Y=10;var I=new e.XYZW(0,0,0,0);var $=new e.XYZW(0,0,0,0);var D=e.MM.newZero();var N=e.MM.newZero();var X=e.MM.newZero();for(var Z=0;Z<=Y;Z++){var _=e.XYZ.newRandom().normalize();var x=Z*Math.PI*2/Y;e.geo.axisAngleToQuaternion(_,x,I);e.geo.quaternionToMatrix(I,D);e.geo.matrixToQuaternion(D,$);e.geo.quaternionToMatrix($,N);t.assertTrue(e.geo.almostLogicalEqual(I,$));t.assertTrue(D.almostEqual(N));e.geo.axisAngleToMatrix(_,x,X);t.assertTrue(X.almostEqual(D))}}var E=e.XYZ.newRandom();var R=e.XYZ.newZero().copyFrom(E);var q=e.XYZ.newRandom();t.assertTrue(E.add(q).add(q.scale(-1)).almostEqual(R));var z=e.XYZ.newZero();e.geo.cross(T,M,z);t.assertTrue(z.almostEqual(C));var G=e.XYZ.newFrom(T);var W=e.XYZ.newFrom(M);var U=e.XYZ.newFrom(C);S.x=1;S.y=1;S.z=0;t.assertTrue(e.geo.almostEquality(e.geo.angleBetweenTwoVectorsBetween0andPi(T,S),Math.PI/4));t.assertTrue(e.geo.almostEquality(e.geo.angleBetweenTwoVectorsBetween0andPi(M,S),Math.PI/4));t.assertTrue(e.geo.almostEquality(e.geo.angleBetweenTwoVectorsBetween0andPi(e.XYZ.newFrom(T).scale(-1),S),3*Math.PI/4));{var Y=10;for(var Z=0;Z<Y;Z++){var L=2*Math.PI/Y*Z*12;var H=e.XYZ.newRandom().normalize();var j=e.MM.newZero();e.geo.axisAngleToMatrix(H,L,j);e.geo.multiplicationMatrixVector(j,T,G);e.geo.multiplicationMatrixVector(j,M,W);e.geo.multiplicationMatrixVector(j,C,U);t.assertTrue(e.geo.almostEquality(e.geo.dot(G,W),0)&&e.geo.almostEquality(e.geo.dot(G,U),0)&&e.geo.almostEquality(e.geo.dot(W,U),0));t.assertTrue(e.geo.almostEquality(1,e.geo.norme(G))&&e.geo.almostEquality(1,e.geo.norme(W))&&e.geo.almostEquality(1,e.geo.norme(U)));var J=e.XYZ.newZero();e.geo.cross(G,W,J);t.assertTrue(J.almostEqual(U))}}{var Y=10;for(var Z=0;Z<Y;Z++){var L=2*Math.PI/Y*Z*12;var H=new e.XYZ(0,0,1);var j=e.MM.newZero();e.geo.axisAngleToMatrix(H,L,j);e.geo.multiplicationMatrixVector(j,T,G);var K=e.modulo(L,2*Math.PI);if(K>Math.PI)K=2*Math.PI-K;t.assertTrue(e.geo.almostEquality(e.geo.angleBetweenTwoVectorsBetween0andPi(G,T),K))}var Q=e.XYZ.newRandom();var ee=e.XYZ.newRandom();var te=e.XYZ.newRandom();var ie=e.XYZ.newFrom(Q);ie.add(ee).add(te).scale(1/3);var re=e.XYZ.newZero();e.geo.baryCenter([Q,ee,te],[1/3,1/3,1/3],re);t.assertTrue(ie.almostEqual(re))}{var se=new e.XYZ(0,0,0);var ae=new e.XYZ(2,0,0);var ne=new e.XYZ(0,1,0);var oe=new e.XYZ(0,-1,0);var he=[];e.geo.hermiteSpline(se,ne,ae,oe,2,he);t.assertTrue(he[1].almostEqual(new e.XYZ(1,.25,0)))}{var le=[new e.XYZ(0,0,0),new e.XYZ(0,0,1),new e.XYZ(0,0,2),new e.XYZ(-10,0,0),new e.XYZ(0,0,0),new e.XYZ(0,0,1),new e.XYZ(0,0,2),new e.XYZ(0,0,0)];var ue=new e.geometry.CloseXYZfinder(le,null,1e3);var y=ue.go();t.assertTrue(JSON.stringify({4:0,5:1,6:2,7:0})==JSON.stringify(y))}{var ce=[new e.XYZ(0,0,0),new e.XYZ(0,0,1),new e.XYZ(0,0,2),new e.XYZ(-20,0,0)];var me=[new e.XYZ(-1e-6,0,0),new e.XYZ(0,0,1.000001),new e.XYZ(0,0,2),new e.XYZ(-10,0,0),new e.XYZ(0,0,2)];var de=new e.geometry.CloseXYZfinder(ce,me,1e3);de.nbDistinctPoint=1e4;var fe=de.go();t.assertTrue(JSON.stringify({0:0,1:1,2:2,4:2})==JSON.stringify(fe))}{var le=[new e.XYZ(0,0,0),new e.XYZ(1,0,0),new e.XYZ(2,0,0),new e.XYZ(3,0,0),new e.XYZ(4,0,0)];var pe=new e.geometry.CloseXYZfinder(le,null,1e3);pe.deformationFunction=function(t){var i=e.XYZ.newFrom(t);i.x=e.modulo(i.x,2);return i};var y=pe.go();t.assertTrue(JSON.stringify({2:0,3:1,4:0})==JSON.stringify(y))}{var ve=new e.XYZ(1,0,0);var ge=new e.XYZ(0,0,1);var we=new e.XYZ(1,1,0).normalize();var ye=new e.XYZ(-1,1,0).normalize();var F=new e.MM;e.geo.anOrthogonalMatrixMovingABtoCD(ve,ge,we,ye,F,true);var be=e.XYZ.newZero();var Te=e.XYZ.newZero();e.geo.multiplicationMatrixVector(F,ve,be);e.geo.multiplicationMatrixVector(F,ge,Te);t.assertTrue(e.geo.xyzAlmostEquality(we,be)&&e.geo.xyzAlmostEquality(ye,Te))}{var ve=e.XYZ.newRandom().normalize();var ge=new e.XYZ(-1,1,0);e.geo.getOneOrthonormal(ve,ge);ge.normalize();var we=e.XYZ.newRandom().normalize();var ye=new e.XYZ(0,0,0);e.geo.getOneOrthonormal(we,ye);ye.normalize();var F=new e.MM;e.geo.anOrthogonalMatrixMovingABtoCD(ve,ge,we,ye,F,true);var be=e.XYZ.newZero();var Te=e.XYZ.newZero();e.geo.multiplicationMatrixVector(F,ve,be);e.geo.multiplicationMatrixVector(F,ge,Te);t.assertTrue(e.geo.xyzAlmostEquality(we,be)&&e.geo.xyzAlmostEquality(ye,Te))}{var F=new e.MM;var ve=e.XYZ.newRandom().normalize();var ge=new e.XYZ(-1,1,0);e.geo.getOneOrthonormal(ve,ge);ge.normalize();var we=new e.XYZ(0,0,0);e.geo.cross(ve,ge,we);e.geo.matrixFromLines(ve,ge,we,F);var Me=new e.XYZW(0,0,0,0);e.geo.matrixToQuaternion(F,Me);var Ce=new e.MM;e.geo.quaternionToMatrix(Me,Ce);t.assertTrue(F.almostEqual(Ce))}{var Me=new e.XYZW(0,0,0,0);e.geo.axisAngleToQuaternion(new e.XYZ(1,0,0),1.5,Me);var F=new e.MM;e.geo.quaternionToMatrix(Me,F);var Se=new e.XYZW(0,0,0,0);e.geo.matrixToQuaternion(F,Se);t.assertTrue(e.geo.xyzwAlmostEquality(Me,Se))}{var ve=e.XYZ.newRandom().normalize();var ge=new e.XYZ(0,0,0);e.geo.getOneOrthonormal(ve,ge);ge.normalize();var we=e.XYZ.newRandom().normalize();var ye=new e.XYZ(0,0,0);e.geo.getOneOrthonormal(we,ye);ye.normalize();var Me=new e.XYZW(0,0,0,0);e.geo.aQuaternionMovingABtoCD(ve,ge,we,ye,Me,true);var be=e.XYZ.newZero();var Te=e.XYZ.newZero();var F=new e.MM;e.geo.quaternionToMatrix(Me,F);e.geo.multiplicationMatrixVector(F,ve,be);e.geo.multiplicationMatrixVector(F,ge,Te);t.assertTrue(e.geo.xyzAlmostEquality(we,be)&&e.geo.xyzAlmostEquality(ye,Te))}{var xe=new e.periodicWorld.CartesianFundamentalDomain(new e.XYZ(2,0,0),new e.XYZ(0,2,0),new e.XYZ(0,0,2));var y=new e.XYZ(0,0,0);xe.modulo(new e.XYZ(.5,-1.75,3.5),y);t.assertTrue(e.geo.xyzAlmostEquality(y,new e.XYZ(.5,.25,-.5)))}{var Fe=new e.XYZ(1,1,0);var Ve=new e.MM;e.geo.orthogonalProjectionOnLine(Fe,Ve);var ke=new e.XYZ(Math.random(),Math.random(),Math.random());var s=new e.XYZ(0,0,0);e.geo.multiplicationMatrixVector(Ve,ke,s);var Oe=new e.XYZ(0,0,0);e.geo.multiplicationMatrixVector(Ve,s,Oe);t.assertTrue(Oe.almostEqual(s))}{var Fe=new e.XYZ(1,1,0);var Ae=new e.XYZ(-1,1,2);var Ve=new e.MM;e.geo.orthogonalProjectionOnPlane(Fe,Ae,Ve);var ke=new e.XYZ(Math.random(),Math.random(),Math.random());var s=new e.XYZ(0,0,0);e.geo.multiplicationMatrixVector(Ve,ke,s);var Oe=new e.XYZ(0,0,0);e.geo.multiplicationMatrixVector(Ve,s,Oe);t.assertTrue(Oe.almostEqual(s))}return t}e.geometryTest=t})(mathis||(mathis={}));var mathis;(function(e){var t=BABYLON.VertexData;var i=function(){function e(){}e.prototype.eat=function(){return"miam"};return e}();var r=function(){function e(){}e.prototype.sleep=function(){return"ZZZ"};return e}();function s(e,t){t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(i){if(i!=="constructor"){e.prototype[i]=t.prototype[i]}})})}var a=function(){function e(){if(!e.mixinsWasMade){s(e,[i,r]);e.mixinsWasMade=true}}e.mixinsWasMade=false;return e}();function n(){var i=new e.Bilan;e.logger.c("this a warning which test that warning are fired");{var r=new e.Vertex;r.position=new e.XYZ(1,2,3);var s=new e.Vertex;s.position=new e.XYZ(1,2,4);var n=new e.Vertex;n.position=new e.XYZ(1,2,5);var o=new e.Vertex;o.position=new e.XYZ(1,2,5.5);var h=new e.Line([r,s,n,o],false);var l=new e.Line([o,n,s,r],false);i.assertTrue(h.hashString==l.hashString);var u=new e.Line([r,s,n,o],true);var c=new e.Line([r,o,n,s],false);i.assertTrue(h.hashString==l.hashString);var m=new e.Vertex;m.position=new e.XYZ(1,2,3);var d=new e.Vertex;d.position=new e.XYZ(1,2,4);var f=new e.Vertex;f.position=new e.XYZ(1,2,5);var p=new e.Vertex;p.position=new e.XYZ(1,2,5.5);var v=new e.Line([m,d,f,p],false);i.assertTrue(v.hashString!=l.hashString);i.assertTrue(v.positionnalHash()==l.positionnalHash())}{var g=new e.reseau.BasisForRegularReseau;g.nbI=2;g.nbJ=2;var w=new e.reseau.Regular(g);var y=w.go();y.fillLineCatalogue();new e.spacialTransformations.Similitude(y.vertices,Math.PI/4).goChanging();e.spacialTransformations.adjustInASquare(y,new e.XYZ(0,0,0),new e.XYZ(1,1,0));var b=new e.reseau.Regular(g);var T=b.go();T.fillLineCatalogue();new e.spacialTransformations.Similitude(T.vertices,Math.PI/2).goChanging();e.spacialTransformations.adjustInASquare(T,new e.XYZ(0,0,0),new e.XYZ(1,1,0));var M=new e.StringMap;for(var C=0,S=T.lines.concat(T.lines);C<S.length;C++){var x=S[C];M.putValue(x.hashString,true)}i.assertTrue(M.allValues().length==4);var F=new e.StringMap;for(var V=0,k=y.lines;V<k.length;V++){var x=k[V];F.putValue(x.hashStringUpToSymmetries(e.symmetries.squareMainSymmetries,true),true)}i.assertTrue(F.allValues().length==1)}{var O=new e.Vertex;var A=new e.Vertex;var P=new e.Vertex;var L=new e.Vertex;var B=new e.Vertex;var Y=new e.Vertex;var I=new e.Vertex;var $=new e.Vertex;var D=[O,A,P,L,B,Y,I,$];var N=new e.tab.ArrayMinusBlocksElements(D,4,[P,L,O,A]).go();i.assertTrue(N[0].hashString==B.hashString&&N[1].hashString==Y.hashString&&N[2].hashString==I.hashString&&N[3].hashString==$.hashString)}var X=new a;X.age=37;i.assertTrue(X.age==37);i.assertTrue(X.sleep()=="ZZZ");i.assertTrue(X.eat()=="miam");{var Z=new e.HashMap;var O=new e.Vertex;var A=new e.Vertex;var P=new e.Vertex;Z.putValue(O,"vertex0");Z.putValue(A,"vertex1");Z.putValue(P,"vertex2");Z.putValue(O,"vertex0bis");i.assertTrue(Z.getValue(O)=="vertex0bis")}{var _=new e.reseau.Regular;_.nbI=3;_.nbJ=2;_.makeLinks=false;var y=_.go();var E=new e.mameshModification.SquareDichotomer(y);E.go();var R=new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(y).goChanging();y.fillLineCatalogue();var q=new e.mameshModification.MameshDeepCopier(y).go();i.assertTrue(y.toString()==q.toString())}{var z=new t;z._idx=5;var G=function(){function e(){this.aString="toto";this.aNumber=5}return e}();var W=new G;W.aString="mqlskdj";{W.newPro=5}i.assertTrue(W.newPro==5)}return i}e.informatisTest=n})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(e){this.makeLinks=true;this.markCorners=true;this.addALoopLineAround=false;this.mamesh=e}t.prototype.go=function(){var t=this.mamesh.newVertex(new e.XYZ(0,0,0));var i=this.mamesh.newVertex(new e.XYZ(1,0,0));var r=this.mamesh.newVertex(new e.XYZ(1,1,0));var s=this.mamesh.newVertex(new e.XYZ(0,1,0));this.mamesh.addATriangle(t,i,s);this.mamesh.addATriangle(i,r,s);if(this.markCorners){t.markers.push(e.Vertex.Markers.corner);i.markers.push(e.Vertex.Markers.corner);r.markers.push(e.Vertex.Markers.corner);s.markers.push(e.Vertex.Markers.corner)}if(this.makeLinks){i.setOneLink(s);s.setOneLink(i);if(!this.addALoopLineAround){t.setOneLink(i);t.setOneLink(s);i.setOneLink(t);i.setOneLink(r);r.setOneLink(i);r.setOneLink(s);s.setOneLink(t);s.setOneLink(r)}else{t.setTwoOppositeLinks(i,s);i.setTwoOppositeLinks(r,t);r.setTwoOppositeLinks(s,i);s.setTwoOppositeLinks(t,r)}}};return t}();t.SingleSquareWithOneDiag=i;var r=function(){function t(e){this.makeLinks=true;this.markCorners=true;this.addALoopLineAround=false;this.mamesh=e}t.prototype.go=function(){var t=this.mamesh.newVertex(new e.XYZ(0,0,0));var i=this.mamesh.newVertex(new e.XYZ(1,0,0));var r=this.mamesh.newVertex(new e.XYZ(1,1,0));var s=this.mamesh.newVertex(new e.XYZ(0,1,0));var a=this.mamesh.newVertex(new e.XYZ(.5,.5,0));this.mamesh.addATriangle(t,i,a);this.mamesh.addATriangle(i,r,a);this.mamesh.addATriangle(r,s,a);this.mamesh.addATriangle(a,s,t);if(this.markCorners){t.markers.push(e.Vertex.Markers.corner);i.markers.push(e.Vertex.Markers.corner);r.markers.push(e.Vertex.Markers.corner);s.markers.push(e.Vertex.Markers.corner)}if(this.makeLinks){t.setOneLink(a);i.setOneLink(a);r.setOneLink(a);s.setOneLink(a);a.setTwoOppositeLinks(t,r);a.setTwoOppositeLinks(i,s);if(!this.addALoopLineAround){t.setOneLink(i);t.setOneLink(s);i.setOneLink(t);i.setOneLink(r);r.setOneLink(i);r.setOneLink(s);s.setOneLink(t);s.setOneLink(r)}else{t.setTwoOppositeLinks(i,s);i.setTwoOppositeLinks(r,t);r.setTwoOppositeLinks(s,i);s.setTwoOppositeLinks(t,r)}}};return t}();t.SingleSquareWithTwoDiag=r;var s=function(){function t(e){this.makeLinks=true;this.markCorners=true;this.addALoopLineAround=false;this.mamesh=e}t.prototype.go=function(){var t=this.mamesh.newVertex(new e.XYZ(0,0,0));var i=this.mamesh.newVertex(new e.XYZ(1,0,0));var r=this.mamesh.newVertex(new e.XYZ(1,1,0));var s=this.mamesh.newVertex(new e.XYZ(0,1,0));this.mamesh.addASquare(t,i,r,s);if(this.markCorners){t.markers.push(e.Vertex.Markers.corner);i.markers.push(e.Vertex.Markers.corner);r.markers.push(e.Vertex.Markers.corner);s.markers.push(e.Vertex.Markers.corner)}if(this.makeLinks){if(!this.addALoopLineAround){t.setOneLink(i);i.setOneLink(r);r.setOneLink(s);s.setOneLink(t);t.setOneLink(s);s.setOneLink(r);r.setOneLink(i);i.setOneLink(t)}else{t.setTwoOppositeLinks(i,s);i.setTwoOppositeLinks(r,t);r.setTwoOppositeLinks(s,i);s.setTwoOppositeLinks(t,r)}}};return t}();t.SingleSquare=s})(t=e.creationFlat||(e.creationFlat={}));function i(){var i=new e.Bilan;{var r=new e.reseau.Regular;var s=r.go();var a=new e.linkModule.SimpleLinkFromPolygonCreator(s);a.goChanging();s.fillLineCatalogue();i.assertTrue(s.allLinesAsASortedString()=='straightLines:["[0,1]","[0,3]","[1,2]","[1,4]","[2,5]","[3,4]","[3,6]","[4,5]","[4,7]","[5,8]","[6,7]","[7,8]"]')}{var r=new e.reseau.Regular;r.squareVersusTriangleMaille=false;var s=r.go();var a=new e.linkModule.SimpleLinkFromPolygonCreator(s);a.goChanging();s.fillLineCatalogue();i.assertTrue(s.allLinesAsASortedString()=='straightLines:["[0,1]","[0,3]","[0,4]","[1,2]","[1,4]","[2,4]","[2,5]","[3,4]","[3,6]","[3,7]","[4,5]","[4,7]","[5,7]","[5,8]","[6,7]","[7,8]"]')}{var s=new e.Mamesh;var n=new t.SingleSquare(s);n.makeLinks=false;n.go();new e.mameshModification.SquareDichotomer(s).go();new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(s).goChanging();s.clearOppositeInLinks();new e.linkModule.OppositeLinkAssocierByAngles(s.vertices).goChanging();e.debug.checkTheRegularityOfAGraph(s.vertices)}{var o=new e.reseau.BasisForRegularReseau;o.nbVerticalDecays=1;o.nbHorizontalDecays=1;o.nbI=4;o.nbJ=4;var h=o.go();var l=new e.reseau.Regular;l.makeLinks=true;l.nbI=4;l.nbJ=4;l.Vi=h.Vi;l.Vj=h.Vj;var s=l.go();s.clearOppositeInLinks();var u=new e.linkModule.OppositeLinkAssocierByAngles(s.vertices);u.maxAngleToAssociateLinks=Math.PI/6;u.goChanging();s.fillLineCatalogue();i.assertTrue(s.allLinesAsASortedString()=='straightLines:["[0,1,2,3]","[0,4,8,12]","[1,5,9,13]","[12,13,14,15]","[2,6,10,14]","[3,7,11,15]","[4,5,6,7]","[8,9,10,11]"]');e.debug.checkTheRegularityOfAGraph(s.vertices)}{function c(t,i,r,s){var a=new e.reseau.BasisForRegularReseau;a.nbI=t;a.nbJ=i;a.end=new e.XYZ(2*Math.PI,2*Math.PI,0);a.nbVerticalDecays=r;a.nbHorizontalDecays=s;var n=a.go();var o=.8;var h=2;var l=new e.reseau.Regular;l.makeLinks=false;l.nbI=t;l.nbJ=i;l.Vi=n.Vi;l.Vj=n.Vj;var u=l.go();u.vertices.forEach(function(e){var t=e.position.x;var i=e.position.y;e.position.x=(o*Math.cos(t)+h)*Math.cos(i);e.position.y=(o*Math.cos(t)+h)*Math.sin(i);e.position.z=o*Math.sin(t)});u.clearLinksAndLines();var c=new e.grateAndGlue.Merger(u,null,null);c.cleanDoubleLinks=false;c.mergeLink=false;c.goChanging();var m=new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(u);m.forceOppositeLinksAtCorners=true;m.goChanging();u.fillLineCatalogue();return u.allLinesAsASortedString()}function m(t,i,r,s,a){var n=new e.reseau.BasisForRegularReseau;n.nbI=t;n.nbJ=i;n.end=new e.XYZ(2*Math.PI,2*Math.PI,0);n.nbVerticalDecays=r;n.nbHorizontalDecays=s;var o=n.go();var h=.8;var l=2;var u=new e.reseau.Regular;u.makeLinks=true;u.nbI=t;u.nbJ=i;u.Vi=o.Vi;u.Vj=o.Vj;var c=u.go();c.vertices.forEach(function(e){var t=e.position.x;var i=e.position.y;e.position.x=(h*Math.cos(t)+l)*Math.cos(i);e.position.y=(h*Math.cos(t)+l)*Math.sin(i);e.position.z=h*Math.sin(t)});var m=new e.grateAndGlue.Merger(c,null,null);m.cleanDoubleLinks=true;m.mergeLink=true;m.goChanging();var d=new e.linkModule.OppositeLinkAssocierByAngles(c.vertices);d.maxAngleToAssociateLinks=a;d.goChanging();c.fillLineCatalogue();return c.allLinesAsASortedString()}}{var s=new e.Mamesh;var d=s.newVertex(new e.XYZ(1,0,0));var f=s.newVertex(new e.XYZ(2,0,0));d.setOneLink(f);f.setOneLink(d);var p=new e.Vertex;p.param=new e.XYZ(1,2,3);p.setOneLink(f);f.setOneLink(p);var v=new e.lineModule.LineComputer(s);v.restrictLinesToTheseVertices=s.vertices;v.go();i.assertTrue(s.getStraightLines().length==1)}return i}e.linkerTest=i})(mathis||(mathis={}));var mathis;(function(e){function t(t){var i=new e.Bilan;{var r=new e.Mamesh;var s=new e.creationFlat.SingleSquare(r);s.makeLinks=false;s.go();var a=new e.mameshModification.SquareDichotomer(r);a.go();var n=new e.mameshModification.SquareDichotomer(r);n.squareToCut=[r.vertices[0],r.vertices[4],r.vertices[8],r.vertices[7]];n.go();var o=new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(r);o.goChanging();r.fillLineCatalogue();i.assertTrue(r.allLinesAsASortedString()=='straightLines:["[0,12,7,3]","[0,9,4,1]","[1,5,2]","[10,13,12]","[2,6,3]","[4,10,8,6]","[5,8,11,7]","[9,13,11]"]')}{var r=new e.Mamesh;new e.creationFlat.SingleSquareWithOneDiag(r).go();var a=new e.mameshModification.TriangleDichotomer(r);a.trianglesToCut=[r.vertices[0],r.vertices[1],r.vertices[3]];a.makeLinks=true;a.go();var n=new e.mameshModification.TriangleDichotomer(r);n.trianglesToCut=[r.vertices[4],r.vertices[5],r.vertices[6]];a.makeLinks=true;n.go();new e.spacialTransformations.Similitude(r.vertices,.1).goChanging();r.fillLineCatalogue();i.assertTrue(r.allLinesAsASortedString()=='straightLines:["[0,4,1]","[0,6,3]","[1,2]","[1,5,3]","[2,3]","[4,7,5]","[4,9,6]","[5,8,6]","[7,8]","[7,9]","[8,9]"]')}{var r=new e.Mamesh;var s=new e.creationFlat.SingleSquare(r);s.makeLinks=false;s.go();var a=new e.mameshModification.SquareDichotomer(r);a.go();var h=new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(r);h.goChanging();r.fillLineCatalogue();i.assertTrue(r.allLinesAsASortedString()=='straightLines:["[0,4,1]","[0,7,3]","[1,5,2]","[2,6,3]","[4,8,6]","[5,8,7]"]')}{var r=new e.Mamesh;new e.creationFlat.SingleSquareWithOneDiag(r).go();var a=new e.mameshModification.TriangleDichotomer(r);a.trianglesToCut=[r.vertices[0],r.vertices[1],r.vertices[3]];a.makeLinks=true;a.go();r.clearLinksAndLines();new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(r).goChanging();r.fillLineCatalogue();i.assertTrue(r.allLinesAsASortedString()=='straightLines:["[0,4,1]","[0,6,3]","[1,2]","[1,5,3]","[2,3]","[4,5]","[4,6]","[5,6]"]')}{var r=new e.Mamesh;var s=new e.creationFlat.SingleSquare(r);s.makeLinks=false;s.go();var a=new e.mameshModification.SquareDichotomer(r);a.go();var n=new e.mameshModification.SquareDichotomer(r);n.squareToCut=[r.vertices[0],r.vertices[4],r.vertices[8],r.vertices[7]];n.go();new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(r).goChanging();r.fillLineCatalogue();i.assertTrue(r.allLinesAsASortedString()=='straightLines:["[0,12,7,3]","[0,9,4,1]","[1,5,2]","[10,13,12]","[2,6,3]","[4,10,8,6]","[5,8,11,7]","[9,13,11]"]')}{var l=new e.reseau.Regular;l.nbI=2;l.nbJ=2;l.makeLinks=false;var u=l.go();new e.mameshModification.SquareDichotomer(u).go();new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(u).goChanging();var c=new e.reseau.Regular;c.nbI=2;c.nbJ=2;var m=c.go();m.vertices.forEach(function(e){e.position.x+=1});new e.grateAndGlue.Merger(u,m,null).goChanging()}{var r=new e.Mamesh;new e.creationFlat.SingleSquareWithOneDiag(r).go();var d=new e.mameshModification.TriangleDichotomer(r);d.makeLinks=true;d.go();r.fillLineCatalogue();var f=new e.Mamesh;new e.creationFlat.SingleSquareWithOneDiag(f).go();var p=new e.mameshModification.TriangleDichotomer(f);p.makeLinks=false;p.go();new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(f).goChanging();f.fillLineCatalogue();i.assertTrue(r.allLinesAsASortedString()==f.allLinesAsASortedString())}{var v=0;var g=0;var w="";var y="";{var b=performance.now();var r=new e.Mamesh;var T=new e.reseau.SingleTriangle(r);T.go();var M=new e.mameshModification.TriangleDichotomer(r);M.makeLinks=false;M.go();M=new e.mameshModification.TriangleDichotomer(r);M.makeLinks=false;M.go();M=new e.mameshModification.TriangleDichotomer(r);M.makeLinks=false;M.go();M=new e.mameshModification.TriangleDichotomer(r);M.makeLinks=false;M.go();M=new e.mameshModification.TriangleDichotomer(r);M.makeLinks=false;M.go();new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(r).goChanging();v=performance.now()-b;r.fillLineCatalogue();w=r.allLinesAsASortedString()}{var b=performance.now();var r=new e.Mamesh;var T=new e.reseau.SingleTriangle(r);T.go();var M=new e.mameshModification.TriangleDichotomer(r);M.makeLinks=true;M.go();M=new e.mameshModification.TriangleDichotomer(r);M.makeLinks=true;M.go();M=new e.mameshModification.TriangleDichotomer(r);M.makeLinks=true;M.go();M=new e.mameshModification.TriangleDichotomer(r);M.makeLinks=true;M.go();M=new e.mameshModification.TriangleDichotomer(r);M.makeLinks=true;M.go();g=performance.now()-b;r.fillLineCatalogue();y=r.allLinesAsASortedString()}i.assertTrue(v>g);i.assertTrue(w==y)}{var r=new e.reseau.TriangulatedPolygone(13).go();r.fillLineCatalogue();i.assertTrue(r.getStraightLines().length==26)}return i}e.testMameshModification=t})(mathis||(mathis={}));var mathis;(function(e){function t(t){var i=new e.Bilan;{var r=3;var s=new e.reseau.BasisForRegularReseau;s.origin=new e.XYZ(-1/2,-1/2,0);s.end=new e.XYZ(1/2,1/2,0);s.nbI=r;s.nbJ=r;var a=new e.reseau.Regular(s).go();var n=[];for(var o=0;o<a.vertices.length;o++){if(o!=2)n.push(a.vertices[o])}var h=new e.grateAndGlue.SubMameshExtractor(a,n);h.takeCareOfPolygons=false;var l=h.go();l.isolateMameshVerticesFromExteriorVertices();l.fillLineCatalogue();i.assertTrue(l.allLinesAsASortedString()=='straightLines:["[0,1]","[0,3,6]","[1,4,7]","[3,4,5]","[5,8]","[6,7,8]"]')}{var u=function(t){var i=6;var r=new e.reseau.BasisForRegularReseau;r.origin=new e.XYZ(-1/2,-1/2,0);r.end=new e.XYZ(1/2,1/2,0);r.nbI=i;r.nbJ=i;var s=new e.reseau.Regular(r).go();var a=new e.reseau.BasisForRegularReseau;a.origin=new e.XYZ(-1/2,-1/2,0);a.end=new e.XYZ(1/2,1/2,0);a.nbI=i;a.nbJ=i;var n=new e.reseau.Regular(a).go();var o=new e.reseau.BasisForRegularReseau;o.origin=new e.XYZ(-1/2,-1/2,0);o.end=new e.XYZ(1/2,1/2,0);o.nbI=i;o.nbJ=i;var h=new e.reseau.Regular(o).go();new e.spacialTransformations.Similitude(n.vertices,0,new e.XYZ(.3,.2,0)).goChanging();new e.spacialTransformations.Similitude(h.vertices,0,new e.XYZ(.2,-.2,0)).goChanging();var l=new e.grateAndGlue.GraphGrater;l.IN_graphFamily=[s.vertices,n.vertices,h.vertices];l.proximityCoefToGrate=t;var u=l.go();s=new e.grateAndGlue.SubMameshExtractor(s,u[0]).go();s.isolateMameshVerticesFromExteriorVertices();n=new e.grateAndGlue.SubMameshExtractor(n,u[1]).go();n.isolateMameshVerticesFromExteriorVertices();h=new e.grateAndGlue.SubMameshExtractor(h,u[2]).go();h.isolateMameshVerticesFromExteriorVertices();return s.allSquareAndTrianglesAsSortedString()+n.allSquareAndTrianglesAsSortedString()+h.allSquareAndTrianglesAsSortedString()};i.assertTrue(u([1])=='square:["[0,6,7,1]","[1,7,8,2]","[12,18,19,13]","[13,19,20,14]","[14,20,21,15]","[15,21,22,16]","[2,8,9,3]","[3,9,10,4]","[6,12,13,7]","[7,13,14,8]","[8,14,15,9]","[9,15,16,10]"]triangle:[]square:["[0,6,7,1]","[1,7,8,2]","[2,8,9,3]","[6,12,13,7]","[7,13,14,8]","[8,14,15,9]"]triangle:[]square:["[0,6,7,1]","[12,18,19,13]","[18,24,25,19]","[19,25,26,20]","[20,26,27,21]","[24,30,31,25]","[25,31,32,26]","[26,32,33,27]","[6,12,13,7]"]triangle:[]');i.assertTrue(u([.7])=='square:["[0,6,7,1]","[1,7,8,2]","[10,16,17,11]","[12,18,19,13]","[13,19,20,14]","[14,20,21,15]","[15,21,22,16]","[16,22,23,17]","[2,8,9,3]","[3,9,10,4]","[4,10,11,5]","[6,12,13,7]","[7,13,14,8]","[8,14,15,9]","[9,15,16,10]"]triangle:[]square:["[0,6,7,1]","[1,7,8,2]","[2,8,9,3]","[6,12,13,7]","[7,13,14,8]","[8,14,15,9]"]triangle:[]square:["[0,6,7,1]","[1,7,8,2]","[2,8,9,3]","[6,12,13,7]","[7,13,14,8]","[8,14,15,9]"]triangle:[]');i.assertTrue(u([.5])=='square:["[0,6,7,1]","[1,7,8,2]","[10,16,17,11]","[12,18,19,13]","[13,19,20,14]","[14,20,21,15]","[15,21,22,16]","[16,22,23,17]","[2,8,9,3]","[21,27,28,22]","[22,28,29,23]","[3,9,10,4]","[4,10,11,5]","[6,12,13,7]","[7,13,14,8]","[8,14,15,9]","[9,15,16,10]"]triangle:[]square:["[0,6,7,1]","[1,7,8,2]","[2,8,9,3]","[6,12,13,7]","[7,13,14,8]","[8,14,15,9]"]triangle:[]square:["[0,6,7,1]","[1,7,8,2]","[2,8,9,3]","[6,12,13,7]","[7,13,14,8]","[8,14,15,9]"]triangle:[]')}{var c=function(t){var i=4;var r=new e.reseau.BasisForRegularReseau;r.origin=new e.XYZ(-1/2,-1/2,0);r.end=new e.XYZ(1/2,1/2,0);r.nbI=i;r.nbJ=i;var s=new e.reseau.Regular(r);s.squareVersusTriangleMaille=false;var a=s.go();var n=[a.vertices[0],a.vertices[1],a.vertices[4],a.vertices[5]];var o=new e.grateAndGlue.SubMameshExtractor(a,n);o.addBorderPolygonInsteadOfSuppress=t;var h=o.go();return h};var m=c(false);i.assertTrue(m.allSquareAndTrianglesAsSortedString()=='square:[]triangle:["[0,4,5]","[0,5,1]"]');m=c(true);i.assertTrue(m.allSquareAndTrianglesAsSortedString()=='square:[]triangle:["[0,4,5]","[0,5,1]","[1,5,2]","[2,5,6]","[4,8,9]","[4,9,5]","[5,9,6]"]')}{var r=4;var s=new e.reseau.BasisForRegularReseau;s.origin=new e.XYZ(-1/2,-1/2,0);s.end=new e.XYZ(1/2,1/2,0);s.nbI=r;s.nbJ=r;var d=new e.reseau.Regular(s).go();var f=[d.vertices[0],d.vertices[1],d.vertices[4],d.vertices[5]];var p=new e.grateAndGlue.SubMameshExtractor(d,f);p.addBorderPolygonInsteadOfSuppress=true;var m=p.go();i.assertTrue(p.OUT_BorderPolygon.length==3);i.assertTrue(p.OUT_BorderVerticesInside.length==3);i.assertTrue(p.OUTBorderVerticesOutside.length==5);i.assertTrue(m.allSquareAndTrianglesAsSortedString()=='square:["[0,4,5,1]","[1,5,6,2]","[4,8,9,5]","[5,9,10,6]"]triangle:[]')}{var r=4;var s=new e.reseau.BasisForRegularReseau;s.origin=new e.XYZ(-1/2,-1/2,0);s.end=new e.XYZ(1/2,1/2,0);s.nbI=r;s.nbJ=r;var d=new e.reseau.Regular(s).go();var f=[d.vertices[0],d.vertices[1],d.vertices[4],d.vertices[5]];var p=new e.grateAndGlue.SubMameshExtractor(d,f);p.addBorderPolygonInsteadOfSuppress=false;var m=p.go();i.assertTrue(p.OUT_BorderPolygon.length==3);i.assertTrue(p.OUT_BorderVerticesInside.length==3);i.assertTrue(p.OUTBorderVerticesOutside.length==5);i.assertTrue(m.allSquareAndTrianglesAsSortedString()=='square:["[0,4,5,1]"]triangle:[]')}{var r=5;var s=new e.reseau.BasisForRegularReseau;s.origin=new e.XYZ(-1/2,-1/2,0);s.end=new e.XYZ(1/2,1/2,0);s.nbI=r;s.nbJ=r;var d=new e.reseau.Regular(s).go();d.fillLineCatalogue();var v=d.allLinesAsASortedString();d.clearOppositeInLinks();new e.linkModule.OppositeLinkAssocierByAngles(d.vertices).goChanging();d.fillLineCatalogue();var g=d.allLinesAsASortedString();i.assertTrue(v==g)}{var r=7;var s=new e.reseau.BasisForRegularReseau;s.origin=new e.XYZ(-1/2,-1/2,0);s.end=new e.XYZ(1/2,1/2,0);s.nbI=r;s.nbJ=r;var d=new e.reseau.Regular(s).go();r=5;var w=new e.reseau.BasisForRegularReseau;w.origin=new e.XYZ(-1/2,-1/2,0);w.end=new e.XYZ(1/2,1/2,0);w.nbI=r;w.nbJ=r;var y=new e.reseau.Regular(w).go();new e.spacialTransformations.Similitude(y.vertices,Math.PI/4,new e.XYZ(0,0,0),new e.XYZ(.5,.5,0)).goChanging();var b=new e.grateAndGlue.GraphGrater;b.IN_graphFamily=[d.vertices,y.vertices];var T=b.go();d=new e.grateAndGlue.SubMameshExtractor(d,T[0]).go();d.isolateMameshVerticesFromExteriorVertices();y=new e.grateAndGlue.SubMameshExtractor(y,T[1]).go();y.isolateMameshVerticesFromExteriorVertices();i.assertTrue(d.allSquareAndTrianglesAsSortedString()+y.allSquareAndTrianglesAsSortedString()=='square:["[0,7,8,1]","[1,8,9,2]","[12,19,20,13]","[28,35,36,29]","[33,40,41,34]","[35,42,43,36]","[36,43,44,37]","[39,46,47,40]","[4,11,12,5]","[40,47,48,41]","[5,12,13,6]","[7,14,15,8]"]triangle:[]square:["[0,5,6,1]","[1,6,7,2]","[10,15,16,11]","[11,16,17,12]","[12,17,18,13]","[13,18,19,14]","[15,20,21,16]","[16,21,22,17]","[17,22,23,18]","[18,23,24,19]","[2,7,8,3]","[3,8,9,4]","[5,10,11,6]","[6,11,12,7]","[7,12,13,8]","[8,13,14,9]"]triangle:[]')}{var r=4;var s=new e.reseau.BasisForRegularReseau;s.origin=new e.XYZ(-1/2,-1/2,0);s.end=new e.XYZ(1/2,1/2,0);s.nbI=r;s.nbJ=r;var d=new e.reseau.Regular(s).go();d.name="centre00";var M=new e.HashMap;d.vertices.forEach(function(e){if(e.param.x!=1)M.putValue(e,true)});var n=e.graph.getGroup([d.vertices[0]],M);n=e.graph.getEdge(n);var h=new e.grateAndGlue.SubMameshExtractor(d,n);h.takeCareOfPolygons=false;var l=h.go();l.isolateMameshVerticesFromExteriorVertices();l.fillLineCatalogue();i.assertTrue(l.allLinesAsASortedString()=='straightLines:["[0,1,2,3]"]')}{var r=4;var s=new e.reseau.BasisForRegularReseau;s.origin=new e.XYZ(-1/2,-1/2,0);s.end=new e.XYZ(1/2,1/2,0);s.nbI=r;s.nbJ=r;var d=new e.reseau.Regular(s).go();d.name="centre00";var C=new e.HashMap;d.vertices.forEach(function(e){if(e.param.x!=1)C.putValue(e,true)});var n=e.graph.getGroup([d.vertices[0]],C);var h=new e.grateAndGlue.SubMameshExtractor(d,n);h.takeCareOfPolygons=false;var l=h.go();l.isolateMameshVerticesFromExteriorVertices();l.fillLineCatalogue();i.assertTrue(l.allLinesAsASortedString()=='straightLines:["[0,1,2,3]"]')}{var r=4;var s=new e.reseau.BasisForRegularReseau;s.origin=new e.XYZ(-1/2,-1/2,0);s.end=new e.XYZ(1/2,1/2,0);s.nbI=r;s.nbJ=r;var d=new e.reseau.Regular(s).go();d.name="centre00";var S=new e.HashMap;d.vertices.forEach(function(e){if(e.param.x!=1||e.param.y!=1)S.putValue(e,true)});var n=e.graph.getGroup([d.vertices[0]],S);var h=new e.grateAndGlue.SubMameshExtractor(d,n);h.takeCareOfPolygons=false;var l=h.go();l.isolateMameshVerticesFromExteriorVertices();l.fillLineCatalogue();i.assertTrue(l.allLinesAsASortedString()=='straightLines:["[0,1,2,3]","[0,4,8,12]","[12,13,14,15]","[2,6,10,14]","[3,7,11,15]","[6,7]","[8,9,10,11]","[9,13]"]')}return i}e.testRiemann=t})(mathis||(mathis={}));var mathis;(function(e){function t(){var t=new e.Bilan;function i(i,r){var s=new e.HashMap(true);r.vertices.forEach(function(e){var t=i(e.param);s.putValue(r.findVertexFromParam(t),true)});t.assertTrue(s.allValues().length==r.vertices.length)}function r(e,t){t.allValues().forEach(function(t){i(t,e)})}{var s=new e.reseau.Regular;s.nbI=5;s.nbJ=6;s.makeLinks=false;var a=s.go();new e.mameshModification.SquareDichotomer(a).go();new e.mameshModification.SquareDichotomer(a).go();r(a,e.symmetries.cartesian(s.nbI,s.nbJ))}{var s=new e.reseau.Regular;s.nbI=3;s.nbJ=7;s.oneMoreVertexForOddLine=true;s.squareVersusTriangleMaille=false;var a=s.go();r(a,e.symmetries.cartesian(s.nbI,s.nbJ,s.oneMoreVertexForOddLine))}{var s=new e.reseau.Regular;s.nbI=9;s.nbJ=5;s.oneMoreVertexForOddLine=false;s.squareVersusTriangleMaille=false;var a=s.go();var n=new e.mameshModification.TriangleDichotomer(a);n.makeLinks=true;n.go();n=new e.mameshModification.TriangleDichotomer(a);n.makeLinks=true;n.go();r(a,e.symmetries.cartesian(s.nbI,s.nbJ,s.oneMoreVertexForOddLine))}{for(var o=3;o<12;o++){var s=new e.reseau.TriangulatedPolygone(o);var a=s.go();var n=new e.mameshModification.TriangleDichotomer(a);n.makeLinks=true;n.go();n=new e.mameshModification.TriangleDichotomer(a);n.makeLinks=true;n.go();r(a,e.symmetries.polygonRotations(o))}}{var o=5;var s=new e.reseau.TriangulatedPolygone(o);var a=s.go();var n=new e.mameshModification.TriangleDichotomer(a);n.makeLinks=true;n.go();n=new e.mameshModification.TriangleDichotomer(a);n.makeLinks=true;n.go();r(a,e.symmetries.polygonRotations(o))}{t.assertTrue(e.roundWithGivenPrecision(5.749999999,3)==5.75);t.assertTrue(e.roundWithGivenPrecision(-5.789999999,5)==-5.79);t.assertTrue(e.roundWithGivenPrecision(5.749999936,9)==5.749999936)}return t}e.symmetriesTest=t})(mathis||(mathis={}));var mathis;(function(e){e.myFavoriteColors={green:new BABYLON.Color3(124/255,252/255,0)};var t=function(){function e(e,t){this.u=e;this.v=t}return e}();e.UV=t;var i=function(){function e(){this.m11=0;this.m12=0;this.m21=0;this.m22=0}e.prototype.determinant=function(){return this.m11*this.m22-this.m21*this.m12};e.prototype.inverse=function(){var t=new e;var i=this.determinant();t.m11=this.m22/i;t.m22=this.m11/i;t.m12=-this.m12/i;t.m21=-this.m21/i;return t};e.prototype.multiplyUV=function(e){return new t(this.m11*e.u+this.m12*e.v,this.m21*e.u+this.m22*e.v)};return e}();e.M22=i;var r=function(t){__extends(i,t);function i(e,i,r){t.call(this,e,i,r)}i.resetDefaultNbDecimalForHash=function(){i.nbDecimalForHash=5};Object.defineProperty(i.prototype,"hashString",{get:function(){return e.roundWithGivenPrecision(this.x,i.nbDecimalForHash)+","+e.roundWithGivenPrecision(this.y,i.nbDecimalForHash)+","+e.roundWithGivenPrecision(this.z,i.nbDecimalForHash)},enumerable:true,configurable:true});i.newZero=function(){return new i(0,0,0)};i.newFrom=function(e){if(e==null)return null;return new i(e.x,e.y,e.z)};i.newOnes=function(){return new i(1,1,1)};i.newRandom=function(){return new i(Math.random(),Math.random(),Math.random())};i.temp0=function(e,t,i){s.copyFromFloats(e,t,i);return s};i.temp1=function(e,t,i){a.copyFromFloats(e,t,i);return a};i.prototype.add=function(t){e.geo.add(this,t,this);return this};i.prototype.resizes=function(e){this.x*=e.x;this.y*=e.y;this.z*=e.z;return this};i.prototype.multiply=function(e){this.x*=e.x;this.y*=e.y;this.z*=e.z;return this};i.prototype.substract=function(t){e.geo.substract(this,t,this);return this};i.prototype.scale=function(t){e.geo.scale(this,t,this);return this};i.prototype.copyFrom=function(e){this.x=e.x;this.y=e.y;this.z=e.z;return this};i.prototype.copyFromFloats=function(e,t,i){this.x=e;this.y=t;this.z=i;return this};i.prototype.changeBy=function(e,t,i){this.x=e;this.y=t;this.z=i;return this};i.prototype.normalize=function(){var t=e.geo.norme(this);if(t<e.geo.epsilon)throw"be careful, you have normalized a very small vector";return this.scale(1/t)};i.prototype.almostEqual=function(t){return e.geo.xyzAlmostEquality(this,t)};i.prototype.toString=function(e){if(e===void 0){e=2}return"("+this.x.toFixed(e)+","+this.y.toFixed(e)+","+this.z.toFixed(e)+")"};i.lexicalOrder=function(e,t){if(e.x!=t.x)return e.x-t.x;else if(e.y!=t.y)return e.y-t.y;else if(e.z!=t.z)return e.z-t.z;else return 0};i.lexicalOrderInverse=function(e,t){return-i.lexicalOrder(e,t)};i.nbDecimalForHash=5;return i}(BABYLON.Vector3);e.XYZ=r;var s=new r(0,0,0);var a=new r(0,0,0);var n=function(t){__extends(i,t);function i(e,i,r,s){t.call(this,e,i,r,s)}i.prototype.multiply=function(t){e.geo.quaternionMultiplication(t,this,this);return this};return i}(BABYLON.Quaternion);e.XYZW=n;var o=function(){function e(){}e.segment=function(e,t){return f.segmentId(e.hashNumber,t.hashNumber)};e.segmentOrd=function(e,t){if(e.hashNumber>t.hashNumber)i=[t,e],e=i[0],t=i[1];return[e,t];var i};e.quad=function(t,i,r,s){a=e.quadOrd(t,i,r,s),t=a[0],i=a[1],r=a[2],s=a[3];return t.hashNumber+","+i.hashNumber+","+r.hashNumber+","+s.hashNumber;var a};e.quadOrd=function(e,t,i,r){while(e.hashNumber>t.hashNumber||e.hashNumber>i.hashNumber||e.hashNumber>r.hashNumber)s=[t,i,r,e],e=s[0],t=s[1],i=s[2],r=s[3];if(t.hashNumber<r.hashNumber)a=[r,t],t=a[0],r=a[1];return[e,t,i,r];var s,a};return e}();e.Hash=o;var h=function(){function t(){this.position=new r(0,0,0);this.frontDir=new r(1,0,0);this.upVector=new r(0,1,0);this.scaling=new r(1,1,1);this.defaultUpDirIfTooSmall=new r(1,1,0);this.defaultFrontDirIfTooSmall=new r(0,0,1)}t.prototype.copyFrom=function(e){this.position=r.newFrom(e.position);this.upVector=r.newFrom(e.upVector);this.frontDir=r.newFrom(e.frontDir);this.scaling=r.newFrom(e.scaling)};t.prototype.changeFrontDir=function(t){e.geo.orthonormalizeKeepingFirstDirection(t,this.upVector,this.frontDir,this.upVector)};t.prototype.changeUpVector=function(t){e.geo.orthonormalizeKeepingFirstDirection(this.upVector,t,this.upVector,this.frontDir)};t.prototype.setOrientation=function(t,i){this.upVector=new r(0,0,0);this.frontDir=new r(0,0,0);e.geo.orthonormalizeKeepingFirstDirection(t,i,this.frontDir,this.upVector)};t.prototype.quaternion=function(t){if(t===void 0){t=true}if(this.frontDir==null&&this.upVector==null)throw"you must precise a frontDir or a upVector or both of them";else if(this.frontDir==null){this.frontDir=new r(0,0,0);e.geo.getOneOrthonormal(this.upVector,this.frontDir)}else if(this.upVector==null){this.upVector=new r(0,0,0);e.geo.getOneOrthonormal(this.frontDir,this.upVector)}if(this.frontDir.length()<e.geo.epsilon){this.frontDir=this.defaultFrontDirIfTooSmall;e.logger.c("a tangent was too small, and so replaced by a default one")}if(this.upVector.length()<e.geo.epsilon){this.upVector=this.defaultUpDirIfTooSmall;e.logger.c("a normal was too small, and so replaced by a default one")}var i=new n(0,0,0,1);e.geo.twoVectorsToQuaternion(this.frontDir,this.upVector,!t,i);return i};t.prototype.applyToMeshes=function(e){var t=null;if(this.frontDir!=null||this.upVector!=null)t=this.quaternion();for(var i=0,r=e;i<r.length;i++){var s=r[i];if(this.scaling!=null)s.scaling=this.scaling;if(t!=null)s.rotationQuaternion=t;if(this.position!=null)s.position=this.position}};t.prototype.applyToVertices=function(t){var i=this.quaternion();var r=new l;e.geo.quaternionToMatrix(i,r);for(var s=0,a=t;s<a.length;s++){var n=a[s];n.position.multiply(this.scaling);e.geo.multiplicationMatrixVector(r,n.position,n.position);n.position.add(this.position)}};return t}();e.Positioning=h;var l=function(t){__extends(i,t);function i(){t.call(this)}i.newIdentity=function(){var e=new i;e.m[0]=1;e.m[5]=1;e.m[10]=1;e.m[15]=1;return e};i.newFrom=function(e){var t=new i;for(var r=0;r<16;r++)t.m[r]=e.m[r];return t};i.newRandomMat=function(){var e=new i;for(var t=0;t<16;t++)e.m[t]=Math.random();return e};i.newZero=function(){return new i};i.prototype.equal=function(t){return e.geo.matEquality(this,t)};i.prototype.almostEqual=function(t){return e.geo.matAlmostEquality(this,t)};i.prototype.leftMultiply=function(t){e.geo.multiplyMatMat(t,this,this);return this};i.prototype.rightMultiply=function(t){e.geo.multiplyMatMat(this,t,this);return this};i.prototype.inverse=function(){e.geo.inverse(this,this);return this};i.prototype.copyFrom=function(t){e.geo.copyMat(t,this);return this};i.prototype.transpose=function(){e.geo.transpose(this,this);return this};i.prototype.toString=function(){return"\n"+this.m[0]+this.m[1]+this.m[2]+this.m[3]+"\n"+this.m[4]+this.m[5]+this.m[6]+this.m[7]+"\n"+this.m[8]+this.m[9]+this.m[10]+this.m[11]+"\n"+this.m[12]+this.m[13]+this.m[14]+this.m[15]+"\n"};return i}(BABYLON.Matrix);e.MM=l;var u=function(){function e(e){this.customerOb=null;if(e==null)throw"a links is construct with a null vertex";this.to=e}return e}();e.Link=u;var c=function(){function t(){this.links=[];this.isInvisible=false;this.dichoLevel=0;this.markers=[];this.customerObject={};this._hashCode=t.hashCount++}Object.defineProperty(t.prototype,"hashNumber",{get:function(){return this._hashCode},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"hashString",{get:function(){return this._hashCode+""},enumerable:true,configurable:true});t.prototype.setPosition=function(e,t,i,s){if(s===void 0){s=true}this.position=new r(e,t,i);if(s)this.param=new r(e,t,i);return this};t.prototype.hasMark=function(e){return this.markers.indexOf(e)!=-1};t.prototype.getOpposites=function(e){var t=this.findLink(e);if(t==null)throw"the vertex is not a neighbor. Probably your neighborhood relation is not symetric. "+"Please, perform the graph analysis, with the help of the function linkModule.checkTheRegularityOfAGRaph";if(t.opposites==null)return null;var i=[];for(var r=0,s=t.opposites;r<s.length;r++){var a=s[r];i.push(a.to)}return i};t.prototype.hasBifurcations=function(){for(var e=0,t=this.links;e<t.length;e++){var i=t[e];if(i.opposites!=null&&i.opposites.length>1)return true}return false};t.prototype.hasVoisin=function(e){for(var t=0,i=this.links;t<i.length;t++){var r=i[t];if(r.to==e)return true}return false};t.prototype.isBorder=function(){return this.hasMark(t.Markers.border)};t.prototype.findLink=function(e){for(var t=0,i=this.links;t<i.length;t++){var r=i[t];if(r.to==e)return r}return null};t.prototype.setTwoOppositeLinks=function(e,t){var i=this.findLink(e);var r=this.findLink(t);if(i==null){i=new u(e);this.links.push(i)}if(r==null){r=new u(t);this.links.push(r)}if(i.opposites==null)i.opposites=[];if(r.opposites==null)r.opposites=[];i.opposites.push(r);r.opposites.push(i);return this};t.prototype.setOneLink=function(e){if(e==this)throw"it is forbidden to link to itself";this.suppressOneLink(e);this.links.push(new u(e));return this};t.separateTwoVoisins=function(e,t){e.suppressOneLink(t);t.suppressOneLink(e)};t.prototype.suppressOneLink=function(t){var i=this.findLink(t);if(i==null)return;e.tab.removeFromArray(this.links,i);if(i.opposites!=null){for(var r=0,s=i.opposites;r<s.length;r++){var a=s[r];if(a.opposites.length>=2)e.tab.removeFromArray(a.opposites,i);else a.opposites=null}}};t.prototype.changeToLinkWithoutOpposite=function(t){var i=this.findLink(t);if(i==null)return;if(i.opposites!=null){for(var r=0,s=i.opposites;r<s.length;r++){var a=s[r];if(a.opposites.length>=2)e.tab.removeFromArray(a.opposites,i);else a.opposites=null}}i.opposites=null};t.prototype.toString=function(e){var t=this.hashNumber-e+"";return t};t.prototype.toStringComplete=function(e){var i=this.hashNumber-e+"|links:";for(var r=0,s=this.links;r<s.length;r++){var a=s[r];var n="";if(a.opposites!=null){n+=",";for(var o=0,h=a.opposites;o<h.length;o++){var l=h[o];n+=l.to.hashNumber-e+","}}i+="("+(a.to.hashNumber-e)+n+")"}if(this.position!=null)i+="|pos:"+this.position.toString(1)+",";i+="|mark:";for(var u=0,c=this.markers;u<c.length;u++){var m=c[u];i+=t.Markers[m]+","}return i};t.hashCount=0;return t}();e.Vertex=c;var c;(function(e){(function(e){e[e["honeyComb"]=0]="honeyComb";e[e["corner"]=1]="corner";e[e["center"]=2]="center";e[e["border"]=3]="border";e[e["polygonCenter"]=4]="polygonCenter";e[e["selectedForLineDrawing"]=5]="selectedForLineDrawing"})(e.Markers||(e.Markers={}));var t=e.Markers})(c=e.Vertex||(e.Vertex={}));var m=function(){function t(){this.vertices=[];this.smallestTriangles=[];this.smallestSquares=[];this.hexahedrons=[];this.cutSegmentsDico={}}Object.defineProperty(t.prototype,"polygons",{get:function(){var e=[];for(var t=0;t<this.smallestSquares.length;t+=4)e.push([this.smallestSquares[t],this.smallestSquares[t+1],this.smallestSquares[t+2],this.smallestSquares[t+3]]);for(var t=0;t<this.smallestTriangles.length;t+=3)e.push([this.smallestTriangles[t],this.smallestTriangles[t+1],this.smallestTriangles[t+2]]);return e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"linesWasMade",{get:function(){return this.lines!=null},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"segments",{get:function(){var e=[];for(var t=0,i=this.vertices;t<i.length;t++){var r=i[t];for(var s=0,a=r.links;s<a.length;s++){var n=a[s];if(r.hashNumber<n.to.hashNumber)e.push([r,n.to])}}return e},enumerable:true,configurable:true});t.prototype.addATriangle=function(e,t,i){this.smallestTriangles.push(e,t,i);return this};t.prototype.addASquare=function(e,t,i,r){this.smallestSquares.push(e,t,i,r);return this};t.prototype.addHexahedron=function(e){this.hexahedrons.concat(e);return this};t.prototype.getVertex=function(e){var t=this.findVertexFromParam(e);if(t==null)t=this.newVertex(e);return t};t.prototype.newVertex=function(e,t,i){if(t===void 0){t=0}var r=new c;r.position=e;r.param=i?i:e;r.dichoLevel=t;this.addVertex(r);return r};t.prototype.findVertexFromParam=function(e){for(var t=0,i=this.vertices;t<i.length;t++){var r=i[t];if(r.param.hashString==e.hashString)return r}return null};t.prototype.addVertex=function(e){this.vertices.push(e)};t.prototype.hasVertex=function(e){for(var t=0,i=this.vertices;t<i.length;t++){var r=i[t];if(r.hashNumber==e.hashNumber)return true}return false};t.prototype.getStraightLines=function(){var e=[];for(var t=0,i=this.lines;t<i.length;t++){var r=i[t];if(!r.isLoop)e.push(r)}return e};t.prototype.getLoopLines=function(){var e=[];for(var t=0,i=this.lines;t<i.length;t++){var r=i[t];if(r.isLoop)e.push(r)}return e};t.prototype.getStraightLinesAsVertices=function(){var e=[];for(var t=0,i=this.lines;t<i.length;t++){var r=i[t];if(!r.isLoop)e.push(r.vertices)}return e};t.prototype.getLoopLinesAsVertices=function(){var e=[];for(var t=0,i=this.lines;t<i.length;t++){var r=i[t];if(r.isLoop)e.push(r.vertices)}return e};t.prototype.toString=function(e){if(e===void 0){e=true}var t=0;if(e){t=Number.MAX_VALUE;for(var i=0,r=this.vertices;i<r.length;i++){var s=r[i];if(s.hashNumber<t)t=s.hashNumber}}var a="\n";if(this.name!=null)a+=this.name+"\n";for(var n=0,o=this.vertices;n<o.length;n++){var s=o[n];a+=s.toStringComplete(t)+"\n"}a+="tri:";for(var h=0;h<this.smallestTriangles.length;h+=3){a+="["+(this.smallestTriangles[h].hashNumber-t)+","+(this.smallestTriangles[h+1].hashNumber-t)+","+(this.smallestTriangles[h+2].hashNumber-t)+"]"}a+="\nsqua:";for(var h=0;h<this.smallestSquares.length;h+=4){a+="["+(this.smallestSquares[h].hashNumber-t)+","+(this.smallestSquares[h+1].hashNumber-t)+","+(this.smallestSquares[h+2].hashNumber-t)+","+(this.smallestSquares[h+3].hashNumber-t)+"]"}if(this.linesWasMade){a+="\nstrai:";for(var l=0,u=this.getStraightLines();l<u.length;l++){var c=u[l];a+="[";for(var m=0,d=c.vertices;m<d.length;m++){var f=d[m];a+=f.hashNumber-t+","}a+="]"}a+="\nloop:";for(var p=0,v=this.getLoopLines();p<v.length;p++){var c=v[p];a+="[";for(var g=0,w=c.vertices;g<w.length;g++){var f=w[g];a+=f.hashNumber-t+","}a+="]"}}a+="\ncutSegments";for(var y in this.cutSegmentsDico){var b=this.cutSegmentsDico[y];a+="{"+(b.a.hashNumber-t)+","+(b.middle.hashNumber-t)+","+(b.b.hashNumber-t)+"}"}return a};t.prototype.fillLineCatalogue=function(t){if(t===void 0){t=this.vertices}this.lines=e.lineModule.makeLineCatalogue2(t,true)};t.prototype.addSimpleLinksAroundPolygons=function(){new e.linkModule.SimpleLinkFromPolygonCreator(this).goChanging()};t.prototype.addOppositeLinksAroundPolygons=function(){new e.linkModule.SimpleLinkFromPolygonCreator(this).goChanging();new e.linkModule.OppositeLinkAssocierByAngles(this.vertices).goChanging()};t.prototype.isolateMameshVerticesFromExteriorVertices=function(){var e=[];for(var t=0,i=this.vertices;t<i.length;t++){var r=i[t];for(var s=0,a=r.links;s<a.length;s++){var n=a[s];if(!this.hasVertex(n.to))e.push({vertex:r,link:n})}}for(var o=0,h=e;o<h.length;o++){var l=h[o];c.separateTwoVoisins(l.link.to,l.vertex)}};t.prototype.getOrCreateSegment=function(e,t,i){var r=this.cutSegmentsDico[f.segmentId(e.hashNumber,t.hashNumber)];if(r==null){r=new f(e,t);this.cutSegmentsDico[f.segmentId(e.hashNumber,t.hashNumber)]=r}i[f.segmentId(e.hashNumber,t.hashNumber)]=r};t.prototype.maxLinkLength=function(){var t=-1;this.vertices.forEach(function(i){i.links.forEach(function(r){var s=e.geo.distance(i.position,r.to.position);if(s>t)t=s})});if(t==-1)throw"your IN_mamesh seems empty";return t};t.prototype.clearLinksAndLines=function(){this.vertices.forEach(function(t){e.tab.clearArray(t.links)});this.lines=null};t.prototype.clearOppositeInLinks=function(){this.vertices.forEach(function(e){e.links.forEach(function(e){e.opposites=null})})};t.prototype.allLinesAsASortedString=function(t){if(t===void 0){t=true}var i="";var r;var s;if(t){s=Number.MAX_VALUE;for(var a=0,n=this.vertices;a<n.length;a++){var o=n[a];if(o.hashNumber<s)s=o.hashNumber}}if(this.linesWasMade){var h=this.getStraightLines();var l=this.getLoopLines();if(this.linesWasMade&&h.length>0){r=[];h.forEach(function(e){var t=e.vertices;var i=[];t.forEach(function(e){i.push(e.hashNumber-s)});r.push(JSON.stringify(i))});r.sort();i="straightLines:"+JSON.stringify(r)}if(l.length>0){r=[];l.forEach(function(t){var i=t.vertices;var a=[];i.forEach(function(e){a.push(e.hashNumber-s)});var n=e.tab.minIndexOfNumericList(a);var o=[];for(var h=0;h<a.length;h++){o[h]=a[(h+n)%a.length]}r.push(JSON.stringify(o))});r.sort();i+="|loopLines:"+JSON.stringify(r)}}return i};t.prototype.allSquareAndTrianglesAsSortedString=function(e){if(e===void 0){e=true}var t=0;if(e){t=Number.MAX_VALUE;for(var i=0,r=this.vertices;i<r.length;i++){var s=r[i];if(s.hashNumber<t)t=s.hashNumber}}var a="square:"+this.allSquaresOrTrianglesAsASortedString(this.smallestSquares,4,t);var n="triangle:"+this.allSquaresOrTrianglesAsASortedString(this.smallestTriangles,3,t);return a+n};t.prototype.allSquaresOrTrianglesAsASortedString=function(t,i,r){var s="";var a;var n=[];for(var o=0;o<t.length;o+=i){var h=[];for(var l=0;l<i;l++)h.push(t[o+l]);n.push(h)}a=[];n.forEach(function(t){var i=[];t.forEach(function(e){i.push(e.hashNumber-r)});var s=e.tab.minIndexOfNumericList(i);var n=[];for(var o=0;o<i.length;o++){n[o]=i[(o+s)%i.length]}a.push(JSON.stringify(n))});a.sort();s+=JSON.stringify(a);return s};return t}();e.Mamesh=m;var d=function(){function t(e,t){this.vertices=e;this.isLoop=t}t.prototype.getVertex=function(e,t){if(t===void 0){t=true}if(this.isLoop&&t)return this.vertices[e%this.vertices.length];else return this.vertices[e]};t.prototype.hashForDirected=function(){var t=[];if(!this.isLoop){for(var i=0,r=this.vertices;i<r.length;i++){var s=r[i];t.push(s.hashNumber)}}else{var a=e.tab.minIndexOb(this.vertices,function(e,t){return e.hashNumber-t.hashNumber});for(var n=0;n<this.vertices.length;n++)t.push(this.vertices[(n+a)%this.vertices.length].hashNumber)}return JSON.stringify(t)};t.prototype.inverted=function(){var e=[];for(var i=0;i<this.vertices.length;i++)e.push(this.vertices[this.vertices.length-1-i]);return new t(e,this.isLoop)};t.prototype.positionList=function(){var e=[];for(var t=0,i=this.vertices;t<i.length;t++){var r=i[t];e.push(r.position)}return e};Object.defineProperty(t.prototype,"hashString",{get:function(){var e=this.hashForDirected();var t=this.inverted().hashForDirected();return e<t?e:t},enumerable:true,configurable:true});t.prototype.positionnalHashForDirected=function(t){if(t===void 0){t=1}var i=[];r.nbDecimalForHash=t;if(!this.isLoop){for(var s=0,a=this.vertices;s<a.length;s++){var n=a[s];i.push(n.position.hashString)}}else{var o=this.positionList();var h=e.tab.minIndexOb(o,r.lexicalOrder);for(var l=0;l<o.length;l++)i.push(o[(l+h)%o.length].hashString)}r.resetDefaultNbDecimalForHash();return JSON.stringify(i)};t.prototype.positionnalHash=function(e){if(e===void 0){e=1}var t=this.positionnalHashForDirected(e);var i=this.inverted().positionnalHashForDirected(e);return t<i?t:i};t.prototype.hashStringUpToSymmetries=function(i,r){var s=[this.positionnalHash()];for(var a=0,n=i;a<n.length;a++){var o=n[a];var h=[];for(var l=0,u=this.vertices;l<u.length;l++){var m=u[l];var d=new c;if(r)d.position=o(m.position);else d.position=o(m.param);h.push(d)}var f=new t(h,this.isLoop);s.push(f.positionnalHash())}return e.tab.minValueString(s)};t.prototype.allSegments=function(){var e=[];var t=this.isLoop?1:0;for(var i=0;i<this.vertices.length-1+t;i++){e.push(new f(this.vertices[i],this.vertices[(i+1)%this.vertices.length]))}return e};return t}();e.Line=d;var f=function(){function e(e,t){this.a=e.hashNumber<t.hashNumber?e:t;this.b=e.hashNumber<t.hashNumber?t:e}e.segmentId=function(e,t){if(e<t)return e+","+t;else return t+","+e};Object.defineProperty(e.prototype,"hashString",{get:function(){return e.segmentId(this.a.hashNumber,this.b.hashNumber)},enumerable:true,configurable:true});e.prototype.equals=function(e){return this.a==e.a&&this.b==e.b};e.prototype.getOther=function(e){if(e==this.a)return this.b;else return this.a};e.prototype.getFirst=function(){return this.a};e.prototype.getSecond=function(){return this.b};e.prototype.has=function(e){return e==this.a||e==this.b};return e}();e.Segment=f})(mathis||(mathis={}));var mathis;(function(e){var t=function(){function e(e){if(typeof e==="number"){var t=this.hex2rgb(this.intToColorName(e));this.rgb=new r(t[0],t[1],t[2])}else if(typeof e==="string"){var t=this.hex2rgb(e);this.rgb=new r(t[0],t[1],t[2])}else if(e instanceof r){this.rgb=e}else if(e instanceof i){this.rgb=e.toRGB()}}e.prototype.hex2rgb=function(e){var t=e.replace("#","");t=t.match(new RegExp("(.{"+t.length/3+"})","g"));for(var i=0;i<t.length;i++)t[i]=parseInt(t[i].length==1?t[i]+t[i]:t[i],16);return t};e.prototype.lighten=function(e){this.rgb=this.rgb.lighten(e);return this};e.prototype.darken=function(e){this.rgb=this.rgb.darken(e);return this};e.prototype.toBABYLON_Color4=function(){return new BABYLON.Color4(this.rgb.r/255,this.rgb.g/255,this.rgb.b/255,this.rgb.alpha)};e.prototype.toBABYLON_Color3=function(){return new BABYLON.Color3(this.rgb.r/255,this.rgb.g/255,this.rgb.b/255)};e.prototype.toString=function(){return this.rgb.toString()};e.prototype.intToColorName=function(t){var i=226-78;var r=0;for(var s in e.names){if(e.names.hasOwnProperty(s)){if(r==t*763%i){return e.names[s]}r++}}};e.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};return e}();e.Color=t;var i=function(){function e(e,t,i,r){if(r===void 0){r=1}this.h=e;this.s=t;this.v=i;this.alpha=r}e.HSV_01_toRGB_01=function(e,t,i){var r,s,a,n,o,h,l,u;n=Math.floor(e*6);o=e*6-n;h=i*(1-t);l=i*(1-o*t);u=i*(1-(1-o)*t);switch(n%6){case 0:r=i;s=u;a=h;break;case 1:r=l;s=i;a=h;break;case 2:r=h;s=i;a=u;break;case 3:r=h;s=l;a=i;break;case 4:r=u;s=h;a=i;break;case 5:r=i;s=h;a=l;break}return{r:r,g:s,b:a}};e.prototype.toRGB=function(){var t=e.HSV_01_toRGB_01(this.h,this.s,this.v);return new r(t.r*255,t.g*255,t.b*255,1)};return e}();e.HSV_01=i;var r=function(){function e(e,t,i,r){if(r===void 0){r=1}this.r=0;this.g=0;this.b=0;this.alpha=1;this.setRed(e).setGreen(t).setBlue(i).setAlpha(r)}e.prototype.getHexPart=function(e){var t=e.toString(16);return t.length>1?t:"0"+t};e.prototype.setRed=function(e){this.r=e>255?255:e<0?0:Math.floor(e);return this};e.prototype.setGreen=function(e){this.g=e>255?255:e<0?0:Math.floor(e);return this};e.prototype.setBlue=function(e){this.b=e>255?255:e<0?0:Math.floor(e);return this};e.prototype.setAlpha=function(e){this.alpha=e<=1&&e>=0?e:1;return this};e.prototype.lighten=function(e){this.setRed(this.r+e).setBlue(this.g+e).setGreen(this.b+e);return this};e.prototype.darken=function(e){this.setRed(this.r-e).setBlue(this.g-e).setGreen(this.b-e);return this};e.prototype.toString=function(){return this.alpha<1?"rgba("+this.r+","+this.g+","+this.b+","+this.alpha+")":"rgb("+this.r+","+this.g+","+this.b+")"};return e}();e.RGB_range255=r;var s;(function(e){var i;(function(e){e.defaultSurfaceColor=new t(new r(255,50,50));e.defaultVertexColor=new t(new r(255,50,50));e.defaultLinkColor=new t(new r(124,252,0))})(i=e.thema||(e.thema={}))})(s=e.color||(e.color={}));function a(e,t,i,r){if(r===void 0){r=true}var s,a,n,o,h,l,u,c;o=Math.floor(e*6);h=e*6-o;l=i*(1-t);u=i*(1-h*t);c=i*(1-(1-h)*t);switch(o%6){case 0:s=i;a=c;n=l;break;case 1:s=u;a=i;n=l;break;case 2:s=l;a=i;n=c;break;case 3:s=l;a=u;n=i;break;case 4:s=c;a=l;n=i;break;case 5:s=i;a=l;n=u;break}if(r){s=Math.floor(s*255);a=Math.floor(a*255);n=Math.floor(n*255);return"rgb("+s+","+a+","+n+")"}else return{r:s,g:a,b:n}}e.HSVtoRGB=a;function n(e,t){if(t===void 0){t=false}var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);var r=t?1:255;return i?{r:parseInt(i[1],16)/r,g:parseInt(i[2],16)/r,b:parseInt(i[3],16)/r}:null}e.hexToRgb=n;function o(e){var t=e.toString(16);return t.length==1?"0"+t:t}function h(e,t,i){return"#"+o(e)+o(t)+o(i)}e.rgbToHex=h})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){(function(e){e[e["triangulatedTriangle"]=0]="triangulatedTriangle";e[e["triangulatedRect"]=1]="triangulatedRect";e[e["square"]=2]="square";e[e["polygon3"]=3]="polygon3";e[e["polygon4"]=4]="polygon4";e[e["polygon5"]=5]="polygon5";e[e["polygon6"]=6]="polygon6";e[e["polygon7"]=7]="polygon7";e[e["polygon8"]=8]="polygon8";e[e["polygon9"]=9]="polygon9";e[e["polygon10"]=10]="polygon10";e[e["polygon11"]=11]="polygon11";e[e["polygon12"]=12]="polygon12"})(t.PartShape||(t.PartShape={}));var i=t.PartShape;var r=function(){function t(t,r){this.SUB_gratAndStick=new e.grateAndGlue.ConcurrentMameshesGraterAndSticker;this.SUB_oppositeLinkAssocierByAngles=new e.linkModule.OppositeLinkAssocierByAngles(null);this.SUB_mameshCleaner=new e.mameshModification.MameshCleaner(null);this.origine=new e.XYZ(0,0,0);this.end=new e.XYZ(1,1,0);this.rotation=.001;this.shapes=[i.square];this.proportions=[new e.UV(1,1),new e.UV(1,1)];this.individualScales=[new e.UV(1,1)];this.individualRotations=[0];this.individualTranslation=[new e.XYZ(0,0,0),new e.XYZ(0,0,0)];this.nbPatches=2;this.toleranceToBeOneOfTheClosest=.55;this.stratesToSuppressFromCorners=[0];this.scalingBeforeOppositeLinkAssociations=null;this.exponentOfRoundingFunction=[1];this.percolationProba=[0];this.forceToGrate=[.1];this.nbI=t;this.nbJ=r}t.prototype.go=function(){var t=[];var r=function(r){var a=r%s.shapes.length;var n=s.shapes[a];var o=i[n];var h=Math.round(s.nbI*s.proportions[r%s.proportions.length].u);var l=Math.round(s.nbJ*s.proportions[r%s.proportions.length].v);var u=.5*s.individualScales[r%s.individualScales.length].u*s.proportions[r%s.proportions.length].u;var c=.5*s.individualScales[r%s.individualScales.length].v*s.proportions[r%s.proportions.length].v;var m=void 0;if(o.indexOf("polygon")!=-1){var d=parseInt(o.slice(7,o.length));var f=new e.reseau.TriangulatedPolygone(d);f.origin=new e.XYZ(-u,-c,0);f.end=new e.XYZ(u,c,0);f.nbSubdivisionInARadius=Math.floor((h+l)/4);m=f.go()}else if(n==i.square||n==i.triangulatedRect){var p=new e.reseau.BasisForRegularReseau;p.origin=new e.XYZ(-u,-c,0);p.end=new e.XYZ(u,c,0);p.nbI=h;p.nbJ=l;if(n==i.triangulatedRect)p.squareMailleInsteadOfTriangle=false;p.go();var v=new e.reseau.Regular(p);if(n==i.triangulatedRect)v.oneMoreVertexForOddLine=true;m=v.go()}else if(n==i.triangulatedTriangle){var g=new e.reseau.TriangulatedTriangle;g.origin=new e.XYZ(-u,-c,0);g.end=new e.XYZ(u,c,0);g.nbSubdivisionInSide=(h+l)/2;m=g.go()}if(s.propBeginToRound||s.propEndToRound||s.integerBeginToRound||s.integerEndToRound){var w=new e.spacialTransformations.RoundSomeStrates(m);if(s.propBeginToRound==null)w.propBeginToRound=0;else w.propBeginToRound=s.propBeginToRound[r%s.propBeginToRound.length];if(s.propEndToRound==null)w.propEndToRound=1;else w.propEndToRound=s.propEndToRound[r%s.propEndToRound.length];if(s.integerBeginToRound!=null)w.integerBeginToRound=s.integerBeginToRound[r%s.integerBeginToRound.length];if(s.integerEndToRound!=null)w.integerEndToRound=s.integerEndToRound[r%s.integerEndToRound.length];w.exponentOfRoundingFunction=s.exponentOfRoundingFunction[r%s.exponentOfRoundingFunction.length];w.referenceRadiusIsMinVersusMaxVersusMean=2;w.preventStratesCrossings=true;w.goChanging()}var y=s.percolationProba[r*s.percolationProba.length];if(y>0){var b=new e.mameshModification.PercolationOnLinks(m);b.percolationProba=y;b.goChanging()}if(s.stratesToSuppressFromCorners[r%s.stratesToSuppressFromCorners.length]>0){var T=new e.grateAndGlue.ExtractCentralPart(m,s.stratesToSuppressFromCorners[r%s.stratesToSuppressFromCorners.length]);T.suppressFromBorderVersusCorner=false;m=T.go();m.isolateMameshVerticesFromExteriorVertices()}t.push(m);var M=s.individualTranslation[r%s.individualTranslation.length];var C=s.individualRotations[r%s.individualRotations.length];var S=new e.MM;e.geo.axisAngleToMatrix(new e.XYZ(0,0,-1),C,S);m.vertices.forEach(function(t){e.geo.multiplicationMatrixVector(S,t.position,t.position);t.position.add(M)})};var s=this;for(var a=0;a<this.nbPatches;a++){r(a)}var n;if(this.nbPatches>1){this.SUB_gratAndStick.IN_mameshes=t;this.SUB_gratAndStick.toleranceToBeOneOfTheClosest=this.toleranceToBeOneOfTheClosest;this.SUB_gratAndStick.SUB_grater.proportionOfSeeds=this.forceToGrate;n=this.SUB_gratAndStick.goChanging()}else{n=t[0];e.spacialTransformations.adjustInASquare(n,new e.XYZ(0,0,0),new e.XYZ(1,1,0));n.clearOppositeInLinks()}if(this.scalingBeforeOppositeLinkAssociations!=null)e.spacialTransformations.adjustInASquare(n,new e.XYZ(0,0,0),new e.XYZ(this.scalingBeforeOppositeLinkAssociations.x,this.scalingBeforeOppositeLinkAssociations.y,0));this.SUB_oppositeLinkAssocierByAngles.vertices=n.vertices;this.SUB_oppositeLinkAssocierByAngles.goChanging();this.SUB_mameshCleaner.IN_mamesh=n;this.SUB_mameshCleaner.goChanging();new e.spacialTransformations.Similitude(n.vertices,this.rotation).goChanging();e.spacialTransformations.adjustInASquare(n,this.origine,this.end);return n};return t}();t.Concentric=r;var s=function(t){__extends(i,t);function i(e,i,r,s){t.call(this,e,i);this.nbPatchesI=2;this.nbPatchesJ=2;this.patchesInQuinconce=false;this.oddPatchLinesAreTheSameVersusLongerVersusShorter=0;this.alternateShapeAccordingIPlusJVersusCounter=true;this.nbPatchesI=r;this.nbPatchesJ=s;this.nbPatches=0;this.individualTranslation=[]}i.prototype.go=function(){this.individualTranslation=[];this.nbPatches=0;var i=[];var r=0;for(var s=0;s<this.nbPatchesJ;s++){var a=0;if(s%2==1){if(this.oddPatchLinesAreTheSameVersusLongerVersusShorter==0)a=0;else if(this.oddPatchLinesAreTheSameVersusLongerVersusShorter==1)a=1;else if(this.oddPatchLinesAreTheSameVersusLongerVersusShorter==2)a=-1;else throw"must be 0 or 1 or 2"}for(var n=0;n<this.nbPatchesI+a;n++){this.nbPatches++;var o=0;if(this.patchesInQuinconce&&s%2==1){if(this.oddPatchLinesAreTheSameVersusLongerVersusShorter==0)o=-.5;if(this.oddPatchLinesAreTheSameVersusLongerVersusShorter==1)o=-.5;if(this.oddPatchLinesAreTheSameVersusLongerVersusShorter==2)o=.5}this.individualTranslation.push(new e.XYZ(n+o,s,0));r++;var h=this.alternateShapeAccordingIPlusJVersusCounter?n+a+s:r;i.push(this.shapes[h%this.shapes.length])}}this.shapes=i;return t.prototype.go.call(this)};return i}(r);t.Patchwork=s})(t=e.creation2D||(e.creation2D={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){(function(e){e[e["Tetrahedron"]=0]="Tetrahedron";e[e["Cube"]=1]="Cube";e[e["Octahedron"]=2]="Octahedron";e[e["Dodecahedron"]=3]="Dodecahedron";e[e["Icosahedron"]=4]="Icosahedron";e[e["TruncatedTetrahedron"]=5]="TruncatedTetrahedron";e[e["TruncatedCube"]=6]="TruncatedCube";e[e["TruncatedOctahedron"]=7]="TruncatedOctahedron";e[e["TruncatedDodecahedron"]=8]="TruncatedDodecahedron";e[e["TruncatedIcosahedron"]=9]="TruncatedIcosahedron";e[e["Cuboctahedron"]=10]="Cuboctahedron";e[e["TruncatedCubocahedron"]=11]="TruncatedCubocahedron";e[e["Rhombicubocahedron"]=12]="Rhombicubocahedron";e[e["SnubCuboctahedron"]=13]="SnubCuboctahedron";e[e["Icosidodecahedron"]=14]="Icosidodecahedron";e[e["TruncatedIcosidodecahedron"]=15]="TruncatedIcosidodecahedron";e[e["Rhombicosidodecahedron"]=16]="Rhombicosidodecahedron";e[e["SnubIcosidodecahedron"]=17]="SnubIcosidodecahedron";e[e["Rhombicuboctahedron"]=18]="Rhombicuboctahedron";e[e["TriangulPrism"]=19]="TriangulPrism";e[e["PentagonalPrism"]=20]="PentagonalPrism";e[e["HexagonalPrism"]=21]="HexagonalPrism";e[e["SquarePyramid"]=22]="SquarePyramid";e[e["PentagonalPyramid"]=23]="PentagonalPyramid";e[e["TriangularDipyramid"]=24]="TriangularDipyramid";e[e["PentagonalDipyramid"]=25]="PentagonalDipyramid";e[e["ElongatedSquareDipyramid"]=26]="ElongatedSquareDipyramid";e[e["ElongatedPentagonalDipyramid"]=27]="ElongatedPentagonalDipyramid";e[e["ElongatedPentagonalCupola"]=28]="ElongatedPentagonalCupola"})(t.PolyhedronType||(t.PolyhedronType={}));var i=t.PolyhedronType;var r=function(){function t(t){this.makeLinks=true;this.mamesh=new e.Mamesh;this.type=t}t.prototype.go=function(){var t=[];t[i.Tetrahedron]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]};t[i.Cube]={vertex:[[0,0,0],[1,0,0],[1,1,0],[0,1,0],[0,0,1],[1,0,1],[1,1,1],[0,1,1]],face:[[0,1,2,3],[4,7,6,5],[1,5,6,2],[0,3,7,4],[2,6,7,3],[0,4,5,1]],notYetCentered:true};t[i.Octahedron]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]};t[i.Dodecahedron]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]};t[i.Icosahedron]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]};t[i.TruncatedTetrahedron]={vertex:[[0,0,1.105542],[.8528029,0,.7035265],[-.7106691,.4714045,.7035265],[.3316456,-.7856742,.7035265],[.9949367,.4714045,-.1005038],[-1.089693,.1571348,-.1005038],[-.5685352,.942809,-.1005038],[-.04737794,-1.099944,-.1005038],[.6159132,.1571348,-.904534],[.2842676,.942809,-.5025189],[-.758047,-.6285394,-.5025189],[.09475587,-.6285394,-.904534]],face:[[0,3,1],[2,6,5],[4,8,9],[7,10,11],[0,1,4,9,6,2],[0,2,5,10,7,3],[1,3,7,11,8,4],[5,6,9,8,11,10]]};t[i.TruncatedCube]={vertex:[[0,0,1.042011],[.5621693,0,.8773552],[-.4798415,.2928932,.8773552],[.2569714,-.5,.8773552],[.8773552,.2928932,.4798415],[-.9014684,.2071068,.4798415],[-.5962706,.7071068,.4798415],[.1405423,-.9142136,.4798415],[1.017898,.2071068,-.08232778],[.7609261,.7071068,.08232778],[-1.017898,-.2071068,.08232778],[-.2810846,1,.08232778],[-.2810846,-1,.08232778],[.2810846,-1,-.08232778],[.9014684,-.2071068,-.4798415],[.2810846,1,-.08232778],[-.7609261,-.7071068,-.08232778],[-.8773552,-.2928932,-.4798415],[-.1405423,.9142136,-.4798415],[.5962706,-.7071068,-.4798415],[.4798415,-.2928932,-.8773552],[-.5621693,0,-.8773552],[-.2569714,.5,-.8773552],[0,0,-1.042011]],face:[[0,3,1],[2,6,5],[4,8,9],[7,12,13],[10,17,16],[11,15,18],[14,19,20],[21,22,23],[0,1,4,9,15,11,6,2],[0,2,5,10,16,12,7,3],[1,3,7,13,19,14,8,4],[5,6,11,18,22,21,17,10],[8,14,20,23,22,18,15,9],[12,16,17,21,23,20,19,13]]};t[i.TruncatedOctahedron]={vertex:[[0,0,1.054093],[.6324555,0,.843274],[-.421637,.4714045,.843274],[-.07027284,-.6285394,.843274],[.843274,.4714045,.421637],[.5621827,-.6285394,.6324555],[-.9135469,.3142697,.421637],[-.2108185,.942809,.421637],[-.5621827,-.7856742,.421637],[.9838197,.3142697,-.2108185],[.421637,.942809,.2108185],[.7027284,-.7856742,0],[-.7027284,.7856742,0],[-.9838197,-.3142697,.2108185],[-.421637,-.942809,-.2108185],[.5621827,.7856742,-.421637],[.9135469,-.3142697,-.421637],[.2108185,-.942809,-.421637],[-.5621827,.6285394,-.6324555],[-.843274,-.4714045,-.421637],[.07027284,.6285394,-.843274],[.421637,-.4714045,-.843274],[-.6324555,0,-.843274],[0,0,-1.054093]],face:[[0,3,5,1],[2,7,12,6],[4,9,15,10],[8,13,19,14],[11,17,21,16],[18,20,23,22],[0,1,4,10,7,2],[0,2,6,13,8,3],[1,5,11,16,9,4],[3,8,14,17,11,5],[6,12,18,22,19,13],[7,10,15,20,18,12],[9,16,21,23,20,15],[14,19,22,23,21,17]]};t[i.TruncatedDodecahedron]={vertex:[[0,0,1.014485],[.3367628,0,.9569589],[-.2902233,.1708204,.9569589],[.1634681,-.2944272,.9569589],[.5914332,.1708204,.806354],[-.5963465,.1527864,.806354],[-.4230517,.4472136,.806354],[.1377417,-.6,.806354],[.8302037,.1527864,.5626702],[.6667356,.4472136,.6201961],[-.8014407,-.0472136,.6201961],[-.3477493,.7236068,.6201961],[-.06735256,-.8,.6201961],[.2694102,-.8,.5626702],[.9618722,-.0472136,.3189863],[.5339072,.7236068,.4695912],[-.8271671,-.3527864,.4695912],[-.9599955,-.0763932,.3189863],[-.3992021,.8763932,.3189863],[-.09307895,.8944272,.4695912],[-.3734757,-.818034,.4695912],[.5081808,-.818034,.3189863],[.9361459,-.3527864,.1683814],[1.011448,-.0763932,-.0177765],[.4824544,.8763932,.1683814],[.2436839,.8944272,.4120653],[-.663699,-.6472136,.4120653],[-1.011448,.0763932,.0177765],[-.5577569,.8472136,.0177765],[-.5320305,-.8472136,.1683814],[.5577569,-.8472136,-.0177765],[.7628511,-.6472136,.1683814],[.9599955,.0763932,-.3189863],[.5320305,.8472136,-.1683814],[-.9618722,.0472136,-.3189863],[-.9361459,.3527864,-.1683814],[-.7628511,.6472136,-.1683814],[-.5081808,.818034,-.3189863],[-.4824544,-.8763932,-.1683814],[.3992021,-.8763932,-.3189863],[.8014407,.0472136,-.6201961],[.8271671,.3527864,-.4695912],[.663699,.6472136,-.4120653],[.3734757,.818034,-.4695912],[-.8302037,-.1527864,-.5626702],[-.2694102,.8,-.5626702],[-.5339072,-.7236068,-.4695912],[-.2436839,-.8944272,-.4120653],[.09307895,-.8944272,-.4695912],[.3477493,-.7236068,-.6201961],[.5963465,-.1527864,-.806354],[.06735256,.8,-.6201961],[-.6667356,-.4472136,-.6201961],[-.5914332,-.1708204,-.806354],[-.1377417,.6,-.806354],[.4230517,-.4472136,-.806354],[.2902233,-.1708204,-.9569589],[-.3367628,0,-.9569589],[-.1634681,.2944272,-.9569589],[0,0,-1.014485]],face:[[0,3,1],[2,6,5],[4,8,9],[7,12,13],[10,17,16],[11,19,18],[14,22,23],[15,24,25],[20,26,29],[21,30,31],[27,35,34],[28,37,36],[32,40,41],[33,42,43],[38,46,47],[39,48,49],[44,53,52],[45,51,54],[50,55,56],[57,58,59],[0,1,4,9,15,25,19,11,6,2],[0,2,5,10,16,26,20,12,7,3],[1,3,7,13,21,31,22,14,8,4],[5,6,11,18,28,36,35,27,17,10],[8,14,23,32,41,42,33,24,15,9],[12,20,29,38,47,48,39,30,21,13],[16,17,27,34,44,52,46,38,29,26],[18,19,25,24,33,43,51,45,37,28],[22,31,30,39,49,55,50,40,32,23],[34,35,36,37,45,54,58,57,53,44],[40,50,56,59,58,54,51,43,42,41],[46,52,53,57,59,56,55,49,48,47]]};t[i.TruncatedIcosahedron]={vertex:[[0,0,1.021],[.4035482,0,.9378643],[-.2274644,.3333333,.9378643],[-.1471226,-.375774,.9378643],[.579632,.3333333,.7715933],[.5058321,-.375774,.8033483],[-.6020514,.2908927,.7715933],[-.05138057,.6666667,.7715933],[.1654988,-.6080151,.8033483],[-.5217096,-.4182147,.7715933],[.8579998,.2908927,.4708062],[.3521676,.6666667,.6884578],[.7841999,-.4182147,.5025612],[-.657475,.5979962,.5025612],[-.749174,-.08488134,.6884578],[-.3171418,.8302373,.5025612],[.1035333,-.8826969,.5025612],[-.5836751,-.6928964,.4708062],[.8025761,.5979962,.2017741],[.9602837,-.08488134,.3362902],[.4899547,.8302373,.3362902],[.7222343,-.6928964,.2017741],[-.8600213,.5293258,.1503935],[-.9517203,-.1535518,.3362902],[-.1793548,.993808,.1503935],[.381901,-.9251375,.2017741],[-.2710537,-.9251375,.3362902],[-.8494363,-.5293258,.2017741],[.8494363,.5293258,-.2017741],[1.007144,-.1535518,-.06725804],[.2241935,.993808,.06725804],[.8600213,-.5293258,-.1503935],[-.7222343,.6928964,-.2017741],[-1.007144,.1535518,.06725804],[-.381901,.9251375,-.2017741],[.1793548,-.993808,-.1503935],[-.2241935,-.993808,-.06725804],[-.8025761,-.5979962,-.2017741],[.5836751,.6928964,-.4708062],[.9517203,.1535518,-.3362902],[.2710537,.9251375,-.3362902],[.657475,-.5979962,-.5025612],[-.7841999,.4182147,-.5025612],[-.9602837,.08488134,-.3362902],[-.1035333,.8826969,-.5025612],[.3171418,-.8302373,-.5025612],[-.4899547,-.8302373,-.3362902],[-.8579998,-.2908927,-.4708062],[.5217096,.4182147,-.7715933],[.749174,.08488134,-.6884578],[.6020514,-.2908927,-.7715933],[-.5058321,.375774,-.8033483],[-.1654988,.6080151,-.8033483],[.05138057,-.6666667,-.7715933],[-.3521676,-.6666667,-.6884578],[-.579632,-.3333333,-.7715933],[.1471226,.375774,-.9378643],[.2274644,-.3333333,-.9378643],[-.4035482,0,-.9378643],[0,0,-1.021]],face:[[0,3,8,5,1],[2,7,15,13,6],[4,10,18,20,11],[9,14,23,27,17],[12,21,31,29,19],[16,26,36,35,25],[22,32,42,43,33],[24,30,40,44,34],[28,39,49,48,38],[37,47,55,54,46],[41,45,53,57,50],[51,52,56,59,58],[0,1,4,11,7,2],[0,2,6,14,9,3],[1,5,12,19,10,4],[3,9,17,26,16,8],[5,8,16,25,21,12],[6,13,22,33,23,14],[7,11,20,30,24,15],[10,19,29,39,28,18],[13,15,24,34,32,22],[17,27,37,46,36,26],[18,28,38,40,30,20],[21,25,35,45,41,31],[23,33,43,47,37,27],[29,31,41,50,49,39],[32,34,44,52,51,42],[35,36,46,54,53,45],[38,48,56,52,44,40],[42,51,58,55,47,43],[48,49,50,57,59,56],[53,54,55,58,59,57]]};t[i.Cuboctahedron]={vertex:[[0,0,1.154701],[1,0,.5773503],[.3333333,.942809,.5773503],[-1,0,.5773503],[-.3333333,-.942809,.5773503],[1,0,-.5773503],[.6666667,-.942809,0],[-.6666667,.942809,0],[.3333333,.942809,-.5773503],[-1,0,-.5773503],[-.3333333,-.942809,-.5773503],[0,0,-1.154701]],face:[[0,1,2],[0,3,4],[1,6,5],[2,8,7],[3,7,9],[4,10,6],[5,11,8],[9,11,10],[0,2,7,3],[0,4,6,1],[1,5,8,2],[3,9,10,4],[5,6,10,11],[7,8,11,9]]};t[i.TruncatedCubocahedron]={vertex:[[0,0,1.024117],[.4314788,0,.928785],[-.02106287,.4309644,.928785],[-.3410582,-.2642977,.928785],[.4104159,.4309644,.833453],[.7006238,-.2642977,.6986333],[-.3831839,.5976311,.7381211],[-.3919084,-.6380712,.6986333],[-.7031792,-.09763107,.7381211],[.6584981,.5976311,.5079694],[.6497736,-.6380712,.4684816],[.948706,-.09763107,.3731496],[-.4638216,.8333333,.3731496],[-.7242421,.3333333,.6427891],[-.7540295,-.4714045,.5079694],[-.1227634,-.9023689,.4684816],[.5778604,.8333333,.1429979],[.9276431,.3333333,.2778177],[.8978557,-.4714045,.1429979],[.3087154,-.9023689,.3731496],[-.8048797,.5690356,.2778177],[-.2157394,1,.04766598],[-.8470055,-.5690356,.08715377],[-.2157394,-1,.04766598],[.8470055,.5690356,-.08715377],[.2157394,1,-.04766598],[.8048797,-.5690356,-.2778177],[.2157394,-1,-.04766598],[-.8978557,.4714045,-.1429979],[-.3087154,.9023689,-.3731496],[-.9276431,-.3333333,-.2778177],[-.5778604,-.8333333,-.1429979],[.7540295,.4714045,-.5079694],[.1227634,.9023689,-.4684816],[.7242421,-.3333333,-.6427891],[.4638216,-.8333333,-.3731496],[-.948706,.09763107,-.3731496],[-.6497736,.6380712,-.4684816],[-.6584981,-.5976311,-.5079694],[.7031792,.09763107,-.7381211],[.3919084,.6380712,-.6986333],[.3831839,-.5976311,-.7381211],[-.7006238,.2642977,-.6986333],[-.4104159,-.4309644,-.833453],[.3410582,.2642977,-.928785],[.02106287,-.4309644,-.928785],[-.4314788,0,-.928785],[0,0,-1.024117]],face:[[0,1,4,2],[3,8,14,7],[5,10,18,11],[6,12,20,13],[9,17,24,16],[15,23,27,19],[21,25,33,29],[22,30,38,31],[26,35,41,34],[28,37,42,36],[32,39,44,40],[43,46,47,45],[0,2,6,13,8,3],[1,5,11,17,9,4],[7,14,22,31,23,15],[10,19,27,35,26,18],[12,21,29,37,28,20],[16,24,32,40,33,25],[30,36,42,46,43,38],[34,41,45,47,44,39],[0,3,7,15,19,10,5,1],[2,4,9,16,25,21,12,6],[8,13,20,28,36,30,22,14],[11,18,26,34,39,32,24,17],[23,31,38,43,45,41,35,27],[29,33,40,44,47,46,42,37]]};t[i.Rhombicubocahedron]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]};t[i.SnubCuboctahedron]={vertex:[[0,0,1.077364],[.7442063,0,.7790187],[.3123013,.6755079,.7790187],[-.482096,.5669449,.7790187],[-.7169181,-.1996786,.7790187],[-.1196038,-.7345325,.7790187],[.6246025,-.7345325,.4806734],[1.056508,-.1996786,.06806912],[.8867128,.5669449,.2302762],[.2621103,1.042774,.06806912],[-.532287,.9342111,.06806912],[-1.006317,.3082417,.2302762],[-.7020817,-.784071,.2302762],[.02728827,-1.074865,.06806912],[.6667271,-.784071,-.3184664],[.8216855,-.09111555,-.6908285],[.6518908,.6755079,-.5286215],[-.1196038,.8751866,-.6168117],[-.8092336,.4758293,-.5286215],[-.9914803,-.2761507,-.3184664],[-.4467414,-.825648,-.5286215],[.1926974,-.5348539,-.915157],[.1846311,.2587032,-1.029416],[-.5049987,-.1406541,-.9412258]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[1,6,7],[1,7,8],[1,8,2],[2,8,9],[3,10,11],[3,11,4],[4,12,5],[5,12,13],[5,13,6],[6,13,14],[6,14,7],[7,14,15],[8,16,9],[9,16,17],[9,17,10],[10,17,18],[10,18,11],[11,18,19],[12,19,20],[12,20,13],[14,21,15],[15,21,22],[15,22,16],[16,22,17],[18,23,19],[19,23,20],[20,23,21],[21,23,22],[0,5,6,1],[2,9,10,3],[4,11,19,12],[7,15,16,8],[13,20,21,14],[17,22,23,18]]};t[i.Icosidodecahedron]={vertex:[[0,0,1.051462],[.618034,0,.8506508],[.2763932,.5527864,.8506508],[-.618034,0,.8506508],[-.2763932,-.5527864,.8506508],[1,0,.3249197],[.7236068,-.5527864,.5257311],[-.1708204,.8944272,.5257311],[.4472136,.8944272,.3249197],[-1,0,.3249197],[-.7236068,.5527864,.5257311],[.1708204,-.8944272,.5257311],[-.4472136,-.8944272,.3249197],[1,0,-.3249197],[.8944272,.5527864,0],[.5527864,-.8944272,0],[-.5527864,.8944272,0],[.4472136,.8944272,-.3249197],[-1,0,-.3249197],[-.8944272,-.5527864,0],[-.4472136,-.8944272,-.3249197],[.618034,0,-.8506508],[.7236068,-.5527864,-.5257311],[.1708204,-.8944272,-.5257311],[-.7236068,.5527864,-.5257311],[-.1708204,.8944272,-.5257311],[.2763932,.5527864,-.8506508],[-.618034,0,-.8506508],[-.2763932,-.5527864,-.8506508],[0,0,-1.051462]],face:[[0,1,2],[0,3,4],[1,6,5],[2,8,7],[3,10,9],[4,12,11],[5,13,14],[6,11,15],[7,16,10],[8,14,17],[9,18,19],[12,19,20],[13,22,21],[15,23,22],[16,25,24],[17,26,25],[18,24,27],[20,28,23],[21,29,26],[27,29,28],[0,2,7,10,3],[0,4,11,6,1],[1,5,14,8,2],[3,9,19,12,4],[5,6,15,22,13],[7,8,17,25,16],[9,10,16,24,18],[11,12,20,23,15],[13,21,26,17,14],[18,27,28,20,19],[21,22,23,28,29],[24,25,26,29,27]]};t[i.TruncatedIcosidodecahedron]={vertex:[[0,0,1.008759],[.2629922,0,.973874],[-.00462747,.2629515,.973874],[-.2211363,-.1423503,.973874],[.2583647,.2629515,.9389886],[.4673861,-.1423503,.8825429],[-.2303913,.3835526,.9041033],[-.3159502,-.372678,.8825429],[-.4469001,-.02174919,.9041033],[.4581312,.3835526,.8127722],[.5351104,-.372678,.7696515],[.6671526,-.02174919,.7563265],[-.3326926,.5786893,.7563265],[-.4515276,.2412023,.8692179],[-.541714,-.2520769,.8127722],[-.248226,-.6030057,.7696515],[.518368,.5786893,.6434351],[.6625252,.2412023,.7214412],[.7348768,-.2520769,.6434351],[.4402965,-.6030057,.6783205],[-.5538289,.436339,.7214412],[-.2724557,.7738261,.5869894],[-.6997536,-.3618034,.6301101],[-.04383203,-.745356,.6783205],[-.4062656,-.7127322,.5869894],[.722762,.436339,.552104],[.4160667,.7738261,.4956583],[.8398294,-.3618034,.4258876],[.2191601,-.745356,.6434351],[.5452491,-.7127322,.460773],[-.7147284,.4891254,.5172187],[-.07268925,.8944272,.460773],[-.4333553,.8266125,.3827669],[-.8606531,-.309017,.4258876],[-.6320294,-.5921311,.5172187],[-.2018716,-.8550825,.4956583],[.8248546,.4891254,.3129962],[.1903029,.8944272,.4258876],[.5181594,.8266125,.2565505],[.9419221,-.309017,.1867798],[.7450156,-.5921311,.3345566],[.3241127,-.8550825,.4258876],[-.8727679,.3793989,.3345566],[-.6544916,.6842621,.3478816],[-.2335888,.9472136,.2565505],[-.7929289,-.5393447,.3129962],[-.9629544,-.1138803,.2781109],[-.096919,-.9648091,.2781109],[.9298072,.3793989,.09544872],[.7225533,.6842621,.1652194],[.2923956,.9472136,.1867798],[.8471082,-.5393447,.09544872],[1.002159,-.1138803,.01744268],[.1660732,-.9648091,.2432255],[-.8125311,.5745356,.1652194],[-.9675818,.1490712,.2432255],[-.1314961,1,.01744268],[-.8275059,-.5745356,.05232804],[-.9975315,-.1490712,.01744268],[-.1314961,-1,.01744268],[.8275059,.5745356,-.05232804],[.9975315,.1490712,-.01744268],[.1314961,1,-.01744268],[.8125311,-.5745356,-.1652194],[.9675818,-.1490712,-.2432255],[.1314961,-1,-.01744268],[-.8471082,.5393447,-.09544872],[-1.002159,.1138803,-.01744268],[-.1660732,.9648091,-.2432255],[-.7225533,-.6842621,-.1652194],[-.9298072,-.3793989,-.09544872],[-.2923956,-.9472136,-.1867798],[.7929289,.5393447,-.3129962],[.9629544,.1138803,-.2781109],[.096919,.9648091,-.2781109],[.6544916,-.6842621,-.3478816],[.8727679,-.3793989,-.3345566],[.2335888,-.9472136,-.2565505],[-.7450156,.5921311,-.3345566],[-.9419221,.309017,-.1867798],[-.3241127,.8550825,-.4258876],[-.8248546,-.4891254,-.3129962],[-.5181594,-.8266125,-.2565505],[-.1903029,-.8944272,-.4258876],[.6320294,.5921311,-.5172187],[.8606531,.309017,-.4258876],[.2018716,.8550825,-.4956583],[.7147284,-.4891254,-.5172187],[.4333553,-.8266125,-.3827669],[.07268925,-.8944272,-.460773],[-.8398294,.3618034,-.4258876],[-.5452491,.7127322,-.460773],[-.2191601,.745356,-.6434351],[-.722762,-.436339,-.552104],[-.4160667,-.7738261,-.4956583],[.6997536,.3618034,-.6301101],[.4062656,.7127322,-.5869894],[.04383203,.745356,-.6783205],[.5538289,-.436339,-.7214412],[.2724557,-.7738261,-.5869894],[-.7348768,.2520769,-.6434351],[-.4402965,.6030057,-.6783205],[-.6625252,-.2412023,-.7214412],[-.518368,-.5786893,-.6434351],[.541714,.2520769,-.8127722],[.248226,.6030057,-.7696515],[.4515276,-.2412023,-.8692179],[.3326926,-.5786893,-.7563265],[-.6671526,.02174919,-.7563265],[-.5351104,.372678,-.7696515],[-.4581312,-.3835526,-.8127722],[.4469001,.02174919,-.9041033],[.3159502,.372678,-.8825429],[.2303913,-.3835526,-.9041033],[-.4673861,.1423503,-.8825429],[-.2583647,-.2629515,-.9389886],[.2211363,.1423503,-.973874],[.00462747,-.2629515,-.973874],[-.2629922,0,-.973874],[0,0,-1.008759]],face:[[0,1,4,2],[3,8,14,7],[5,10,18,11],[6,12,20,13],[9,17,25,16],[15,24,35,23],[19,28,41,29],[21,31,44,32],[22,33,45,34],[26,38,50,37],[27,40,51,39],[30,43,54,42],[36,48,60,49],[46,55,67,58],[47,59,65,53],[52,64,73,61],[56,62,74,68],[57,70,81,69],[63,75,87,76],[66,78,90,79],[71,82,94,83],[72,85,95,84],[77,89,99,88],[80,92,101,91],[86,96,105,97],[93,102,110,103],[98,107,113,106],[100,109,114,108],[104,111,116,112],[115,118,119,117],[0,2,6,13,8,3],[1,5,11,17,9,4],[7,14,22,34,24,15],[10,19,29,40,27,18],[12,21,32,43,30,20],[16,25,36,49,38,26],[23,35,47,53,41,28],[31,37,50,62,56,44],[33,46,58,70,57,45],[39,51,63,76,64,52],[42,54,66,79,67,55],[48,61,73,85,72,60],[59,71,83,89,77,65],[68,74,86,97,92,80],[69,81,93,103,94,82],[75,88,99,107,98,87],[78,91,101,109,100,90],[84,95,104,112,105,96],[102,108,114,118,115,110],[106,113,117,119,116,111],[0,3,7,15,23,28,19,10,5,1],[2,4,9,16,26,37,31,21,12,6],[8,13,20,30,42,55,46,33,22,14],[11,18,27,39,52,61,48,36,25,17],[24,34,45,57,69,82,71,59,47,35],[29,41,53,65,77,88,75,63,51,40],[32,44,56,68,80,91,78,66,54,43],[38,49,60,72,84,96,86,74,62,50],[58,67,79,90,100,108,102,93,81,70],[64,76,87,98,106,111,104,95,85,73],[83,94,103,110,115,117,113,107,99,89],[92,97,105,112,116,119,118,114,109,101]]};t[i.Rhombicosidodecahedron]={vertex:[[0,0,1.026054],[.447838,0,.9231617],[-.02363976,.4472136,.9231617],[-.4050732,.190983,.9231617],[-.1693344,-.4145898,.9231617],[.4241982,.4472136,.8202696],[.7673818,.190983,.6537868],[.5552827,-.4145898,.7566788],[-.2312241,.7562306,.6537868],[-.5744076,-.2236068,.8202696],[-.6126576,.5,.6537868],[.1738492,-.6708204,.7566788],[-.4669629,-.6381966,.6537868],[.493393,.7562306,.4873039],[.8748265,-.2236068,.4873039],[.8365765,.5,.320821],[.7054921,-.6381966,.3844118],[.08831973,.9472136,.3844118],[-.5434628,.809017,.320821],[-.8866463,-.1708204,.4873039],[-.9102861,.2763932,.3844118],[-.1237794,-.8944272,.4873039],[.3240586,-.8944272,.3844118],[-.7792016,-.5854102,.320821],[.6289922,.809017,.05144604],[1.010426,-.1708204,.05144604],[.9867859,.2763932,-.05144604],[.8410913,-.5854102,-.05144604],[-.223919,1,.05144604],[.223919,1,-.05144604],[-.8410913,.5854102,.05144604],[-.9867859,-.2763932,.05144604],[-1.010426,.1708204,-.05144604],[-.223919,-1,.05144604],[.223919,-1,-.05144604],[-.6289922,-.809017,-.05144604],[.7792016,.5854102,-.320821],[.9102861,-.2763932,-.3844118],[.8866463,.1708204,-.4873039],[.5434628,-.809017,-.320821],[-.3240586,.8944272,-.3844118],[.1237794,.8944272,-.4873039],[-.7054921,.6381966,-.3844118],[-.8365765,-.5,-.320821],[-.8748265,.2236068,-.4873039],[-.08831973,-.9472136,-.3844118],[-.493393,-.7562306,-.4873039],[.4669629,.6381966,-.6537868],[.6126576,-.5,-.6537868],[.5744076,.2236068,-.8202696],[.2312241,-.7562306,-.6537868],[-.1738492,.6708204,-.7566788],[-.5552827,.4145898,-.7566788],[-.7673818,-.190983,-.6537868],[-.4241982,-.4472136,-.8202696],[.1693344,.4145898,-.9231617],[.4050732,-.190983,-.9231617],[.02363976,-.4472136,-.9231617],[-.447838,0,-.9231617],[0,0,-1.026054]],face:[[0,2,3],[1,6,5],[4,9,12],[7,16,14],[8,18,10],[11,21,22],[13,15,24],[17,29,28],[19,31,23],[20,30,32],[25,27,37],[26,38,36],[33,45,34],[35,43,46],[39,50,48],[40,41,51],[42,52,44],[47,49,55],[53,58,54],[56,57,59],[0,1,5,2],[0,3,9,4],[1,7,14,6],[2,8,10,3],[4,12,21,11],[5,6,15,13],[7,11,22,16],[8,17,28,18],[9,19,23,12],[10,18,30,20],[13,24,29,17],[14,16,27,25],[15,26,36,24],[19,20,32,31],[21,33,34,22],[23,31,43,35],[25,37,38,26],[27,39,48,37],[28,29,41,40],[30,42,44,32],[33,35,46,45],[34,45,50,39],[36,38,49,47],[40,51,52,42],[41,47,55,51],[43,53,54,46],[44,52,58,53],[48,50,57,56],[49,56,59,55],[54,58,59,57],[0,4,11,7,1],[2,5,13,17,8],[3,10,20,19,9],[6,14,25,26,15],[12,23,35,33,21],[16,22,34,39,27],[18,28,40,42,30],[24,36,47,41,29],[31,32,44,53,43],[37,48,56,49,38],[45,46,54,57,50],[51,55,59,58,52]]};t[i.SnubIcosidodecahedron]={vertex:[[0,0,1.028031],[.4638569,0,.9174342],[.2187436,.4090409,.9174342],[-.2575486,.3857874,.9174342],[-.4616509,-.04518499,.9174342],[-.177858,-.4284037,.9174342],[.5726782,-.4284037,.7384841],[.8259401,-.04518499,.6104342],[.6437955,.3857874,.702527],[.349648,.7496433,.6104342],[-.421009,.7120184,.6104342],[-.6783139,.3212396,.702527],[-.6031536,-.4466658,.702527],[-.2749612,-.7801379,.6104342],[.1760766,-.6931717,.7384841],[.5208138,-.7801379,.4206978],[.8552518,-.4466658,.3547998],[1.01294,-.03548596,.1718776],[.7182239,.661842,.3208868],[.3633691,.9454568,.1758496],[-.04574087,.9368937,.4206978],[-.4537394,.905564,.1758496],[-.7792791,.5887312,.3208868],[-.9537217,.1462217,.3547998],[-.9072701,-.3283699,.3547998],[-.6503371,-.7286577,.3208868],[.08459482,-.9611501,.3547998],[.3949153,-.9491262,-.007072558],[.9360473,-.409557,-.1136978],[.9829382,.02692292,-.2999274],[.9463677,.4014808,-.007072558],[.6704578,.7662826,-.1419366],[-.05007646,1.025698,-.04779978],[-.4294337,.8845784,-.2999274],[-.9561681,.3719321,-.06525234],[-1.022036,-.1000338,-.04779978],[-.8659056,-.5502712,-.06525234],[-.5227761,-.8778535,-.1136978],[-.06856319,-1.021542,-.09273844],[.2232046,-.8974878,-.4489366],[.6515438,-.7200947,-.3373472],[.7969535,-.3253959,-.5619888],[.8066872,.4395354,-.461425],[.4468035,.735788,-.5619888],[.001488801,.8961155,-.503809],[-.3535403,.6537658,-.7102452],[-.7399517,.5547758,-.4489366],[-.9120238,.1102196,-.461425],[-.6593998,-.6182798,-.4896639],[-.2490651,-.8608088,-.503809],[.4301047,-.5764987,-.734512],[.5057577,-.1305283,-.8854492],[.5117735,.3422252,-.8232973],[.09739587,.5771941,-.8451093],[-.6018946,.2552591,-.7933564],[-.6879024,-.2100741,-.734512],[-.3340437,-.5171509,-.8232973],[.08570633,-.3414376,-.9658797],[.1277354,.1313635,-1.011571],[-.3044499,-.06760332,-.979586]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[1,6,7],[1,7,8],[1,8,2],[2,8,9],[3,10,11],[3,11,4],[4,12,5],[5,12,13],[5,13,14],[6,14,15],[6,15,16],[6,16,7],[7,16,17],[8,18,9],[9,18,19],[9,19,20],[10,20,21],[10,21,22],[10,22,11],[11,22,23],[12,24,25],[12,25,13],[13,26,14],[14,26,15],[15,26,27],[16,28,17],[17,28,29],[17,29,30],[18,30,31],[18,31,19],[19,32,20],[20,32,21],[21,32,33],[22,34,23],[23,34,35],[23,35,24],[24,35,36],[24,36,25],[25,36,37],[26,38,27],[27,38,39],[27,39,40],[28,40,41],[28,41,29],[29,42,30],[30,42,31],[31,42,43],[32,44,33],[33,44,45],[33,45,46],[34,46,47],[34,47,35],[36,48,37],[37,48,49],[37,49,38],[38,49,39],[39,50,40],[40,50,41],[41,50,51],[42,52,43],[43,52,53],[43,53,44],[44,53,45],[45,54,46],[46,54,47],[47,54,55],[48,55,56],[48,56,49],[50,57,51],[51,57,58],[51,58,52],[52,58,53],[54,59,55],[55,59,56],[56,59,57],[57,59,58],[0,5,14,6,1],[2,9,20,10,3],[4,11,23,24,12],[7,17,30,18,8],[13,25,37,38,26],[15,27,40,28,16],[19,31,43,44,32],[21,33,46,34,22],[29,41,51,52,42],[35,47,55,48,36],[39,49,56,57,50],[45,53,58,59,54]]};t[i.TriangulPrism]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]};t[i.PentagonalPrism]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]};t[i.HexagonalPrism]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]};t[i.SquarePyramid]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]};t[i.PentagonalPyramid]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]};t[i.TriangularDipyramid]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]};t[i.PentagonalDipyramid]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]};t[i.ElongatedSquareDipyramid]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]};t[i.ElongatedPentagonalDipyramid]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]};t[i.ElongatedPentagonalCupola]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var r=t[this.type];for(var s=0,a=r.vertex;s<a.length;s++){var n=a[s];this.mamesh.newVertex(new e.XYZ(n[0],n[1],n[2]))}if(r.notYetCentered){var o=new e.XYZ(0,0,0);var h=null;for(var l=0,u=this.mamesh.vertices;l<u.length;l++){h=u[l];o.add(h.position)}o.scale(1/this.mamesh.vertices.length);for(var c=0,m=this.mamesh.vertices;c<m.length;c++){h=m[c];h.position.substract(o)}}var d=Number.MIN_VALUE;for(var f=0,p=this.mamesh.vertices;f<p.length;f++){var h=p[f];var v=h.position.length();if(v>d)d=v}for(var g=0,w=this.mamesh.vertices;g<w.length;g++){var h=w[g];h.position.scale(1/d)}var y=0;for(var b=0,T=r.face;b<T.length;b++){var M=T[b];if(M.length==3)this.mamesh.addATriangle(this.mamesh.vertices[M[0]],this.mamesh.vertices[M[1]],this.mamesh.vertices[M[2]]);else if(M.length==4)this.mamesh.addASquare(this.mamesh.vertices[M[0]],this.mamesh.vertices[M[1]],this.mamesh.vertices[M[2]],this.mamesh.vertices[M[3]]);else if(M.length>=5){var C=this.mamesh.newVertex(new e.XYZ(0,0,0));C.markers.push(e.Vertex.Markers.polygonCenter);y=1/M.length;var S=[this.mamesh.vertices[M[0]]];var x=[S[0].position];var F=[y];for(var V=1;V<M.length;V++){S.push(this.mamesh.vertices[M[V]]);x.push(S[V].position);F.push(y)}e.geo.baryCenter(x,F,C.position);for(var V=0;V<M.length;V++)this.mamesh.addATriangle(S[V],S[(V+1)%M.length],C)}}if(this.makeLinks){new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(this.mamesh).goChanging()}return this.mamesh};return t}();t.Polyhedron=r;var s=function(){function t(t){this.maxLength=500;this.curentLength=0;this.serpentRadius=.03;this.path=[];this.sliceInsteadOfElongateWhenMaxLengthIsReached=true;this.initialPosition=new e.XYZ(0,0,0);this.mathisFrame=t}t.prototype.go=function(){for(var t=0;t<this.maxLength;t++)this.path.push(this.initialPosition);this.serpentMesh=BABYLON.Mesh.CreateTube("",this.path,this.serpentRadius,10,null,BABYLON.Mesh.CAP_ALL,this.mathisFrame.scene,true);var i=new BABYLON.StandardMaterial("",this.mathisFrame.scene);i.diffuseColor=e.myFavoriteColors.green;this.serpentMesh.material=i;this.headSerpent=BABYLON.Mesh.CreateSphere("",10,this.serpentRadius*2.5,this.mathisFrame.scene);var r=new BABYLON.StandardMaterial("",this.mathisFrame.scene);r.diffuseColor=new BABYLON.Color3(1,0,0);this.headSerpent.material=r;this.headSerpent.position.copyFrom(this.initialPosition)};t.prototype.contractInOnePoint=function(e){for(var t=0;t<this.maxLength;t++)this.path[t]=e;this.curentLength=0;this.updateMeshes()};t.prototype.elongateTo=function(e){if(this.curentLength<this.maxLength){for(var t=this.curentLength;t<this.maxLength;t++)this.path[t]=e;this.curentLength++;this.updateMeshes()}else if(this.sliceInsteadOfElongateWhenMaxLengthIsReached)this.bobySliceTo(e);else throw"snake reaches his maximal length"};t.prototype.bobySliceTo=function(e){this.path.splice(0,1);this.path.push(e);this.updateMeshes()};t.prototype.updateMeshes=function(){this.serpentMesh=BABYLON.Mesh.CreateTube("",this.path,this.serpentRadius,null,null,null,null,true,null,this.serpentMesh);this.headSerpent.position=this.getHeadPosition()};t.prototype.getHeadPosition=function(){return this.path[this.path.length-1]};return t}();t.Snake=s;var a=function(){function t(e){this.totalHeight=1;this.bodyProp=3/4;this.headProp=1/4;this.bodyDiameterProp=.1;this.headDiameterProp=.2;this.headUp=true;this.arrowFootAtOrigin=true;this.quaternion=null;this.subdivision=6;this.scene=e}t.prototype.go=function(){var t=this.bodyProp*this.totalHeight;var i=this.headProp*this.totalHeight;var r=BABYLON.Mesh.CreateCylinder("",t,this.bodyDiameterProp*this.totalHeight,this.bodyDiameterProp*this.totalHeight,this.subdivision,null,this.scene);r.position=new e.XYZ(0,t/2,0);var s=BABYLON.Mesh.CreateCylinder("",i,0,this.headDiameterProp*this.totalHeight,this.subdivision,null,this.scene);s.position=new e.XYZ(0,t+i/2,0);var a=BABYLON.Mesh.MergeMeshes([r,s]);if(!this.arrowFootAtOrigin){a.position.addInPlace(new e.XYZ(0,-this.totalHeight/2,0));a.bakeCurrentTransformIntoVertices()}var n=new e.XYZW(0,0,0,1);if(!this.headUp)e.geo.axisAngleToQuaternion(new e.XYZ(1,0,0),Math.PI,n);if(this.quaternion!=null)n.multiply(this.quaternion);a.rotationQuaternion=n;a.bakeCurrentTransformIntoVertices();if(this.color!=null){var o=new BABYLON.StandardMaterial("",this.scene);o.diffuseColor=this.color.toBABYLON_Color3();a.material=o}return a};return t}();t.ArrowCreator=a;var n=function(){function e(e){this.scene=e;this.twoOrThreeAxis=new o(this.scene)}e.prototype.go=function(){this.twoOrThreeAxis.addColor=false;var e=this.twoOrThreeAxis.go();var t=BABYLON.Mesh.MergeMeshes(e);var i=e[0].getTotalIndices();var r=e[1].getTotalIndices();var s=e[2].getTotalIndices();var a=new BABYLON.StandardMaterial("",this.scene);a.diffuseColor=new BABYLON.Color3(1,0,0);var n=new BABYLON.StandardMaterial("",this.scene);n.diffuseColor=new BABYLON.Color3(0,1,0);var o=new BABYLON.StandardMaterial("",this.scene);o.diffuseColor=new BABYLON.Color3(0,0,1);var h=t.getTotalVertices();t.subMeshes=[];t.subMeshes.push(new BABYLON.SubMesh(0,0,h,0,i,t));t.subMeshes.push(new BABYLON.SubMesh(1,0,h,i,r,t));t.subMeshes.push(new BABYLON.SubMesh(2,0,h,i+r,s,t));var l=new BABYLON.MultiMaterial("multi",this.scene);l.subMaterials.push(a);l.subMaterials.push(n);l.subMaterials.push(o);t.material=l;return t};return e}();t.TwoOrThreeAxisMerged=n;var o=function(){function i(e){this.isLeftHandSided=true;this.addColor=true;this.threeVersusTwoAxis=true;this.addLabelsXYZ=false;this.scene=e;this.SUB_x_axisCreator=new a(this.scene);this.SUB_y_axisCreator=new a(this.scene);this.SUB_z_axisCreator=new a(this.scene)}i.prototype.go=function(){if(this.addColor){this.SUB_x_axisCreator.color=new e.Color(e.Color.names.red);this.SUB_y_axisCreator.color=new e.Color(e.Color.names.green);this.SUB_z_axisCreator.color=new e.Color(e.Color.names.blue)}var i=[];if(this.addLabelsXYZ){var r=new t.FlagWithText(this.scene);r.text="x";var s=r.go();s.position=new e.XYZ(1.1,0,0);i.push(s);var a=new t.FlagWithText(this.scene);a.text="y";var n=a.go();n.position=new e.XYZ(0,1.15,0);i.push(n);var o=new t.FlagWithText(this.scene);o.text="z";var h=o.go();h.position=new e.XYZ(0,.1,1);i.push(h)}var l=this.SUB_y_axisCreator.go();l.bakeCurrentTransformIntoVertices();var u=this.SUB_x_axisCreator.go();e.geo.axisAngleToQuaternion(new e.XYZ(0,0,1),-Math.PI/2,u.rotationQuaternion);u.bakeCurrentTransformIntoVertices();if(this.threeVersusTwoAxis){var c=this.SUB_z_axisCreator.go();var m=this.isLeftHandSided?Math.PI/2:-Math.PI/2;e.geo.axisAngleToQuaternion(new e.XYZ(1,0,0),m,c.rotationQuaternion);c.bakeCurrentTransformIntoVertices();return[u,l,c].concat(i)}else return[u,l].concat(i)};return i}();t.TwoOrTreeAxis=o;var h=function(){function e(e){this.text="TOTO";this.font="bold 140px verdana";this.color="black";this.backgroundColor="transparent";this.scene=e}e.prototype.go=function(){var e=new BABYLON.DynamicTexture("dynamic texture",512,this.scene,true);e.drawText(this.text,null,300,this.font,this.color,this.backgroundColor);e.hasAlpha=true;var t=BABYLON.Mesh.CreatePlane("textPlane",1,this.scene,false);var i=new BABYLON.StandardMaterial("textPlane",this.scene);i.diffuseTexture=e;i.specularColor=new BABYLON.Color3(0,0,0);i.emissiveColor=new BABYLON.Color3(1,1,1);i.backFaceCulling=false;t.material=i;return t};return e}();t.FlagWithText=h})(t=e.creation3D||(e.creation3D={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){function i(e){var t=[];for(var i=0,r=e;i<r.length;i++){var s=r[i];t.push(s.hashNumber)}return JSON.stringify(t.sort())}t.verticesToString=i;function r(t){var i=[];for(var r=0,s=t;r<s.length;r++){var a=s[r];var n=[];for(var o=0,h=a;o<h.length;o++){var l=h[o];n.push(l.hashNumber)}i.push(e.tab.indicesUpPermutationToString(n))}return JSON.stringify(i.sort())}t.verticesFamilyToString=r;function s(e){var t="";for(var i=0,r=e;i<r.length;i++){var s=r[i];t+=s.toString()}return t}t.objToString=s;function a(e){for(var t=0,i=e;t<i.length;t++){var r=i[t];var s=null;for(var a=0,n=r.links;a<n.length;a++){s=n[a];if(!s.to.hasVoisin(r))throw"neighborhood relation is not reflexive. The vertex:"+r.toString(0)+"\n has a link which gos to:"+s.to.toString(0)+"\n but no link in the other direction. A possible cause: you vertices is only a part of a graph";if(s.opposites!=null){for(var o=0,h=s.opposites;o<h.length;o++){var l=h[o];if(r.links.indexOf(l)==-1)throw"a link attached to a vertex has an opposite link which is not attached of this vertex \n "+"problem takes place at vertex:"+r.toString(0)+"\n link going to:"+s.to.toString(0)+"\n opposite link going to:"+l.to.toString(0);if(l.opposites.indexOf(s)==-1)throw"opposite of  opposite do not give the same link"}}}}}t.checkTheRegularityOfAGraph=a})(t=e.debug||(e.debug={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(t,i){this.originMath=new e.XYZ(0,0,0);this.endMath=new e.XYZ(1,1,0);this.originView=new e.XYZ(-1,-1,0);this.endView=new e.XYZ(1,1,0);this.nbI=20;this.nbJ=20;this.departure=new e.XYZ(0,0,0);this.deltaT=.1;this.vectorsAreArrowsVersusCone=true;this.scaleVectorsAccordingToTheirNorm=false;this.makeLightAndCamera=true;this.generator=new e.reseau.BasisForRegularReseau;this.stochasticVariation=new e.XYZ(0,0,0);this.dW=new e.XYZ(0,0,0);this.scaler=null;this.functionToSortvertex=function(e,t){return e.customerObject.squareLengthOfTangent-t.customerObject.squareLengthOfTangent};this.vectorField=t;this.mathisFrame=i}t.prototype.go=function(){if(this.randomExitation==null)this.randomExitation=function(){return new e.XYZ(Math.random()-.5,Math.random()-.5,Math.random()-.5)};this.generator.nbI=this.nbI;this.generator.nbJ=this.nbJ;this.generator.origin=this.originView;this.generator.end=this.endView;this.makePlanForClick();if(this.makeLightAndCamera)this.lightAndCamera();this.arrowModel=this.createArrowModel();this.scaler=e.geo.affineTransformGenerator(this.originView,this.endView,this.originMath,this.endMath);this.loadVectorFields();this.mameshAndPositioning();if(this.scaleVectorsAccordingToTheirNorm)this.prepareRescaling();this.start()};t.prototype.makePlanForClick=function(){this.planForClick=BABYLON.Mesh.CreatePlane("",1,this.mathisFrame.scene);var t=e.XYZ.newFrom(this.generator.end).substract(this.generator.origin);var i=e.XYZ.newFrom(this.generator.origin).add(this.generator.end).scale(.5);this.planForClick.scaling=new e.XYZ(t.x,t.y,0);this.planForClick.position=new e.XYZ(i.x,i.y,.06);this.planForClick.bakeCurrentTransformIntoVertices();this.planForClick.visibility=0};t.prototype.lightAndCamera=function(){var t=e.XYZ.newFrom(this.generator.end).substract(this.generator.origin);var i=new e.macamera.PlanarGrabber(this.mathisFrame.scene,new e.XYZ(t.x,t.y,.061));i.mesh.visibility=0;var r=new e.macamera.GrabberCamera(this.mathisFrame,i);r.checkCollisions=false;r.useFreeModeWhenCursorOutOfGrabber=false;r.changePosition(new e.XYZ(0,0,-2),false);r.attachControl(this.mathisFrame.canvas);var s=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-1,1,-1),this.mathisFrame.scene);s.diffuse=new BABYLON.Color3(.5,.5,.5);s.specular=new BABYLON.Color3(.7,.7,.7);s.groundColor=new BABYLON.Color3(1,1,1)};t.prototype.computeNewPathPoint=function(e,t,i){this.vectorFieldScaled(t,e,i);i.scale(this.deltaT);if(this.vectorFieldForNoiseScaled!=null){this.vectorFieldForNoiseScaled(t,e,this.stochasticVariation);this.stochasticVariation.multiply(this.randomExitation()).scale(Math.sqrt(this.deltaT));i.add(this.stochasticVariation)}i.add(e)};t.prototype.mameshAndPositioning=function(){var t=new e.reseau.Regular(this.generator);t.squareVersusTriangleMaille=false;this.mamesh=t.go();var i=new e.mameshAroundComputations.PositioningComputerForMameshVertices(this.mamesh);i.computeTangent=false;i.sizesProp=new e.XYZ(.15,.15,.15);this.positionings=i.go();this.vectorReferencesize=this.positionings.getValue(this.mamesh.vertices[0]).scaling.x};t.prototype.createArrowModel=function(){var t;var i=new e.XYZW(0,0,0,0);e.geo.axisAngleToQuaternion(new e.XYZ(0,0,1),-Math.PI/2,i);if(this.vectorsAreArrowsVersusCone){var r=new e.creation3D.ArrowCreator(this.mathisFrame.scene);r.quaternion=i;r.arrowFootAtOrigin=false;r.totalHeight=3;r.bodyDiameterProp=.2;r.headDiameterProp=.4;t=r.go()}else{t=BABYLON.Mesh.CreateCylinder("",2,0,1,6,null,this.mathisFrame.scene);t.rotationQuaternion=i;t.bakeCurrentTransformIntoVertices()}var s=new BABYLON.StandardMaterial("",this.mathisFrame.scene);s.diffuseColor=new BABYLON.Color3(0,0,1);t.material=s;return t};t.prototype.loadVectorFields=function(){var t=this;var i=new e.XYZ(0,0,0);this.vectorFieldScaled=function(e,r,s){t.scaler(r,i);t.vectorField(e,i,s)};if(this.vectorFieldForNoise!=null){var r=new e.XYZ(0,0,0);this.vectorFieldForNoiseScaled=function(e,i,s){t.scaler(i,r);t.vectorFieldForNoise(e,r,s)}}};t.prototype.start=function(){var t=this;var i=new e.creation3D.Snake(this.mathisFrame);i.initialPosition=this.departure;i.serpentRadius=.01;i.go();this.mamesh.vertices.forEach(function(e){t.vectorFieldScaled(0,e.position,t.positionings.getValue(e).frontDir)});var r=new e.visu3d.VerticesViewer(this.mamesh,this.mathisFrame.scene,this.positionings);r.meshModel=this.arrowModel;r.go();var s=0;var a=new e.PeriodicAction(function(){s+=t.deltaT;var a=new e.XYZ(0,0,0);t.computeNewPathPoint(i.getHeadPosition(),s,a);i.elongateTo(a);t.mamesh.vertices.forEach(function(e){var i=t.positionings.getValue(e);t.vectorFieldScaled(s,e.position,i.frontDir)});if(t.scaleVectorsAccordingToTheirNorm)t.rescaleVectors(t.vectorReferencesize);r.updatePositionings()});a.id="main action";a.frameInterval=1;this.mathisFrame.pushPeriodicAction(a);this.planForClick.onClick=function(r){var s=new e.PeriodicAction(function(){i.contractInOnePoint(r)});s.frameInterval=1;s.nbTimesThisActionMustBeFired=1;s.id="click action";s.passageOrderIndex=2;t.mathisFrame.pushPeriodicAction(s)}};t.prototype.prepareRescaling=function(){var e=this;this.verticeSorted=[];this.mamesh.vertices.forEach(function(t){return e.verticeSorted.push(t)})};t.prototype.rescaleVectors=function(e){var t=this;this.mamesh.vertices.forEach(function(e){e.customerObject.squareLengthOfTangent=t.positionings.getValue(e).frontDir.lengthSquared()});this.verticeSorted.sort(this.functionToSortvertex);for(var i=0;i<this.verticeSorted.length;i++)this.verticeSorted[i].customerObject.scaleFromOrder=i/this.verticeSorted.length;this.mamesh.vertices.forEach(function(i){var r=t.positionings.getValue(i);r.scaling.x=2*e*(i.customerObject.scaleFromOrder+1/4);var s=e*Math.max(1,i.customerObject.scaleFromOrder+1/2);r.scaling.y=s;r.scaling.z=s})};return t}();t.TwoDim=i})(t=e.differentialSystem||(e.differentialSystem={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){(function(e){e[e["cube"]=0]="cube";e[e["hexagone"]=1]="hexagone";e[e["doubleHexagone"]=2]="doubleHexagone"})(t.NameOfReseau3D||(t.NameOfReseau3D={}));var i=t.NameOfReseau3D;var r=function(){function t(e){this.nameOfResau3d=i.cube;this.nbVerticalDecays=0;this.nbHorizontalDecays=0;this.fondamentalDomainSize=9;this.nbSubdivision=3;this.nbRepetition=8;this.fogDensity=.05;this.drawFondamentalDomain=false;this.recenterCamera=true;this.notDrawMeshesAtFarCorners=true;this.population=[];this.collisionOnLinks=false;this.collisionOnVertices=false;this.collisionForCamera=false;this.nbSidesOfLinks=4;this.buildLightCameraSkyboxAndFog=true;this.mathisFrame=e}t.prototype.go=function(){if(this.buildLightCameraSkyboxAndFog)this.cameraLight();this.creationOfReseau();var e=new BABYLON.Texture("assets/texture/escher.jpg",this.mathisFrame.scene);this.vertexVisualization(this.mamesh,e);this.linksVisualization(this.mamesh,e);this.addAndMultiplyPopulation();if(this.buildLightCameraSkyboxAndFog){this.seeWorldFromInside();this.fogAndSkybox()}};t.prototype.addAndMultiplyPopulation=function(){var t=this.notDrawMeshesAtFarCorners?this.getTotalSize()*.6:this.getTotalSize();var i=new e.periodicWorld.Multiply(this.fd,t,this.nbRepetition);for(var r=0,s=this.population;r<s.length;r++){var a=s[r];i.addAbstractMesh(a)}};t.prototype.seeWorldFromOutside=function(){var t=this.getTotalSize();this.getCamera().changePosition(new e.XYZ(0,0,-t*2),false);this.getCamera().changeFrontDir(new e.XYZ(0,0,1),false);this.recenterCamera=false;this.getGrabber().mesh.visibility=1;this.getCamera().useOnlyFreeMode=false;this.mathisFrame.scene.fogMode=BABYLON.Scene.FOGMODE_NONE};t.prototype.seeWorldFromInside=function(){this.recenterCamera=true;this.getCamera().changePosition(new e.XYZ(0,0,0),false);this.getCamera().changeFrontDir(new e.XYZ(-.5,-.5,-1),false);this.getGrabber().mesh.visibility=0;this.getCamera().useOnlyFreeMode=true;this.mathisFrame.scene.fogMode=BABYLON.Scene.FOGMODE_EXP2};t.prototype.getCamera=function(){return this.mathisFrame.scene.activeCamera};t.prototype.getGrabber=function(){return this.getCamera().currentGrabber};t.prototype.cameraLight=function(){var t=this;var i=this.getTotalSize()*.6;var r=new e.macamera.SphericalGrabber(this.mathisFrame.scene,new e.XYZ(i,i,i));r.focusOnMyCenterWhenCameraGoDownWard=false;r.mesh.visibility=0;var s=new e.macamera.GrabberCamera(this.mathisFrame,r);s.translationSpeed=this.fondamentalDomainSize*.5;s.checkCollisions=this.collisionForCamera;s.keysFrontward=[66,78];s.keysBackward=[32];s.attachControl(this.mathisFrame.canvas);this.mathisFrame.scene.activeCamera=s;var a=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-1,1,-1),this.mathisFrame.scene);a.diffuse=new BABYLON.Color3(1,1,1);a.specular=new BABYLON.Color3(0,0,0);a.groundColor=new BABYLON.Color3(0,0,.3);var n=new e.XYZ(0,0,0);var o=new e.periodicWorld.Domain(0,0,0);var h=new e.XYZ(0,0,0);this.fd=new e.periodicWorld.CartesianFundamentalDomain(new e.XYZ(this.fondamentalDomainSize,0,0),new e.XYZ(0,this.fondamentalDomainSize,0),new e.XYZ(0,0,this.fondamentalDomainSize));if(this.drawFondamentalDomain){this.fd.drawMe(this.mathisFrame.scene);this.fd.getArretes(this.mathisFrame.scene)}s.onTranslate=function(){if(t.recenterCamera){t.fd.pointToWebCoordinate(s.trueCamPos.position,n);o.whichContains(n);o.getCenter(t.fd,h);s.changePosition(s.whishedCamPos.getPosition().substract(h),false)}}};t.prototype.creationOfReseau=function(){var t=new e.reseau.BasisForRegularReseau;t.end=new e.XYZ(this.fondamentalDomainSize,this.fondamentalDomainSize,0);t.nbI=this.nbSubdivision;t.nbJ=this.nbSubdivision;t.origin=new e.XYZ(0,0,0);t.nbVerticalDecays=this.nbVerticalDecays;t.nbHorizontalDecays=this.nbHorizontalDecays;var r=t.go();var s=new e.reseau.Regular3D;s.nbI=this.nbSubdivision*this.nbRepetition;s.nbJ=this.nbSubdivision*this.nbRepetition;s.nbK=this.nbSubdivision*this.nbRepetition;s.Vi=r.Vi;s.Vj=r.Vj;s.Vk=new e.XYZ(0,0,this.fondamentalDomainSize/(this.nbSubdivision-1));s.makeTriangleOrSquare=false;s.createIKSquaresOrTriangles=false;s.createJKSquares=false;if(this.nameOfResau3d==i.hexagone||this.nameOfResau3d==i.doubleHexagone){s.strateHaveSquareMailleVersusTriangleMaille=false}if(this.nameOfResau3d==i.doubleHexagone){s.interStrateMailleAreSquareVersusTriangle=false;s.decayOddStrates=true}var a=this.getTotalSize();s.origine=new e.XYZ(-a/2,-a/2,-a/2);if(this.notDrawMeshesAtFarCorners)s.putAVertexOnlyAtXYZCheckingThisCondition=function(e){return e.length()<a*.6};this.mamesh=s.go();this.mamesh.fillLineCatalogue()};t.prototype.getTotalSize=function(){return this.nbRepetition*this.fondamentalDomainSize};t.prototype.vertexVisualization=function(t,i){var r=BABYLON.Mesh.CreateBox("",.5,this.mathisFrame.scene);var s=new BABYLON.StandardMaterial("",this.mathisFrame.scene);s.diffuseTexture=i;r.material=s;r.convertToFlatShadedMesh();var a=new e.visu3d.VerticesViewer(t,this.mathisFrame.scene);a.meshModel=r;a.checkCollision=this.collisionOnVertices;var n=new e.Positioning;n.upVector=new e.XYZ(1,0,0);n.frontDir=new e.XYZ(0,1,0);a.positionings=new e.HashMap;for(var o=0,h=t.vertices;o<h.length;o++){var l=h[o];a.positionings.putValue(l,n)}a.go()};t.prototype.linksVisualization=function(t,i){var r;if(this.nbSidesOfLinks==4)r=BABYLON.Mesh.CreateBox("",1,this.mathisFrame.scene);else r=BABYLON.Mesh.CreateCylinder("",1,1,1,this.nbSidesOfLinks,null,this.mathisFrame.scene);var s=new BABYLON.StandardMaterial("",this.mathisFrame.scene);s.diffuseColor=new BABYLON.Color3(.6,.6,.6);s.diffuseTexture=i;r.material=s;r.convertToFlatShadedMesh();var a=new e.visu3d.LinksViewer(t,this.mathisFrame.scene);a.lateralScalingConstant=.2;a.checkCollision=this.collisionOnLinks;a.meshModel=r;var n=new e.XYZ(1,0,0);var o=new e.XYZ(0,1,0);a.pairVertexToLateralDirection=function(t,i){if(Math.abs(e.geo.dot(e.XYZ.newFrom(t.position).substract(i.position),n))<1e-4)return n;else return o};a.go()};t.prototype.fogAndSkybox=function(){var e=BABYLON.Mesh.CreateBox("skyBox",50*this.fondamentalDomainSize,this.mathisFrame.scene);this.mathisFrame.skybox=e;e.visibility=1;var t=new BABYLON.StandardMaterial("skyBox",this.mathisFrame.scene);t.backFaceCulling=false;e.material=t;t.diffuseColor=new BABYLON.Color3(0,0,0);t.specularColor=new BABYLON.Color3(0,0,0);t.reflectionTexture=new BABYLON.CubeTexture("assets/skybox/skybox",this.mathisFrame.scene,["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]);t.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE;this.mathisFrame.scene.fogDensity=this.fogDensity;this.mathisFrame.scene.fogColor=new BABYLON.Color3(1,1,1)};return t}();t.InfiniteCartesian=r})(t=e.infiniteWorlds||(e.infiniteWorlds={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(e){this.q=1.1;this.beta=.5;this.sphereRadius=1;this.frameInterval=5;this.nbActionsPerIteration=100;this.defineLightAndCamera=true;this.nbDicho=4;this.mathisFrame=e}t.prototype.go=function(){if(this.defineLightAndCamera)this.lightAndCam();this.meshAndIsing()};t.prototype.lightAndCam=function(){var t=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-1,1,-1),this.mathisFrame.scene);t.diffuse=new BABYLON.Color3(1,1,1);t.specular=new BABYLON.Color3(1,1,1);t.groundColor=new BABYLON.Color3(.5,.5,.5);var i=new e.XYZ(0,0,0);var r=new e.macamera.SphericalGrabber(this.mathisFrame.scene,new e.XYZ(this.sphereRadius,this.sphereRadius,this.sphereRadius),i);r.mesh.material.alpha=.6;r.showGrabberOnlyWhenGrabbing=false;r.endOfZone1=0;r.endOfZone2=0;var s=new e.macamera.GrabberCamera(this.mathisFrame,r);s.useFreeModeWhenCursorOutOfGrabber=false;s.changePosition(new e.XYZ(0,0,-4*this.sphereRadius),false);s.attachControl(this.mathisFrame.canvas)};t.prototype.meshAndIsing=function(){var t=this;var i=new e.creation3D.Polyhedron(e.creation3D.PolyhedronType.Dodecahedron);var r=i.go();for(var s=0;s<this.nbDicho;s++){var a=new e.mameshModification.TriangleDichotomer(r);a.makeLinks=true;a.go()}r.vertices.forEach(function(e){e.position.normalize().scale(t.sphereRadius)});var n=new e.metropolis.IsingModel(r.vertices);n.beta=this.beta;n.q=this.q;n.nbActionsPerIteration=this.nbActionsPerIteration;n.go();var o=this.sphereModel(new BABYLON.Color3(1,0,0));var h=this.sphereModel(new BABYLON.Color3(0,0,1));var l=new e.mameshAroundComputations.PositioningComputerForMameshVertices(r);l.sizesProp=new e.XYZ(1,1,1);var u=l.go();var c=new e.HashMap;r.vertices.forEach(function(t){var i=new e.Positioning;i.copyFrom(u.getValue(t));i.scaling.copyFromFloats(0,0,0);c.putValue(t,i)});var m=new e.HashMap;r.vertices.forEach(function(t){var i=new e.Positioning;i.copyFrom(u.getValue(t));i.scaling.copyFromFloats(0,0,0);m.putValue(t,i)});var d=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);d.positionings=c;d.meshModel=o;d.go();var f=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);f.positionings=m;f.meshModel=h;f.go();var p=u.getValue(r.vertices[0]).scaling;var v=new e.PeriodicAction(function(){var e=n.iterateAndGetChangedVertices();e.allKeys().forEach(function(e){if(e.customerObject.value==0){c.getValue(e).scaling.copyFromFloats(0,0,0);m.getValue(e).scaling.copyFromFloats(0,0,0)}else if(e.customerObject.value==1){c.getValue(e).scaling.copyFrom(p);m.getValue(e).scaling.copyFromFloats(0,0,0)}else if(e.customerObject.value==-1){m.getValue(e).scaling.copyFrom(p);c.getValue(e).scaling.copyFromFloats(0,0,0)}});d.updatePositionings();f.updatePositionings()});v.frameInterval=this.frameInterval;this.mathisFrame.pushPeriodicAction(v)};t.prototype.sphereModel=function(t){var i=BABYLON.Mesh.CreateSphere("",6,1,this.mathisFrame.scene);var r=new BABYLON.StandardMaterial("",this.mathisFrame.scene);r.diffuseColor=t;i.material=r;var s=new e.XYZW(0,0,0,0);e.geo.axisAngleToQuaternion(new e.XYZ(1,0,0),Math.PI/2,s);i.rotationQuaternion=s;return i};return t}();t.IsingOnMesh=i})(t=e.mecaStat||(e.mecaStat={}))})(mathis||(mathis={}));var mathis;(function(e){var t=function(){function t(){this.epsilon=1e-8;this.epsilonSquare=this.epsilon*this.epsilon;this.epsitlonForAlmostEquality=1e-6;this._resultTransp=new e.MM;this.baryResult=new e.XYZ(0,0,0);this._scaled=new e.XYZ(0,0,0);this._matUn=new e.MM;this._source=new e.XYZ(0,0,0);this._axis=new e.XYZ(0,0,0);this._ortBasisV1=new e.XYZ(0,0,0);this._ortBasisV2=new e.XYZ(0,0,0);this._ortBasisV3=new e.XYZ(0,0,0);this._ortBasisAll=new e.MM;this._basisOrtho0=new e.XYZ(0,0,0);this._basisOrtho1=new e.XYZ(0,0,0);this._basisOrtho2=new e.XYZ(0,0,0);this._basisMatrix=new e.MM;this._transposedBasisMatrix=new e.MM;this._diagoMatrix=new e.MM;this.matt1=new e.MM;this.matt2=new e.MM;this.oor1=new e.XYZ(0,0,0);this.oor2=new e.XYZ(0,0,0);this.copA=new e.XYZ(0,0,0);this.copB=new e.XYZ(0,0,0);this.copC=new e.XYZ(0,0,0);this.copD=new e.XYZ(0,0,0);this.matBefore=new e.MM;this.v1nor=new e.XYZ(0,0,0);this.v2nor=new e.XYZ(0,0,0);this._aCros=new e.XYZ(0,0,0);this._quat0=new e.XYZW(0,0,0,0);this._quat1=new e.XYZW(0,0,0,0);this._quatAlpha=new e.XYZW(0,0,0,0);this._mat0=new e.MM;this._mat1=new e.MM;this._matAlpha=new e.MM;this._c0=new e.XYZ(0,0,0);this._c1=new e.XYZ(0,0,0);this._crossResult=new e.XYZ(0,0,0);this.v1forSubstraction=new e.XYZ(0,0,0);this.randV2=new e.XYZ(0,0,0);this._result1=new e.XYZ(0,0,0);this._result2=new e.XYZ(0,0,0);this.spheCentToRayOri=new e.XYZ(0,0,0);this._resultInters=new e.XYZ(0,0,0);this.difference=new e.XYZ(0,0,0);this._xAxis=e.XYZ.newZero();this._yAxis=e.XYZ.newZero();this._zAxis=e.XYZ.newZero()}t.prototype.copyXYZ=function(e,t){t.x=e.x;t.y=e.y;t.z=e.z;return t};t.prototype.copyXyzFromFloat=function(e,t,i,r){r.x=e;r.y=t;r.z=i;return r};t.prototype.copyMat=function(e,t){for(var i=0;i<16;i++)t.m[i]=e.m[i];return t};t.prototype.matEquality=function(e,t){for(var i=0;i<16;i++){if(e.m[i]!=t.m[i])return false}return true};t.prototype.matAlmostEquality=function(e,t){for(var i=0;i<16;i++){if(!this.almostEquality(e.m[i],t.m[i]))return false}return true};t.prototype.xyzEquality=function(e,t){return e.x==t.x&&e.y==t.y&&e.z==t.z};t.prototype.xyzAlmostEquality=function(e,t){return Math.abs(e.x-t.x)<this.epsitlonForAlmostEquality&&Math.abs(e.y-t.y)<this.epsitlonForAlmostEquality&&Math.abs(e.z-t.z)<this.epsitlonForAlmostEquality};t.prototype.xyzwAlmostEquality=function(e,t){return Math.abs(e.x-t.x)<this.epsitlonForAlmostEquality&&Math.abs(e.y-t.y)<this.epsitlonForAlmostEquality&&Math.abs(e.z-t.z)<this.epsitlonForAlmostEquality&&Math.abs(e.w-t.w)<this.epsitlonForAlmostEquality};t.prototype.almostLogicalEqual=function(t,i){return e.geo.xyzwAlmostEquality(t,i)||e.geo.almostEquality(t.x,-i.x)&&e.geo.almostEquality(t.y,-i.y)&&e.geo.almostEquality(t.z,-i.z)&&e.geo.almostEquality(t.w,-i.w)};t.prototype.xyzAlmostZero=function(e){return Math.abs(e.x)<this.epsilon&&Math.abs(e.y)<this.epsilon&&Math.abs(e.z)<this.epsilon};t.prototype.almostEquality=function(e,t){return Math.abs(t-e)<this.epsitlonForAlmostEquality};t.prototype.inverse=function(e,t){var i=e.m[0];var r=e.m[1];var s=e.m[2];var a=e.m[3];var n=e.m[4];var o=e.m[5];var h=e.m[6];var l=e.m[7];var u=e.m[8];var c=e.m[9];var m=e.m[10];var d=e.m[11];var f=e.m[12];var p=e.m[13];var v=e.m[14];var g=e.m[15];var w=m*g-d*v;var y=c*g-d*p;var b=c*v-m*p;var T=u*g-d*f;var M=u*v-m*f;var C=u*p-c*f;var S=o*w-h*y+l*b;var x=-(n*w-h*T+l*M);var F=n*y-o*T+l*C;var V=-(n*b-o*M+h*C);var k=1/(i*S+r*x+s*F+a*V);var O=h*g-l*v;var A=o*g-l*p;var P=o*v-h*p;var L=n*g-l*f;var B=n*v-h*f;var Y=n*p-o*f;var I=h*d-l*m;var $=o*d-l*c;var D=o*m-h*c;var N=n*d-l*u;var X=n*m-h*u;var Z=n*c-o*u;t.m[0]=S*k;t.m[4]=x*k;t.m[8]=F*k;t.m[12]=V*k;t.m[1]=-(r*w-s*y+a*b)*k;t.m[5]=(i*w-s*T+a*M)*k;t.m[9]=-(i*y-r*T+a*C)*k;t.m[13]=(i*b-r*M+s*C)*k;t.m[2]=(r*O-s*A+a*P)*k;t.m[6]=-(i*O-s*L+a*B)*k;t.m[10]=(i*A-r*L+a*Y)*k;t.m[14]=-(i*P-r*B+s*Y)*k;t.m[3]=-(r*I-s*$+a*D)*k;t.m[7]=(i*I-s*N+a*X)*k;t.m[11]=-(i*$-r*N+a*Z)*k;t.m[15]=(i*D-r*X+s*Z)*k};t.prototype.transpose=function(t,i){this._resultTransp.m[0]=t.m[0];this._resultTransp.m[1]=t.m[4];this._resultTransp.m[2]=t.m[8];this._resultTransp.m[3]=t.m[12];this._resultTransp.m[4]=t.m[1];this._resultTransp.m[5]=t.m[5];this._resultTransp.m[6]=t.m[9];this._resultTransp.m[7]=t.m[13];this._resultTransp.m[8]=t.m[2];this._resultTransp.m[9]=t.m[6];this._resultTransp.m[10]=t.m[10];this._resultTransp.m[11]=t.m[14];this._resultTransp.m[12]=t.m[3];this._resultTransp.m[13]=t.m[7];this._resultTransp.m[14]=t.m[11];this._resultTransp.m[15]=t.m[15];e.geo.copyMat(this._resultTransp,i)};t.prototype.multiplyMatMat=function(e,t,i){var r=e.m[0];var s=e.m[1];var a=e.m[2];var n=e.m[3];var o=e.m[4];var h=e.m[5];var l=e.m[6];var u=e.m[7];var c=e.m[8];var m=e.m[9];var d=e.m[10];var f=e.m[11];var p=e.m[12];var v=e.m[13];var g=e.m[14];var w=e.m[15];var y=t.m[0];var b=t.m[1];var T=t.m[2];var M=t.m[3];var C=t.m[4];var S=t.m[5];var x=t.m[6];var F=t.m[7];var V=t.m[8];var k=t.m[9];var O=t.m[10];var A=t.m[11];var P=t.m[12];var L=t.m[13];var B=t.m[14];var Y=t.m[15];i.m[0]=r*y+s*C+a*V+n*P;i.m[1]=r*b+s*S+a*k+n*L;i.m[2]=r*T+s*x+a*O+n*B;i.m[3]=r*M+s*F+a*A+n*Y;i.m[4]=o*y+h*C+l*V+u*P;i.m[5]=o*b+h*S+l*k+u*L;i.m[6]=o*T+h*x+l*O+u*B;i.m[7]=o*M+h*F+l*A+u*Y;i.m[8]=c*y+m*C+d*V+f*P;i.m[9]=c*b+m*S+d*k+f*L;i.m[10]=c*T+m*x+d*O+f*B;i.m[11]=c*M+m*F+d*A+f*Y;i.m[12]=p*y+v*C+g*V+w*P;i.m[13]=p*b+v*S+g*k+w*L;i.m[14]=p*T+v*x+g*O+w*B;i.m[15]=p*M+v*F+g*A+w*Y};t.prototype.baryCenter=function(t,i,r){this.baryResult.x=0;this.baryResult.y=0;this.baryResult.z=0;for(var s=0;s<t.length;s++){e.geo.copyXYZ(t[s],this._scaled);this.scale(this._scaled,i[s],this._scaled);this.add(this.baryResult,this._scaled,this.baryResult)}e.geo.copyXYZ(this.baryResult,r)};t.prototype.between=function(e,t,i,r){r.x=e.x*(1-i)+t.x*i;r.y=e.y*(1-i)+t.y*i;r.z=e.z*(1-i)+t.z*i};t.prototype.betweenUV=function(e,t,i,r){r.u=e.u*(1-i)+t.u*i;r.v=e.v*(1-i)+t.v*i};t.prototype.unproject=function(t,i,r,s,a,n,o){e.geo.copyXYZ(t,this._source);if(s!=null){this.multiplyMatMat(s,a,this._matUn);this.multiplyMatMat(this._matUn,n,this._matUn)}else{this.multiplyMatMat(a,n,this._matUn)}this.inverse(this._matUn,this._matUn);this._source.x=this._source.x/i*2-1;this._source.y=-(this._source.y/r*2-1);this.multiplicationMatrixVector(this._matUn,this._source,o);var h=t.x*this._matUn.m[3]+t.y*this._matUn.m[7]+t.z*this._matUn.m[11]+this._matUn.m[15];if(this.withinEpsilon(h,1)){this.scale(o,1/h,o)}};t.prototype.withinEpsilon=function(e,t){var i=e-t;return-1.401298e-45<=i&&i<=1.401298e-45};t.prototype.axisAngleToMatrix=function(t,i,r){var s=Math.sin(-i);var a=Math.cos(-i);var n=1-a;e.geo.copyXYZ(t,this._axis);this.normalize(this._axis,this._axis);r.m[0]=this._axis.x*this._axis.x*n+a;r.m[1]=this._axis.x*this._axis.y*n-this._axis.z*s;r.m[2]=this._axis.x*this._axis.z*n+this._axis.y*s;r.m[3]=0;r.m[4]=this._axis.y*this._axis.x*n+this._axis.z*s;r.m[5]=this._axis.y*this._axis.y*n+a;r.m[6]=this._axis.y*this._axis.z*n-this._axis.x*s;r.m[7]=0;r.m[8]=this._axis.z*this._axis.x*n-this._axis.y*s;r.m[9]=this._axis.z*this._axis.y*n+this._axis.x*s;r.m[10]=this._axis.z*this._axis.z*n+a;r.m[11]=0;r.m[12]=0;r.m[13]=0;r.m[14]=0;r.m[15]=1};t.prototype.multiplicationMatrixVector=function(e,t,i){var r=t.x*e.m[0]+t.y*e.m[4]+t.z*e.m[8]+e.m[12];var s=t.x*e.m[1]+t.y*e.m[5]+t.z*e.m[9]+e.m[13];var a=t.x*e.m[2]+t.y*e.m[6]+t.z*e.m[10]+e.m[14];var n=t.x*e.m[3]+t.y*e.m[7]+t.z*e.m[11]+e.m[15];i.x=r/n;i.y=s/n;i.z=a/n};t.prototype.axisAngleToQuaternion=function(e,t,i){var r=Math.sin(t/2);i.w=Math.cos(t/2);i.x=e.x*r;i.y=e.y*r;i.z=e.z*r};t.prototype.matrixToQuaternion=function(e,t){var i,r,s,a,n,o,h,l,u;i=e.m[0];a=e.m[1];h=e.m[2];r=e.m[4];n=e.m[5];l=e.m[6];s=e.m[8];o=e.m[9];u=e.m[10];var c,m,d,f;var p=i+n+u;if(p>0){var v=Math.sqrt(p+1)*2;f=.25*v;c=(l-o)/v;m=(s-h)/v;d=(a-r)/v}else if(i>n&&i>u){var v=Math.sqrt(1+i-n-u)*2;f=(l-o)/v;c=.25*v;m=(r+a)/v;d=(s+h)/v}else if(n>u){var v=Math.sqrt(1+n-i-u)*2;f=(s-h)/v;c=(r+a)/v;m=.25*v;d=(o+l)/v}else{var v=Math.sqrt(1+u-i-n)*2;f=(a-r)/v;c=(s+h)/v;m=(o+l)/v;d=.25*v}t.x=c;t.y=m;t.z=d;t.w=f};t.prototype.twoVectorsToQuaternion=function(t,i,r,s){if(r){e.geo.orthonormalizeKeepingFirstDirection(t,i,this._ortBasisV1,this._ortBasisV2)}else{e.geo.orthonormalizeKeepingFirstDirection(i,t,this._ortBasisV2,this._ortBasisV1)}e.geo.cross(this._ortBasisV1,this._ortBasisV2,this._ortBasisV3);e.geo.matrixFromLines(this._ortBasisV1,this._ortBasisV2,this._ortBasisV3,this._ortBasisAll);e.geo.matrixToQuaternion(this._ortBasisAll,s)};t.prototype.orthogonalProjectionOnLine=function(e,t){this.normalize(e,this._basisOrtho0);this.getOneOrthonormal(e,this._basisOrtho1);this.cross(this._basisOrtho0,this._basisOrtho1,this._basisOrtho2);this.matrixFromLines(this._basisOrtho0,this._basisOrtho1,this._basisOrtho2,this._basisMatrix);this.transpose(this._basisMatrix,this._transposedBasisMatrix);this._diagoMatrix.m[0]=1;this._diagoMatrix.m[15]=1;this.multiplyMatMat(this._transposedBasisMatrix,this._diagoMatrix,t);this.multiplyMatMat(t,this._basisMatrix,t)};t.prototype.orthogonalProjectionOnPlane=function(e,t,i){this.orthonormalizeKeepingFirstDirection(e,t,this._basisOrtho0,this._basisOrtho1);this.cross(this._basisOrtho0,this._basisOrtho1,this._basisOrtho2);this.matrixFromLines(this._basisOrtho0,this._basisOrtho1,this._basisOrtho2,this._basisMatrix);this.transpose(this._basisMatrix,this._transposedBasisMatrix);this._diagoMatrix.m[0]=1;this._diagoMatrix.m[5]=1;this._diagoMatrix.m[15]=1;this.multiplyMatMat(this._transposedBasisMatrix,this._diagoMatrix,i);this.multiplyMatMat(i,this._basisMatrix,i)};t.prototype.translationOnMatrix=function(e,t){t.m[12]=e.x;t.m[13]=e.y;t.m[14]=e.z};t.prototype.quaternionToMatrix=function(e,t){var i=e.x*e.x;var r=e.y*e.y;var s=e.z*e.z;var a=e.x*e.y;var n=e.z*e.w;var o=e.z*e.x;var h=e.y*e.w;var l=e.y*e.z;var u=e.x*e.w;t.m[0]=1-2*(r+s);t.m[1]=2*(a+n);t.m[2]=2*(o-h);t.m[3]=0;t.m[4]=2*(a-n);t.m[5]=1-2*(s+i);t.m[6]=2*(l+u);t.m[7]=0;t.m[8]=2*(o+h);t.m[9]=2*(l-u);t.m[10]=1-2*(r+i);t.m[11]=0;t.m[12]=0;t.m[13]=0;t.m[14]=0;t.m[15]=1};t.prototype.quaternionMultiplication=function(e,t,i){var r=e.x*t.w+e.y*t.z-e.z*t.y+e.w*t.x;var s=-e.x*t.z+e.y*t.w+e.z*t.x+e.w*t.y;var a=e.x*t.y-e.y*t.x+e.z*t.w+e.w*t.z;var n=-e.x*t.x-e.y*t.y-e.z*t.z+e.w*t.w;i.x=r;i.y=s;i.z=a;i.w=n};t.prototype.anOrthogonalMatrixMovingABtoCD=function(e,t,i,r,s,a){if(a===void 0){a=false}if(a){this.copA.copyFrom(e);this.copB.copyFrom(t);this.copC.copyFrom(i);this.copD.copyFrom(r)}else{this.orthonormalizeKeepingFirstDirection(e,t,this.copA,this.copB);this.orthonormalizeKeepingFirstDirection(i,r,this.copC,this.copD)}this.cross(this.copA,this.copB,this.oor1);this.matrixFromLines(this.copA,this.copB,this.oor1,this.matt1);this.cross(this.copC,this.copD,this.oor2);this.matrixFromLines(this.copC,this.copD,this.oor2,this.matt2);this.transpose(this.matt1,this.matt1);this.multiplyMatMat(this.matt1,this.matt2,s)};t.prototype.aQuaternionMovingABtoCD=function(e,t,i,r,s,a){if(a===void 0){a=false}this.anOrthogonalMatrixMovingABtoCD(e,t,i,r,this.matBefore,a);this.matrixToQuaternion(this.matBefore,s)};t.prototype.slerp=function(e,t,i,r){var s;var a;var n=i;var o=e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w;var h=false;if(o<0){h=true;o=-o}if(o>.999999){a=1-n;s=h?-n:n}else{var l=Math.acos(o);var u=1/Math.sin(l);a=Math.sin((1-n)*l)*u;s=h?-Math.sin(n*l)*u:Math.sin(n*l)*u}r.x=a*e.x+s*t.x;r.y=a*e.y+s*t.y;r.z=a*e.z+s*t.z;r.w=a*e.w+s*t.w};t.prototype.matrixFromLines=function(e,t,i,r){r.m[0]=e.x;r.m[1]=e.y;r.m[2]=e.z;r.m[3]=0;r.m[4]=t.x;r.m[5]=t.y;r.m[6]=t.z;r.m[7]=0;r.m[8]=i.x;r.m[9]=i.y;r.m[10]=i.z;r.m[11]=0;r.m[12]=0;r.m[13]=0;r.m[14]=0;r.m[15]=1};t.prototype.angleBetweenTwoVectorsBetween0andPi=function(t,i){if(e.geo.xyzAlmostZero(t)||e.geo.xyzAlmostZero(i)){throw"be aware: you compute angle between two vectors, one of them being almost zero"}this.normalize(t,this.v1nor);this.normalize(i,this.v2nor);var r=this.dot(this.v1nor,this.v2nor);if(r>1)return 0;if(r<-1)return Math.PI;else return Math.acos(r)};t.prototype.almostParallel=function(e,t,i,r){if(i===void 0){i=true}if(r===void 0){r=.001}var s=this.angleBetweenTwoVectorsBetween0andPi(e,t);if(s<r)return true;if(i&&Math.PI-s<r)return true;return false};t.prototype.angleBetweenTwoVectorsBetweenMinusPiAndPi=function(t,i,r){var s=this.angleBetweenTwoVectorsBetween0andPi(t,i);e.geo.cross(t,i,this._aCros);var a=e.geo.dot(r,this._aCros)<0?-1:1;return a*s};t.prototype.slerpTwoOrthogonalVectors=function(t,i,r,s,a,n,o){this.cross(t,i,this._c0);this.cross(r,s,this._c1);this.matrixFromLines(t,i,this._c0,this._mat0);this.matrixFromLines(r,s,this._c1,this._mat1);this.matrixToQuaternion(this._mat0,this._quat0);this.matrixToQuaternion(this._mat1,this._quat1);this.slerp(this._quat0,this._quat1,a,this._quatAlpha);this.quaternionToMatrix(this._quatAlpha,this._matAlpha);e.geo.copyXyzFromFloat(this._matAlpha.m[0],this._matAlpha.m[1],this._matAlpha.m[2],n);e.geo.copyXyzFromFloat(this._matAlpha.m[4],this._matAlpha.m[5],this._matAlpha.m[7],o)};t.prototype.interpolateTwoVectors=function(e,t,i,r){r.x=e.x*(1-i)+t.x*i;r.y=e.y*(1-i)+t.y*i;r.z=e.z*(1-i)+t.z*i};t.prototype.scale=function(e,t,i){i.x=e.x*t;i.y=e.y*t;i.z=e.z*t};t.prototype.add=function(e,t,i){i.x=e.x+t.x;i.y=e.y+t.y;i.z=e.z+t.z};t.prototype.substract=function(e,t,i){i.x=e.x-t.x;i.y=e.y-t.y;i.z=e.z-t.z};t.prototype.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z};t.prototype.norme=function(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)};t.prototype.squareNorme=function(e){return e.x*e.x+e.y*e.y+e.z*e.z};t.prototype.cross=function(t,i,r){this._crossResult.x=t.y*i.z-t.z*i.y;this._crossResult.y=t.z*i.x-t.x*i.z;this._crossResult.z=t.x*i.y-t.y*i.x;e.geo.copyXYZ(this._crossResult,r)};t.prototype.orthonormalizeKeepingFirstDirection=function(t,i,r,s){this.normalize(t,this._result1);e.geo.copyXYZ(t,this.v1forSubstraction);this.scale(this.v1forSubstraction,this.dot(t,i),this.v1forSubstraction);this.substract(i,this.v1forSubstraction,this._result2);if(this.squareNorme(this._result2)<e.geo.epsilon*e.geo.epsilon){e.geo.copyXyzFromFloat(Math.random(),Math.random(),Math.random(),this.randV2);e.logger.c("beware: you try to orthonormalize two co-linear vectors");return this.orthonormalizeKeepingFirstDirection(t,this.randV2,r,s)}this.normalize(this._result2,this._result2);e.geo.copyXYZ(this._result1,r);e.geo.copyXYZ(this._result2,s)};t.prototype.getOneOrthonormal=function(t,i){if(Math.abs(t.x)+Math.abs(t.y)>1e-4)i.copyFromFloats(-t.y,t.x,0);else i.copyFromFloats(0,-t.z,t.y);e.geo.normalize(i,i)};t.prototype.normalize=function(t,i){var r=this.norme(t);if(r<e.geo.epsilon)throw"one can not normalize a the almost zero vector:"+t;this.scale(t,1/r,i)};t.prototype.intersectionBetweenRayAndSphereFromRef=function(t,i,r,s,a,n){e.geo.copyXYZ(t,this.spheCentToRayOri);this.substract(this.spheCentToRayOri,s,this.spheCentToRayOri);var o=this.squareNorme(i);var h=2*this.dot(i,this.spheCentToRayOri);var l=this.squareNorme(this.spheCentToRayOri)-r*r;var u=h*h-4*o*l;if(u<0){return false}else{var c=(-h+Math.sqrt(u))/2/o;var m=(-h-Math.sqrt(u))/2/o;e.geo.copyXYZ(i,this._resultInters);this.scale(this._resultInters,c,this._resultInters);this.add(this._resultInters,t,this._resultInters);e.geo.copyXYZ(this._resultInters,a);e.geo.copyXYZ(i,this._resultInters);this.scale(this._resultInters,m,this._resultInters);this.add(this._resultInters,t,this._resultInters);e.geo.copyXYZ(this._resultInters,n);return true}};t.prototype.distance=function(e,t){this.copyXYZ(e,this.difference);this.substract(this.difference,t,this.difference);return this.norme(this.difference)};t.prototype.squaredDistance=function(e,t){this.copyXYZ(e,this.difference);this.substract(this.difference,t,this.difference);return this.squareNorme(this.difference)};t.prototype.closerOf=function(e,t,i,r){var s=this.distance(e,i);var a=this.distance(t,i);if(s<a)this.copyXYZ(e,r);else this.copyXYZ(t,r);return s<a?s:a};t.prototype.LookAtLH=function(t,i,r,s){this.substract(i,t,this._zAxis);this.normalize(this._zAxis,this._zAxis);this.cross(r,this._zAxis,this._xAxis);if(e.geo.xyzAlmostZero(this._xAxis)){this._xAxis.x=1}else{this._xAxis.normalize()}this.cross(this._zAxis,this._xAxis,this._yAxis);this._yAxis.normalize();var a=-this.dot(this._xAxis,t);var n=-this.dot(this._yAxis,t);var o=-this.dot(this._zAxis,t);this.numbersToMM(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,a,n,o,1,s)};t.prototype.OrthoOffCenterLH=function(e,t,i,r,s,a,n){n.m[0]=2/(t-e);n.m[1]=n.m[2]=n.m[3]=0;n.m[5]=2/(r-i);n.m[4]=n.m[6]=n.m[7]=0;n.m[10]=-1/(s-a);n.m[8]=n.m[9]=n.m[11]=0;n.m[12]=(e+t)/(e-t);n.m[13]=(r+i)/(i-r);n.m[14]=s/(s-a);n.m[15]=1};t.prototype.PerspectiveFovLH=function(e,t,i,r,s){var a=1/Math.tan(e*.5);var n=true;if(n){s.m[0]=a/t}else{s.m[0]=a}s.m[1]=s.m[2]=s.m[3]=0;if(n){s.m[5]=a}else{s.m[5]=a*t}s.m[4]=s.m[6]=s.m[7]=0;s.m[8]=s.m[9]=0;s.m[10]=-r/(i-r);s.m[11]=1;s.m[12]=s.m[13]=s.m[15]=0;s.m[14]=i*r/(i-r)};t.prototype.numbersToMM=function(e,t,i,r,s,a,n,o,h,l,u,c,m,d,f,p,v){v.m[0]=e;v.m[1]=t;v.m[2]=i;v.m[3]=r;v.m[4]=s;v.m[5]=a;v.m[6]=n;v.m[7]=o;v.m[8]=h;v.m[9]=l;v.m[10]=u;v.m[11]=c;v.m[12]=m;v.m[13]=d;v.m[14]=f;v.m[15]=p};t.prototype.newHermite=function(t,i,r,s,a){var n=a*a;var o=a*n;var h=2*o-3*n+1;var l=-2*o+3*n;var u=o-2*n+a;var c=o-n;var m=t.x*h+r.x*l+i.x*u+s.x*c;var d=t.y*h+r.y*l+i.y*u+s.y*c;var f=t.z*h+r.z*l+i.z*u+s.z*c;return new e.XYZ(m,d,f)};t.prototype.hermiteSpline=function(t,i,r,s,a,n){e.tab.clearArray(n);var o=1/a;for(var h=0;h<a;h++){n.push(this.newHermite(t,i,r,s,h*o))}};t.prototype.quadraticBezier=function(t,i,r,s,a){e.tab.clearArray(a);s=s>2?s:3;var n=function(e,t,i,r){var s=(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*r;return s};for(var o=0;o<s;o++){a.push(new e.XYZ(n(o/s,t.x,i.x,r.x),n(o/s,t.y,i.y,r.y),n(o/s,t.z,i.z,r.z)))}};t.prototype.cubicBezier=function(t,i,r,s,a,n){e.tab.clearArray(n);a=a>3?a:4;var o=function(e,t,i,r,s){var a=(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*r+e*e*e*s;return a};for(var h=0;h<a;h++){n.push(new e.XYZ(o(h/a,t.x,i.x,r.x,s.x),o(h/a,t.y,i.y,r.y,s.y),o(h/a,t.z,i.z,r.z,s.z)))}};t.prototype.affineTransformGenerator=function(t,i,r,s){var a=e.XYZ.newFrom(i).substract(t);var n=e.XYZ.newFrom(s).substract(r);if(a.x==0&&n.x!=0)throw"impossible affine transform from a rectangle to a pavé";if(a.y==0&&n.y!=0)throw"impossible affine transform from a rectangle to a pavé";if(a.z==0&&n.z!=0)throw"impossible affine transform from a rectangle to a pavé";var o=0;if(a.x==0)o++;if(a.y==0)o++;if(a.z==0)o++;if(o>=2)throw"intrance pavé is too degenerated";var h=new e.XYZ(a.x==0?1:1/a.x,a.y==0?1:1/a.y,a.z==0?1:1/a.z);var l=function(e,i){i.copyFrom(e).substract(t).multiply(h).multiply(n).add(r)};return l};return t}();e.Geo=t;var i;(function(t){var i=function(){function t(t,i,r){this.nbDistinctPoint=1e3;this.maxDistToBeClose=null;this.deformationFunction=function(e){return e};this.mins=new e.XYZ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.maxs=new e.XYZ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);this.nbDistinctPoint=r;this.recepteurList=t;if(i==null||t==i){this.sourceList=t;this.sourceEqualRecepter=true}else{this.sourceList=i;this.sourceEqualRecepter=false}}t.prototype.go=function(){this.buildScaler();var t=new e.XYZ(Math.max(1,this.maxs.x-this.mins.x),Math.max(1,this.maxs.y-this.mins.y),Math.max(1,this.maxs.z-this.mins.z));var i={};for(var r=0;r<this.recepteurList.length;r++){var s=this.deformationFunction(this.recepteurList[r]);var a=Math.round((s.x-this.mins.x)/t.x*this.nbDistinctPoint);var n=Math.round((s.y-this.mins.y)/t.y*this.nbDistinctPoint);var o=Math.round((s.z-this.mins.z)/t.z*this.nbDistinctPoint);var h=a+","+n+","+o;if(i[h]==null)i[h]=r;else if(!this.sourceEqualRecepter)e.logger.c("strange: the recepterList has several XYZ very close. This is, in general, only possible, when recepter equal source")}var l={};for(var r=0;r<this.sourceList.length;r++){var s=this.deformationFunction(this.sourceList[r]);var a=Math.round((s.x-this.mins.x)/t.x*this.nbDistinctPoint);var n=Math.round((s.y-this.mins.y)/t.y*this.nbDistinctPoint);var o=Math.round((s.z-this.mins.z)/t.z*this.nbDistinctPoint);var u=i[a+","+n+","+o];if(u!=null){if(this.sourceEqualRecepter){if(u!=r)l[r]=u}else l[r]=u}}return l};t.prototype.buildScaler=function(){var t=this;this.recepteurList.forEach(function(e){var i=t.deformationFunction(e);if(i.x<t.mins.x)t.mins.x=i.x;if(i.y<t.mins.y)t.mins.y=i.y;if(i.z<t.mins.z)t.mins.z=i.z;if(i.x>t.maxs.x)t.maxs.x=i.x;if(i.y>t.maxs.y)t.maxs.y=i.y;if(i.z>t.maxs.z)t.maxs.z=i.z});if(!this.sourceEqualRecepter){this.sourceList.forEach(function(e){var i=t.deformationFunction(e);if(i.x<t.mins.x)t.mins.x=i.x;if(i.y<t.mins.y)t.mins.y=i.y;if(i.z<t.mins.z)t.mins.z=i.z;if(i.x>t.maxs.x)t.maxs.x=i.x;if(i.y>t.maxs.y)t.maxs.y=i.y;if(i.z>t.maxs.z)t.maxs.z=i.z})}if(this.maxDistToBeClose!=null){this.nbDistinctPoint=e.geo.distance(this.maxs,this.mins)/this.maxDistToBeClose}};return t}();t.CloseXYZfinder=i;var r=function(){function t(e){this.options=new a;this.hermite=new Array;this.points=e}t.prototype.checkArgs=function(){if(this.points==null||this.points.length<2)throw"too few points"};t.prototype.go=function(){var t=this;var i=new Array;if(this.points.length==2){i=[];for(var r=0;r<this.options.nbSubdivisions+1;r++){var a=new e.XYZ(0,0,0);e.geo.between(this.points[0],this.points[1],r/this.options.nbSubdivisions,a);i.push(a)}if(this.options.loopLine)i.push(e.XYZ.newFrom(this.points[0]))}else if(this.options.interpolationStyle==s.none){i=[];this.points.forEach(function(t){return i.push(e.XYZ.newFrom(t))});if(this.options.loopLine)i.push(e.XYZ.newFrom(this.points[0]))}else if(this.options.interpolationStyle==s.hermite){var n=e.XYZ.newZero();var o=e.XYZ.newZero();var h=function(r,s,a,h){e.geo.substract(s,r,n);e.geo.substract(h,a,o);n.scale(t.options.ratioTan);o.scale(t.options.ratioTan);e.geo.hermiteSpline(s,n,a,o,t.options.nbSubdivisions,t.hermite);t.hermite.forEach(function(e){i.push(e)})};var l=this.points.length-1;if(!this.options.loopLine)h(this.points[0],this.points[0],this.points[1],this.points[2]);else{h(this.points[l],this.points[0],this.points[1],this.points[2])}for(var r=1;r<this.points.length-2;r++){h(this.points[r-1],this.points[r],this.points[r+1],this.points[r+2])}if(!this.options.loopLine){h(this.points[l-2],this.points[l-1],this.points[l],this.points[l]);i.push(this.points[l])}else{h(this.points[l-2],this.points[l-1],this.points[l],this.points[0]);h(this.points[l-1],this.points[l],this.points[0],this.points[1]);i.push(this.points[0])}}else if(this.options.interpolationStyle==s.octavioStyle){if(this.points.length==2)return[e.XYZ.newFrom(this.points[0]),e.XYZ.newFrom(this.points[1])];var l=this.points.length-1;var u=e.XYZ.newZero();var c=e.XYZ.newZero();var h=function(r,s,a){e.geo.between(r,s,.5,u);e.geo.between(s,a,.5,c);e.geo.quadraticBezier(u,s,c,t.options.nbSubdivisions,t.hermite);t.hermite.forEach(function(e){i.push(e)})};if(!this.options.loopLine){var m=e.XYZ.newFrom(this.points[0]);i.push(m)}else{h(this.points[l],this.points[0],this.points[1])}for(var r=1;r<this.points.length-1;r++){h(this.points[r-1],this.points[r],this.points[r+1])}if(!this.options.loopLine){var d=e.XYZ.newFrom(this.points[l]);i.push(d)}else{h(this.points[l-1],this.points[l],this.points[0]);var f=e.XYZ.newZero();e.geo.between(this.points[l],this.points[0],.5,f);i.push(f)}}else throw"line interporler style unknown";return i};return t}();t.LineInterpoler=r;(function(e){e[e["hermite"]=0]="hermite";e[e["octavioStyle"]=1]="octavioStyle";e[e["none"]=2]="none"})(t.InterpolationStyle||(t.InterpolationStyle={}));var s=t.InterpolationStyle;var a=function(){function e(){this.loopLine=false;this.interpolationStyle=s.octavioStyle;this.nbSubdivisions=10;this.ratioTan=.5}return e}();t.InterpolationOption=a})(i=e.geometry||(e.geometry={}))})(mathis||(mathis={}));var mathis;(function(e){var t=function(){function e(e,t){this.a=e<t?e:t;this.b=e<t?t:e}return e}();var i;(function(t){function i(t,i){var r=[];var s=[];var a=t;var o=new e.HashMap;for(var h=0,l=t;h<l.length;h++){var u=l[h];r.push(u);o.putValue(u,true)}while(a.length>0){s=n(a);a=[];for(var c=0,m=s;c<m.length;c++){var u=m[c];if(!o.getValue(u)){if(i==null||i.getValue(u)){a.push(u);r.push(u)}o.putValue(u,true)}}}return r}t.getGroup=i;var r=function(){function t(t){this.OUT_distances_dico=new e.HashMap;this.centralCells=t}t.prototype.OUT_distance=function(e){return this.OUT_distances_dico.getValue(e)};t.prototype.OUT_allGeodesics=function(t,i){if(i===void 0){i=false}var r=[];var s=[t];var a=new e.HashMap;var o=this.OUT_distances_dico.getValue(t);while(s.length>0){r.push(s);o--;s=n(s,a);var h=[];for(var l=0,u=s;l<u.length;l++){var c=u[l];if(this.OUT_distances_dico.getValue(c)==o){h.push(c);if(i)break}}s=h}return r};t.prototype.go=function(){var t=new e.HashMap;if(this.centralCells==null||this.centralCells.length==0)throw"problème d argument";this.OUT_stratesAround=[];this.OUT_stratesAround.push(this.centralCells);var i=n(this.centralCells,t);while(i.length>0){this.OUT_stratesAround.push(i);i=n(i,t)}for(var r=0;r<this.OUT_stratesAround.length;r++){for(var s=0,a=this.OUT_stratesAround[r];s<a.length;s++){var o=a[s];this.OUT_distances_dico.putValue(o,r)}}};return t}();t.DistancesFromAGroup=r;var s=function(){function e(e){this.vertices=e;this.nbTimeOfNonEvolutionToStop=2;this.lookNonEvolutionWithDistanceVersusWithGroups=true;this.consecutiveExtremetDistances=[];this.OUT_nbIteration=0;this.OUT_twoChosenExtremeVertices=[]}e.prototype.go=function(){var e=[this.vertices[0]];var t=0;var i=[];var s;while(this.evolution()){this.OUT_nbIteration++;s=new r(e);s.go();t=s.OUT_stratesAround.length;var a=s.OUT_stratesAround[t-1][0];e=[a];this.consecutiveExtremetDistances.push(t);i.push(a)}this.OUT_twoChosenExtremeVertices=[i[this.OUT_nbIteration-1],i[this.OUT_nbIteration-2]];this.OUT_geodesicsBetweenChosenExtremeVertices=s.OUT_allGeodesics(i[this.OUT_nbIteration-1]);this.OUT_oneGeodesicBetweenChosenExtremeVertices=s.OUT_allGeodesics(i[this.OUT_nbIteration-1],true);return t-1};e.prototype.evolution=function(){if(this.lookNonEvolutionWithDistanceVersusWithGroups){var e=this.consecutiveExtremetDistances.length;if(e<this.nbTimeOfNonEvolutionToStop)return true;var t=this.consecutiveExtremetDistances[e-1];for(var i=1;i<this.nbTimeOfNonEvolutionToStop;i++){if(this.consecutiveExtremetDistances[e-1-i]!=t)return true}return false}else throw"TODO"};return e}();t.HeuristicDiameter=s;var a=function(){function t(t){this.OUT_allExtremeVertex=[];this.allCounters=new e.HashMap;this.allToTransmit=new e.HashMap;this.OUT_diameter=null;this.allVertices=t}t.prototype.OUT_distance=function(e,t){return this.allCounters.getValue(e).getValue(t)};t.prototype.OUT_allGeodesics=function(t,i,r){if(r===void 0){r=false}var s=[];var a=[t];var o=new e.HashMap;var h=this.allCounters.getValue(t).getValue(i);while(a.length>0){s.push(a);h--;a=n(a,o);var l=[];for(var u=0,c=a;u<c.length;u++){var m=c[u];if(this.allCounters.getValue(m).getValue(i)==h){l.push(m);if(r)break}}a=l}return s};t.prototype.go=function(){for(var t=0,i=this.allVertices;t<i.length;t++){var r=i[t];var s=new e.HashMap(true);s.putValue(r,0);this.allCounters.putValue(r,s);var a=new e.HashMap(true);a.putValue(r,0);this.allToTransmit.putValue(r,a)}var n=true;while(n){n=false;this.allFreshlyReceived=new e.HashMap;for(var o=0,h=this.allVertices;o<h.length;o++){var r=h[o];this.allFreshlyReceived.putValue(r,new e.HashMap(true))}for(var l=0,u=this.allVertices;l<u.length;l++){var r=u[l];var a=this.allToTransmit.getValue(r);for(var c=0,m=r.links;c<m.length;c++){var d=m[c];var f=this.allCounters.getValue(d.to);for(var p=0,v=a.allKeys();p<v.length;p++){var g=v[p];if(f.getValue(g)==null){n=true;f.putValue(g,a.getValue(g)+1);this.allFreshlyReceived.getValue(d.to).putValue(g,a.getValue(g)+1)}}}}this.allToTransmit=this.allFreshlyReceived;this.OUT_diameter=0;for(var w=0,y=this.allVertices;w<y.length;w++){var r=y[w];for(var b=0,T=this.allCounters.getValue(r).allEntries();b<T.length;b++){var M=T[b];if(M.value>this.OUT_diameter){this.OUT_diameter=M.value;this.OUT_aMaxCouple=[r,M.key];this.OUT_allExtremeVertex=[r]}if(M.value==this.OUT_diameter)this.OUT_allExtremeVertex.push(r)}}}};return t}();t.DistancesBetweenAllVertices=a;function n(t,i){if(i==null)i=new e.HashMap;var r=[];for(var s=0,a=t;s<a.length;s++){var n=a[s];i.putValue(n,true)}for(var o=0,h=t;o<h.length;o++){var n=h[o];for(var l=0,u=n.links;l<u.length;l++){var c=u[l];if(!i.getValue(c.to)){r.push(c.to)}i.putValue(c.to,true)}}return r}t.getEdge=n;function o(t,i,r){if(r===void 0){r=false}if(i==null)i=new e.HashMap;var s=n(t,i);var a=new e.HashMap;for(var o=0,h=s;o<h.length;o++){var l=h[o];a.putValue(l,true)}var u=s.concat(t);var c=n(u);for(var m=0,d=c;m<d.length;m++){var l=d[m];if(l.links.length<=4){var f=0;for(var p=0,v=l.links;p<v.length;p++){var g=v[p];if(a.getValue(g.to)!=null)f++}if(r&&f==2){s.push(l);i.putValue(l,true)}else if(f>=2){s.push(l);i.putValue(l,true)}}}return s}t.getEdgeConsideringAlsoDiagonalVoisin=o;function h(t){var i=new e.HashMap;if(t==null||t.length==0)throw"problème d argument";var r=[];r.push(t);var s=n(t,i);while(s.length>0){r.push(s);s=n(s,i)}return r}t.ringify=h;function l(e){if(e==null||e.length==0)throw"problème d argument";var t=[];t.push(e);var i=e;var r=o(i);while(r.length>0){t.push(r);i=i.concat(r);r=o(i)}return t}t.ringifyConsideringAlsoDiagonalVoisin=l})(i=e.graph||(e.graph={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(){this.IN_graphFamily=[];this.seedsList=null;this.seedComputedFromBarycentersVersusFromAllPossibleCells=true;this.barycenterDecay=new e.XYZ(2.34e-8,6.77e-10,9.87e-10);this.proximityCoefToGrate=[.7];this.proportionOfSeeds=[.1];this.asymmetriesForSeeds=null}t.prototype.checkArgs=function(){if(this.IN_graphFamily==null||this.IN_graphFamily.length<2)throw"SUB_grater works from 2 graphs"};t.prototype.suppressTooCloseVertex=function(e){var t=[];for(var i=0;i<e.length;i++){var r=this.proximityCoefToGrate[i%this.proximityCoefToGrate.length];t[i]=[];for(var s=0,a=e[i];s<a.length;s++){var n=a[s];var o=true;for(var h=0;h<e.length;h++){if(i!=h){o=!this.proximityMeasurer.isCloseToMe(n,e[h],r);if(!o)break}}if(o)t[i].push(n)}}return t};t.prototype.findSeeds=function(){var t=[];if(!this.seedComputedFromBarycentersVersusFromAllPossibleCells){t=this.suppressTooCloseVertex(this.IN_graphFamily)}else{for(var i=0;i<this.IN_graphFamily.length;i++){t[i]=[]}var r=[];for(var i=0;i<this.IN_graphFamily.length;i++){r[i]=new e.XYZ(0,0,0);for(var s=0,a=this.IN_graphFamily[i];s<a.length;s++){var n=a[s];r[i].add(n.position)}r[i].scale(1/this.IN_graphFamily[i].length);r[i].add(this.barycenterDecay)}var o=function(e,t){return t.distance-e.distance};for(var h=0;h<this.IN_graphFamily.length;h++){var l=new e.XYZ(0,0,0);for(var u=0;u<this.IN_graphFamily.length;u++)if(u!=h)l.add(r[u]);l.scale(1/(this.IN_graphFamily.length-1));var c=[];var m=new e.XYZ(0,0,0);for(var d=0,f=this.IN_graphFamily[h];d<f.length;d++){var n=f[d];m.copyFrom(n.position).substract(l);var p=e.geo.distance(n.position,l);if(this.asymmetriesForSeeds!=null&&this.asymmetriesForSeeds[h%this.asymmetriesForSeeds.length]!=null){var v=this.asymmetriesForSeeds[h%this.asymmetriesForSeeds.length];var g=e.geo.angleBetweenTwoVectorsBetween0andPi(m,v.direction);var w=Math.PI;if(v.modulo!=null){w=v.modulo;if(isNaN(w)||w<0||w>Math.PI)throw"modulo must be a number between 0 and PI, but is:"+w;g=e.modulo(g,w)}var y=1-g/w;p=p*(1-v.influence)+y*v.influence}c.push({vertex:n,distance:p})}c.sort(o);t[h]=[];var b=void 0;if(this.proportionOfSeeds[h%this.proportionOfSeeds.length]>0)b=c[0].distance*(1-this.proportionOfSeeds[h%this.proportionOfSeeds.length]);else b=c[0].distance*.99;var T=Number.MAX_VALUE;var i=0;while(T>=b&&i<c.length-1){t[h].push(c[i].vertex);i++;T=c[i].distance}}}t=this.suppressTooCloseVertex(t);for(var i=0;i<this.IN_graphFamily.length;i++)if(t[i].length==0)throw"an empty seeds, possible cause: 1/  two graphes are identical 2/ one of your graph is nearly includes into an other and you do not use the barycenter technique";return t};t.prototype.go=function(){this.checkArgs();if(this.proximityMeasurer==null)this.proximityMeasurer=new r;if(this.seedsList==null){this.seedsList=this.findSeeds();this.OUT_allSeeds=this.seedsList}var t=true;var i=[];for(var s=0;s<this.IN_graphFamily.length;s++){i[s]=[].concat(this.seedsList[s])}var a=new e.HashMap;while(t){t=false;for(var s=0;s<this.IN_graphFamily.length;s++){var n=this.proximityCoefToGrate[s%this.proximityCoefToGrate.length];var o=e.graph.getEdge(i[s],a);for(var h=0,l=o;h<l.length;h++){var u=l[h];var c=false;for(var m=0;m<this.IN_graphFamily.length;m++){if(s!=m&&this.proximityMeasurer.isCloseToMe(u,i[m],n)){c=true;break}}if(!c){i[s].push(u);t=true}}}}return i};return t}();t.GraphGrater=i;var r=function(){function t(){this.vertexToLinkLength=new e.HashMap}t.prototype.meanLinksDist=function(t){var i=this.vertexToLinkLength.getValue(t);if(i!=null)return i;var r=0;for(var s=0,a=t.links;s<a.length;s++){var n=a[s];r+=e.geo.distance(t.position,n.to.position)}r/=t.links.length;this.vertexToLinkLength.putValue(t,r);return r};t.prototype.isCloseToMe=function(e,t,i){for(var r=0,s=t;r<s.length;r++){var a=s[r];if(this.areClose(e,a,i))return true}return false};t.prototype.areClose=function(t,i,r){return e.geo.distance(t.position,i.position)<(this.meanLinksDist(t)+this.meanLinksDist(i))/2*r};t.prototype.areFar=function(t,i,r){return e.geo.distance(t.position,i.position)>(this.meanLinksDist(t)+this.meanLinksDist(i))/2*r};return t}();t.ProximityMeasurer=r;var s=function(){function t(e,t){this.verticesToKeepMustBeInMamesh=true;this.constructCutSegment=true;this.takeCareOfPolygons=true;this.addBorderPolygonInsteadOfSuppress=false;this.OUT_BorderPolygon=[];this.OUT_BorderVerticesInside=[];this.OUTBorderVerticesOutside=[];this.mamesh=e;this.verticesToKeep=t}t.prototype.go=function(){var t=this;var i=new e.Mamesh;this.verticesToKeep.forEach(function(e){if(t.mamesh.hasVertex(e)){i.addVertex(e)}else if(t.verticesToKeepMustBeInMamesh)throw'a vertex in the list to keep is not in the original mesh. If you want to allow this, please turn the boolean "verticesToKeepMustBeInMamesh" to false'});for(var r=0;r<this.mamesh.smallestSquares.length;r+=4){var s=0;if(i.hasVertex(this.mamesh.smallestSquares[r]))s++;if(i.hasVertex(this.mamesh.smallestSquares[r+1]))s++;if(i.hasVertex(this.mamesh.smallestSquares[r+2]))s++;if(i.hasVertex(this.mamesh.smallestSquares[r+3]))s++;if(s>0&&s<4)this.OUT_BorderPolygon.push([this.mamesh.smallestSquares[r],this.mamesh.smallestSquares[r+1],this.mamesh.smallestSquares[r+2],this.mamesh.smallestSquares[r+3]]);else if(s==4)i.smallestSquares.push(this.mamesh.smallestSquares[r],this.mamesh.smallestSquares[r+1],this.mamesh.smallestSquares[r+2],this.mamesh.smallestSquares[r+3])}for(var r=0;r<this.mamesh.smallestTriangles.length;r+=3){var s=0;if(i.hasVertex(this.mamesh.smallestTriangles[r]))s++;if(i.hasVertex(this.mamesh.smallestTriangles[r+1]))s++;if(i.hasVertex(this.mamesh.smallestTriangles[r+2]))s++;if(s>0&&s<3)this.OUT_BorderPolygon.push([this.mamesh.smallestTriangles[r],this.mamesh.smallestTriangles[r+1],this.mamesh.smallestTriangles[r+2]]);else if(s==3)i.smallestTriangles.push(this.mamesh.smallestTriangles[r],this.mamesh.smallestTriangles[r+1],this.mamesh.smallestTriangles[r+2])}for(var a=0,n=this.OUT_BorderPolygon;a<n.length;a++){var o=n[a];for(var h=0,l=o;h<l.length;h++){var u=l[h];if(i.hasVertex(u)){if(this.OUT_BorderVerticesInside.indexOf(u)==-1)this.OUT_BorderVerticesInside.push(u)}else{if(this.OUTBorderVerticesOutside.indexOf(u)==-1)this.OUTBorderVerticesOutside.push(u)}}}if(this.takeCareOfPolygons){if(this.addBorderPolygonInsteadOfSuppress){for(var c=0,m=this.OUT_BorderPolygon;c<m.length;c++){var o=m[c];if(o.length==3)i.smallestTriangles.push(o[0],o[1],o[2]);else if(o.length==4)i.smallestSquares.push(o[0],o[1],o[2],o[3])}for(var d=0,f=this.OUTBorderVerticesOutside;d<f.length;d++){var p=f[d];i.addVertex(p)}}else{var v=[];var g=[];for(var r=0;r<this.OUT_BorderVerticesInside.length;r++){var p=this.OUT_BorderVerticesInside[r];var w=false;for(var y=0,b=i.smallestSquares;y<b.length;y++){var u=b[y];if(u.hashNumber==p.hashNumber){w=true;break}}if(!w){for(var T=0,M=i.smallestTriangles;T<M.length;T++){var u=M[T];if(u.hashNumber==p.hashNumber){w=true;break}}}if(!w){g.push(i.vertices.indexOf(p));v.push(r)}}this.OUT_BorderVerticesInside=e.tab.arrayMinusSomeIndices(this.OUT_BorderVerticesInside,v);i.vertices=e.tab.arrayMinusSomeIndices(i.vertices,g)}}if(this.constructCutSegment){for(var C in this.mamesh.cutSegmentsDico){var S=this.mamesh.cutSegmentsDico[C];if(!i.hasVertex(S.a))continue;if(!i.hasVertex(S.b))continue;if(!i.hasVertex(S.middle))continue;i.cutSegmentsDico[C]=S}}return i};return t}();t.SubMameshExtractor=s;var a=function(){function i(e,t){this.markBorder=true;this.suppressFromBorderVersusCorner=true;this.mamesh=e;this.nb=t}i.prototype.go=function(){var i=[];if(this.suppressFromBorderVersusCorner){for(var r=0,s=this.mamesh.vertices;r<s.length;r++){var a=s[r];if(a.hasMark(e.Vertex.Markers.border))i.push(a)}}else{for(var n=0,o=this.mamesh.vertices;n<o.length;n++){var a=o[n];if(a.hasMark(e.Vertex.Markers.corner))i.push(a)}}var h=e.graph.ringify(i);var l=new e.HashMap;if(this.nb<0)this.nb=h.length+this.nb-1;if(this.nb>=h.length-1)throw"you want to suppress too much strates";for(var u=0;u<this.nb;u++){for(var c=0,m=h[u];c<m.length;c++){var d=m[c];l.putValue(d,true)}}var f=[];for(var p=0,v=this.mamesh.vertices;p<v.length;p++){var d=v[p];if(l.getValue(d)==null){f.push(d)}}if(this.markBorder)for(var g=0,w=h[this.nb];g<w.length;g++){var d=w[g];d.markers.push(e.Vertex.Markers.border)}var y=new t.SubMameshExtractor(this.mamesh,f);var b=y.go();return b};return i}();t.ExtractCentralPart=a;var n=function(){function t(e,t){this.receiver=e;this.source=t}t.prototype.checkArgs=function(){if(this.receiver.length%4!=0)throw"receiver is not a list representing squares";if(this.source.length%4!=0)throw"source is not a list representing squares"};t.prototype.go=function(){this.checkArgs();var t=new e.HashMap(true);var i=this.squareToBaryCenter(this.source);var r=this.squareToBaryCenter(this.receiver);for(var s=0;s<i.length;s++){var a=Number.MAX_VALUE;var n=-1;for(var o=0;o<r.length;o++){var h=e.geo.distance(i[s],r[o]);if(h<a){a=h;n=o}}var l=[this.receiver[4*n],this.receiver[4*n+1],this.receiver[4*n+2],this.receiver[4*n+3]];var u=[this.source[4*s],this.source[4*s+1],this.source[4*s+2],this.source[4*s+3]];var c=this.getBestPermutationOfReceiver(l,u);for(var m=0;m<4;m++){t.putValue(u[m],c[m])}}return t};t.prototype.getBestPermutationOfReceiver=function(t,i){var r=Number.MAX_VALUE;var s=-1;for(var a=0;a<4;a++){var n=[t[a],t[(a+1)%4],t[(a+2)%4],t[(a+3)%4]];var o=0;for(var h=0;h<4;h++)o+=e.geo.distance(i[h].position,n[h].position);if(o<r){r=o;s=a}}var l=s;return[t[l],t[(l+1)%4],t[(l+2)%4],t[(l+3)%4]]};t.prototype.squareToBaryCenter=function(t){var i=[];for(var r=0;r<t.length;r+=4){var s=[t[r].position,t[r+1].position,t[r+2].position,t[r+3].position];var a=new e.XYZ(0,0,0);e.geo.baryCenter(s,[1/4,1/4,1/4,1/4],a);i.push(a)}return i};return t}();var o=function(){function t(e,t){this.toleranceToBeOneOfTheClosest=.5;this.proximityCoef=.7;this.acceptOnlyDisjointReceiverAndSource=true;this.receiver=e;this.source=t}t.prototype.checkArgs=function(){if(this.acceptOnlyDisjointReceiverAndSource){var t=new e.HashMap;for(var i=0,r=this.source;i<r.length;i++){var s=r[i];t.putValue(s,true)}for(var a=0,n=this.receiver;a<n.length;a++){var s=n[a];if(t.getValue(s)!=null)throw"source and receiver must be disjoint"}}};t.prototype.go=function(){this.checkArgs();if(this.proximityMeasurer==null)this.proximityMeasurer=new r;this.checkArgs();var t=new e.HashMap(true);for(var i=0,s=this.source;i<s.length;i++){var a=s[i];var n=Number.POSITIVE_INFINITY;var o=new e.HashMap(true);var h=null;for(var l=0,u=this.receiver;l<u.length;l++){var c=u[l];var m=e.geo.distance(a.position,c.position);if(this.proximityMeasurer.areClose(a,c,this.proximityCoef)){o.putValue(c,m);if(m<n){n=m;h=c}}}if(h!=null){var d=[];d.push(h);for(var f=0,p=o.allKeys();f<p.length;f++){var c=p[f];if(c!=h&&o.getValue(c)<=n*(1+this.toleranceToBeOneOfTheClosest)){d.push(c)}}t.putValue(a,d)}}return t};return t}();t.FindSickingMapFromVertices=o;var h=function(){function r(){this.IN_mameshes=[];this.SUB_grater=new i;this.justGrateDoNotStick=false;this.proximityCoefToStick=[2];this.toleranceToBeOneOfTheClosest=.5;this.OUTBorderVerticesToStick=[];this.OUTGratedMameshes=[];this.takeCareOfPolygons=true;this.suppressLinksAngularlyTooClose=true;this.SUB_linkCleanerByAngle=new e.linkModule.LinksSorterAndCleanerByAngles(null,null);this.OUT_stickingMap=new e.HashMap(true);this.SUB_linkCleanerByAngle.suppressLinksAngularParam=2*Math.PI*.1}r.prototype.checkArgs=function(){};r.prototype.goChanging=function(){this.checkArgs();for(var i=0,r=this.IN_mameshes;i<r.length;i++){var s=r[i];for(var a=0,n=s.vertices;a<n.length;a++){var h=n[a];for(var l=0,u=h.links;l<u.length;l++){var m=u[l];m.opposites=null}}}var d=[];this.IN_mameshes.forEach(function(e){return d.push(e.vertices)});this.SUB_grater.IN_graphFamily=d;var f=this.SUB_grater.go();for(var p=0;p<this.IN_mameshes.length;p++){var v=new t.SubMameshExtractor(this.IN_mameshes[p],f[p]);v.takeCareOfPolygons=this.takeCareOfPolygons;v.addBorderPolygonInsteadOfSuppress=false;this.OUTGratedMameshes[p]=v.go();this.OUTBorderVerticesToStick[p]=[];for(var g=0,w=v.OUT_BorderVerticesInside;g<w.length;g++){var y=w[g];for(var b=0,T=y.links;b<T.length;b++){var M=T[b];if(this.IN_mameshes[p].hasVertex(M.to)&&!this.OUTGratedMameshes[p].hasVertex(M.to)){this.OUTBorderVerticesToStick[p].push(y);break}}}this.OUTGratedMameshes[p].isolateMameshVerticesFromExteriorVertices();for(var C=0,S=this.OUTGratedMameshes[p].vertices;C<S.length;C++){var x=S[C];if(x.hasMark(e.Vertex.Markers.border)&&this.OUTBorderVerticesToStick[p].indexOf(x)==-1)this.OUTBorderVerticesToStick[p].push(x)}}var F=this.OUTGratedMameshes[0];for(var V=1;V<this.IN_mameshes.length;V++){var k=new o(F.vertices,this.OUTBorderVerticesToStick[V]);k.toleranceToBeOneOfTheClosest=this.toleranceToBeOneOfTheClosest;k.proximityCoef=this.proximityCoefToStick[V%this.proximityCoefToStick.length];var O=k.go();this.OUT_stickingMap.extend(O);var A=new c(F,this.OUTGratedMameshes[V],O);A.zIndex1=V;A.cleanOppositeLinksAtBegin=false;A.createNewLinks=!this.justGrateDoNotStick;A.goChanging()}F.isolateMameshVerticesFromExteriorVertices();for(var P=0,L=F.vertices;P<L.length;P++){var h=L[P];if(h.links.length==0)throw" grating process produce a vertex with no links"}if(this.suppressLinksAngularlyTooClose){this.SUB_linkCleanerByAngle.mamesh=F;this.SUB_linkCleanerByAngle.goChanging()}return F};return r}();t.ConcurrentMameshesGraterAndSticker=h;var l=function(){function t(t,i){this.nbDistinctPoint=1e3;this.maxDistToBeClose=null;this.throwExceptionIfReceiverHaveCloseVertices=false;this.receiverAndSourceMustBeDisjoint=false;this.deformationFunction=function(e){return e};this.mins=new e.XYZ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.maxs=new e.XYZ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);this.receivers=t;this.sources=i}t.prototype.go=function(){this.buildScaler();var t=new e.XYZ(Math.max(1,this.maxs.x-this.mins.x),Math.max(1,this.maxs.y-this.mins.y),Math.max(1,this.maxs.z-this.mins.z));var i=new e.StringMap;for(var r=0,s=this.receivers;r<s.length;r++){var a=s[r];var n=this.deformationFunction(a.position);var o=Math.round((n.x-this.mins.x)/t.x*this.nbDistinctPoint);var h=Math.round((n.y-this.mins.y)/t.y*this.nbDistinctPoint);var l=Math.round((n.z-this.mins.z)/t.z*this.nbDistinctPoint);var u=o+","+h+","+l;if(i.getValue(u)==null)i.putValue(u,a);else if(this.throwExceptionIfReceiverHaveCloseVertices)throw"the receiver list has several XYZ very close, and you have forbidden that"}var c=new e.HashMap(true);for(var m=0,d=this.sources;m<d.length;m++){var f=d[m];var n=this.deformationFunction(f.position);var o=Math.round((n.x-this.mins.x)/t.x*this.nbDistinctPoint);var h=Math.round((n.y-this.mins.y)/t.y*this.nbDistinctPoint);var l=Math.round((n.z-this.mins.z)/t.z*this.nbDistinctPoint);var p=i.getValue(o+","+h+","+l);if(p!=null){if(p!=f){var v=c.getValue(p);if(v==null)c.putValue(f,[p]);else{if(e.geo.distance(p.position,f.position)<e.geo.distance(p.position,v[0].position)){c.putValue(f,[p].concat(v))}else v.push(p)}}else if(this.receiverAndSourceMustBeDisjoint)throw"receiver-list and source-list are not disjoint, and you have forbidden that"}}return c};t.prototype.buildScaler=function(){var t=this;this.receivers.forEach(function(e){var i=t.deformationFunction(e.position);if(i.x<t.mins.x)t.mins.x=i.x;if(i.y<t.mins.y)t.mins.y=i.y;if(i.z<t.mins.z)t.mins.z=i.z;if(i.x>t.maxs.x)t.maxs.x=i.x;if(i.y>t.maxs.y)t.maxs.y=i.y;if(i.z>t.maxs.z)t.maxs.z=i.z});this.sources.forEach(function(e){var i=t.deformationFunction(e.position);if(i.x<t.mins.x)t.mins.x=i.x;if(i.y<t.mins.y)t.mins.y=i.y;if(i.z<t.mins.z)t.mins.z=i.z;if(i.x>t.maxs.x)t.maxs.x=i.x;if(i.y>t.maxs.y)t.maxs.y=i.y;if(i.z>t.maxs.z)t.maxs.z=i.z});if(this.maxDistToBeClose!=null){this.nbDistinctPoint=e.geo.distance(this.maxs,this.mins)/this.maxDistToBeClose}};return t}();t.FindCloseVerticesFast=l;var u=function(){function t(t,i,r){this.sourceEqualRecepter=false;this.cleanDoubleLinks=false;this.cleanDoubleSquareAndTriangles=true;this.cleanLinksCrossingSegmentMiddle=true;this.suppressSomeTriangleAndSquareSuperposition=false;this.mergeLink=true;this.mergeTrianglesAndSquares=true;this.mergeSegmentsMiddle=true;this.destroySource=true;this.receiverMamesh=t;if(i==null||t==i){this.sourceMamesh=t;this.sourceEqualRecepter=true}else{this.sourceMamesh=i;this.sourceEqualRecepter=false}if(r==null)r=new l(this.receiverMamesh.vertices,this.sourceMamesh.vertices).go();this.merginMap=new e.HashMap(true);for(var s=0,a=r.allEntries();s<a.length;s++){var n=a[s];this.merginMap.putValue(n.key,n.value[0])}}t.prototype.checkArgs=function(){var e=this;if(!this.merginMap.memorizeKeys)throw"the merging map must memorize the keys";this.merginMap.allValues().forEach(function(t){if(e.merginMap.getValue(t)!=null)throw"a vertex cannot be the destination and the source of a merging"})};t.prototype.goChanging=function(){this.checkArgs();if(this.mergeLink)this.mergeVerticesAndLinks();else this.mergeOnlyVertices();if(this.mergeTrianglesAndSquares)this.letsMergeTrianglesAndSquares();if(this.mergeSegmentsMiddle)this.mergeCutSegment();this.receiverMamesh.lines=null;if(this.destroySource&&!this.sourceEqualRecepter)this.sourceMamesh.vertices=null};t.prototype.mergeOnlyVertices=function(){var t=this;if(!this.sourceEqualRecepter)this.receiverMamesh.vertices=this.receiverMamesh.vertices.concat(this.sourceMamesh.vertices);this.receiverMamesh.clearLinksAndLines();this.merginMap.allKeys().forEach(function(i){e.tab.removeFromArray(t.receiverMamesh.vertices,i)})};t.prototype.mergeVerticesAndLinks=function(){var t=this;if(!this.sourceEqualRecepter)this.receiverMamesh.vertices=this.receiverMamesh.vertices.concat(this.sourceMamesh.vertices);this.receiverMamesh.clearOppositeInLinks();this.merginMap.allKeys().forEach(function(e){var i=[];e.links.forEach(function(r){if(t.merginMap.getValue(r.to)==null){if(t.merginMap.getValue(e)!=r.to)i.push(r)}});t.merginMap.getValue(e).links=t.merginMap.getValue(e).links.concat(i)});var i=[];this.receiverMamesh.vertices.forEach(function(e){if(t.merginMap.allKeys().indexOf(e)==-1)i.push(e)});this.receiverMamesh.vertices=i;this.receiverMamesh.vertices.forEach(function(i){var r=null;i.links.forEach(function(e){if(t.merginMap.getValue(e.to)!=null){if(t.merginMap.getValue(e.to)!=i)e.to=t.merginMap.getValue(e.to);else{if(r==null)r=[];r.push(e)}}});if(r!=null){r.forEach(function(t){e.tab.removeFromArray(i.links,t)})}});if(this.cleanDoubleLinks){}};t.prototype.mergeCutSegment=function(){var t=this;if(!this.sourceEqualRecepter){for(var i in this.sourceMamesh.cutSegmentsDico)this.receiverMamesh.cutSegmentsDico[i]=this.sourceMamesh.cutSegmentsDico[i]}for(var i in this.receiverMamesh.cutSegmentsDico){var r=this.receiverMamesh.cutSegmentsDico[i];if(r.a.hashNumber==r.middle.hashNumber||r.b.hashNumber==r.middle.hashNumber||r.a.hashNumber==r.b.hashNumber){delete this.receiverMamesh.cutSegmentsDico[i];continue}var s=false;if(this.merginMap.getValue(r.a)!=null){r.a=this.merginMap.getValue(r.a);s=true}if(this.merginMap.getValue(r.b)!=null){r.b=this.merginMap.getValue(r.b);s=true}if(this.merginMap.getValue(r.middle)!=null){r.middle=this.merginMap.getValue(r.middle);s=true}if(s){delete this.receiverMamesh.cutSegmentsDico[i];this.receiverMamesh.cutSegmentsDico[e.Segment.segmentId(r.a.hashNumber,r.b.hashNumber)]=r}}if(this.cleanLinksCrossingSegmentMiddle){this.receiverMamesh.vertices.forEach(function(i){var r=[];for(var s=0;s<i.links.length;s++){var a=i.links[s];if(t.receiverMamesh.cutSegmentsDico[e.Segment.segmentId(i.hashNumber,a.to.hashNumber)]!=null)r.push(s)}i.links=e.tab.arrayMinusBlocksIndices(i.links,r,1)})}};t.prototype.letsMergeTrianglesAndSquares=function(){if(!this.sourceEqualRecepter){this.receiverMamesh.smallestSquares=this.receiverMamesh.smallestSquares.concat(this.sourceMamesh.smallestSquares);this.receiverMamesh.smallestTriangles=this.receiverMamesh.smallestTriangles.concat(this.sourceMamesh.smallestTriangles)}for(var t=0;t<this.receiverMamesh.smallestTriangles.length;t++){var i=this.receiverMamesh.smallestTriangles[t];if(this.merginMap.getValue(i)!=null)this.receiverMamesh.smallestTriangles[t]=this.merginMap.getValue(i)}var r=[];for(var t=0;t<this.receiverMamesh.smallestTriangles.length;t+=3){if(this.receiverMamesh.smallestTriangles[t]==this.receiverMamesh.smallestTriangles[t+1]||this.receiverMamesh.smallestTriangles[t+1]==this.receiverMamesh.smallestTriangles[t+2]||this.receiverMamesh.smallestTriangles[t+2]==this.receiverMamesh.smallestTriangles[t]){r.push(t)}}this.receiverMamesh.smallestTriangles=e.tab.arrayMinusBlocksIndices(this.receiverMamesh.smallestTriangles,r,3);this.receiverMamesh.smallestTriangles=new e.tab.ArrayMinusBlocksElements(this.receiverMamesh.smallestTriangles,3).go();for(var t=0;t<this.receiverMamesh.smallestSquares.length;t++){var i=this.receiverMamesh.smallestSquares[t];if(this.merginMap.getValue(i)!=null)this.receiverMamesh.smallestSquares[t]=this.merginMap.getValue(i)}var s=[];for(var t=0;t<this.receiverMamesh.smallestSquares.length;t+=4){var a=this.changeOneSquare([this.receiverMamesh.smallestSquares[t],this.receiverMamesh.smallestSquares[t+1],this.receiverMamesh.smallestSquares[t+2],this.receiverMamesh.smallestSquares[t+3]]);if(a==null){s.push(t)}else if(a.length==3){this.receiverMamesh.smallestTriangles.push(a[0],a[1],a[2]);s.push(t)}}this.receiverMamesh.smallestSquares=e.tab.arrayMinusBlocksIndices(this.receiverMamesh.smallestSquares,s,4);if(this.cleanDoubleSquareAndTriangles)this.receiverMamesh.smallestSquares=new e.tab.ArrayMinusBlocksElements(this.receiverMamesh.smallestSquares,4).go();if(this.suppressSomeTriangleAndSquareSuperposition){var n=new e.StringMap;for(var t=0;t<this.receiverMamesh.smallestSquares.length;t+=4){n.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[t].hashNumber,this.receiverMamesh.smallestSquares[t+1].hashNumber,this.receiverMamesh.smallestSquares[t+2].hashNumber]),true);n.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[t+2].hashNumber,this.receiverMamesh.smallestSquares[t+3].hashNumber,this.receiverMamesh.smallestSquares[t].hashNumber]),true);n.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[t].hashNumber,this.receiverMamesh.smallestSquares[t+1].hashNumber,this.receiverMamesh.smallestSquares[t+3].hashNumber]),true);n.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[t+1].hashNumber,this.receiverMamesh.smallestSquares[t+2].hashNumber,this.receiverMamesh.smallestSquares[t+3].hashNumber]),true)}var o=[];for(var t=0;t<this.receiverMamesh.smallestTriangles.length;t+=3){var h=e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestTriangles[t].hashNumber,this.receiverMamesh.smallestTriangles[t+1].hashNumber,this.receiverMamesh.smallestTriangles[t+2].hashNumber]);if(n.getValue(h)){o.push(t,t+1,t+2)}}this.receiverMamesh.smallestTriangles=e.tab.arrayMinusBlocksIndices(this.receiverMamesh.smallestTriangles,o,3);var l=new e.StringMap;for(var t=0;t<this.receiverMamesh.smallestSquares.length;t+=4){l.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[t].hashNumber,this.receiverMamesh.smallestSquares[t+2].hashNumber]),true);l.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[t+1].hashNumber,this.receiverMamesh.smallestSquares[t+3].hashNumber]),true)}var u=[];var c=[];for(var t=0;t<this.receiverMamesh.smallestSquares.length;t+=4){for(var m=0;m<4;m++){var d=[this.receiverMamesh.smallestSquares[t+m].hashNumber,this.receiverMamesh.smallestSquares[t+(m+1)%4].hashNumber];var f=[this.receiverMamesh.smallestSquares[t+(m+1)%4].hashNumber,this.receiverMamesh.smallestSquares[t+(m+2)%4].hashNumber];if(l.getValue(e.tab.indicesUpPermutationToString(d))&&l.getValue(e.tab.indicesUpPermutationToString(f))){u.push(t,t+1,t+2,t+3);c.push(this.receiverMamesh.smallestSquares[t+(m+2)%4],this.receiverMamesh.smallestSquares[t+(m+3)%4],this.receiverMamesh.smallestSquares[t+m%4])}}}if(c.length>0){this.receiverMamesh.smallestSquares=e.tab.arrayMinusBlocksIndices(this.receiverMamesh.smallestSquares,u,4);this.receiverMamesh.smallestTriangles=this.receiverMamesh.smallestTriangles.concat(c)}}};t.prototype.changeOneSquare=function(e){if(e[0]==e[2]||e[1]==e[3])return null;var t=null;var i=0;for(var r=0;r<4;r++){if(e[r]==e[(r+1)%4]){i++;t=r}}if(i==0)return e;if(i>1)return null;if(t==0)return[e[1],e[2],e[3]];if(t==1)return[e[2],e[3],e[0]];if(t==2)return[e[3],e[0],e[1]];if(t==3)return[e[0],e[1],e[2]]};return t}();t.Merger=u;var c=function(){function e(e,t,i){this.createNewLinks=true;this.cleanOppositeLinksAtBegin=true;this.twoMameshes=true;this.zIndex1=Math.random();if(e==t||t==null)this.twoMameshes=false;this.mamesh0=e;if(this.twoMameshes)this.mamesh1=t;else this.mamesh1=null;this.stickingMap=i}e.prototype.checkArgs=function(){if(!this.stickingMap.memorizeKeys)throw"the sticking map must memorize the keys";for(var e=0,t=this.stickingMap.allValues();e<t.length;e++){var i=t[e];for(var r=0,s=i;r<s.length;r++){var a=s[r];if(this.stickingMap.getValue(a)!=null)throw"a vertex cannot be the destination and the source of a sticking"}}};e.prototype.goChanging=function(){if(this.stickingMap.allKeys().length==0)return;this.checkArgs();if(this.cleanOppositeLinksAtBegin){this.mamesh0.clearOppositeInLinks();if(this.twoMameshes)this.mamesh1.clearOppositeInLinks()}if(this.twoMameshes){for(var e=0,t=this.mamesh1.vertices;e<t.length;e++){var i=t[e];i.param.z=this.zIndex1;this.mamesh0.addVertex(i)}this.mamesh0.smallestSquares=this.mamesh0.smallestSquares.concat(this.mamesh1.smallestSquares);this.mamesh0.smallestTriangles=this.mamesh0.smallestTriangles.concat(this.mamesh1.smallestTriangles)}this.mamesh0.cutSegmentsDico={};this.mamesh0.vertexToPositioning=null;this.mamesh0.lines=null;if(this.createNewLinks){for(var r=0,s=this.stickingMap.allKeys();r<s.length;r++){var a=s[r];for(var n=0,o=this.stickingMap.getValue(a);n<o.length;n++){var h=o[n];a.setOneLink(h);h.setOneLink(a)}}}};return e}();t.Sticker=c})(t=e.grateAndGlue||(e.grateAndGlue={}))})(mathis||(mathis={}));var mathis;(function(e){function t(t,i){var r=[];var s=e.roundWithGivenPrecision(100/t,2)+"%";for(var a=0;a<t;a++){var n=document.createElement("canvas");n.id="renderCanvas"+a;n.style.width=s;n.style.height="100%";n.style.backgroundColor="red";i.appendChild(n);r.push(n)}return r}e.nCanvasInOneLine=t;function i(t,i,r){var s=[];i.style.position="relative";var a=e.roundWithGivenPrecision(100/t,4);for(var n=0;n<t;n++){var o=document.createElement("div");o.id="divContainer"+n;o.style.display="inline-block";o.style.position="absolute";o.style.top="0";o.style.left=n*a+"%";o.style.width=a+"%";o.style.height="100%";if(r!=null&&n>0)o.style.borderLeft=r;i.appendChild(o);s.push(o)}return s}e.nDivInOneLine=i;function r(t,i,r){var s=[];var a=[];i.style.position="relative";var n=e.roundWithGivenPrecision(100/t,4);for(var o=0;o<t;o++){var h=document.createElement("div");h.id="divContainer"+o;h.style.display="inline-block";h.style.position="absolute";h.style.top="0";h.style.left=o*n+"%";h.style.width=n+"%";h.style.height="100%";if(r!=null&&o>0)h.style.borderLeft=r;i.appendChild(h);a.push(h);var l=document.createElement("canvas");l.id="renderCanvas"+o;l.style.width="100%";l.style.height="100%";h.appendChild(l);s.push(l)}return{divs:a,canvass:s}}e.nDivContainningCanvasInOneLine=r;function s(e,t,i,r){if(i===void 0){i=true}var s=document.createElement("div");s.style.display="inline-block";s.style.position="absolute";if(i)s.style.bottom="0";else s.style.top="0";s.style.left="0";s.style.width="100%";s.style.height=e;s.style.zIndex=parseInt(t.style.zIndex)+10+"";if(r!=null)s.style.borderTop=r;t.appendChild(s);return s}e.legend=s})(mathis||(mathis={}));var mathis;(function(e){function t(e){var t=[];for(var i in e){if(e.hasOwnProperty(i)){var r=parseInt(i);if(!isNaN(r))t.push(r)}}return t}e.allIntegerValueOfEnume=t;function i(e){var t=[];for(var i in e){if(e.hasOwnProperty(i)&&isNaN(parseInt(i))){t.push(i)}}return t}e.allStringValueOfEnume=i;var r=function(){function e(){this.showTrace=false;this.alreadyWroteWarning=[]}e.prototype.c=function(e,t){if(t===void 0){t=1}if(this.alreadyWroteWarning[e]!=null)this.alreadyWroteWarning[e]++;else this.alreadyWroteWarning[e]=1;if(this.alreadyWroteWarning[e]<=t){if(this.showTrace){var i=new Error;console.log("WARNING",e,"...........................................",i)}else{console.log("WARNING",e)}}};return e}();e.Logger=r;function s(e,t){e*=Math.pow(10,t);e=Math.round(e);e/=Math.pow(10,t);return e}e.roundWithGivenPrecision=s;function a(e,t){t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(i){if(i!=="constructor"){e.prototype[i]=t.prototype[i]}})})}e.applyMixins=a;function n(e,t){var i;if(document.getElementById&&(i=document.getElementById(e))){if(i.style)i.style.cursor=t}}e.setCursorByID=n;var o=function(){function e(){this.millisDuration=0;this.nbTested=0;this.nbOK=0;this.millisDep=performance.now()}e.prototype.computeTime=function(){this.millisDuration=performance.now()-this.millisDep};e.prototype.add=function(e){e.computeTime();this.nbTested+=e.nbTested;this.nbOK+=e.nbOK;this.millisDuration+=e.millisDuration};e.prototype.assertTrue=function(e){this.nbTested++;if(e)this.nbOK++;else{var t=new Error;console.log(t.stack)}};e.prototype.toString=function(){return"nbTest:"+this.nbTested+", nbOK:"+this.nbOK+", millisDuration:"+this.millisDuration.toFixed(2)};return e}();e.Bilan=o;function h(e,t,i){if(i===void 0){i=false}if(t<0)throw"second arg must be positif";var r=0;if(e>=0)r=e%t;else r=t- -e%t;if(i&&r>t/2)r=r-t;if(Math.abs(r-t)<Number.MIN_VALUE*10)r=0;return r}e.modulo=h;function l(e){var t=e.length,i,r;while(t>0){r=Math.floor(Math.random()*t);t--;i=e[t];e[t]=e[r];e[r]=i}return e}e.shuffle=l;var u=function(){function e(e,t){this.key=e;this.value=t}return e}();e.Entry=u;var c=function(){function e(e){if(e===void 0){e=false}this.values={};this.keys={};this.memorizeKeys=e}e.prototype.putValue=function(e,t,i){if(i===void 0){i=true}if(e==null){if(i)throw"key must be non null";else return null}this.values[e.hashString]=t;if(this.memorizeKeys)this.keys[e.hashString]=e};e.prototype.removeKey=function(e){delete this.values[e.hashString];if(this.memorizeKeys)delete this.keys[e.hashString]};e.prototype.getValue=function(e,t){if(t===void 0){t=true}if(e==null){if(t)throw"key must be non null";else return null}return this.values[e.hashString]};e.prototype.allValues=function(){var e=new Array;for(var t in this.values)e.push(this.values[t]);return e};e.prototype.allKeys=function(){if(!this.memorizeKeys)throw"this hashMap has not memorized keys. Please, put args=true in the constructor";var e=new Array;for(var t in this.keys)e.push(this.keys[t]);return e};e.prototype.allEntries=function(){if(!this.memorizeKeys)throw"this hashMap has not memorized keys. Please, put args=true in the constructor";var e=[];for(var t in this.keys)e.push(new u(this.keys[t],this.values[t]));return e};e.prototype.aRandomValue=function(){var e=Object.keys(this.values);return this.values[e[Math.floor(e.length*Math.random())]]};e.prototype.extend=function(e){if(!e.memorizeKeys)throw"cannot extend this  with a HashMap which do not memorize keys";for(var t=0,i=e.allEntries();t<i.length;t++){var r=i[t];this.putValue(r.key,r.value)}};e.prototype.size=function(){var e=0;for(var t in this.values)e++;return e};return e}();e.HashMap=c;var m=function(){function e(){this.values={}}e.prototype.putValue=function(e,t,i){if(i===void 0){i=true}if(e==null){if(i)throw"key must be non null";else return null}this.values[e]=t};e.prototype.removeKey=function(e){delete this.values[e]};e.prototype.getValue=function(e,t){if(t===void 0){t=true}if(e==null){if(t)throw"key must be non null";else return null}return this.values[e]};e.prototype.allValues=function(){var e=new Array;for(var t in this.values)e.push(this.values[t]);return e};e.prototype.allKeys=function(){return Object.keys(this.values)};e.prototype.aRandomValue=function(){var e=Object.keys(this.values);return this.values[e[Math.floor(e.length*Math.random())]]};e.prototype.size=function(){var e=0;for(var t in this.values)e++;return e};e.prototype.__serialize=function(){return this.values};e.prototype.__load=function(e){this.values=e};return e}();e.StringMap=m})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(e){this.cannotOverwriteExistingLines=true;this.startingVertices=null;this.restrictLinesToTheseVertices=null;this.lookAtBifurcation=true;this.mamesh=e}t.prototype.go=function(){if(this.mamesh==null)throw" a null mamesh";if(this.mamesh.vertices==null||this.mamesh.vertices.length==0)throw"no vertices in this mamesh";if(this.mamesh.linesWasMade&&this.cannotOverwriteExistingLines)throw"lines already exist for this mamesh";var t=s(this.mamesh.vertices,this.lookAtBifurcation);var i=[];if(this.startingVertices!=null){var a=new e.HashMap;for(var n=0,o=this.startingVertices;n<o.length;n++){var h=o[n];a.putValue(h,true)}for(var l=0,u=t;l<u.length;l++){var c=u[l];for(var m=0,d=c.vertices;m<d.length;m++){var f=d[m];if(a.getValue(f)!=null){i.push(c);break}}}}else i=t;if(this.restrictLinesToTheseVertices!=null){var p=new r(i,this.restrictLinesToTheseVertices);i=p.go()}this.mamesh.lines=i;return i};return t}();t.LineComputer=i;var r=function(){function t(e,t){this.lines=e;this.vertices=t}t.prototype.go=function(){var t=this;this.allPresentVertices=new e.HashMap;for(var i=0,r=this.vertices;i<r.length;i++){var s=r[i];this.allPresentVertices.putValue(s,true)}var a=[];this.lines.forEach(function(i){if(!i.isLoop){var r=t.cutOneLine(i.vertices);for(var s=0,n=r;s<n.length;s++){var o=n[s];a.push(new e.Line(o,false))}}});this.lines.forEach(function(i){if(i.isLoop){var r=i.vertices;var s=-1;for(var n=0;n<r.length;n++){if(t.allPresentVertices.getValue(r[n])==null){s=n;break}}if(s==-1)a.push(i);else{var o=[];for(var h=0;h<r.length;h++){o.push(r[(h+s)%r.length])}var l=t.cutOneLine(o);for(var u=0,c=l;u<c.length;u++){var m=c[u];a.push(new e.Line(m,false))}}}});return a};t.prototype.cutOneLine=function(e){var t=[];t[0]=[];var i=-1;var r=true;for(var s=0;s<e.length;s++){if(this.allPresentVertices.getValue(e[s])==true){if(!r)t[i].push(e[s]);else{i++;t[i]=[];t[i].push(e[s]);r=false}}else{r=true}}var a=[];t.forEach(function(e){if(e.length>=2)a.push(e)});return a};return t}();t.LinesCuter=r;function s(t,i){var r=new e.HashMap;var s=[];function a(t,n,o,h){var l=n[n.length-1];var u=n[n.length-2];r.putValue(new e.Segment(u,l),true);var c=l.getOpposites(u);if(c==null){if(t)throw"strange : probably, the function makeLineCatalogue2 have as args a non complete graph (call getGroup before)";s.push(new e.Line(n,false))}else if(c.length==0)throw"convention: is no opposite, the array opposite must be null, and not empty";else if(o.getValue(new e.Segment(u,l))==true){s.push(new e.Line(n,false))}else{o.putValue(new e.Segment(u,l),true);var m=c.length;if(!i)m=1;for(var d=0;d<m;d++){var f=c[d];if(f==n[0]){s.push(new e.Line(n,true));r.putValue(new e.Segment(l,n[0]),true)}else{if(d<m-1){var p=new e.HashMap;for(var v=0;v<n.length-1;v++)p.putValue(new e.Segment(n[v],n[v+1]),true);var g=n.concat([f]);a(t,g,p,true)}else{n.push(f);a(t,n,o,h)}}}}}t.forEach(function(t){t.links.forEach(function(s){if(s.opposites==null){if(i||r.getValue(new e.Segment(t,s.to))==null){var n=[t,s.to];var o=new e.HashMap;a(false,n,o,false)}}})});if(i){var n=new e.HashMap;var o=[];for(var h=0,l=s;h<l.length;h++){var u=l[h];if(n.getValue(u)==null)o.push(u);n.putValue(u,true)}s=o}t.forEach(function(t){t.links.forEach(function(i){if(r.getValue(new e.Segment(t,i.to))==null){var s=[t,i.to];var n=new e.HashMap;a(true,s,n,false)}})});return s}t.makeLineCatalogue2=s;var a=function(e){__extends(t,e);function t(){e.call(this,true)}return t}(e.HashMap);var n=function(){function t(e){this.packSymmetricLines=true;this.forSymmetriesUsePositionVersusParam=true;this.useConsecutiveIntegerForPackNumber=true;this.symmetries=null;this.OUT_nbFoundSymmetricLines=0;this.mamesh=e}t.prototype.go=function(){if(!this.mamesh.linesWasMade)throw"no line for this IN_mamesh";var t=[];var i=0;var r=new e.HashMap;for(var s=0,n=this.mamesh.lines;s<n.length;s++){var o=n[s];var h=[];var l=[];for(var u=0,c=o.allSegments();u<c.length;u++){var m=c[u];if(r.getValue(m)!=null)h.push(m);else l.push(m)}if(h.length==0){var d=new a;d.index=i++;for(var f=0,p=o.allSegments();f<p.length;f++){var m=p[f];d.putValue(m,true);r.putValue(m,d)}}else{var v=r.getValue(h[0]);for(var g=1;g<h.length;g++)this.segmentAndHisPackJoinNewPack(h[g],v,r);for(var w=0,y=l;w<y.length;w++){var b=y[w];v.putValue(b,true);r.putValue(b,v)}}}if(this.symmetries!=null){e.XYZ.nbDecimalForHash=1;var T=new e.StringMap;for(var g=0;g<this.mamesh.lines.length;g++){var o=this.mamesh.lines[g];var M=o.hashStringUpToSymmetries(this.symmetries,this.forSymmetriesUsePositionVersusParam);var C=T.getValue(M);if(C==null)T.putValue(M,r.getValue(new e.Segment(o.vertices[0],o.vertices[1])));else{this.OUT_nbFoundSymmetricLines++;var S=r.getValue(new e.Segment(o.vertices[0],o.vertices[1]));if(S.size()==C.size())S.index=C.index}}e.XYZ.nbDecimalForHash=5}for(var g=0;g<this.mamesh.lines.length;g++){var o=this.mamesh.lines[g];t[g]=r.getValue(new e.Segment(o.vertices[0],o.vertices[1])).index}if(this.useConsecutiveIntegerForPackNumber&&this.packSymmetricLines){var x=[];var F=e.tab.maxIndexOfNumericList(t);var V=t[F];var k=0;for(var O=0;O<=V;O++){var A=false;for(var P=0;P<t.length;P++){if(t[P]==O){x[P]=O-k;A=true}}if(!A)k++}t=x}var L=new e.HashMap;for(var g=0;g<this.mamesh.lines.length;g++){L.putValue(this.mamesh.lines[g],t[g])}return L};t.prototype.segmentAndHisPackJoinNewPack=function(e,t,i){var r=i.getValue(e);for(var s=0,a=r.allKeys();s<a.length;s++){var n=a[s];t.putValue(n,true);i.putValue(n,t)}i.putValue(e,t)};return t}();t.CreateAColorIndexRespectingBifurcationsAndSymmetries=n})(t=e.lineModule||(e.lineModule={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(e){this.mamesh=e}t.prototype.goChanging=function(){this.mamesh.clearLinksAndLines();var t=new e.StringMap;for(var i=0,r=this.mamesh.polygons;i<r.length;i++){var s=r[i];for(var a=0;a<s.length;a++){var n=e.Segment.segmentId(s[a].hashNumber,s[(a+1)%s.length].hashNumber);if(t.getValue(n)==null){t.putValue(n,true);s[a].setOneLink(s[(a+1)%s.length]);s[(a+1)%s.length].setOneLink(s[a])}}}};return t}();t.SimpleLinkFromPolygonCreator=i;var r=function(){function t(e,t){this.normals=t;this.suppressLinksAngularlyTooCloseVersusNot=true;this.suppressLinksAngularParam=2*Math.PI*.1;this.keepShorterLinksVersusGiveSomePriorityToLinksWithOpposite=true;this.mamesh=e}t.prototype.goChanging=function(){var t=this;if(this.mamesh==null)throw"mamesh is null";if(this.normals==null)this.vertexToPositioning=new e.mameshAroundComputations.PositioningComputerForMameshVertices(this.mamesh).go();else if(this.normals instanceof e.HashMap)this.vertexToPositioning=this.normals;else if(this.normals instanceof e.XYZ){this.vertexToPositioning=new e.HashMap;var i=new e.Positioning;i.upVector=this.normals;for(var r=0,s=this.mamesh.vertices;r<s.length;r++){var a=s[r];this.vertexToPositioning.putValue(a,i)}}this.mamesh.vertices.forEach(function(i){var r=[];for(var s=0;s<i.links.length;s++){r[s]=new e.XYZ(0,0,0).copyFrom(i.links[s].to.position).substract(i.position);if(r[s].length()<e.geo.epsilon)throw"a IN_mamesh with two voisins at the same position"}var a=[];a.push({angle:0,i:0});var n=t.vertexToPositioning.getValue(i).upVector;for(var s=1;s<i.links.length;s++){a.push({angle:e.geo.angleBetweenTwoVectorsBetweenMinusPiAndPi(r[0],r[s],n),i:s})}a.sort(function(e,t){return e.angle-t.angle});var o=[];for(var h=0;h<a.length;h++){o.push(i.links[a[h].i])}i.links=o});if(this.suppressLinksAngularlyTooCloseVersusNot)this.letsSuppressLinks()};t.prototype.letsSuppressLinks=function(){for(var t=0,i=this.mamesh.vertices;t<i.length;t++){var r=i[t];var s=0;var a=true;while(a&&r.links.length>=2){a=false;for(var n=s;n<s+r.links.length;n++){var o=n%r.links.length;var h=(n+1)%r.links.length;var l=e.XYZ.newFrom(r.links[o].to.position).substract(r.position);var u=e.XYZ.newFrom(r.links[h].to.position).substract(r.position);var c=e.geo.angleBetweenTwoVectorsBetween0andPi(l,u);if(c<this.suppressLinksAngularParam){var m=e.geo.distance(r.position,r.links[o].to.position);var d=e.geo.distance(r.position,r.links[h].to.position);var f=void 0;if(this.keepShorterLinksVersusGiveSomePriorityToLinksWithOpposite){if(m<d)f=r.links[h];else f=r.links[o]}else{var p=m/(m+d);if(p<.6&&p>.4){if(r.links[h].opposites==null&&r.links[o].opposites!=null)f=r.links[h];else f=r.links[o]}else{if(m<d)f=r.links[h];else f=r.links[o]}}e.Vertex.separateTwoVoisins(r,f.to);a=true;s=h+1;break}}}}};return t}();t.LinksSorterAndCleanerByAngles=r;var s=function(){function t(e){this.maxAngleToAssociateLinks=Math.PI*.3;this.clearAllExistingOppositeBefore=false;this.canCreateBifurcations=true;this.doNotBranchOnBorder=false;this.OUT_nbBranching=0;this.vertices=e}t.prototype.associateOppositeLinks=function(){var t=this;var i=[];this.vertices.forEach(function(i){var r=0;for(var s=0,a=i.links;s<a.length;s++){var n=a[s];if(n.opposites==null)r++}var o=[];for(var h=0;h<i.links.length;h++){o[h]=new e.XYZ(0,0,0).copyFrom(i.links[h].to.position).substract(i.position);if(o[h].lengthSquared()<e.geo.epsilonSquare)throw"the IN_mamesh has two voisins at the same position"}var l=[];var u=[];for(var h=0;h<i.links.length;h++){u[h]=Number.POSITIVE_INFINITY;for(var c=h+1;c<i.links.length;c++){var m=Math.abs(e.modulo(e.geo.angleBetweenTwoVectorsBetween0andPi(o[h],o[c])-Math.PI,Math.PI*2,true));if(m<t.maxAngleToAssociateLinks&&(i.links[h].opposites==null&&i.links[c].opposites==null)){if(m<u[h])u[h]=m;l.push({angle:m,i:h,j:c})}}}l.sort(function(e,t){return t.angle-e.angle});if(!t.canCreateBifurcations||t.doNotBranchOnBorder&&i.hasMark(e.Vertex.Markers.border)){while(l.length>0){var d=l.pop();var f=i.links[d.i];var p=i.links[d.j];f.opposites=[p];p.opposites=[f];l=e.tab.arrayMinusElements(l,function(e){return e.i==d.i||e.j==d.i||e.i==d.j||e.j==d.j})}}else{while(l.length>0){var d=l.pop();var v=l[l.length-1];var f=void 0;var p=void 0;var g=void 0;if(r==3&&v!=null){if(d.i==v.i){f=i.links[d.i];p=i.links[d.j];g=i.links[v.j]}else if(d.i==v.j){f=i.links[d.i];p=i.links[d.j];g=i.links[v.i]}else if(d.j==v.i){f=i.links[d.j];p=i.links[d.i];g=i.links[v.j]}else if(d.j==v.j){f=i.links[d.j];p=i.links[d.i];g=i.links[v.i]}else{f=i.links[d.i];p=i.links[d.j]}}else{f=i.links[d.i];p=i.links[d.j]}if(g==null){f.opposites=[p];p.opposites=[f];l=e.tab.arrayMinusElements(l,function(e){return e.i==d.i||e.j==d.i||e.i==d.j||e.j==d.j});r-=2}else{t.OUT_nbBranching++;l.pop();f.opposites=[p,g];p.opposites=[f];g.opposites=[f];r-=1;l=e.tab.arrayMinusElements(l,function(e){return e.i==d.i||e.j==d.i||e.i==d.j||e.j==d.j||e.i==v.i||e.j==v.i||e.i==v.j||e.j==v.j})}}}})};t.prototype.goChanging=function(){if(this.clearAllExistingOppositeBefore){this.vertices.forEach(function(e){e.links.forEach(function(e){e.opposites=null})})}if(this.maxAngleToAssociateLinks!=null)this.associateOppositeLinks()};return t}();t.OppositeLinkAssocierByAngles=s;var a=function(){function t(t){this.interiorTJonction=new e.HashMap;this.borderTJonction=new e.HashMap;this.forcedOpposite=new e.HashMap;this.polygonesAroundEachVertex=new e.HashMap;this.polygones=[];this.markIsolateVertexAsCorner=true;this.markBorder=true;this.forceOppositeLinksAtCorners=false;this.mamesh=t}t.prototype.goChanging=function(){this.checkArgs();this.createPolygonesFromSmallestTrianglesAnSquares();this.detectBorder();this.createLinksTurningAround();this.makeLinksFinaly()};t.prototype.checkArgs=function(){if((this.mamesh.smallestSquares==null||this.mamesh.smallestSquares.length==0)&&(this.mamesh.smallestTriangles==null||this.mamesh.smallestTriangles.length==0))throw"no triangles nor squares given";this.mamesh.clearLinksAndLines()};t.prototype.createPolygonesFromSmallestTrianglesAnSquares=function(){var t=this;for(var i=0;i<this.mamesh.smallestTriangles.length;i+=3){this.polygones.push(new n([this.mamesh.smallestTriangles[i],this.mamesh.smallestTriangles[i+1],this.mamesh.smallestTriangles[i+2]]))}for(var i=0;i<this.mamesh.smallestSquares.length;i+=4){this.polygones.push(new n([this.mamesh.smallestSquares[i],this.mamesh.smallestSquares[i+1],this.mamesh.smallestSquares[i+2],this.mamesh.smallestSquares[i+3]]))}for(var r=0,s=this.polygones;r<s.length;r++){var a=s[r];var o=a.points.length;for(var i=0;i<o;i++){var h=a.points[i%o];var l=a.points[(i+1)%o];this.subdivideSegment(a,h,l,this.mamesh.cutSegmentsDico)}}this.mamesh.vertices.forEach(function(e){t.polygonesAroundEachVertex.putValue(e,new Array)});this.polygones.forEach(function(e){e.points.forEach(function(i){t.polygonesAroundEachVertex.getValue(i).push(e)})});if(this.markIsolateVertexAsCorner){this.mamesh.vertices.forEach(function(i){if(t.polygonesAroundEachVertex.getValue(i).length==1){i.markers.push(e.Vertex.Markers.corner);e.logger.c("new corners was added when we automatically create then links from the triangulatedRect/square")}})}};t.prototype.detectBorder=function(){var t=this;for(var i=0;i<this.mamesh.vertices.length;i++){var r=this.mamesh.vertices[i];var s=this.polygonesAroundEachVertex.getValue(r);var a=new e.HashMap(true);for(var n=0,o=s;n<o.length;n++){var h=o[n];var l=h.theTwoAnglesAdjacentFrom(r);var u=l[0];var c=l[1];if(a.getValue(u)==null)a.putValue(u,1);else a.putValue(u,a.getValue(u)+1);if(a.getValue(c)==null)a.putValue(c,1);else a.putValue(c,a.getValue(c)+1)}var m=0;a.allKeys().forEach(function(i){if(a.getValue(i)==1){m++;if(t.borderTJonction.getValue(r)==null){t.borderTJonction.putValue(r,new Array);if(t.markBorder)r.markers.push(e.Vertex.Markers.border)}t.borderTJonction.getValue(r).push(i)}else if(a.getValue(i)>2)throw" non conform mesh: a link appear strictly more than 2 times as side of polygones turning around a vertex   "});if(!(m==0||m==2))throw"strange mesh (perhaps too holy): the vertex: "+r.toString(0)+" has:"+m+" link with multiplicity 1"}};t.prototype.createLinksTurningAround=function(){var t=this;var i=function(i,r){var s=t.mamesh.cutSegmentsDico[e.Segment.segmentId(i.hashNumber,r.hashNumber)];if(s!=null){if(t.interiorTJonction.getValue(s.middle)!=null){console.log("attention, une double interiorTjonction")}else t.interiorTJonction.putValue(s.middle,true);t.forcedOpposite.putValue(s.middle,[i,r])}};for(var r=0,s=this.polygones;r<s.length;r++){var a=s[r];var n=a.points.length;if(n>3){if(n==4){i(a.points[0],a.points[2]);i(a.points[1],a.points[3])}else{for(var o=0;o<n;o++){var h=a.points[o];var l=a.points[(o+2)%n];i(h,l)}}}}this.mamesh.vertices.forEach(function(i){var r=t.polygonesAroundEachVertex.getValue(i);if(t.borderTJonction.getValue(i)!=null&&t.interiorTJonction.getValue(i)!=null)throw"a vertex cannot be a interior and border T-jonction";if(t.borderTJonction.getValue(i)==null){var s=r[0];if(s==null)e.logger.c("some vertex was not around a square/triangulatedRect");else t.createLinksTurningFromOnePolygone(i,s,r,false)}else{var a=t.findAPolygoneWithOrientedEdge(i,t.borderTJonction.getValue(i)[0],r);if(a==null)a=t.findAPolygoneWithOrientedEdge(i,t.borderTJonction.getValue(i)[1],r);t.createLinksTurningFromOnePolygone(i,a,r,true)}})};t.prototype.makeLinksFinaly=function(){var t=this;this.mamesh.vertices.forEach(function(i){if(t.forceOppositeLinksAtCorners||!i.hasMark(e.Vertex.Markers.corner)){var r=i.links.length;if(t.borderTJonction.getValue(i)!=null){var s=i.links[0];var a=i.links[r-1];s.opposites=[a];a.opposites=[s]}else{if(r%2==0){for(var n=0;n<r;n++){var s=i.links[n];var a=i.links[(n+r/2)%r];s.opposites=[a];a.opposites=[s]}}if(t.forcedOpposite.getValue(i)!=null){var o=t.forcedOpposite.getValue(i)[0];var h=t.forcedOpposite.getValue(i)[1];i.changeToLinkWithoutOpposite(o);i.changeToLinkWithoutOpposite(h);i.setTwoOppositeLinks(o,h)}}}})};t.prototype.findAPolygoneWithOrientedEdge=function(e,t,i){for(var r=0,s=i;r<s.length;r++){var a=s[r];var n=a.points.length;for(var o=0;o<n;o++){if(a.points[o%n].hashNumber==e.hashNumber&&a.points[(o+1)%n].hashNumber==t.hashNumber)return a}}return null};t.prototype.findAPolygoneWithThisEdge=function(t,i,r){for(var s=0,a=r;s<a.length;s++){var n=a[s];var o=n.points.length;for(var h=0;h<o;h++){var l=e.Segment.segmentId(n.points[h%o].hashNumber,n.points[(h+1)%o].hashNumber);var u=e.Segment.segmentId(t.hashNumber,i.hashNumber);if(l==u)return n}}return null};t.prototype.createLinksTurningFromOnePolygone=function(t,i,r,s){var a=i.theOutgoingAnglesAdjacentFrom(t);var n=i;var o=true;while(r.length>0){t.links.push(new e.Link(a));if(o)a=n.theIngoingAnglesAdjacentFrom(t);else{var h=n.theTwoAnglesAdjacentFrom(t);if(h[0].hashNumber==a.hashNumber)a=h[1];else a=h[0]}e.tab.removeFromArray(r,n);n=this.findAPolygoneWithOrientedEdge(t,a,r);if(n==null){n=this.findAPolygoneWithOrientedEdge(a,t,r);o=false}}if(s){t.links.push(new e.Link(a))}};t.prototype.subdivideSegment=function(t,i,r,s){var a=s[e.Segment.segmentId(i.hashNumber,r.hashNumber)];if(a!=null){var n=t.points.indexOf(i);var o=t.points.indexOf(r);var h=Math.min(n,o);var l=Math.max(n,o);if(l==t.points.length-1&&h==0)t.points.splice(length,0,a.middle);else t.points.splice(h+1,0,a.middle);this.subdivideSegment(t,i,a.middle,s);this.subdivideSegment(t,r,a.middle,s)}};return t}();t.LinkCreaterSorterAndBorderDetecterByPolygons=a;var n=function(){function e(e){this.points=e}e.prototype.hasAngle=function(e){for(var t=0,i=this.points;t<i.length;t++){var r=i[t];if(r.hashNumber==e.hashNumber)return true}return false};e.prototype.theOutgoingAnglesAdjacentFrom=function(e){var t=this.points.length;for(var i=0;i<t;i++){if(this.points[i]==e){return this.points[(i+1)%t]}}throw"we do not find the point in this polygone"};e.prototype.theIngoingAnglesAdjacentFrom=function(e){var t=this.points.length;for(var i=0;i<t;i++){if(this.points[i]==e){return this.points[(i-1+t)%t]}}throw"we do not find the point in this polygone"};e.prototype.theTwoAnglesAdjacentFrom=function(e){var t=this.points.length;for(var i=0;i<t;i++){if(this.points[i]==e){return[this.points[(i-1+t)%t],this.points[(i+1)%t]]}}throw"we do not find the point in this polygone"};e.prototype.toString=function(){var e="[";for(var t=0,i=this.points;t<i.length;t++){var r=i[t];e+=r.hashNumber+","}return e+"]"};return e}();t.Polygone=n})(t=e.linkModule||(e.linkModule={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=BABYLON.Tools;var r=BABYLON.Collider;var s=function(t){__extends(s,t);function s(s,o){t.call(this,name,new BABYLON.Vector3(0,0,-10),s.scene);this.translationSpeed=1;this.checkCollisions=false;this.showPredefinedConsoleLog=false;this.grabbers=[];this.useOnlyFreeMode=false;this.useFreeModeWhenCursorOutOfGrabber=true;this.onGrabberChange=null;this.onTranslate=null;this.tooSmallAngle=.001;this.tooBigAngle=.3;this.cumulatedAngle=0;this.relativeCursorPositionOnGrabber=new e.XYZ(0,0,0);this.cursorPositionOnGrabberOld=new e.XYZ(0,0,0);this.angleOfRotationAroundGrabber=0;this.axeOfRotationAroundGrabber=new e.XYZ(0,0,0);this.camDir=new e.XYZ(0,0,0);this.oldCamDir=new e.XYZ(0,0,0);this.angleForCamRot=0;this.axisForCamRot=new e.XYZ(0,0,0);this.myNullVector=new e.XYZ(123,234,345);this.frozonProjectionMatrix=new e.MM;this.frozonViewMatrix=new e.MM;this.pickingRay={origin:new e.XYZ(0,0,0),direction:new e.XYZ(0,0,0)};this.aPartOfTheFrontDir=new e.XYZ(0,0,0);this.whishedCamPos=new n(this);this.trueCamPos=new a(this);this._paralDisplacement=new e.XYZ(0,0,0);this._matrixRotationAroundCam=new e.MM;this._matrixRotationAroundZero=new e.MM;this.camRelativePos=new e.XYZ(0,0,0);this._collider=new r;this.correctionToRecenter=new e.XYZ(0,0,0);this._deltaPosition=new e.XYZ(0,0,0);this._popo=new e.XYZ(0,0,0);this._babylonRay=new BABYLON.Ray(new BABYLON.Vector3(0,0,0),new BABYLON.Vector3(0,0,1));this.pointerIsOnCurrentGrabber=false;this._tempCN=new e.XYZ(0,0,0);this._end=new e.XYZ(0,0,0);this.pointerIsDown=false;this._lookForTheBestGrabber=true;this._target=e.XYZ.newZero();this.viewMM=new e.MM;this._keys=[];this.keysUp=[38];this.keysDown=[40];this.keysLeft=[37];this.keysRight=[39];this.keysFrontward=[];this.keysBackward=[];this._axeForKeyRotation=new e.XYZ(0,0,0);this._additionnalVec=new e.XYZ(0,0,0);this.wheelPrecision=1;this.eventPrefix=i.GetPointerPrefix();this.scene=s.scene;e.geo.copyXYZ(this.myNullVector,this.cursorPositionOnGrabberOld);e.geo.copyXYZ(this.myNullVector,this.oldCamDir);this.$canvasElement=s.canvas;this.toogleIconCursor("cursorDefault");this.replaceTheFirstGrabber(o);this.attachControl(s.canvas)}s.prototype.changePosition=function(e,t){if(t===void 0){t=true}this.whishedCamPos.changePosition(e);if(!t){this.trueCamPos.position=e}};s.prototype.changeFrontDir=function(e,t){if(t===void 0){t=true}this.whishedCamPos.changeFrontDir(e);if(!t){this.trueCamPos.changeFrontDir(e)}};s.prototype.changeUpVector=function(e,t){if(t===void 0){t=true}this.whishedCamPos.changeUpVector(e);if(!t){this.trueCamPos.changeUpVector(e)}};s.prototype.addGrabber=function(e){e.checkArgs();this.grabbers.push(e)};s.prototype.replaceTheFirstGrabber=function(e){if(this.grabbers[0]!=null)this.grabbers[0].dispose();e.checkArgs();e.grabberCamera=this;this.grabbers[0]=e;this.currentGrabber=this.grabbers[0]};s.prototype.freeRotation=function(){if(this.showPredefinedConsoleLog)console.log("free rotation angle",this.angleForCamRot.toFixed(4));this.rotate(this.axisForCamRot,this.angleForCamRot);this.toogleIconCursor("cursorMove")};s.prototype.grabberMovement=function(){if(this.currentGrabber.parallelDisplacementInsteadOfRotation){this._paralDisplacement.copyFrom(this.relativeCursorPositionOnGrabber).substract(this.cursorPositionOnGrabberOld).scale(-1);this._paralDisplacement.add(this.whishedCamPos.getPosition());this.whishedCamPos.changePosition(this._paralDisplacement)}else{if(this.showPredefinedConsoleLog)console.log("grabber rotation angle",this.angleOfRotationAroundGrabber.toFixed(4));this.rotateAroundCenter(this.axeOfRotationAroundGrabber,this.angleOfRotationAroundGrabber,this.currentGrabber.referenceCenter)}this.toogleIconCursor("cursorGrabbing");if(this.currentGrabber.showGrabberOnlyWhenGrabbing)this.currentGrabber.mesh.visibility=1};s.prototype.mixedRotation=function(e){if(this.showPredefinedConsoleLog)console.log("free rotation angle",this.angleForCamRot.toFixed(4),"grabber rotation angle",this.angleOfRotationAroundGrabber.toFixed(4));this.twoRotations(this.axisForCamRot,this.angleForCamRot,this.axeOfRotationAroundGrabber,this.angleOfRotationAroundGrabber,e);this.toogleIconCursor("cursorGrabbing");if(this.currentGrabber.showGrabberOnlyWhenGrabbing)this.currentGrabber.mesh.visibility=1};s.prototype.rotate=function(t,i){e.geo.axisAngleToMatrix(t,i,this._matrixRotationAroundCam);e.geo.multiplicationMatrixVector(this._matrixRotationAroundCam,this.whishedCamPos.frontDir,this.whishedCamPos.frontDir);e.geo.multiplicationMatrixVector(this._matrixRotationAroundCam,this.whishedCamPos.upVector,this.whishedCamPos.upVector)};s.prototype.rotateAroundCenter=function(t,i,r){if(this.currentGrabber.referenceCenter==null)return;e.geo.axisAngleToMatrix(t,i,this._matrixRotationAroundZero);e.geo.multiplicationMatrixVector(this._matrixRotationAroundZero,this.whishedCamPos.frontDir,this.whishedCamPos.frontDir);e.geo.multiplicationMatrixVector(this._matrixRotationAroundZero,this.whishedCamPos.upVector,this.whishedCamPos.upVector);this.camRelativePos.copyFrom(this.whishedCamPos.getPosition()).substract(r);e.geo.multiplicationMatrixVector(this._matrixRotationAroundZero,this.camRelativePos,this.camRelativePos);this.camRelativePos.add(r);this.whishedCamPos.changePosition(this.camRelativePos)};s.prototype.twoRotations=function(e,t,i,r,s){this.rotate(e,t*(1-s));this.rotateAroundCenter(i,r*s,this.currentGrabber.referenceCenter)};s.prototype.translateCam=function(t){var i=t*this.translationSpeed;if(t<0&&this.currentGrabber.focusOnMyCenterWhenCameraGoDownWard&&this.currentGrabber.referenceCenter!=null){var r=Math.min(1,e.geo.distance(this.whishedCamPos.getPosition(),this.currentGrabber.referenceCenter)/this.currentGrabber.endOfZone3);r=r*r*.1;e.geo.scale(this.whishedCamPos.frontDir,1-r,this.aPartOfTheFrontDir);e.geo.substract(this.currentGrabber.referenceCenter,this.whishedCamPos.getPosition(),this.correctionToRecenter);if(this.correctionToRecenter.lengthSquared()>e.geo.epsilon){e.geo.normalize(this.correctionToRecenter,this.correctionToRecenter);e.geo.scale(this.correctionToRecenter,r,this.correctionToRecenter);e.geo.add(this.correctionToRecenter,this.aPartOfTheFrontDir,this.aPartOfTheFrontDir)}this.whishedCamPos.changeFrontDir(this.aPartOfTheFrontDir)}if(i!=0){e.geo.scale(this.whishedCamPos.frontDir,i,this._deltaPosition);e.geo.add(this.whishedCamPos.getPosition(),this._deltaPosition,this._popo);this.whishedCamPos.changePosition(this._popo);if(this.onTranslate!=null)this.onTranslate()}};s.prototype.onPointerMove=function(t,i){if(!this.pointerIsDown)return;var r=true;var s=true;this.createPickingRayWithFrozenCamera(t,i,this.currentGrabber.mesh.getWorldMatrix(),this.frozonViewMatrix,this.frozonProjectionMatrix,this.pickingRay);e.geo.copyXYZ(this.pickingRay.direction,this.camDir);this._babylonRay.direction=this.pickingRay.direction;this._babylonRay.origin=this.pickingRay.origin;var a=this.currentGrabber.mesh.intersects(this._babylonRay,false);this.pointerIsOnCurrentGrabber=a.hit;var n=a.distance;if(this.pointerIsOnCurrentGrabber){this.relativeCursorPositionOnGrabber.x=a.pickedPoint.x;this.relativeCursorPositionOnGrabber.y=a.pickedPoint.y;this.relativeCursorPositionOnGrabber.z=a.pickedPoint.z}if(this.currentGrabber.referenceCenter!=null)this.relativeCursorPositionOnGrabber.substract(this.currentGrabber.referenceCenter);var o=this.currentGrabber.interpolationCoefAccordingToCamPosition(this.trueCamPos.position,n);if(this.showPredefinedConsoleLog)console.log("alpha",o);if(e.geo.xyzEquality(this.oldCamDir,this.myNullVector)){e.geo.copyXYZ(this.camDir,this.oldCamDir);s=false}if(e.geo.xyzEquality(this.cursorPositionOnGrabberOld,this.myNullVector)){if(this.pointerIsOnCurrentGrabber){e.geo.copyXYZ(this.relativeCursorPositionOnGrabber,this.cursorPositionOnGrabberOld)}r=false}else if(!this.pointerIsOnCurrentGrabber){e.geo.copyXYZ(this.myNullVector,this.cursorPositionOnGrabberOld);r=false}if(s){this.angleForCamRot=e.geo.angleBetweenTwoVectorsBetween0andPi(this.camDir,this.oldCamDir);if(this.angleForCamRot>this.tooSmallAngle){e.geo.cross(this.camDir,this.oldCamDir,this.axisForCamRot);e.geo.normalize(this.axisForCamRot,this.axisForCamRot)}else s=false}if(r){this.angleOfRotationAroundGrabber=e.geo.angleBetweenTwoVectorsBetween0andPi(this.relativeCursorPositionOnGrabber,this.cursorPositionOnGrabberOld);if(this.angleOfRotationAroundGrabber>this.tooSmallAngle){e.geo.cross(this.relativeCursorPositionOnGrabber,this.cursorPositionOnGrabberOld,this.axeOfRotationAroundGrabber);this.axeOfRotationAroundGrabber.normalize()}else r=false}if(r&&this.angleOfRotationAroundGrabber>this.tooBigAngle){console.log("a too big angle around zero : ignored"+this.angleOfRotationAroundGrabber.toFixed(4));e.geo.copyXYZ(this.relativeCursorPositionOnGrabber,this.cursorPositionOnGrabberOld);return}if(this.useOnlyFreeMode&&s)this.freeRotation();else if(this.pointerIsOnCurrentGrabber){if(o==0){if(s)this.freeRotation()}else if(o<1&&o>0){if(s&&r){this.mixedRotation(o)}else if(r)this.grabberMovement()}else if(o==1&&r)this.grabberMovement()}else if(this.useFreeModeWhenCursorOutOfGrabber&&s)this.freeRotation();if(r)e.geo.copyXYZ(this.relativeCursorPositionOnGrabber,this.cursorPositionOnGrabberOld);if(s)e.geo.copyXYZ(this.camDir,this.oldCamDir);if(r)this.cumulatedAngle+=this.angleOfRotationAroundGrabber;if(s)this.cumulatedAngle+=this.angleForCamRot;if(this.cumulatedAngle>Math.PI/12){e.geo.copyMat(this.getProjectionMatrix(),this.frozonProjectionMatrix);e.geo.copyMat(this.getViewMatrix(),this.frozonViewMatrix);this.cumulatedAngle=0;e.geo.copyXYZ(this.myNullVector,this.oldCamDir);e.geo.copyXYZ(this.myNullVector,this.cursorPositionOnGrabberOld);if(this.showPredefinedConsoleLog)console.log("nouvelles matrices enregistrées")}};s.prototype.createPickingRayWithFrozenCamera=function(e,t,i,r,s,a){var n=this.getEngine();var o=this.viewport;var h=o.toGlobal(n.getRenderWidth(),n.getRenderHeight());e=e/n.getHardwareScalingLevel()-h.x;t=t/n.getHardwareScalingLevel()-(n.getRenderHeight()-h.y-h.height);this.createNewRay(e,t,h.width,h.height,i,r,s,a)};s.prototype.createNewRay=function(t,i,r,s,a,n,o,h){e.geo.unproject(e.geo.copyXyzFromFloat(t,i,0,this._tempCN),r,s,a,n,o,h.origin);e.geo.unproject(e.geo.copyXyzFromFloat(t,i,1,this._tempCN),r,s,a,n,o,this._end);e.geo.substract(this._end,h.origin,h.direction);e.geo.normalize(h.direction,h.direction)};s.prototype.onPointerDown=function(t,i){this.pointerIsDown=true;e.geo.copyMat(this.getProjectionMatrix(),this.frozonProjectionMatrix);e.geo.copyMat(this.getViewMatrix(),this.frozonViewMatrix);this.cumulatedAngle=0;if(this._lookForTheBestGrabber&&this.grabbers.length>1){this.lookForTheBestGrabber(t,i);this._lookForTheBestGrabber=false}};s.prototype.lookForTheBestGrabber=function(t,i){var r=Number.POSITIVE_INFINITY;var s=null;for(var a=0,n=this.grabbers;a<n.length;a++){var o=n[a];this.createPickingRayWithFrozenCamera(t,i,o.mesh.getWorldMatrix(),this.frozonViewMatrix,this.frozonProjectionMatrix,this.pickingRay);e.geo.copyXYZ(this.pickingRay.direction,this.camDir);this._babylonRay.direction=this.pickingRay.direction;this._babylonRay.origin=this.pickingRay.origin;var h=o.mesh.intersects(this._babylonRay,true);if(h.hit){if(h.distance<r){r=h.distance;s=o}}}if(s!=null&&s!=this.currentGrabber){if(this.onGrabberChange!=null)this.onGrabberChange(this.currentGrabber,s);this.currentGrabber=s;console.log("we have changed grabber, the new one is: ",s.name)}};s.prototype.onPointerUp=function(){this._lookForTheBestGrabber=true;this.toogleIconCursor("cursorDefault");if(this.currentGrabber.showGrabberOnlyWhenGrabbing)this.currentGrabber.mesh.visibility=0;this.pointerIsDown=false;e.geo.copyXYZ(this.myNullVector,this.oldCamDir);e.geo.copyXYZ(this.myNullVector,this.cursorPositionOnGrabberOld)};s.prototype.reset=function(){this._keys=[]};s.prototype.toogleIconCursor=function(e){if(this.cursorActualStyle!=e){this.$canvasElement.className=e;this.cursorActualStyle=e}};s.prototype._isSynchronizedViewMatrix=function(){if(!t.prototype._isSynchronizedViewMatrix.call(this)){return false}return this.trueCamPos.almostEqual(this.whishedCamPos)};s.prototype._getViewMatrix=function(){e.geo.copyXYZ(this.trueCamPos.position,this._target);e.geo.add(this._target,this.trueCamPos.frontDir,this._target);e.geo.LookAtLH(this.trueCamPos.position,this._target,this.trueCamPos.upVector,this.viewMM);return this.viewMM};s.prototype.update=function(){this.checkForKeyPushed();if(!this.trueCamPos.almostEqual(this.whishedCamPos)){this.trueCamPos.goCloser(this.whishedCamPos)}this.position.copyFrom(this.trueCamPos.position);this.upVector.copyFrom(this.trueCamPos.upVector)};s.prototype.onKeyDown=function(e){if(this.keysUp.indexOf(e.keyCode)!==-1||this.keysDown.indexOf(e.keyCode)!==-1||this.keysLeft.indexOf(e.keyCode)!==-1||this.keysRight.indexOf(e.keyCode)!==-1||this.keysBackward.indexOf(e.keyCode)!==-1||this.keysFrontward.indexOf(e.keyCode)!==-1){var t=this._keys.indexOf(e.keyCode);if(t===-1){this._keys.push(e.keyCode)}if(e.preventDefault){e.preventDefault()}}};s.prototype.onKeyUp=function(e){if(this.keysUp.indexOf(e.keyCode)!==-1||this.keysDown.indexOf(e.keyCode)!==-1||this.keysLeft.indexOf(e.keyCode)!==-1||this.keysRight.indexOf(e.keyCode)!==-1||this.keysBackward.indexOf(e.keyCode)!==-1||this.keysFrontward.indexOf(e.keyCode)!==-1){var t=this._keys.indexOf(e.keyCode);if(t>=0){this._keys.splice(t,1)}if(e.preventDefault){e.preventDefault()}}};s.prototype.checkForKeyPushed=function(){if(this._keys.length==0)return;e.geo.copyXyzFromFloat(0,0,0,this._axeForKeyRotation);for(var t=0;t<this._keys.length;t++){var i=this._keys[t];if(this.keysLeft.indexOf(i)!==-1){e.geo.copyXYZ(this.whishedCamPos.upVector,this._additionnalVec);e.geo.scale(this._additionnalVec,-1,this._additionnalVec);e.geo.add(this._axeForKeyRotation,this._additionnalVec,this._axeForKeyRotation)}if(this.keysUp.indexOf(i)!==-1){e.geo.cross(this.whishedCamPos.frontDir,this.whishedCamPos.upVector,this._additionnalVec);e.geo.add(this._additionnalVec,this._axeForKeyRotation,this._axeForKeyRotation)}if(this.keysRight.indexOf(i)!==-1){e.geo.copyXYZ(this.whishedCamPos.upVector,this._additionnalVec);e.geo.add(this._additionnalVec,this._axeForKeyRotation,this._axeForKeyRotation)}if(this.keysDown.indexOf(i)!==-1){e.geo.cross(this.whishedCamPos.upVector,this.whishedCamPos.frontDir,this._additionnalVec);e.geo.add(this._additionnalVec,this._axeForKeyRotation,this._axeForKeyRotation)}if(this.keysBackward.indexOf(i)!==-1)this.translateCam(-.1);else if(this.keysFrontward.indexOf(i)!==-1)this.translateCam(.1)}if(e.geo.squareNorme(this._axeForKeyRotation)<e.geo.epsilon)return;var r=-.02;this.rotate(this._axeForKeyRotation,r)};s.prototype.deltaNotToBigFunction=function(e){if(e>.1)return.1;if(e<-.1)return-.1;return e};s.prototype.attachControl=function(e,t){var r=this;var s;if(this._attachedElement){return}this._attachedElement=e;this._onPointerDown=function(i){if(s){return}s=i.pointerId;if(!t){i.preventDefault()}var a=e.getBoundingClientRect();r.onPointerDown(i.clientX-a.left,i.clientY-a.top)};this._onPointerUp=function(e){s=null;if(!t){e.preventDefault()}r.onPointerUp()};this._onPointerMove=function(i){if(s!==i.pointerId){return}var a=e.getBoundingClientRect();r.onPointerMove(i.clientX-a.left,i.clientY-a.top);if(!t){i.preventDefault()}};this._onMouseMove=this._onPointerMove;this._wheel=function(e){var i=0;if(e.wheelDelta){i=r.deltaNotToBigFunction(e.wheelDelta/(r.wheelPrecision*300))}else if(e.detail){i=r.deltaNotToBigFunction(-e.detail/(r.wheelPrecision*30))}if(i)r.translateCam(i);if(e.preventDefault){if(!t){e.preventDefault()}}};this._onKeyDown=function(e){r.onKeyDown(e)};this._onKeyUp=function(e){r.onKeyUp(e)};this._onLostFocus=function(){r._keys=[];s=null};this._onGestureStart=function(t){if(window.MSGesture===undefined){return}if(!r._MSGestureHandler){r._MSGestureHandler=new MSGesture;r._MSGestureHandler.target=e}r._MSGestureHandler.addPointer(t.pointerId)};this._onGesture=function(e){};this._reset=function(){r.reset();s=null};e.addEventListener(this.eventPrefix+"down",this._onPointerDown,false);e.addEventListener(this.eventPrefix+"up",this._onPointerUp,false);e.addEventListener(this.eventPrefix+"out",this._onPointerUp,false);e.addEventListener(this.eventPrefix+"move",this._onPointerMove,false);e.addEventListener("mousemove",this._onMouseMove,false);e.addEventListener("MSPointerDown",this._onGestureStart,false);e.addEventListener("MSGestureChange",this._onGesture,false);e.addEventListener("mousewheel",this._wheel,false);e.addEventListener("DOMMouseScroll",this._wheel,false);i.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}])};s.prototype.detachControl=function(e){if(this._attachedElement!=e){return}e.removeEventListener(this.eventPrefix+"down",this._onPointerDown);e.removeEventListener(this.eventPrefix+"up",this._onPointerUp);e.removeEventListener(this.eventPrefix+"out",this._onPointerUp);e.removeEventListener(this.eventPrefix+"move",this._onPointerMove);e.removeEventListener("mousemove",this._onMouseMove);e.removeEventListener("MSPointerDown",this._onGestureStart);e.removeEventListener("MSGestureChange",this._onGesture);e.removeEventListener("mousewheel",this._wheel);e.removeEventListener("DOMMouseScroll",this._wheel);i.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]);this._MSGestureHandler=null;this._attachedElement=null;if(this._reset){this._reset()}};return s}(BABYLON.Camera);t.GrabberCamera=s;var a=function(t){__extends(i,t);function i(i){t.call(this);this.grabberPilot=i;this.position=new e.XYZ(0,0,-3);this.upVector=new e.XYZ(0,1,0);this.frontDir=new e.XYZ(0,0,1);this.sizes=new e.XYZ(1,1,1);this.smoothParam=.5;this.positioningCopy=new e.Positioning}i.prototype.almostEqual=function(t){return e.geo.xyzAlmostEquality(this.position,t.getPosition())&&e.geo.xyzAlmostEquality(this.upVector,t.upVector)&&e.geo.xyzAlmostEquality(this.frontDir,t.frontDir)};i.prototype.goCloser=function(t){e.geo.between(t.position,this.position,this.smoothParam,this.position);e.geo.between(t.upVector,this.upVector,this.smoothParam,this.upVector);e.geo.between(t.frontDir,this.frontDir,this.smoothParam,this.frontDir);if(this.upVector.lengthSquared()<e.geo.epsilonSquare){this.upVector.copyFrom(t.upVector).scale(-1);e.logger.c("a wished upVector was opposite to the true upVector")}if(this.frontDir.lengthSquared()<e.geo.epsilonSquare){this.frontDir.copyFrom(t.frontDir).scale(-1);e.logger.c("a wished frontDir was opposite to the true frontDir")}if(this.grabberPilot.onPositioningChange!=null){this.positioningCopy.copyFrom(this);this.grabberPilot.onPositioningChange(this.positioningCopy)}};i.prototype.copyFrom=function(t){e.geo.copyXYZ(t.position,this.position);e.geo.copyXYZ(t.upVector,this.upVector);e.geo.copyXYZ(t.frontDir,this.frontDir)};i.prototype.changeFrontDir=function(t){e.geo.orthonormalizeKeepingFirstDirection(t,this.upVector,this.frontDir,this.upVector)};i.prototype.changeUpVector=function(t){e.geo.orthonormalizeKeepingFirstDirection(this.upVector,t,this.upVector,this.frontDir)};return i}(e.Positioning);t.CamPositioning=a;var n=function(t){__extends(i,t);function i(i){var s=this;t.call(this);this.camera=i;this.upVector=new e.XYZ(0,1,0);this.frontDir=new e.XYZ(0,0,1);this.position=new e.XYZ(0,0,-3);this._newPositionBeforCollision=new e.XYZ(0,0,0);this._velocity=new e.XYZ(0,0,0);this._collider=new r;this.ellipsoid=new e.XYZ(1,1,1);this._oldPosition=new e.XYZ(0,0,0);this._diffPosition=new e.XYZ(0,0,0);this._newPosition=new e.XYZ(0,0,0);this._inter=new e.XYZ(0,0,0);this._upPerturbation=new e.XYZ(0,0,0);this._onCollisionPositionChange=function(e,t,i){if(i===void 0){i=null}s._newPosition.copyFrom(t);s._newPosition.subtractToRef(s._oldPosition,s._diffPosition).scale(2);if(i!=null){console.log("collision");s._upPerturbation.copyFrom(s.upVector).scale(.005);s.position.add(s._diffPosition).add(s._upPerturbation)}else s.position.copyFrom(s._oldPosition)}}i.prototype.getPosition=function(){return this.position};i.prototype.changePosition=function(e){if(this.camera.positionChangesBiaiser!=null){this._newPositionBeforCollision.copyFrom(this.camera.positionChangesBiaiser(this.position,e,this.camera.currentGrabber))}else this._newPositionBeforCollision.copyFrom(e);if(this.camera.checkCollisions){this._velocity.copyFrom(this._newPositionBeforCollision).substract(this.camera.trueCamPos.position);this._collideWithWorld(this._velocity,this._newPositionBeforCollision)}else this.position.copyFrom(this._newPositionBeforCollision)};i.prototype._collideWithWorld=function(e,t){this._collider.radius=this.ellipsoid;this._oldPosition.copyFrom(t);this.camera.scene.collisionCoordinator.getNewPosition(this._oldPosition,e,this._collider,3,null,this._onCollisionPositionChange,-13)};return i}(e.Positioning);t.WishedPositioning=n;var o=function(){function t(t){this.parallelDisplacementInsteadOfRotation=false;this.showGrabberOnlyWhenGrabbing=true;this.referenceCenter=null;this.onGrabbingActions=new e.StringMap;this.endOfZone1=1;this.endOfZone2=3;this.endOfZone3=10;this.zoneAreDefinedFromCenterRatherFromSurface=true;this.focusOnMyCenterWhenCameraGoDownWard=true;this.scene=t;this.material=new BABYLON.StandardMaterial("",this.scene);this.material=new BABYLON.StandardMaterial("texture1",this.scene);this.material.alpha=.3;this.material.diffuseColor=new BABYLON.Color3(1,1,1)}t.prototype.dispose=function(){this.mesh.dispose()};t.prototype.interpolationCoefAccordingToCamPosition=function(t,i){var r=0;if(this.zoneAreDefinedFromCenterRatherFromSurface)r=e.geo.distance(t,this.referenceCenter);else r=i;if(r<=this.endOfZone1)return 0;if(r>=this.endOfZone2)return 1;return(r-this.endOfZone1)/(this.endOfZone2-this.endOfZone1)};t.prototype.checkArgs=function(){if(this.zoneAreDefinedFromCenterRatherFromSurface&&this.referenceCenter==null)throw"you must define a reference center when zoneAreDefinedFromCenterRatherFromSurface";if(this.focusOnMyCenterWhenCameraGoDownWard&&this.referenceCenter==null)throw"you must define a reference center when focusOnMyCenterWhenCameraGoDownWard";if(this.endOfZone1>this.endOfZone2)throw"zone2 must contains zone1";if(this.endOfZone2>this.endOfZone3)throw"zone3 must contains zone2"};return t}();t.Grabber=o;var h=function(t){__extends(i,t);function i(i,r,s,a){if(r===void 0){r=new e.XYZ(1,1,1)}if(s===void 0){s=new e.XYZ(0,0,0)}if(a===void 0){a=false}t.call(this,i);this.radius=1;this.radius=r.x;this.endOfZone1=this.radius;this.endOfZone2=3*this.radius;this.endOfZone3=10*this.radius;this.referenceCenter=s;this.focusOnMyCenterWhenCameraGoDownWard=true;this.parallelDisplacementInsteadOfRotation=false;this.showGrabberOnlyWhenGrabbing=true;this.mesh=BABYLON.Mesh.CreateSphere("default sphere for grabbing",10,2,i);this.mesh.position=s;this.mesh.scaling=r;this.mesh.material=this.material;this.mesh.isPickable=a}return i}(o);t.SphericalGrabber=h;var l=function(t){__extends(i,t);function i(i,r,s,a,n){if(r===void 0){r=new e.XYZ(1,1,1)}if(s===void 0){s=new e.XYZ(0,0,0)}if(a===void 0){a=new e.XYZW(0,0,0,1)}if(n===void 0){n=false}t.call(this,i);this.referenceCenter=null;this.focusOnMyCenterWhenCameraGoDownWard=false;this.parallelDisplacementInsteadOfRotation=true;this.zoneAreDefinedFromCenterRatherFromSurface=false;this.endOfZone1=0;this.endOfZone2=0;this.mesh=BABYLON.Mesh.CreatePlane("default plane for grabbing",1,i);this.mesh.position=s;this.mesh.scaling=r;this.mesh.rotationQuaternion=a;this.mesh.material=this.material;this.mesh.isPickable=n}return i}(o);t.PlanarGrabber=l})(t=e.macamera||(e.macamera={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(t){this.attractionOfTangent=new e.XYZ(1,.0123456721,.00078654343);this.computeTangent=true;this.computeNormal=true;this.computeSizes=true;this.sizesProp=new e.XYZ(.3,.3,.3);this.allVerticesHaveSameSizes=true;this.temp=new e.XYZ(0,0,0);this._side1=new e.XYZ(0,0,0);this._side2=new e.XYZ(0,0,0);this.mamesh=t}t.prototype.checkArgs=function(){if(this.mamesh.smallestSquares.length==0&&this.mamesh.smallestTriangles.length==0)throw"no triangles nor Square. The normals cannot be computed"};t.prototype.go=function(){var t=this;var i=new e.HashMap;if(this.mamesh.vertices.length==0){e.logger.c("you try to compute normal, tangent, diameter for an empty mamesh");return}this.mamesh.vertices.forEach(function(t){var r=new e.Positioning;r.position=t.position;r.upVector=new e.XYZ(0,0,0);r.frontDir=new e.XYZ(0,0,0);i.putValue(t,r)});if(this.computeTangent){this.mamesh.vertices.forEach(function(r){var s=Number.NEGATIVE_INFINITY;var a=Number.POSITIVE_INFINITY;var n=new e.XYZ(0,0,0);var o=new e.XYZ(0,0,0);if(r.links.length==0)throw"a vertex with no links. Impossible to compute a tangent";var h=t.attractionOfTangent.length();for(var l=0;l<r.links.length;l++){t.temp.copyFrom(r.links[l].to.position).substract(r.position);if(t.temp.length()<e.geo.epsilon){e.logger.c("a mamesh has two vertices at almost the same position")}else{var u=e.geo.dot(t.temp,t.attractionOfTangent)/t.temp.length()/h;if(u>s){s=u;n.copyFrom(t.temp)}if(u<a){a=u;o.copyFrom(t.temp)}}}if(-a>2*s)i.getValue(r).frontDir.copyFrom(o.scale(-1));else i.getValue(r).frontDir.copyFrom(n)})}if(this.computeNormal){var r=[];for(var s=0;s<this.mamesh.smallestTriangles.length/3;s++){this._side1.copyFrom(this.mamesh.smallestTriangles[3*s+1].position).substract(this.mamesh.smallestTriangles[3*s].position);this._side2.copyFrom(this.mamesh.smallestTriangles[3*s+2].position).substract(this.mamesh.smallestTriangles[3*s].position);r[s]=new e.XYZ(0,0,0);e.geo.cross(this._side1,this._side2,r[s]);r[s].normalize()}var a=[];for(var s=0;s<this.mamesh.smallestSquares.length/4;s++){this._side1.copyFrom(this.mamesh.smallestSquares[4*s+1].position).substract(this.mamesh.smallestSquares[4*s].position);this._side2.copyFrom(this.mamesh.smallestSquares[4*s+3].position).substract(this.mamesh.smallestSquares[4*s].position);a[s]=new e.XYZ(0,0,0);e.geo.cross(this._side1,this._side2,a[s]);try{a[s].normalize()}catch(e){throw"the square"+this.mamesh.smallestSquares[4*s].hashNumber+","+this.mamesh.smallestSquares[4*s+1].hashNumber+","+this.mamesh.smallestSquares[4*s+2].hashNumber+","+this.mamesh.smallestSquares[4*s+3].hashNumber+" is degenerated"}}for(var s=0;s<r.length;s++){var n=this.mamesh.smallestTriangles[3*s];var o=this.mamesh.smallestTriangles[3*s+1];var h=this.mamesh.smallestTriangles[3*s+2];i.getValue(n).upVector.add(r[s]);i.getValue(o).upVector.add(r[s]);i.getValue(h).upVector.add(r[s])}for(var s=0;s<a.length;s++){var n=this.mamesh.smallestSquares[4*s];var o=this.mamesh.smallestSquares[4*s+1];var h=this.mamesh.smallestSquares[4*s+2];var l=this.mamesh.smallestSquares[4*s+3];i.getValue(n).upVector.add(a[s]);i.getValue(o).upVector.add(a[s]);i.getValue(h).upVector.add(a[s]);i.getValue(l).upVector.add(a[s])}var u=[];this.mamesh.vertices.forEach(function(t){try{i.getValue(t).upVector.normalize()}catch(i){e.logger.c("a too small upVector for a vertex, probably a vertex which is not in any polygone. The upVector will be the mean of other upVector");u.push(t)}});if(u.length>0){var c=new e.XYZ(0,0,0);for(var m=0,d=this.mamesh.vertices;m<d.length;m++){var f=d[m];c.add(i.getValue(f).upVector)}try{c.normalize()}catch(e){throw"canot manage to compute upVector for any vertex"}for(var p=0,v=u;p<v.length;p++){var g=v[p];i.getValue(g).upVector.copyFrom(c)}}}if(this.computeSizes){if(!this.allVerticesHaveSameSizes){this.mamesh.vertices.forEach(function(r){var s=0;r.links.forEach(function(t){s+=e.geo.distance(r.position,t.to.position)});i.getValue(r).scaling.copyFrom(t.sizesProp).scale(s/r.links.length)})}else{var w=0;var y=this.mamesh.vertices[0];var b=0;y.links.forEach(function(t){b+=e.geo.distance(y.position,t.to.position)});w=b/y.links.length;this.mamesh.vertices.forEach(function(e){return i.getValue(e).scaling.copyFrom(t.sizesProp).scale(w)})}}return i};return t}();t.PositioningComputerForMameshVertices=i})(t=e.mameshAroundComputations||(e.mameshAroundComputations={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){function i(t,i,r,s){if(r.middle==null){var a=new e.XYZ(0,0,0);e.geo.between(r.a.position,r.b.position,.5,a);r.middle=i.newVertex(a,Math.max(r.a.dichoLevel,r.b.dichoLevel)+1,t(r.a.param,r.b.param));if(r.a.hasMark(e.Vertex.Markers.border)&&r.b.hasMark(e.Vertex.Markers.border))r.middle.markers.push(e.Vertex.Markers.border);if(s!=null)r.orth1=s}else if(s!=null)r.orth2=s}var r=function(){function t(t){this.makeLinks=true;this.trianglesToCut=null;this.nbDicho=1;this.newParamForMiddle=function(t,i){var r=new e.XYZ(0,0,0);e.geo.between(t,i,1/2,r);return r};this.mamesh=t}t.prototype.checkArgs=function(){if(this.mamesh.smallestTriangles.length==0)e.logger.c("no triangulatedRect for triangulatedRect dichotomy")};t.prototype.go=function(){this.checkArgs();if(!this.makeLinks)this.mamesh.clearLinksAndLines();var t;if(this.trianglesToCut==null){this.trianglesToCut=this.mamesh.smallestTriangles;t=new Array}else{t=new e.tab.ArrayMinusBlocksElements(this.mamesh.smallestTriangles,3,this.trianglesToCut).go()}var r=this.createAndAddSegmentsFromTriangles(this.trianglesToCut);for(var s=0;s<this.trianglesToCut.length;s+=3){var a=this.trianglesToCut[s];var n=this.trianglesToCut[s+1];var o=this.trianglesToCut[s+2];var h=r[e.Segment.segmentId(a.hashNumber,n.hashNumber)];var l=r[e.Segment.segmentId(n.hashNumber,o.hashNumber)];var u=r[e.Segment.segmentId(o.hashNumber,a.hashNumber)];if(this.makeLinks){i(this.newParamForMiddle,this.mamesh,h,o);i(this.newParamForMiddle,this.mamesh,l,a);i(this.newParamForMiddle,this.mamesh,u,n)}else{i(this.newParamForMiddle,this.mamesh,h);i(this.newParamForMiddle,this.mamesh,l);i(this.newParamForMiddle,this.mamesh,u)}var c=h.middle;var m=l.middle;var d=u.middle;t.push(a,c,d);t.push(n,m,c);t.push(o,d,m);t.push(c,m,d)}if(this.makeLinks){for(var f in r){var p=r[f];var v=r[e.Segment.segmentId(p.a.hashNumber,p.orth1.hashNumber)];var g=r[e.Segment.segmentId(p.b.hashNumber,p.orth1.hashNumber)];if(p.orth2!=null){var w=r[e.Segment.segmentId(p.a.hashNumber,p.orth2.hashNumber)];var y=r[e.Segment.segmentId(p.b.hashNumber,p.orth2.hashNumber)];p.middle.setTwoOppositeLinks(v.middle,y.middle);p.middle.setTwoOppositeLinks(w.middle,g.middle)}else{p.middle.setOneLink(v.middle);p.middle.setOneLink(g.middle)}try{var b=function(e,t,i){var r=e.findLink(t);r.to=i};b(p.a,p.b,p.middle);b(p.b,p.a,p.middle);p.middle.setTwoOppositeLinks(p.a,p.b)}catch(e){throw"a bad segment, probably your triangles are not corrects (e.g. one missing, or one more)"}}}this.mamesh.smallestTriangles=t};t.prototype.createAndAddSegmentsFromTriangles=function(e){var t={};for(var i=0;i<e.length;i+=3){var r=e[i];var s=e[i+1];var a=e[i+2];this.mamesh.getOrCreateSegment(r,s,t);this.mamesh.getOrCreateSegment(s,a,t);this.mamesh.getOrCreateSegment(a,r,t)}return t};return t}();t.TriangleDichotomer=r;var s=function(){function t(i){this.makeLinks=true;this.squareToCut=null;this.dichoStyle=t.DichoStyle.fourSquares;this.newParamForMiddle=function(t,i){var r=new e.XYZ(0,0,0);e.geo.between(t,i,1/2,r);return r};this.newParamForCenter=function(t,i,r,s){var a=new e.XYZ(0,0,0);e.geo.baryCenter([t,i,r,s],[1/4,1/4,1/4,1/4],a);return a};this.mamesh=i}t.prototype.checkArgs=function(){if(this.mamesh.smallestSquares.length==0)throw"no square for square dichotomy";this.mamesh.clearLinksAndLines()};t.prototype.go=function(){this.checkArgs();var r;if(this.squareToCut==null){this.squareToCut=this.mamesh.smallestSquares;r=new Array}else{r=new e.tab.ArrayMinusBlocksElements(this.mamesh.smallestSquares,4,this.squareToCut).go()}var s=this.createAndAddSegmentsFromSquare(this.squareToCut);for(var a=0;a<this.squareToCut.length;a+=4){var n=this.squareToCut[a];var o=this.squareToCut[a+1];var h=this.squareToCut[a+2];var l=this.squareToCut[a+3];var u=s[e.Segment.segmentId(n.hashNumber,o.hashNumber)];var c=s[e.Segment.segmentId(o.hashNumber,h.hashNumber)];var m=s[e.Segment.segmentId(h.hashNumber,l.hashNumber)];var d=s[e.Segment.segmentId(l.hashNumber,n.hashNumber)];i(this.newParamForMiddle,this.mamesh,u);i(this.newParamForMiddle,this.mamesh,c);i(this.newParamForMiddle,this.mamesh,m);i(this.newParamForMiddle,this.mamesh,d);var f=u.middle;var p=c.middle;var v=m.middle;var g=d.middle;if(this.dichoStyle==t.DichoStyle.fourSquares){var w=new e.XYZ(0,0,0);e.geo.baryCenter([u.a.position,u.b.position,m.a.position,m.b.position],[1/4,1/4,1/4,1/4],w);var y=Math.max(u.a.dichoLevel,u.b.dichoLevel,m.a.dichoLevel,m.b.dichoLevel)+1;var b=this.mamesh.newVertex(w,y,this.newParamForCenter(u.a.param,u.b.param,m.a.param,m.b.param));var T=new e.Segment(f,v);T.middle=b;this.mamesh.cutSegmentsDico[e.Segment.segmentId(f.hashNumber,v.hashNumber)]=T;r.push(n,f,b,g);r.push(o,p,b,f);r.push(h,v,b,p);r.push(l,g,b,v)}else if(this.dichoStyle==t.DichoStyle.fourTriangles){r.push(f,p,v,g);this.mamesh.smallestTriangles.push(n,f,g);this.mamesh.smallestTriangles.push(o,p,f);this.mamesh.smallestTriangles.push(h,v,p);this.mamesh.smallestTriangles.push(l,g,v)}else throw"ho ho"}this.mamesh.smallestSquares=r;if(this.makeLinks){var M=new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(this.mamesh);M.goChanging()}};t.prototype.createAndAddSegmentsFromSquare=function(e){var t={};for(var i=0;i<e.length;i+=4){var r=e[i];var s=e[i+1];var a=e[i+2];var n=e[i+3];this.mamesh.getOrCreateSegment(r,s,t);this.mamesh.getOrCreateSegment(s,a,t);this.mamesh.getOrCreateSegment(a,n,t);this.mamesh.getOrCreateSegment(n,r,t)}return t};return t}();t.SquareDichotomer=s;var a=function(){function t(t){this.makeLinks=true;this.squareToCut=null;this.dichoStyle=s.DichoStyle.fourSquares;this.newParamForMiddle=function(t,i){var r=new e.XYZ(0,0,0);e.geo.between(t,i,1/2,r);return r};this.newParamForCenter=function(t,i,r,s){var a=new e.XYZ(0,0,0);e.geo.baryCenter([t,i,r,s],[1/4,1/4,1/4,1/4],a);return a};this.mamesh=t}t.prototype.checkArgs=function(){if(this.mamesh.smallestSquares.length==0)throw"no square for square dichotomy";this.mamesh.clearLinksAndLines()};t.prototype.go=function(){this.checkArgs();var t;if(this.squareToCut==null){this.squareToCut=this.mamesh.smallestSquares;t=new Array}else{t=new e.tab.ArrayMinusBlocksElements(this.mamesh.smallestSquares,4,this.squareToCut).go()}var r=this.createAndAddSegmentsFromSquare(this.squareToCut);for(var a=0;a<this.squareToCut.length;a+=4){var n=this.squareToCut[a];var o=this.squareToCut[a+1];var h=this.squareToCut[a+2];var l=this.squareToCut[a+3];var u=r[e.Segment.segmentId(n.hashNumber,o.hashNumber)];var c=r[e.Segment.segmentId(o.hashNumber,h.hashNumber)];var m=r[e.Segment.segmentId(h.hashNumber,l.hashNumber)];var d=r[e.Segment.segmentId(l.hashNumber,n.hashNumber)];i(this.newParamForMiddle,this.mamesh,u);i(this.newParamForMiddle,this.mamesh,c);i(this.newParamForMiddle,this.mamesh,m);i(this.newParamForMiddle,this.mamesh,d);var f=u.middle;var p=c.middle;var v=m.middle;var g=d.middle;if(this.dichoStyle==s.DichoStyle.fourSquares){var w=new e.XYZ(0,0,0);e.geo.baryCenter([u.a.position,u.b.position,m.a.position,m.b.position],[1/4,1/4,1/4,1/4],w);var y=Math.max(u.a.dichoLevel,u.b.dichoLevel,m.a.dichoLevel,m.b.dichoLevel)+1;var b=this.mamesh.newVertex(w,y,this.newParamForCenter(u.a.param,u.b.param,m.a.param,m.b.param));var T=new e.Segment(f,v);T.middle=b;this.mamesh.cutSegmentsDico[e.Segment.segmentId(f.hashNumber,v.hashNumber)]=T;t.push(n,f,b,g);t.push(o,p,b,f);t.push(h,v,b,p);t.push(l,g,b,v)}else if(this.dichoStyle==s.DichoStyle.fourTriangles){t.push(f,p,v,g);this.mamesh.smallestTriangles.push(n,f,g);this.mamesh.smallestTriangles.push(o,p,f);this.mamesh.smallestTriangles.push(h,v,p);this.mamesh.smallestTriangles.push(l,g,v)}else throw"ho ho"}this.mamesh.smallestSquares=t;if(this.makeLinks){var M=new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(this.mamesh);M.goChanging()}};t.prototype.createAndAddSegmentsFromSquare=function(e){var t={};for(var i=0;i<e.length;i+=4){var r=e[i];var s=e[i+1];var a=e[i+2];var n=e[i+3];this.mamesh.getOrCreateSegment(r,s,t);this.mamesh.getOrCreateSegment(s,a,t);this.mamesh.getOrCreateSegment(a,n,t);this.mamesh.getOrCreateSegment(n,r,t)}return t};return t}();t.SimplestSquareDichotomer=a;var s;(function(e){(function(e){e[e["fourSquares"]=0]="fourSquares";e[e["fourTriangles"]=1]="fourTriangles"})(e.DichoStyle||(e.DichoStyle={}));var t=e.DichoStyle})(s=t.SquareDichotomer||(t.SquareDichotomer={}));var n=function(){function t(e){this.subdivider=3;this.hexahedronsToCut=null;this.suppressVolumes=null;this.createdPointsPerSegment={};this.createdPointsPerSurface={};this.newHexahedrons=null;this.points=null;this.mamesh=e}t.prototype.checkArgs=function(){if(this.hexahedronsToCut==null&&this.mamesh.hexahedrons.length==0||this.hexahedronsToCut!=null&&this.hexahedronsToCut.length==0)e.logger.c("HexahedronSubdivider : No input")};t.prototype.go=function(){this.checkArgs();if(this.hexahedronsToCut==null)this.hexahedronsToCut=this.mamesh.hexahedrons;this.points=new Array(this.subdivider+1);for(var e=0;e<=this.subdivider;e++){this.points[e]=new Array(this.subdivider+1);for(var t=0;t<=this.subdivider;t++)this.points[e][t]=new Array(this.subdivider+1)}this.subdivideHexahedrons()};t.prototype.subdivideHexahedronInVertices=function(t){var i=this;var r=this.subdivider;var s=[[0,0,0],[r,0,0],[r,0,r],[0,0,r],[0,r,r],[0,r,0],[r,r,0],[r,r,r]];s.forEach(function(e,r){var s=e[0],a=e[1],n=e[2];i.points[s][a][n]=i.hexahedronsToCut[t+r]});var a=[[0,1],[1,2],[2,3],[3,0],[0,5],[1,6],[2,7],[3,4],[4,5],[5,6],[6,7],[7,4]];for(var n=0,o=a;n<o.length;n++){var h=o[n],l=h[0],u=h[1];var c=e.Hash.segment(this.hexahedronsToCut[t+l],this.hexahedronsToCut[t+u]);if(this.hexahedronsToCut[t+l].hashNumber>this.hexahedronsToCut[t+u].hashNumber)_=[u,l],l=_[0],u=_[1];var m=s[l],d=m[0],f=m[1],p=m[2];var v=s[u],g=v[0],w=v[1],y=v[2];for(var b=1;b<r;b++)this.points[d+(g-d)/r*b][f+(w-f)/r*b][p+(y-p)/r*b]=this.createdPointsPerSegment[c][b]}var T=[[0,1,2,3],[4,7,6,5],[0,3,4,5],[1,6,7,2],[2,7,4,3],[0,5,6,1]];for(var M=0,C=T;M<C.length;M++){var S=C[M],l=S[0],u=S[1],x=S[2],F=S[3];var c=e.Hash.quad(this.hexahedronsToCut[t+l],this.hexahedronsToCut[t+u],this.hexahedronsToCut[t+x],this.hexahedronsToCut[t+F]);while(this.hexahedronsToCut[t+l].hashNumber>this.hexahedronsToCut[t+u].hashNumber||this.hexahedronsToCut[t+l].hashNumber>this.hexahedronsToCut[t+x].hashNumber||this.hexahedronsToCut[t+l].hashNumber>this.hexahedronsToCut[t+F].hashNumber)E=[u,x,F,l],l=E[0],u=E[1],x=E[2],F=E[3];if(this.hexahedronsToCut[t+u].hashNumber>this.hexahedronsToCut[t+F].hashNumber)R=[F,u],u=R[0],F=R[1];var V=s[l],d=V[0],f=V[1],p=V[2];var k=s[u],g=k[0],w=k[1],y=k[2];var O=s[x],A=O[0],P=O[1],L=O[2];for(var b=1;b<r;b++)for(var B=1;B<r;B++)this.points[d+(g-d)/r*b+(A-g)/r*B][f+(w-f)/r*b+(P-w)/r*B][p+(y-p)/r*b+(L-y)/r*B]=this.createdPointsPerSurface[c][b][B]}for(var Y=1;Y<r;Y++){for(var I=1;I<r;I++){for(var $=1;$<r;$++){var D=new e.XYZ(0,0,0);var N=Y/r;var X=I/r;var Z=$/r;e.geo.baryCenter([this.hexahedronsToCut[t].position,this.hexahedronsToCut[t+1].position,this.hexahedronsToCut[t+2].position,this.hexahedronsToCut[t+3].position,this.hexahedronsToCut[t+4].position,this.hexahedronsToCut[t+5].position,this.hexahedronsToCut[t+6].position,this.hexahedronsToCut[t+7].position],[(1-N)*(1-X)*(1-Z),N*(1-X)*(1-Z),N*(1-X)*Z,(1-N)*(1-X)*Z,(1-N)*X*Z,(1-N)*X*(1-Z),N*X*(1-Z),N*X*Z],D);this.points[Y][I][$]=this.mamesh.newVertex(D)}}}var _,E,R};t.prototype.makeNewHexahedronsFromPoints=function(){if(this.suppressVolumes==null)this.suppressVolumes=[];var e=this.subdivider;var t=function(t){var r=function(r){var s=function(e){if(i.suppressVolumes.some(function(i){return i[0]==t&&i[1]==r&&i[2]==e}))return"continue";i.newHexahedrons.push.apply(i.newHexahedrons,[i.points[t][r][e],i.points[t+1][r][e],i.points[t+1][r][e+1],i.points[t][r][e+1],i.points[t][r+1][e+1],i.points[t][r+1][e],i.points[t+1][r+1][e],i.points[t+1][r+1][e+1]])};for(var a=0;a<e;a++){s(a)}};for(var s=0;s<e;s++){r(s)}};var i=this;for(var r=0;r<e;r++){t(r)}};t.prototype.makeSurfacesVertices=function(){var t=[[0,1,2,3],[4,7,6,5],[0,3,4,5],[1,6,7,2],[2,7,4,3],[0,5,6,1]];for(var i=0;i<this.hexahedronsToCut.length;i+=8){for(var r=0,s=t;r<s.length;r++){var a=s[r],n=a[0],o=a[1],h=a[2],l=a[3];if(this.createdPointsPerSurface[e.Hash.quad(this.hexahedronsToCut[i+n],this.hexahedronsToCut[i+o],this.hexahedronsToCut[i+h],this.hexahedronsToCut[i+l])]==null)this.createdPointsPerSurface[e.Hash.quad(this.hexahedronsToCut[i+n],this.hexahedronsToCut[i+o],this.hexahedronsToCut[i+h],this.hexahedronsToCut[i+l])]=this.subdivideSurface(this.hexahedronsToCut[i+n],this.hexahedronsToCut[i+o],this.hexahedronsToCut[i+h],this.hexahedronsToCut[i+l])}}};t.prototype.makeSegmentsVertices=function(){var t=[[0,1],[1,2],[2,3],[3,0],[0,5],[1,6],[2,7],[3,4],[4,5],[5,6],[6,7],[7,4]];for(var i=0;i<this.hexahedronsToCut.length;i+=8){for(var r=0,s=t;r<s.length;r++){var a=s[r],n=a[0],o=a[1];if(this.createdPointsPerSegment[e.Hash.segment(this.hexahedronsToCut[i+n],this.hexahedronsToCut[i+o])]==null)this.createdPointsPerSegment[e.Hash.segment(this.hexahedronsToCut[i+n],this.hexahedronsToCut[i+o])]=this.subdivideSegment(this.hexahedronsToCut[i+n],this.hexahedronsToCut[i+o])}}};t.prototype.subdivideSegment=function(t,i){h=e.Hash.segmentOrd(t,i),t=h[0],i=h[1];var r=[];var s=this.subdivider;for(var a=1;a<s;a++){var n=new e.XYZ(0,0,0);var o=a/s;e.geo.baryCenter([t.position,i.position],[1-o,o],n);r[a]=this.mamesh.newVertex(n)}return r;var h};t.prototype.subdivideSurface=function(t,i,r,s){d=e.Hash.quadOrd(t,i,r,s),t=d[0],i=d[1],r=d[2],s=d[3];var a=[];var n=this.subdivider;for(var o=1;o<n;o++){a[o]=[];for(var h=1;h<n;h++){var l=new e.XYZ(0,0,0);var u=[h/n,o/n],c=u[0],m=u[1];e.geo.baryCenter([t.position,i.position,r.position,s.position],[(1-c)*(1-m),c*(1-m),c*m,(1-c)*m],l);a[o][h]=this.mamesh.newVertex(l)}}return a;var d};t.prototype.subdivideHexahedrons=function(){this.makeSegmentsVertices();this.makeSurfacesVertices();var e=this.hexahedronsToCut.length/8;this.newHexahedrons=[];for(var t=0;t<e;t++){this.subdivideHexahedronInVertices(t*8);this.makeNewHexahedronsFromPoints()}};return t}();t.HexahedronSubdivider=n;var o=function(){function t(e){this.hexahedronsToDraw=null;this.newSurfaces=null;this.surfacesSet={};this.mamesh=e}t.prototype.checkArgs=function(){if(this.hexahedronsToDraw==null&&(this.mamesh.hexahedrons==null||this.mamesh.hexahedrons.length==0)||this.hexahedronsToDraw!=null&&this.hexahedronsToDraw.length==0)e.logger.c("SurfacesFromHexahedrons : No input")};t.prototype.go=function(){this.checkArgs();if(this.hexahedronsToDraw==null)this.hexahedronsToDraw=this.mamesh.hexahedrons;var t=[[0,3,2,1],[4,5,6,7],[0,5,4,3],[1,2,7,6],[2,3,4,7],[0,1,6,5]];this.newSurfaces=[];for(var i=0;i<this.hexahedronsToDraw.length;i+=8){for(var r=0,s=t;r<s.length;r++){var a=s[r],n=a[0],o=a[1],h=a[2],l=a[3];var u=e.Hash.quad(this.hexahedronsToDraw[i+n],this.hexahedronsToDraw[i+o],this.hexahedronsToDraw[i+h],this.hexahedronsToDraw[i+l]);if(this.surfacesSet[u]==null)this.surfacesSet[u]=[this.hexahedronsToDraw[i+n],this.hexahedronsToDraw[i+o],this.hexahedronsToDraw[i+h],this.hexahedronsToDraw[i+l]];else delete this.surfacesSet[u]}}for(var c in this.surfacesSet)this.newSurfaces.push.apply(this.newSurfaces,this.surfacesSet[c]);var m=this.newSurfaces.length;for(var n=0;n<m;n+=5e3)this.mamesh.smallestSquares.push.apply(this.mamesh.smallestSquares,this.newSurfaces.slice(n,n+5e3))};return t}();t.SurfacesFromHexahedrons=o;var h=function(){function t(e){this.copyCutSegmentsDico=true;this.copyLines=true;this.oldMamesh=e}t.prototype.go=function(){var t=new e.HashMap;var i=new e.Mamesh;this.oldMamesh.vertices.forEach(function(r){var s=e.XYZ.newFrom(r.param);var a=i.newVertex(r.position,r.dichoLevel,s);t.putValue(r,a);a.importantMarker=r.importantMarker;r.markers.forEach(function(e){return a.markers.push(e)})});this.oldMamesh.vertices.forEach(function(i){var r=t.getValue(i);for(var s=0;s<i.links.length;s++){r.links[s]=new e.Link(t.getValue(i.links[s].to))}for(var s=0;s<i.links.length;s++){var a=i.links[s];var n=r.links[s];if(a.opposites!=null){n.opposites=[];for(var o=0,h=a.opposites;o<h.length;o++){var l=h[o];var u=i.links.indexOf(l);n.opposites.push(r.links[u])}}}});this.oldMamesh.smallestTriangles.forEach(function(e){i.smallestTriangles.push(t.getValue(e))});this.oldMamesh.smallestSquares.forEach(function(e){i.smallestSquares.push(t.getValue(e))});if(this.copyLines){if(this.oldMamesh.linesWasMade){var r=this.oldMamesh.getStraightLinesAsVertices();var s=this.oldMamesh.getLoopLinesAsVertices();i.lines=[];r.forEach(function(r){var s=[];r.forEach(function(e){s.push(t.getValue(e))});i.lines.push(new e.Line(s,false))});s.forEach(function(r){var s=[];r.forEach(function(e){s.push(t.getValue(e))});i.lines.push(new e.Line(s,true))})}}if(this.copyCutSegmentsDico){for(var a in this.oldMamesh.cutSegmentsDico){var n=this.oldMamesh.cutSegmentsDico[a];var o=t.getValue(n.a);var h=t.getValue(n.b);var l=new e.Segment(o,h);l.middle=t.getValue(n.middle);if(n.orth1!=null)l.orth1=t.getValue(n.orth1);if(n.orth2!=null)l.orth2=t.getValue(n.orth2);i.cutSegmentsDico[e.Segment.segmentId(o.hashNumber,h.hashNumber)]=l}}else this.copyCutSegmentsDico=null;return i};return t}();t.MameshDeepCopier=h;var l=function(){function t(t){var i=this;this.percolationProba=.5;this.probaToPercolateFunction=function(e){if(e.links.length==3)return 0;if(e.links.length==4)return.3*i.percolationProba;if(e.links.length==5)return.6*i.percolationProba;if(e.links.length>=6)return i.percolationProba};this.SUB_random=new e.proba.Random;this.doNotPercolateOnBorder=true;this.maxPercolationForAVertexAlreadyPercolate=0;if(t instanceof e.Mamesh){this.IN_vertices=t.vertices}else{this.IN_vertices=t}}t.prototype.goChanging=function(){if(this.IN_vertices==null)throw"vertices must be specifiate";var t=new e.HashMap;for(var i=0,r=this.IN_vertices;i<r.length;i++){var s=r[i];t.putValue(s,s.links.length)}for(var a=0,n=this.IN_vertices;a<n.length;a++){var s=n[a];if(!(this.doNotPercolateOnBorder&&s.hasMark(e.Vertex.Markers.border))){if(this.SUB_random.pseudoRand()<this.probaToPercolateFunction(s)){var o=this.SUB_random.pseudoRandInt(s.links.length);var h=s.links[o].to;if(h.links.length>=t.getValue(h)-this.maxPercolationForAVertexAlreadyPercolate)e.Vertex.separateTwoVoisins(s,h)}}}};return t}();t.PercolationOnLinks=l;var u=function(){function t(e){this.OUT_nbLinkSuppressed=0;this.OUT_nbVerticesSuppressed=0;this.suppressCellWithNoVoisin=true;this.suppressLinkWithoutOppositeFunction=function(e){return e.links.length>=5};this.IN_mamesh=e}t.prototype.goChanging=function(){if(this.IN_mamesh==null)throw"a Mamesh is require as IN_arg";if(this.suppressLinkWithoutOppositeFunction!=null)this.suppressLinkWithoutOpposite()};t.prototype.suppressLinkWithoutOpposite=function(){var t=true;while(t){t=false;for(var i=0,r=this.IN_mamesh.vertices;i<r.length;i++){var s=r[i];if(this.suppressLinkWithoutOppositeFunction(s)){for(var a=0;a<s.links.length;a++){var n=s.links[a];if(n.opposites==null){t=true;e.Vertex.separateTwoVoisins(s,n.to);this.OUT_nbLinkSuppressed++;break}}}}}if(this.suppressCellWithNoVoisin){var o=[];for(var a=0;a<this.IN_mamesh.vertices.length;a++){if(this.IN_mamesh.vertices[a].links.length==0){o.push(a);this.OUT_nbVerticesSuppressed++}}this.IN_mamesh.vertices=e.tab.arrayMinusSomeIndices(this.IN_mamesh.vertices,o)}};return t}();t.MameshCleaner=u})(t=e.mameshModification||(e.mameshModification={}))})(mathis||(mathis={}));var mathis;(function(e){function t(e){if(e===void 0){e=false}if(typeof $!=="undefined")return true;if(e)throw"jQuery is not present";else return false}e.jQueryOK=t;var i=function(){function e(e){this.nbTimesThisActionMustBeFired=Number.POSITIVE_INFINITY;this.isPaused=false;this.firedCount=0;this.id="";this.frameInterval=null;this.timeIntervalMilli=null;this.passageOrderIndex=1;this.action=e;this.lastTimeFired=performance.now()}return e}();e.PeriodicAction=i;var r=function(){function i(i,r,n){var o=this;if(i===void 0){i=null}if(r===void 0){r=true}if(n===void 0){n=false}this.callbackIfWebglNotHere=null;this.periodicActions=[];this.sortAction=function(e,t){return e.passageOrderIndex-t.passageOrderIndex};this.backgroundColor=new e.Color("#d3d3d3");this.parentWidth=null;if(n)return;if(i==null){var h=document.getElementsByTagName("html")[0];h.style.height="100%";h.style.width="100%";h.style.padding="0";h.style.margin="0";this.canvasParent=document.getElementsByTagName("body")[0];this.canvasParent.style.height="100%";this.canvasParent.style.width="100%";this.canvasParent.style.padding="0";this.canvasParent.style.margin="0"}else{if(typeof i=="string"){this.canvasParent=document.getElementById(i);if(this.canvasParent==null)throw"the id:"+i+" does not correspond to any HTMLElement"}else if(i instanceof HTMLElement)this.canvasParent=i;else throw"htmlElementOrId must be an htmlElement or the id of an html element"}if(this.canvasParent.offsetHeight<10)throw"the container-height is too small. Perhaps no css-included ?";if(this.canvasParent.offsetWidth<10)throw"the container-width is too small.  Perhaps no css-included ?";this.canvas=document.createElement("canvas");this.canvas.style.touchAction="none";this.canvasParent.appendChild(this.canvas);this.set100(this.canvas);this.callbackIfWebglNotHere=function(){setTimeout(function(){var e=document.createElement("DIV");e.id="noWebGL";e.innerHTML="<h3> Activez WebGL et relancez la page.</h3>\n                     <p> Safari: Développement > Activer WebGL</p>";o.canvasParent.appendChild(e);o.canvasParent.style.position="absolute";o.canvasParent.style.top="0";o.canvasParent.style.left="0";o.canvasParent.style.textAlign="center";o.canvasParent.style.zIndex="1001";o.canvasParent.style.backgroundColor="red"},100)};try{this.engine=new BABYLON.Engine(this.canvas,true)}catch(t){e.logger.c("webGL seems to not be present. Here is the message from Babylon:"+t);this.callbackIfWebglNotHere();this.engine=null}if(this.engine!=null){this.resetScene();var l=0;var u=0;var c=0;this.engine.runRenderLoop(function(){c++;for(var t in o.periodicActions){var i=o.periodicActions[t];if(i.isPaused)continue;if(i.timeIntervalMilli==null&&i.frameInterval==null){i.frameInterval=1;e.logger.c("no intervalle given for a periodic action: by default the action is fired every frame")}if(i.timeIntervalMilli!=null){var r=performance.now();if(r-i.lastTimeFired>i.timeIntervalMilli){o.fireAction(i);i.lastTimeFired=r}}else if(i.frameInterval!=null&&c%i.frameInterval==0)o.fireAction(i)}o.scene.render();l++;var s=o.engine.getFps();if(s<u)u=s;if(l%100==0){if(o.$info!=null)o.$info.textContent=u.toFixed();u=Number.MAX_VALUE}});this.domEventsHandler()}if(r){this.addDefaultLight();this.addDefaultCamera()}if(t()){this.messageDiv=new a(this);this.subWindow_NE=new s(this,"NE");this.subWindow_NW=new s(this,"NW");this.subWindow_N=new s(this,"N");this.subWindow_SE=new s(this,"SE");this.subWindow_SW=new s(this,"SW");this.subWindow_S=new s(this,"S");this.subWindow_W=new s(this,"W");this.subWindow_E=new s(this,"E")}}i.prototype.showFPSinCorner=function(){this.$info=document.createElement("DIV");this.canvasParent.appendChild(this.$info);this.$info.style.position="absolute";this.$info.style.top="0";this.$info.style.left="0";this.$info.style.width="100px";this.$info.style.height="20px";this.$info.style.backgroundColor="red";this.$info.style.zIndex="1000"};i.prototype.dispose=function(){this.engine.dispose()};i.prototype.resetScene=function(){if(this.scene!=null)this.scene.dispose();this.scene=new BABYLON.Scene(this.engine);this.scene.clearColor=this.backgroundColor.toBABYLON_Color4()};i.prototype.clearScene=function(t,i,r){if(t===void 0){t=true}if(i===void 0){i=true}if(r===void 0){r=true}if(this.scene==null)throw"no scene to clear";var s=[];if(this.scene.activeCamera!=null&&!t){if(this.scene.activeCamera instanceof e.macamera.GrabberCamera){var a=this.scene.activeCamera;for(var n=0,o=a.grabbers;n<o.length;n++){var h=o[n];s.push(h.mesh)}}}else{this.scene.cameras=[];if(this.scene.activeCamera!=null)this.scene.activeCamera.detachControl(this.canvas);this.scene.activeCamera=null}if(!r)s.push(this.skybox);else this.skybox=null;this.scene.meshes=s;if(i)this.scene.lights=[]};i.prototype.emptyAllCorner=function(){t(true);this.subWindow_NW.empty();this.subWindow_NE.empty();this.subWindow_N.empty();this.subWindow_SW.empty();this.subWindow_SE.empty();this.subWindow_S.empty();this.subWindow_W.empty();this.subWindow_E.empty()};i.prototype.addDefaultLight=function(){var e=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-1,1,-1),this.scene);e.diffuse=new BABYLON.Color3(1,1,1);e.specular=new BABYLON.Color3(1,1,1);e.groundColor=new BABYLON.Color3(.5,.5,.5)};i.prototype.getGrabberCamera=function(){if(this.scene.activeCamera==null)throw"no camera defined";if(this.scene.activeCamera instanceof e.macamera.GrabberCamera)return this.scene.activeCamera;else throw"active camera is not a grabber camera"};i.prototype.addDefaultCamera=function(){var t=new e.macamera.SphericalGrabber(this.scene);this.scene.activeCamera=new e.macamera.GrabberCamera(this,t);this.scene.activeCamera.attachControl(this.canvas)};i.prototype.pushPeriodicAction=function(e){this.periodicActions.push(e);this.periodicActions.sort(this.sortAction)};i.prototype.suppressPeriodicAction=function(e){var t=this.periodicActions.indexOf(e);if(t==-1)throw"this action is not registered";this.periodicActions.splice(t,1)};i.prototype.cleanAllPeriodicActions=function(){this.periodicActions=[]};i.prototype.pauseAllPeriodicActions=function(){for(var e=0,t=this.periodicActions;e<t.length;e++){var i=t[e];i.isPaused=true}};i.prototype.unpauseAllPeriodicActions=function(){for(var e=0,t=this.periodicActions;e<t.length;e++){var i=t[e];i.isPaused=false}};i.prototype.fireAction=function(e){e.action();e.firedCount++;if(e.firedCount>=e.nbTimesThisActionMustBeFired){this.suppressPeriodicAction(e)}};i.prototype.set100=function(e){e.style.position="absolute";e.style.top="0";e.style.left="0";e.style.width="100%";e.style.height="100%"};i.prototype.onParentDimChange=function(){var e=this.canvasParent.offsetWidth;if(this.parentWidth==null)this.parentWidth=e;else{if(e!=this.parentWidth){this.parentWidth=e;this.engine.resize();console.log("dim of parent of canvas  changes")}}};i.prototype.domEventsHandler=function(){var e=this;this.parentWidth=this.canvasParent.offsetWidth;window.addEventListener("resize",function(){e.onParentDimChange()});setInterval(function(){e.onParentDimChange()},1e3);var t=function(){var t=e.scene.pick(e.scene.pointerX,e.scene.pointerY,function(e){return e.isPickable},false);if(t.pickedMesh!=null){var i=t.pickedMesh.onClick;if(i!=null){i(t.pickedPoint)}}};var i;var r=function(){i=performance.now()};var s=function(){if(performance.now()-i<500)t()};var a=BABYLON.Tools.GetPointerPrefix();this.canvas.addEventListener(a+"down",r,false);this.canvas.addEventListener(a+"up",s,false)};return i}();e.MathisFrame=r;var s=function(){function e(e,i){this.mathisFrame=e;t(true);this.$visual=$('<div class="subWindow">');this.$visual.addClass(i);this.mathisFrame.canvasParent.appendChild(this.$visual[0])}e.prototype.appendAndGoToLine=function(e){this.$visual.append($("<div>").append(e))};e.prototype.append=function(e){this.$visual.append(e)};e.prototype.empty=function(){this.$visual.empty()};return e}();e.SubWindow=s;var a=function(){function e(e){this.mathisFrame=e}e.prototype.addInMathisFrame=function(){this.$logDiv=document.createElement("DIV");this.mathisFrame.canvasParent.appendChild(this.$logDiv);this.$logDiv.style.position="absolute";this.$logDiv.style.top="0";this.$logDiv.style.left="0";this.$logDiv.style.width="100%";this.$logDiv.style.backgroundColor="white";this.$logDiv.style.zIndex="900"};e.prototype.append=function(e){if(this.$logDiv==null)this.addInMathisFrame();var t=document.createElement("DIV");t.innerHTML=e;this.$logDiv.appendChild(t)};e.prototype.empty=function(){if(this.$logDiv==null)return;this.$logDiv.innerHTML=""};return e}();e.MessageDiv=a;var n=function(e){__extends(t,e);function t(){e.apply(this,arguments)}t.prototype.addInMathisFrame=function(){};t.prototype.append=function(e){};t.prototype.empty=function(){};return t}(a);e.EmptyMessageDivForTest=n;var o=function(e){__extends(t,e);function t(){e.call(this,null,null,true);this.messageDiv=new n(this)}t.prototype.dispose=function(){};t.prototype.resetScene=function(){};t.prototype.clearScene=function(e,t,i){if(e===void 0){e=true}if(t===void 0){t=true}if(i===void 0){i=true}};t.prototype.addDefaultLight=function(){};t.prototype.getGrabberCamera=function(){return new h};t.prototype.addDefaultCamera=function(){};t.prototype.pushPeriodicAction=function(e){};t.prototype.set100=function(e){};return t}(r);e.EmptyMathisFrameForFastTest=o;var h=function(){function e(){}e.prototype.changePosition=function(e,t){if(t===void 0){t=true}};e.prototype.changeFrontDir=function(e,t){if(t===void 0){t=true}};e.prototype.changeUpVector=function(e,t){if(t===void 0){t=true}};return e}();e.EmptyGrabberCameraForTest=h})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=BABYLON.Vector3;var r=BABYLON.StandardMaterial;var s=function(){function t(t,i,r){this.vecA=t;this.vecB=i;this.vecC=r;this.matWebCoordinateToPoint=new e.MM;this.matPointToWebCoordinate=new e.MM;this.isCartesian=false;this.pointWC=new e.XYZ(0,0,0);this.domainCenter=new e.XYZ(0,0,0);this.domainAroundCenter=new e.XYZ(0,0,0);this._positionWC=new n(0,0,0);this._domainPosition=new o(0,0,0);this._domainPositioncenter=new e.XYZ(0,0,0);this._zero=new e.XYZ(0,0,0);e.geo.matrixFromLines(t,i,r,this.matWebCoordinateToPoint);e.geo.inverse(this.matWebCoordinateToPoint,this.matPointToWebCoordinate)}t.prototype.contains=function(e){throw"must be override"};t.prototype.webCoordinateToPoint=function(t,i){return e.geo.multiplicationMatrixVector(this.matWebCoordinateToPoint,t,i)};t.prototype.pointToWebCoordinate=function(t,i){e.geo.multiplicationMatrixVector(this.matPointToWebCoordinate,t,i)};t.prototype.getDomainContaining=function(e){this.pointToWebCoordinate(e,this.pointWC);if(this.isCartesian)return new o(this.pointWC.x,this.pointWC.y,this.pointWC.z);else{for(var t=-1;t<=1;t++){for(var i=-1;i<=1;i++){for(var r=-1;r<=1;r++){var s=new o(this.pointWC.x+t,this.pointWC.y+i,this.pointWC.z+r);if(s.contains(e,this))return s}}}}};t.prototype.getDomainsAround=function(t,i,r){if(r===void 0){r=true}var s=[];var a=Math.floor(t/=2);var n=new e.XYZ(a,a,a);for(var h=-n.x;h<=n.x;h++){for(var l=-n.y;l<=n.y;l++){for(var u=-n.z;u<=n.z;u++){var c=new o(h,l,u);if(!(r&&h==0&&l==0&&u==0)){c.getCenter(this,this.domainAroundCenter);if(e.XYZ.DistanceSquared(this.domainAroundCenter,this.domainCenter)<i*i)s.push(c)}}}}return s};t.prototype.modulo=function(e,t){this.pointToWebCoordinate(e,this._positionWC);this._domainPosition.whichContains(this._positionWC);this._domainPosition.getCenter(this,this._domainPositioncenter);t.copyFrom(e).substract(this._domainPositioncenter)};return t}();t.FundamentalDomain=s;var a=function(t){__extends(s,t);function s(i,r,s){t.call(this,i,r,s);this.pointWC2=new e.XYZ(0,0,0);this.isCartesian=true}s.prototype.contains=function(e){t.prototype.pointToWebCoordinate.call(this,e,this.pointWC2);if(Math.abs(this.pointWC2.x)>1/2)return false;if(Math.abs(this.pointWC2.y)>1/2)return false;if(Math.abs(this.pointWC2.z)>1/2)return false;return true};s.prototype.drawMe=function(e){var t=BABYLON.Mesh.CreateBox("",1,e);t.scaling=new i(this.vecA.length(),this.vecB.length(),this.vecC.length());t.material=new r("",e);t.material.alpha=.2};s.prototype.getCorner=function(){var t=new e.XYZ(0,0,0);t.add(this.vecA).add(this.vecB).add(this.vecC);t.scaleInPlace(-.5);return t};s.prototype.getArretes=function(t){var i=this.getCorner();var r=new Array;var s=1;var a=BABYLON.Mesh.CreateCylinder("",1,s,s,12,null,t);var n=BABYLON.Mesh.CreateCylinder("",1,s,s,12,null,t);var o=BABYLON.Mesh.CreateCylinder("",1,s,s,12,null,t);new e.visu3d.ElongateAMeshFromBeginToEnd(i,e.XYZ.newFrom(i).add(this.vecA),a).goChanging();new e.visu3d.ElongateAMeshFromBeginToEnd(i,e.XYZ.newFrom(i).add(this.vecB),n).goChanging();new e.visu3d.ElongateAMeshFromBeginToEnd(i,e.XYZ.newFrom(i).add(this.vecC),o).goChanging();r.push(a);r.push(n);r.push(o);return r};return s}(s);t.CartesianFundamentalDomain=a;var n=function(e){__extends(t,e);function t(){e.apply(this,arguments)}return t}(e.XYZ);t.WebCoordinate=n;var o=function(t){__extends(i,t);function i(i,r,s){t.call(this,Math.round(i),Math.round(r),Math.round(s));this._point=new e.XYZ(0,0,0);this._domainCenter=new e.XYZ(0,0,0)}i.prototype.whichContains=function(e){this.x=Math.round(e.x);this.y=Math.round(e.y);this.z=Math.round(e.z);return this};i.prototype.equals=function(e){if(e.x!=this.x)return false;if(e.y!=this.y)return false;if(e.z!=this.z)return false;return true};i.prototype.getCenter=function(e,t){e.webCoordinateToPoint(this,t)};i.prototype.contains=function(e,t){this._point.copyFrom(e);this.getCenter(t,this._domainCenter);this._point.substract(this._domainCenter);return t.contains(this._point)};return i}(n);t.Domain=o;var h=function(){function t(e,t,i){this.fd=e;this.maxDistance=t;this.nbRepetitions=i}t.prototype.addMesh=function(t){var i=this;var r=this.fd.getDomainsAround(this.nbRepetitions,this.maxDistance);r.forEach(function(r){var s=new e.XYZ(0,0,0);var a=t.createInstance("");r.getCenter(i.fd,s);a.position.addInPlace(s);a.visibility=1;a.isVisible=true})};t.prototype.addInstancedMesh=function(t){var i=this;var r=this.fd.getDomainsAround(this.nbRepetitions,this.maxDistance);r.forEach(function(r){var s=new e.XYZ(0,0,0);var a=t.sourceMesh.createInstance("");a.scaling.copyFrom(t.scaling);a.position.copyFrom(t.position);a.rotationQuaternion=new BABYLON.Quaternion(0,0,0,0);a.rotationQuaternion.copyFrom(t.rotationQuaternion);r.getCenter(i.fd,s);a.position.addInPlace(s);a.visibility=1;a.isVisible=true})};t.prototype.addAbstractMesh=function(e){if(e instanceof BABYLON.Mesh)this.addMesh(e);else if(e instanceof BABYLON.InstancedMesh)this.addInstancedMesh(e)};return t}();t.Multiply=h})(t=e.periodicWorld||(e.periodicWorld={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){(function(e){e[e["square"]=0]="square";e[e["triangle"]=1]="triangle";e[e["diamond"]=2]="diamond";e[e["hexagonal"]=3]="hexagonal";e[e["slash"]=4]="slash";e[e["croisillon"]=5]="croisillon"})(t.Maille||(t.Maille={}));var i=t.Maille;var r=function(){function t(e){this.makeLinks=true;this.markCorners=true;this.addALoopLineAround=false;this.mamesh=e}t.prototype.go=function(){var t=this.mamesh.newVertex(new e.XYZ(0,0,0));var i=this.mamesh.newVertex(new e.XYZ(0,1,0));var r=this.mamesh.newVertex(new e.XYZ(1,0,0));this.mamesh.addATriangle(t,i,r);if(this.markCorners){t.markers.push(e.Vertex.Markers.corner);i.markers.push(e.Vertex.Markers.corner);r.markers.push(e.Vertex.Markers.corner)}if(this.makeLinks){if(!this.addALoopLineAround){t.setOneLink(i);t.setOneLink(r);i.setOneLink(t);i.setOneLink(r);r.setOneLink(t);r.setOneLink(i)}else{t.setTwoOppositeLinks(i,r);i.setTwoOppositeLinks(r,t);r.setTwoOppositeLinks(t,i)}}};return t}();t.SingleTriangle=r;var s=function(){function t(){this.markCorner=true;this.markBorder=true;this.origin=new e.XYZ(-1,-1,0);this.end=new e.XYZ(1,1,0);this.nbSubdivisionInSide=6;this.setAllDichoLevelTo0=true;this.mamesh=new e.Mamesh}t.prototype.go=function(){for(var t=0;t<3;t++){var i=new e.XYZ(Math.cos(2*Math.PI*t/3-Math.PI/2),Math.sin(2*Math.PI*t/3-Math.PI/2),0);var r=e.XYZ.newFrom(i);var s=this.mamesh.newVertex(r,0,i);s.markers.push(e.Vertex.Markers.corner)}this.mamesh.addATriangle(this.mamesh.vertices[0],this.mamesh.vertices[1],this.mamesh.vertices[2]);var a=Math.floor(Math.log(this.nbSubdivisionInSide)/Math.log(2));for(var n=0;n<a;n++){var o=new e.mameshModification.TriangleDichotomer(this.mamesh);o.makeLinks=false;o.go()}if(Math.pow(2,a)!=this.nbSubdivisionInSide){var o=new e.mameshModification.TriangleDichotomer(this.mamesh);o.makeLinks=false;o.go()}var h=new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(this.mamesh);h.markIsolateVertexAsCorner=false;h.goChanging();if(Math.pow(2,a)!=this.nbSubdivisionInSide){var l=new e.grateAndGlue.ExtractCentralPart(this.mamesh,Math.floor((Math.pow(2,a+1)-this.nbSubdivisionInSide)/3));l.markBorder=this.markBorder;this.mamesh=l.go();this.mamesh.isolateMameshVerticesFromExteriorVertices()}if(this.markCorner){for(var u=0,c=this.mamesh.vertices;u<c.length;u++){var s=c[u];if(s.links.length==2)s.markers.push(e.Vertex.Markers.corner)}}if(this.setAllDichoLevelTo0)for(var m=0,d=this.mamesh.vertices;m<d.length;m++){var f=d[m];f.dichoLevel=0}e.spacialTransformations.adjustInASquare(this.mamesh,this.origin,this.end);return this.mamesh};return t}();t.TriangulatedTriangle=s;var a=function(){function t(t){this.markCorner=true;this.markBorder=true;this.origin=new e.XYZ(-1,-1,0);this.end=new e.XYZ(1,1,0);this.nbSubdivisionInARadius=1;this.setAllDichoLevelTo0=true;this.mamesh=new e.Mamesh;this.nbSides=t}t.prototype.go=function(){var t=this.mamesh.newVertex(new e.XYZ(0,0,0),0,new e.XYZ(0,0,0));t.markers.push(e.Vertex.Markers.center);for(var i=0;i<this.nbSides;i++){var r=new e.XYZ(Math.cos(2*Math.PI*i/this.nbSides-Math.PI/2),Math.sin(2*Math.PI*i/this.nbSides-Math.PI/2),0);var s=e.XYZ.newFrom(r);var a=this.mamesh.newVertex(s,0,r);if(this.markBorder)a.markers.push(e.Vertex.Markers.border)}for(var i=1;i<this.nbSides+1;i++){this.mamesh.addATriangle(this.mamesh.vertices[0],this.mamesh.vertices[i],this.mamesh.vertices[i%this.nbSides+1])}if(this.nbSides%2==0){for(var i=1;i<=this.nbSides/2;i++){t.setTwoOppositeLinks(this.mamesh.vertices[i],this.mamesh.vertices[i+this.nbSides/2])}}else{for(var i=1;i<=this.nbSides;i++)t.setOneLink(this.mamesh.vertices[i])}for(var i=1;i<=this.nbSides;i++){var n=this.mamesh.vertices[i];var o=i==this.nbSides?this.mamesh.vertices[1]:this.mamesh.vertices[i+1];var h=i==1?this.mamesh.vertices[this.nbSides]:this.mamesh.vertices[i-1];n.setOneLink(t);n.setOneLink(o);n.setOneLink(h)}var l=Math.log(this.nbSubdivisionInARadius)/Math.log(2);for(var u=0;u<l;u++){var c=new e.mameshModification.TriangleDichotomer(this.mamesh);c.makeLinks=true;c.go()}if(l!=Math.floor(l)){var c=new e.mameshModification.TriangleDichotomer(this.mamesh);c.makeLinks=true;c.go();var m=new e.grateAndGlue.ExtractCentralPart(this.mamesh,-this.nbSubdivisionInARadius);m.markBorder=this.markBorder;this.mamesh=m.go();this.mamesh.isolateMameshVerticesFromExteriorVertices()}if(this.markCorner){for(var d=0,f=this.mamesh.vertices;d<f.length;d++){var a=f[d];if(a.links.length==3)a.markers.push(e.Vertex.Markers.corner)}}e.spacialTransformations.adjustInASquare(this.mamesh,this.origin,this.end);if(this.setAllDichoLevelTo0)for(var p=0,v=this.mamesh.vertices;p<v.length;p++){var g=v[p];g.dichoLevel=0}return this.mamesh};return t}();t.TriangulatedPolygone=a;var n=function(){function t(){this.nbI=3;this.set_nbJ_toHaveRegularReseau=false;this.nbJ=3;this.origin=new e.XYZ(0,0,0);this.end=new e.XYZ(1,1,0);this.kComponentTranslation=0;this.nbVerticalDecays=0;this.nbHorizontalDecays=0;this.squareMailleInsteadOfTriangle=true}t.prototype.go=function(){this.checkArgs();var t=(this.end.x-this.origin.x)/(this.nbI-1);var i;if(this.set_nbJ_toHaveRegularReseau){if(this.squareMailleInsteadOfTriangle)i=t;else i=t*Math.sqrt(3)/2;this.nbJ=Math.floor((this.end.y-this.origin.y)/i+1)}else{i=(this.end.y-this.origin.y)/(this.nbJ-1)}var r=this.end.x-this.origin.x;var s=this.end.y-this.origin.y;var a=this.computeDecayVector(t,r,i,s,this.nbVerticalDecays,this.nbHorizontalDecays);var n=this.computeDecayVector(i,s,t,r,this.nbHorizontalDecays,this.nbVerticalDecays);var o=new e.XYZ(n.y,n.x,0);a.z+=this.kComponentTranslation;o.z+=this.kComponentTranslation;return{Vi:a,Vj:o,nbI:this.nbI,nbJ:this.nbJ}};t.prototype.checkArgs=function(){var t=this.end.x-this.origin.x;var i=this.end.y-this.origin.y;if(Math.abs(t)<e.geo.epsilon||Math.abs(i)<e.geo.epsilon)throw"origin and end are almost in the same line";if(this.nbI<2)throw"this.nbI must be >=2";if(this.nbJ<2)throw"this.nbJ must be >=2"};t.prototype.computeDecayVector=function(t,i,r,s,a,n){var o=new e.XYZ(0,0,0);o.x=t*i*s/(i*s-t*r*n*a);o.y=r*a/i*o.x;return o};return t}();t.BasisForRegularReseau=n;var o=new e.XYZ(0,0,0);function h(e,t,i,r){{o.copyFromFloats(e.param.x,e.param.y,e.param.z).add(t);var s=r.getValue(o);o.copyFromFloats(e.param.x,e.param.y,e.param.z).add(i);var a=r.getValue(o);if(s!=null&&a!=null)e.setTwoOppositeLinks(s,a);else if(s==null&&a!=null)e.setOneLink(a);else if(s!=null&&a==null)e.setOneLink(s)}}var l=new e.XYZ(0,0,0);function u(e,t,i,r,s){var a=e;if(a==null)return;var n=s.getValue(l.copyFrom(e.param).add(i));if(n==null)return;var o=s.getValue(l.copyFrom(e.param).add(i).add(r));if(o==null)return;var h=s.getValue(l.copyFrom(e.param).add(r));if(h==null)return;t.addASquare(a,n,o,h)}var c=function(){function t(t){this.nbI=3;this.nbJ=3;this.fixedK=0;this.Vi=new e.XYZ(1,0,0);this.Vj=new e.XYZ(0,1,0);this.Vk=new e.XYZ(0,0,0);this.origine=new e.XYZ(0,0,0);this.makeLinks=true;this.makeTriangleOrSquare=true;this.squareVersusTriangleMaille=true;this.oneMoreVertexForOddLine=false;this.holeParameters=new e.HashMap;this.markCorner=true;this.markBorder=true;this.markCenter=true;this.putAVertexOnlyAtXYZCheckingThisCondition=null;this._xyz=new e.XYZ(0,0,0);this._iDirection=new e.XYZ(0,0,0);this._jDirection=new e.XYZ(0,0,0);this._kDirection=new e.XYZ(0,0,0);this.paramToVertex=new e.HashMap(true);this.mamesh=new e.Mamesh;if(t!=null){var i=t.go();this.Vi.copyFrom(i.Vi);this.Vj.copyFrom(i.Vj);this.nbI=i.nbI;this.nbJ=i.nbJ;this.origine.copyFrom(t.origin);this.squareVersusTriangleMaille=t.squareMailleInsteadOfTriangle}}t.prototype.checkArgs=function(){if(!this.makeTriangleOrSquare&&!this.makeLinks)e.logger.c("few interest if you do not add neither square nor links");var t=new e.XYZ(0,0,0);e.geo.cross(this.Vi,this.Vj,t);if(t.x==Number.NaN||t.y==Number.NaN||t.z==Number.NaN)throw"a problem with Vi of Vj";if(t.length()<e.geo.epsilon)throw"origin and end are almost in the same line"};t.prototype.getVertex=function(e,t){this._xyz.x=e;this._xyz.y=t;this._xyz.z=this.fixedK;return this.paramToVertex.getValue(this._xyz)};t.prototype.go=function(){this.checkArgs();for(var t=0;t<this.nbI;t++){for(var i=0;i<this.nbJ;i++){var r=new e.XYZ(t,i,this.fixedK);if(this.holeParameters==null||!this.holeParameters.getValue(r)){var s=!this.squareVersusTriangleMaille&&i%2==0?.5:0;this._iDirection.copyFrom(this.Vi).scale(t+s);this._jDirection.copyFrom(this.Vj).scale(i);this._kDirection.copyFrom(this.Vk).scale(this.fixedK);var a=new e.XYZ(0,0,0).add(this._iDirection).add(this._jDirection).add(this._kDirection).add(this.origine);if(this.putAVertexOnlyAtXYZCheckingThisCondition==null||this.putAVertexOnlyAtXYZCheckingThisCondition(a)){var n=this.mamesh.newVertex(a,0,r);this.paramToVertex.putValue(r,n)}}}}if(this.oneMoreVertexForOddLine){var t=this.nbI;for(var i=0;i<this.nbJ;i++){if(i%2==1){var r=new e.XYZ(t,i,this.fixedK);if(this.holeParameters==null||!this.holeParameters.getValue(r)){var s=!this.squareVersusTriangleMaille&&i%2==0?.5:0;this._iDirection.copyFrom(this.Vi).scale(t+s);this._jDirection.copyFrom(this.Vj).scale(i);this._kDirection.copyFrom(this.Vk).scale(this.fixedK);var a=new e.XYZ(0,0,0).add(this._iDirection).add(this._jDirection).add(this._kDirection).add(this.origine);if(this.putAVertexOnlyAtXYZCheckingThisCondition==null||this.putAVertexOnlyAtXYZCheckingThisCondition(a)){var n=this.mamesh.newVertex(a,0,r);this.paramToVertex.putValue(r,n)}}}}}if(this.mamesh.vertices.length==0)console.log("you have created a IN_mamesh with no vertex. Perhaps because of {@link Regular.putAVertexOnlyAtXYZCheckingThisCondition }");if(this.makeLinks){if(!this.squareVersusTriangleMaille)this.linksCreationForTriangle();else this.linksCreationForSquare()}if(this.makeTriangleOrSquare){if(!this.squareVersusTriangleMaille)this.triangleCreation();else this.squareCreation()}if(this.markBorder){if(this.squareVersusTriangleMaille){for(var o=0,h=this.mamesh.vertices;o<h.length;o++){var l=h[o];if(l.links.length!=4)l.markers.push(e.Vertex.Markers.border)}}else{for(var u=0,c=this.mamesh.vertices;u<c.length;u++){var l=c[u];if(l.links.length!=6)l.markers.push(e.Vertex.Markers.border)}}}if(this.markCorner){var m=this.oneMoreVertexForOddLine&&this.nbJ%2==0?1:0;var n=void 0;n=this.getVertex(0,0);if(n!=null)n.markers.push(e.Vertex.Markers.corner);n=this.getVertex(this.nbI-1+m,this.nbJ-1);if(n!=null)n.markers.push(e.Vertex.Markers.corner);n=this.getVertex(0,this.nbJ-1);if(n!=null)n.markers.push(e.Vertex.Markers.corner);n=this.getVertex(this.nbI-1,0);if(n!=null)n.markers.push(e.Vertex.Markers.corner)}if(this.markCenter){var d=this.nbI/2;var f=[];if(Math.floor(d)!=d){f.push(Math.floor(d))}else f.push(Math.floor(d),Math.floor(d)-1);var p=this.nbJ/2;var v=[];if(Math.floor(p)!=p){v.push(Math.floor(p))}else v.push(Math.floor(p),Math.floor(p)-1);for(var g=0,w=f;g<w.length;g++){var t=w[g];for(var y=0,b=v;y<b.length;y++){var i=b[y];var n=this.getVertex(t,i);if(n!=null)n.markers.push(e.Vertex.Markers.center)}}}return this.mamesh};t.prototype.linksCreationForSquare=function(){var t=this;this.mamesh.vertices.forEach(function(i){h(i,e.XYZ.temp0(1,0,0),e.XYZ.temp1(-1,0,0),t.paramToVertex);h(i,e.XYZ.temp0(0,1,0),e.XYZ.temp1(0,-1,0),t.paramToVertex)})};t.prototype.squareCreation=function(){var t=new e.XYZ(1,0,0);var i=new e.XYZ(0,1,0);for(var r=0,s=this.mamesh.vertices;r<s.length;r++){var a=s[r];u(a,this.mamesh,t,i,this.paramToVertex)}};t.prototype.linksCreationForTriangle=function(){var t=this;this.mamesh.vertices.forEach(function(i){h(i,e.XYZ.temp0(1,0,0),e.XYZ.temp1(-1,0,0),t.paramToVertex);if(i.param.y%2==0){h(i,e.XYZ.temp0(1,1,0),e.XYZ.temp1(0,-1,0),t.paramToVertex);h(i,e.XYZ.temp0(0,1,0),e.XYZ.temp1(1,-1,0),t.paramToVertex)}else{h(i,e.XYZ.temp0(0,1,0),e.XYZ.temp1(-1,-1,0),t.paramToVertex);h(i,e.XYZ.temp0(-1,1,0),e.XYZ.temp1(0,-1,0),t.paramToVertex)}})};t.prototype.triangleCreation=function(){for(var e=0,t=this.mamesh.vertices;e<t.length;e++){var i=t[e];var r=i.param.x;var s=i.param.y;if(s%2==0){var a=i;var n=this.getVertex(r+1,s+1);if(n==null)continue;var o=this.getVertex(r,s+1);if(o!=null)this.mamesh.addATriangle(a,n,o);var h=this.getVertex(r+1,s);if(h!=null)this.mamesh.addATriangle(a,h,n)}else{var a=i;var n=this.getVertex(r,s+1);if(n==null)continue;var o=this.getVertex(r+1,s);if(o!=null)this.mamesh.addATriangle(a,o,n);var h=this.getVertex(r+1,s+1);if(h!=null)this.mamesh.addATriangle(n,o,h)}}};return t}();t.Regular=c;var m=function(){function t(t){if(t===void 0){t=5}this.size=t;this.origin=new e.XYZ(0,0,0);this.end=new e.XYZ(1,0,0)}t.prototype.go=function(){var t=new e.Mamesh;for(var i=0;i<this.size;i++){var r=new e.Vertex;r.position=this.iToXYX(i);t.vertices.push(r)}for(var i=1;i<this.size-1;i++){t.vertices[i].setTwoOppositeLinks(t.vertices[i-1],t.vertices[i+1])}t.vertices[0].setOneLink(t.vertices[1]);t.vertices[this.size-1].setOneLink(t.vertices[this.size-2]);return t};t.prototype.iToXYX=function(t){var i=t/(this.size-1);return e.XYZ.newFrom(this.end).substract(this.origin).scale(i).add(this.origin)};return t}();t.Regular1D=m;var d=function(){function t(){this.nbI=3;this.nbJ=3;this.nbK=3;this.Vi=new e.XYZ(1,0,0);this.Vj=new e.XYZ(0,1,0);this.Vk=new e.XYZ(0,0,1);this.origine=new e.XYZ(0,0,0);this.decayOddStrates=false;this.makeLinks=true;this.makeTriangleOrSquare=true;this.strateHaveSquareMailleVersusTriangleMaille=true;this.oneMoreVertexForOddLine=false;this.interStrateMailleAreSquareVersusTriangle=true;this.createJKSquares=true;this.createIKSquaresOrTriangles=true;this.putAVertexOnlyAtXYZCheckingThisCondition=null;this.paramToVertex=new e.HashMap}t.prototype.go=function(){var t=this;this.mamesh=new e.Mamesh;var i=new e.XYZ(0,0,0);if(this.decayOddStrates)i.add(this.Vi).scale(.5);for(var r=0;r<this.nbK;r++){var s=new c;s.makeTriangleOrSquare=this.makeTriangleOrSquare;s.makeLinks=true;s.oneMoreVertexForOddLine=this.oneMoreVertexForOddLine;s.squareVersusTriangleMaille=this.strateHaveSquareMailleVersusTriangleMaille;s.nbI=this.nbI;s.nbJ=this.nbJ;s.fixedK=r;s.Vi=this.Vi;s.Vj=this.Vj;s.Vk.copyFrom(this.Vk);s.origine=e.XYZ.newFrom(this.origine);if(r%2==1)s.origine.substract(i);s.putAVertexOnlyAtXYZCheckingThisCondition=this.putAVertexOnlyAtXYZCheckingThisCondition;var a=s.go();for(var n=0,o=s.paramToVertex.allEntries();n<o.length;n++){var h=o[n];this.mamesh.vertices.push(h.value);this.paramToVertex.putValue(h.key,h.value)}for(var l=0,m=a.smallestSquares;l<m.length;l++){var d=m[l];this.mamesh.smallestSquares.push(d)}for(var f=0,p=a.smallestTriangles;f<p.length;f++){var d=p[f];this.mamesh.smallestTriangles.push(d)}}if(this.interStrateMailleAreSquareVersusTriangle){this.linksCreationForSquareMaille();if(this.createJKSquares){var v=new e.XYZ(0,1,0);var g=new e.XYZ(0,0,1);this.mamesh.vertices.forEach(function(e){u(e,t.mamesh,v,g,t.paramToVertex)})}if(this.createIKSquaresOrTriangles){var w=new e.XYZ(1,0,0);var y=new e.XYZ(0,0,1);this.mamesh.vertices.forEach(function(e){u(e,t.mamesh,w,y,t.paramToVertex)})}}else{this.linksCreationForTriangleMaille();if(this.createJKSquares){var b=new e.XYZ(0,1,0);var T=new e.XYZ(0,0,1);this.mamesh.vertices.forEach(function(e){u(e,t.mamesh,b,T,t.paramToVertex)})}if(this.createIKSquaresOrTriangles){this.triangleCreation()}}return this.mamesh};t.prototype.linksCreationForSquareMaille=function(){var t=this;var i=new e.XYZ(0,0,1);var r=new e.XYZ(0,0,-1);this.mamesh.vertices.forEach(function(e){h(e,i,r,t.paramToVertex)})};t.prototype.linksCreationForTriangleMaille=function(){var t=this;this.mamesh.vertices.forEach(function(i){if(i.param.z%2==0){h(i,e.XYZ.temp0(1,0,1),e.XYZ.temp1(0,0,-1),t.paramToVertex);h(i,e.XYZ.temp0(0,0,1),e.XYZ.temp1(1,0,-1),t.paramToVertex)}else{h(i,e.XYZ.temp0(0,0,1),e.XYZ.temp1(-1,0,-1),t.paramToVertex);h(i,e.XYZ.temp0(-1,0,1),e.XYZ.temp1(0,0,-1),t.paramToVertex)}})};t.prototype.getVertex=function(t,i,r){return this.paramToVertex.getValue(new e.XYZ(t,r,i))};t.prototype.triangleCreation=function(){for(var e=0,t=this.mamesh.vertices;e<t.length;e++){var i=t[e];var r=i.param.x;var s=i.param.z;var a=i.param.y;if(s%2==0){var n=i;var o=this.getVertex(r+1,s+1,a);if(o==null)continue;var h=this.getVertex(r,s+1,a);if(h!=null)this.mamesh.addATriangle(n,o,h);var l=this.getVertex(r+1,s,a);if(l!=null)this.mamesh.addATriangle(n,l,o)}else{var n=i;var o=this.getVertex(r,s+1,a);if(o==null)continue;var h=this.getVertex(r+1,s,a);if(h!=null)this.mamesh.addATriangle(n,h,o);var l=this.getVertex(r+1,s+1,a);if(l!=null)this.mamesh.addATriangle(o,h,l)}}};return t}();t.Regular3D=d})(t=e.reseau||(e.reseau={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(e){this.propBeginToRound=0;this.propEndToRound=1;this.integerBeginToRound=null;this.integerEndToRound=null;this.exponentOfRoundingFunction=1;this.referenceRadiusIsMinVersusMaxVersusMean=2;this.preventStratesCrossings=true;this.mamesh=e}t.prototype.goChanging=function(){if(isNaN(this.exponentOfRoundingFunction))throw"must be a number";if(this.propBeginToRound<0||this.propBeginToRound>1)throw"must be in [0,1]";if(this.propEndToRound<0||this.propEndToRound>1)throw"must be in [0,1]";if(this.propBeginToRound>=this.propEndToRound)return;var t=[];for(var i=0,r=this.mamesh.vertices;i<r.length;i++){var s=r[i];if(s.hasMark(e.Vertex.Markers.border))t.push(s)}var a=e.graph.ringify(t);if(this.integerBeginToRound==null)this.integerBeginToRound=Math.floor(a.length*this.propBeginToRound);if(this.integerEndToRound==null)this.integerEndToRound=Math.ceil(a.length*this.propEndToRound);if(this.integerEndToRound<0)this.integerEndToRound=a.length+this.integerEndToRound;if(this.integerBeginToRound>a.length||this.integerBeginToRound<0)throw"problem";if(this.integerEndToRound>a.length||this.integerEndToRound<0)throw"problem";if(this.integerEndToRound<=this.integerBeginToRound)return;var n=new e.XYZ(0,0,0);for(var o=0,h=this.mamesh.vertices;o<h.length;o++){var l=h[o];n.add(l.position)}n.scale(1/this.mamesh.vertices.length);var u=new e.XYZ(0,0,0);var c=null;for(var m=this.integerBeginToRound;m<this.integerEndToRound;m++){var d=-1;var f=Number.POSITIVE_INFINITY;var p=0;for(var v=0,g=a[m];v<g.length;v++){var w=g[v];var y=e.geo.distance(w.position,n);if(y>d)d=y;if(y<f)f=y;p+=y}p/=a[m].length;if(d>e.geo.epsilon){var b=void 0;if(this.referenceRadiusIsMinVersusMaxVersusMean==0)b=f;else if(this.referenceRadiusIsMinVersusMaxVersusMean==1)b=d;else if(this.referenceRadiusIsMinVersusMaxVersusMean==2)b=p;c=b;for(var T=0,M=a[m];T<M.length;T++){var w=M[T];var C=u.copyFrom(w.position).substract(n);var S=C.length();var x=Math.pow(b/S,this.exponentOfRoundingFunction);C.scale(x);w.position.copyFrom(C.add(n))}}}if(this.preventStratesCrossings){if(this.integerBeginToRound>0){var F=-1;for(var V=0,k=a[this.integerBeginToRound];V<k.length;V++){var w=k[V];var y=e.geo.distance(w.position,n);if(y>F)F=y}var O=Number.POSITIVE_INFINITY;for(var A=0,P=a[this.integerBeginToRound-1];A<P.length;A++){var w=P[A];var y=e.geo.distance(w.position,n);if(y<O)O=y}var L=null;if(1.1*F>O)L=1.1*F/O;if(L!=null){for(var B=0;B<this.integerBeginToRound;B++){for(var Y=0,I=a[B];Y<I.length;Y++){var w=I[Y];w.position.copyFrom(u.copyFrom(w.position).substract(n).scale(L).add(n))}}}}if(this.integerEndToRound<a.length){var $=Number.POSITIVE_INFINITY;for(var D=0,N=a[this.integerEndToRound-1];D<N.length;D++){var w=N[D];var y=e.geo.distance(w.position,n);if(y<$)$=y}var X=-1;for(var Z=0,_=a[this.integerEndToRound];Z<_.length;Z++){var w=_[Z];var y=e.geo.distance(w.position,n);if(y>X)X=y}var L=null;if(1.1*X>$)L=$/(1.1*X);if(L!=null){for(var B=this.integerEndToRound;B<a.length;B++){for(var E=0,R=a[B];E<R.length;E++){var w=R[E];w.position.copyFrom(u.copyFrom(w.position).substract(n).scale(L).add(n))}}}}}};return t}();t.RoundSomeStrates=i;var r=function(){function t(t,i,r,s){if(r===void 0){r=new e.XYZ(0,0,0)}if(s===void 0){s=new e.XYZ(1,1,1)}this.axisForRotation=new e.XYZ(0,0,1);this.centerForSimilitude=null;this.vertices=t;this.angle=i;this.vectorForTranslation=r;this.sizesForResize=s}t.prototype.goChanging=function(){var t=this;if(this.centerForSimilitude==null){this.centerForSimilitude=new e.XYZ(0,0,0);var i=1/this.vertices.length;var r=[];var s=[];this.vertices.forEach(function(e){s.push(e.position);r.push(i)});e.geo.baryCenter(s,r,this.centerForSimilitude)}var a=new e.MM;e.geo.axisAngleToMatrix(this.axisForRotation,this.angle,a);this.vertices.forEach(function(i){i.position.substract(t.centerForSimilitude);i.position.resizes(t.sizesForResize);e.geo.multiplicationMatrixVector(a,i.position,i.position);i.position.add(t.centerForSimilitude).add(t.vectorForTranslation)})};return t}();t.Similitude=r;function s(t,i,r){var s=e.XYZ.newFrom(t.vertices[0].position);var a=e.XYZ.newFrom(t.vertices[0].position);for(var n=0,o=t.vertices;n<o.length;n++){var h=o[n];if(h.position.x>s.x)s.x=h.position.x;if(h.position.y>s.y)s.y=h.position.y;if(h.position.x<a.x)a.x=h.position.x;if(h.position.y<a.y)a.y=h.position.y}var l=e.XYZ.newFrom(s).substract(a);var u=e.XYZ.newFrom(r).substract(i);var c=new e.XYZ(u.x/l.x,u.y/l.y,0);for(var m=0,d=t.vertices;m<d.length;m++){var h=d[m];h.position.substract(a).resizes(c).add(i)}}t.adjustInASquare=s})(t=e.spacialTransformations||(e.spacialTransformations={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(t){this.referenceDistanceBetweenVertexWithZeroDichoLevel=.1;this.deformationFromCenterVersusFromDirection=true;this.center=new e.XYZ(0,0,0);this.direction=new e.XYZ(0,0,1);this.alpha=1.7;this.beta=.7;this.seed=22345;this.mamesh=t}t.prototype.go=function(){this.simuStable=new e.proba.StableLaw;this.simuStable.alpha=this.alpha;this.simuStable.beta=this.beta;this.simuStable.nbSimu=this.mamesh.vertices.length;var t=new e.proba.Random(this.seed);this.simuStable.basicGenerator=function(){return t.pseudoRand()};var i=this.simuStable.go();var r=true;var s=0;var a=0;var n=new e.XYZ(0,0,0);var o=new e.XYZ(0,0,0);while(r){r=false;for(var h in this.mamesh.cutSegmentsDico){var l=this.mamesh.cutSegmentsDico[h];if(Math.max(l.a.dichoLevel,l.b.dichoLevel)==a){r=true;var u=i[s++]*Math.pow(this.referenceDistanceBetweenVertexWithZeroDichoLevel/Math.pow(2,a),1/this.simuStable.alpha);e.geo.between(l.a.position,l.b.position,1/2,n);if(this.deformationFromCenterVersusFromDirection){n.substract(this.center);n.scale(1+u)}else{o.copyFrom(this.direction).scale(u);n.add(o)}l.middle.position.copyFrom(n)}}a++}};return t}();t.StableRandomFractal=i})(t=e.fractal||(e.fractal={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(e){this.nbActionsPerIteration=1e3;this.q=Number.POSITIVE_INFINITY;this.beta=.01;this.graph=e}t.prototype.checkArgs=function(){if(this.q==null||this.beta==null)throw"q or beta is null";if(this.q<=0)throw"q must be positive"};t.prototype.go=function(){this.checkArgs();if(this.q==Number.POSITIVE_INFINITY)this.possibleValues=[-1,1];else this.possibleValues=[-1,0,1];this.initialisation()};t.prototype.iterateAndGetChangedVertices=function(){var t=new e.HashMap(true);for(var i=0;i<this.nbActionsPerIteration;i++){var r=void 0;var s=void 0;if(this.beta!=Number.POSITIVE_INFINITY){var a=Math.floor(Math.random()*this.graph.length);r=this.graph[a];s=this.newValue()}else{var n=false;while(!n){var a=Math.floor(Math.random()*this.graph.length);r=this.graph[a];s=this.newValue();var o=null;var h=true;for(var l=0,u=r.links;l<u.length;l++){o=u[l];if(o.to.customerObject.value*s==-1){h=false;break}}}}var c=this.energyRatio(r,s);if(c>=1||Math.random()<c){r.customerObject.value=s;t.putValue(r,s)}}return t};t.prototype.newValue=function(){var e=Math.floor(Math.random()*this.possibleValues.length);return this.possibleValues[e]};t.prototype.energyRatio=function(e,t){var i=1;if(this.q!=1&&this.q!=Number.POSITIVE_INFINITY){i=Math.pow(this.q,Math.abs(t)-Math.abs(e.customerObject.value))}if(this.beta!=0&&this.beta!=Number.POSITIVE_INFINITY){var r=t-e.customerObject.value;if(this.beta!=0&&this.beta!=Number.POSITIVE_INFINITY){var s=0;e.links.forEach(function(e){s+=r*e.to.customerObject.value});i*=Math.exp(this.beta*s)}}return i};t.prototype.initialisation=function(){this.graph.forEach(function(e){e.customerObject.value=0})};return t}();t.IsingModel=i})(t=e.metropolis||(e.metropolis={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(e){var t=function(){function e(e){if(e===void 0){e=1234567}this.seed=e}e.prototype.pseudoRand=function(){var e=Math.pow(2,32);this.seed+=this.seed*this.seed|5;return(this.seed>>>32)/e};e.prototype.pseudoRandInt=function(e){var t=Math.floor(e*this.pseudoRand());if(t==e)t--;return t};return e}();e.Random=t;var i=function(){function e(){this.mean=0;this.stdev=1;this.knuthVersusBowMuller=true;this.use_last=false}e.prototype.go=function(){if(this.knuthVersusBowMuller)return this.knuth();else return this.bowMuller()};e.prototype.bowMuller=function(){var e=1-Math.random();var t=1-Math.random();return this.mean+this.stdev*Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)};e.prototype.knuth=function(){var e;if(this.use_last){e=this.y2;this.use_last=false}else{var t,i,r;do{t=2*Math.random()-1;i=2*Math.random()-1;r=t*t+i*i}while(r>=1);r=Math.sqrt(-2*Math.log(r)/r);e=t*r;this.y2=i*r;this.use_last=true}var s=this.mean+this.stdev*e;if(s>0)return s;return-s};return e}();e.Gaussian=i;function r(e,t){var i;var r=false;return function(){var s;if(r){s=i;r=false}else{var a,n,o;do{a=2*Math.random()-1;n=2*Math.random()-1;o=a*a+n*n}while(o>=1);o=Math.sqrt(-2*Math.log(o)/o);s=a*o;i=n*o;r=true}var h=e+t*s;if(h>0)return h;return-h}}e.gaussian=r;var s=function(){function e(){this.nbSimu=1;this.alpha=1.5;this.beta=0;this.sigma=1;this.mu=0;this.basicGenerator=Math.random}e.prototype.checkArgs=function(){if(this.alpha>2||this.alpha<=0)throw"alpha must be in (0,2]";if(this.beta<-1||this.beta>1)throw"beta must be in [-1,1]"};e.prototype.go=function(){this.checkArgs();var e=[];for(var t=0;t<this.nbSimu;t++){var i=this.basicGenerator()*Math.PI-Math.PI/2;var r=-Math.log(this.basicGenerator());if(this.alpha!=1){var s=Math.tan(Math.PI*this.alpha/2);var a=Math.atan(this.beta*s)/this.alpha;var n=1+this.beta^2*s^2^1/2/this.alpha;e[t]=n*Math.sin(this.alpha*(i+a))/Math.pow(Math.cos(i),1/this.alpha)*Math.pow(Math.cos(i-this.alpha*(i+a))/r,(1-this.alpha)/this.alpha);e[t]=this.sigma*e[t]+this.mu}else if(this.alpha==1){e[t]=2/Math.PI*((Math.PI/2+this.beta*i)*Math.tan(i)-this.beta*Math.log(r*Math.cos(i)/(Math.PI/2+this.beta*i)));e[t]=this.sigma*e[t]+2/Math.PI*this.beta*this.sigma*Math.log(this.sigma)+this.mu}}return e};return e}();e.StableLaw=s})(t=e.proba||(e.proba={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){t.sinh=function(e){return(Math.exp(e)-Math.exp(-e))/2};t.tanh=function(e){return(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))};t.sech=function(e){return 2/(Math.exp(e)+Math.exp(-e))};t.sechP=function(e){return-t.tanh(e)*t.sech(e)};t.sechPP=function(e){return-t.tanhP(e)*t.sech(e)-t.tanh(e)*t.sechP(e)};t.tanhP=function(e){var i=t.tanh(e);return 1-i*i};t.tanhPP=function(e){return-2*t.tanh(e)*t.tanhP(e)};t.tractrice=function(i){return new e.XYZ(t.sech(i),i-t.tanh(i),0)};t.tractriceP=function(i){return new e.XYZ(t.sechP(i),1-t.tanhP(i),0)};t.tractricePP=function(i){return new e.XYZ(t.sechPP(i),-t.tanhPP(i),0)};t.rotationYAxis=function(t){var i=new e.MM;var r=Math.cos(t);var s=Math.sin(t);e.geo.numbersToMM(r,0,s,0,0,1,0,0,-s,0,r,0,0,0,0,1,i);return i};t.rotationYAxisP=function(t){var i=new e.MM;var r=Math.cos(t);var s=Math.sin(t);e.geo.numbersToMM(-s,0,r,0,0,0,0,0,-r,0,-s,0,0,0,0,1,i);return i};t.rotationYAxisPP=function(t){var i=new e.MM;var r=Math.cos(t);var s=Math.sin(t);e.geo.numbersToMM(-r,0,-s,0,0,0,0,0,s,0,-r,0,0,0,0,1,i);return i}})(t=e.usualFunction||(e.usualFunction={}));var i;(function(i){var r=function(){function t(){this.orientationCoef=+1;this.unit=1;this.point=new e.XYZ(0,0,0);this._meanLinkLengthAtArrival=null}t.prototype.xyzToUV=function(t,i){if(i===void 0){i=false}if(this.maillage==null)throw"you must give a maillage to use xyzToUV ";var r=new e.UV(0,0);var s=Number.MAX_VALUE;var a=Number.MAX_VALUE;var n=null;for(var o=0,h=this.maillage.vertices;o<h.length;o++){n=h[o];var l=n.position.x;var u=n.position.y;this.point.copyFrom(this.X(l,u));var c=e.geo.distance(this.point,t);if(c<s){s=c;r.u=l;r.v=u}if(n.hasMark(e.Vertex.Markers.border)){var m=e.geo.distance(t,this.point);if(m<a)a=m}}if(i||this._meanLinkLengthAtArrival==null)this._meanLinkLengthAtArrival=this.meanLinkLengthAtArrival();if(s<1.1*this._meanLinkLengthAtArrival)return{uv:r,distToBorder:a,distToNearestArrivalMesh:s};else{return null}};t.prototype.e=function(t,i){return e.geo.dot(this.newN(t,i),this.Xuu(t,i))};t.prototype.f=function(t,i){return e.geo.dot(this.newN(t,i),this.Xuv(t,i))};t.prototype.g=function(t,i){return e.geo.dot(this.newN(t,i),this.Xvv(t,i))};t.prototype.E=function(t,i){return e.geo.dot(this.Xu(t,i),this.Xu(t,i))};t.prototype.F=function(t,i){return e.geo.dot(this.Xu(t,i),this.Xv(t,i))};t.prototype.G=function(t,i){return e.geo.dot(this.Xv(t,i),this.Xv(t,i))};t.prototype.createArrivalMeshFromMaillage=function(){var t=this;var i=new e.mameshModification.MameshDeepCopier(this.maillage);i.copyCutSegmentsDico=false;this.arrivalOpenMesh=i.go();this.arrivalOpenMesh.vertices.forEach(function(e){var i=e.position.x;var r=e.position.y;e.position=t.X(i,r)})};t.prototype.dNinTangentBasis=function(t,i){var r=new e.M22;var s=this.e(t,i);var a=this.f(t,i);var n=this.g(t,i);var o=this.E(t,i);var h=this.F(t,i);var l=this.G(t,i);var u=o*l-h*h;r.m11=(a*h-s*l)/u;r.m12=(n*h-a*l)/u;r.m21=(s*h-a*o)/u;r.m22=(a*h-n*o)/u;return r};t.prototype.dNaction=function(e,t,i){var r=this.dNinTangentBasis(e,t);var s=this.canonicalToTangentBasis(e,t,i);var a=r.multiplyUV(s);return this.tagentToCanonicalBasis(e,t,a)};t.prototype.canonicalToTangentBasis=function(t,i,r){var s=this.Xu(t,i);var a=this.Xv(t,i);var n=new e.M22;n.m11=s.x;n.m21=s.y;n.m21=a.x;n.m22=a.y;var o=n.inverse();cc(o.determinant());var h=new e.UV(r.x,r.y);return o.multiplyUV(h)};t.prototype.tagentToCanonicalBasis=function(e,t,i){var r=this.Xu(e,t);var s=this.Xv(e,t);r.scale(i.u);s.scale(i.v);return r.add(s)};t.prototype.newN=function(t,i){var r=new e.XYZ(0,0,0);e.geo.cross(this.Xu(t,i),this.Xv(t,i),r);r.normalize().scale(this.unit*this.orientationCoef);return r};t.prototype.meanLinkLengthAtArrival=function(){var t=this;var i=0;var r=0;this.maillage.vertices.forEach(function(s){s.links.forEach(function(a){r++;i+=e.geo.distance(t.X(s.position.x,s.position.y),t.X(a.to.position.x,a.to.position.y))})});return i/r};return t}();i.Carte=r;var s=function(){function t(){this.cartes=[]}t.prototype.drawTheWholeSurface=function(e){this.drawOneMesh(this.wholeSurfaceMesh,e)};t.prototype.drawOneCarte=function(e,t){this.drawOneMesh(this.cartes[e].arrivalOpenMesh,t)};t.prototype.drawOneMesh=function(t,i){function r(e,t){var i=true;for(var r=0,s=e;r<s.length;r++){var a=s[r];if(a.param.x%t!=0){i=false;break}}var n=true;for(var o=0,h=e;o<h.length;o++){var a=h[o];if(a.param.y%t!=0){n=false;break}}return i||n}var s=new e.visu3d.LinesViewer(t,i);s.constantRadius=.01;var a=s.go();a.forEach(function(e){return e.isPickable=false});var n=new e.visu3d.SurfaceViewer(t,i);n.alpha=.5;var o=n.go()};t.prototype.findBestCarte=function(e){var t=-1;var i=null;var r=null;this.cartes.forEach(function(s){var a=s.xyzToUV(e);if(a!=null&&a.distToBorder>t){t=a.distToBorder;i=s;r=a.uv}});if(r==null){cc("the point which is not in any cart arrival is:",e.toString());throw"strange, the xyz do not belong to any carte-arrival"}return{uv:r,carte:i}};return t}();i.Surface=s;(function(e){e[e["selle"]=0]="selle";e[e["cylinder"]=1]="cylinder";e[e["torus"]=2]="torus";e[e["pseudoSphere"]=3]="pseudoSphere"})(i.SurfaceName||(i.SurfaceName={}));var a=i.SurfaceName;var n=function(){function n(t){this.vertexToCarte=new e.HashMap;this.carteIndexToMinimalArrivalMesh=[];this.surfaceName=t}n.prototype.go=function(){this.surface=new s;this.surface.cartes=[];if(this.surfaceName==a.torus){var n=function(t,i){var s=new e.reseau.BasisForRegularReseau;s.origin=t;s.end=i;s.nbI=32;s.nbJ=64;var a=new e.reseau.Regular(s).go();var n=new e.reseau.Regular(s).go();var o=.3;var h=.7;var l=new r;l.maillage=a;l.arrivalOpenMesh=n;l.X=function(t,i){return new e.XYZ((o*Math.cos(t)+h)*Math.cos(i),(o*Math.cos(t)+h)*Math.sin(i),o*Math.sin(t))};l.Xu=function(t,i){return new e.XYZ(-o*Math.sin(t)*Math.cos(i),-o*Math.sin(t)*Math.sin(i),o*Math.cos(t))};l.Xv=function(t,i){return new e.XYZ(-(o*Math.cos(t)+h)*Math.sin(i),(o*Math.cos(t)+h)*Math.cos(i),0)};l.Xuu=function(t,i){return new e.XYZ(-o*Math.cos(t)*Math.cos(i),-o*Math.cos(t)*Math.sin(i),-o*Math.sin(t))};l.Xuv=function(t,i){return new e.XYZ(o*Math.sin(t)*Math.sin(i),-o*Math.sin(t)*Math.cos(i),0)};l.Xvv=function(t,i){return new e.XYZ(-(o*Math.cos(t)+h)*Math.cos(i),-(o*Math.cos(t)+h)*Math.sin(i),0)};n.vertices.forEach(function(e){var t=e.position.x;var i=e.position.y;e.position=l.X(t,i)});return l};var o=.1;this.surface.cartes.push(n(new e.XYZ(o,o,0),new e.XYZ(2*Math.PI-o,2*Math.PI-o,0)));this.surface.cartes.push(n(new e.XYZ(-Math.PI+o,-Math.PI+o,0),new e.XYZ(Math.PI-o,Math.PI-o,0)));this.surface.wholeSurfaceMesh=n(new e.XYZ(0,0,0),new e.XYZ(2*Math.PI,2*Math.PI,0)).arrivalOpenMesh}else if(this.surfaceName==a.cylinder){var h=40;var n=function(t,i){var s=new e.reseau.BasisForRegularReseau;s.origin=t;s.end=i;s.nbI=h+1;s.nbJ=h+1;var a=new e.reseau.Regular(s).go();var n=new e.reseau.Regular(s).go();var o=.5;var l=new r;l.maillage=a;l.arrivalOpenMesh=n;l.X=function(t,i){return new e.XYZ(o*Math.cos(t),i,o*Math.sin(t))};l.Xu=function(t,i){return new e.XYZ(-o*Math.sin(t),0,o*Math.cos(t))};l.Xv=function(t,i){return new e.XYZ(0,1,0)};l.Xuu=function(t,i){return new e.XYZ(-o*Math.cos(t),0,-o*Math.sin(t))};l.Xuv=function(t,i){return new e.XYZ(0,0,0)};l.Xvv=function(t,i){return new e.XYZ(0,0,0)};n.vertices.forEach(function(e){var t=e.position.x;var i=e.position.y;e.position=l.X(t,i)});return l};var o=.3;this.surface.cartes.push(n(new e.XYZ(o,-1/2,0),new e.XYZ(2*Math.PI-o,1/2,0)));this.surface.cartes.push(n(new e.XYZ(o-Math.PI,-1/2,0),new e.XYZ(Math.PI-o,1/2,0)));this.surface.wholeSurfaceMesh=n(new e.XYZ(0,-1/2,0),new e.XYZ(2*Math.PI,1/2,0)).arrivalOpenMesh}else if(this.surfaceName==a.pseudoSphere){var n=function(r,s){var a=new e.reseau.BasisForRegularReseau;a.origin=r;a.end=s;a.nbI=32+1;a.nbJ=20+1;var n=new e.reseau.Regular(a).go();var o=new e.reseau.Regular(a).go();var h=new i.RotationCarteMaker(t.tractrice);h.translation=new e.XYZ(0,-1,0);var l=1;h.scaling=new e.XYZ(l,l,l);h.curveP=t.tractriceP;h.curvePP=t.tractricePP;var u=h.go();u.maillage=n;u.arrivalOpenMesh=o;o.vertices.forEach(function(e){var t=e.position.x;var i=e.position.y;e.position=u.X(t,i)});return u};var o=.3;this.surface.cartes.push(n(new e.XYZ(o,.1,0),new e.XYZ(2*Math.PI-o,3.5,0)));this.surface.cartes.push(n(new e.XYZ(-Math.PI+o,.1,0),new e.XYZ(Math.PI-o,3.5,0)));this.surface.wholeSurfaceMesh=n(new e.XYZ(0,.1,0),new e.XYZ(2*Math.PI,3.5,0)).arrivalOpenMesh}else if(this.surfaceName==a.selle){var n=function(t,i){var s=new e.reseau.BasisForRegularReseau;s.origin=t;s.end=i;s.nbI=40+1;s.nbJ=40+1;var a=new e.reseau.Regular(s).go();var n=new e.reseau.Regular(s).go();var o=new r;o.maillage=a;o.arrivalOpenMesh=n;o.X=function(t,i){return new e.XYZ(t,i,i*i-t*t)};o.Xu=function(t,i){return new e.XYZ(1,0,-2*t)};o.Xv=function(t,i){return new e.XYZ(0,1,2*i)};o.Xuu=function(t,i){return new e.XYZ(0,0,-2)};o.Xuv=function(t,i){return new e.XYZ(0,0,0)};o.Xvv=function(t,i){return new e.XYZ(0,0,2)};n.vertices.forEach(function(e){var t=e.position.x;var i=e.position.y;e.position=o.X(t,i)});return o};var l=.7;this.surface.cartes.push(n(new e.XYZ(-l,-l,0),new e.XYZ(l,l,0)));this.surface.wholeSurfaceMesh=n(new e.XYZ(-l,-l,0),new e.XYZ(l,l,0)).arrivalOpenMesh}else throw"not yet";this.makeMinimalMeshesForEachCarte();return this.surface};n.prototype.makeMinimalMeshesForEachCarte=function(){var t=this;var i=function(i){var s=r.surface.cartes[i];var a=[];s.arrivalOpenMesh.vertices.forEach(function(e){var i=t.surface.findBestCarte(e.position);if(i.carte==s){t.vertexToCarte.putValue(e,s);a.push(e)}});var n=new e.grateAndGlue.SubMameshExtractor(s.arrivalOpenMesh,a).go();r.carteIndexToMinimalArrivalMesh[i]=n};var r=this;for(var s=0;s<this.surface.cartes.length;s++){i(s)}};return n}();i.SurfaceMaker=n;var o=function(){function i(t){this.translation=new e.XYZ(0,0,0);this.scaling=new e.XYZ(1,1,1);this.curve=t}i.prototype.go=function(){var i=this;var s=new r;s.X=function(r,s){var a=new e.XYZ(0,0,0);e.geo.multiplicationMatrixVector(t.rotationYAxis(r),i.curve(s),a);a.resizes(i.scaling).add(i.translation);return a};s.Xu=function(r,s){var a=new e.XYZ(0,0,0);e.geo.multiplicationMatrixVector(t.rotationYAxisP(r),i.curve(s),a);a.resizes(i.scaling);return a};s.Xuu=function(r,s){var a=new e.XYZ(0,0,0);e.geo.multiplicationMatrixVector(t.rotationYAxisPP(r),i.curve(s),a);a.resizes(i.scaling);return a};s.Xv=function(r,s){var a=new e.XYZ(0,0,0);e.geo.multiplicationMatrixVector(t.rotationYAxis(r),i.curveP(s),a);a.resizes(i.scaling);return a};s.Xvv=function(r,s){var a=new e.XYZ(0,0,0);e.geo.multiplicationMatrixVector(t.rotationYAxis(r),i.curvePP(s),a);a.resizes(i.scaling);return a};s.Xuv=function(r,s){var a=new e.XYZ(0,0,0);e.geo.multiplicationMatrixVector(t.rotationYAxisP(r),i.curveP(s),a);a.resizes(i.scaling);return a};return s};return i}();i.RotationCarteMaker=o})(i=e.riemann||(e.riemann={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(e){this.makeLinks=true;this.mamesh=e}t.prototype.go=function(){var t=[];var i=[];var r=new e.HashMap;var s=new e.HashMap;for(var a=0,n=this.mamesh.vertices;a<n.length;a++){var o=n[a];var h=0;var l=void 0;var u=[];for(var c=0,m=o.links;c<m.length;c++){var d=m[c];var f=new BABYLON.Vector3(0,0,0);f.x=d.to.param.x-o.param.x;f.y=d.to.param.y-o.param.y;f.z=d.to.param.z-o.param.z;f.normalize();u.push(f)}h=BABYLON.Vector3.Dot(u[0],u[1]);if(h<0)h*=-1;var p=u[0];var v=u[1];for(var g=0;g<u.length;g++){for(var w=g+1;w<u.length;w++){l=BABYLON.Vector3.Dot(u[g],u[w]);if(l<0)l*=-1;if(h>l){h=l;p=u[g];v=u[w]}}}t.push(p);i.push(v);s.putValue(o,-1)}for(var y=0;y<t.length&&y<i.length;y++){var b=BABYLON.Vector3.Cross(t[y],i[y]);b.normalize();r.putValue(this.mamesh.vertices[y],new e.XYZ(b.x,b.y,b.z))}var T=this.mamesh.vertices[0];var M=0;while(M<this.mamesh.vertices.length-1&&r.getValue(T).x==0&&r.getValue(T).y==0&&r.getValue(T).z==0){T=this.mamesh.vertices[M+1];M++}var C=[];C.push(T);var S=[];S.push(C);var x=new e.HashMap;var F=C;while(F.length>0){F=e.graph.getEdge(F,x);S.push(F)}for(var V=1;V<S.length;V++){for(var k=0,O=S[V];k<O.length;k++){var o=O[k];for(var A=0,P=o.links;A<P.length;A++){var d=P[A];for(var L=0,B=S[V-1];L<B.length;L++){var Y=B[L];if(d.to==Y){if(r.getValue(o).x==0&&r.getValue(o).y==0&&r.getValue(o).z==0){var I=new e.XYZ(r.getValue(Y).x,r.getValue(Y).y,r.getValue(Y).z);r.putValue(o,I)}if(BABYLON.Vector3.Dot(r.getValue(Y),r.getValue(o))<0){var $=new e.XYZ(-r.getValue(o).x,-r.getValue(o).y,-r.getValue(o).z);r.putValue(o,$)}}}}}}var D=[];var N=new e.StringMap;var X=[];for(var Z=0,_=this.mamesh.vertices;Z<_.length;Z++){var o=_[Z];for(var E=0,R=o.links;E<R.length;E++){var d=R[E];N.putValue(o.hashNumber+","+d.to.hashNumber,false);var q=[o,d.to];X.push(q)}}for(var z=0,G=X;z<G.length;z++){var W=G[z];var U=W[0];var H=W[0];var j=W[1];if(N.getValue(H.hashNumber+","+j.hashNumber)!=true){var J=[j];var K=true;while(K){var Q=6.4;var ee=H.links[0];for(var te=0,ie=j.links;te<ie.length;te++){var re=ie[te];if(re.to!=H&&N.getValue(j.hashNumber+","+re.to.hashNumber)!=true){var se=new e.XYZ(H.param.x-j.param.x,H.param.y-j.param.y,H.param.z-j.param.z);var ae=new e.XYZ(re.to.param.x-j.param.x,re.to.param.y-j.param.y,re.to.param.z-j.param.z);var ne=e.geo.angleBetweenTwoVectorsBetweenMinusPiAndPi(se,ae,r.getValue(H));if(ne<0)ne=6.2831853072+ne;if(ne<Q){Q=ne;ee=re}}}J.push(ee.to);N.putValue(j.hashNumber+","+ee.to.hashNumber,true);H=j;j=ee.to;if(j==U){K=false}}D.push(J)}}var oe=[];var he=[];var le=0;var ue=-1;for(var ce=0,me=D;ce<me.length;ce++){var Y=me[ce];ue++;if(Y.length==3){var de=e.geo.distance(Y[0].param,Y[1].param);var fe=e.geo.distance(Y[0].param,Y[2].param);var pe=e.geo.distance(Y[1].param,Y[2].param);var ve=(de+fe+pe)/2;var ge=Math.sqrt(ve*(ve-de)*(ve-fe)*(ve-pe));oe.push(ge)}else if(Y.length==4){var de=e.geo.distance(Y[0].param,Y[1].param);var fe=e.geo.distance(Y[1].param,Y[2].param);var pe=e.geo.distance(Y[2].param,Y[3].param);var we=e.geo.distance(Y[3].param,Y[0].param);var ye=e.geo.distance(Y[0].param,Y[2].param);var be=(de+fe+ye)/2;var Te=Math.sqrt(be*(be-de)*(be-fe)*(be-ye));var Me=(pe+we+ye)/2;var Ce=Math.sqrt(Me*(Me-pe)*(Me-we)*(Me-ye));oe.push(Te+Ce)}else if(Y.length>=5){var Se=(new e.Vertex).setPosition(0,0,0);le=1/Y.length;var xe=[Y[0].position];var Fe=[le];for(var Ve=0,ke=Y;Ve<ke.length;Ve++){var o=ke[Ve];xe.push(o.position);Fe.push(le)}e.geo.baryCenter(xe,Fe,Se.param);var Oe=(new e.Vertex).setPosition(Se.param.x,Se.param.y,Se.param.z);var Ae=0;for(var Pe=0;Pe<Y.length;Pe++){var de=e.geo.distance(Y[Pe].param,Y[(Pe+1)%Y.length].param);var fe=e.geo.distance(Y[(Pe+1)%Y.length].param,Oe.param);var pe=e.geo.distance(Oe.param,Y[Pe].param);var Le=(de+fe+pe)/2;Ae=Ae+Math.sqrt(Le*(Le-de)*(Le-fe)*(Le-pe))}oe.push(Ae);he[ue]=Oe}}var Be=-1;var Ye=-1;if(oe.length!=1){for(var Ie=0;Ie<oe.length;Ie++){if(oe[Ie]>Be){Be=oe[Ie];Ye=Ie}}}var $e=-1;for(var De=0,Ne=D;De<Ne.length;De++){var Y=Ne[De];$e++;if(Y.length==3&&$e!=Ye){this.mamesh.addATriangle(Y[0],Y[1],Y[2])}else if(Y.length==4&&$e!=Ye){this.mamesh.addASquare(Y[0],Y[1],Y[2],Y[3])}else if(Y.length>=5&&$e!=Ye){var Oe=he[$e];Oe.markers.push(e.Vertex.Markers.polygonCenter);this.mamesh.vertices.push(Oe);for(var Xe=0;Xe<Y.length;Xe++){this.mamesh.addATriangle(Y[Xe],Y[(Xe+1)%Y.length],Oe);Y[Xe].setOneLink(Oe);Oe.setOneLink(Y[Xe])}}}return this.mamesh};return t}();t.SurfaceConnectionProcess=i})(t=e.surfaceConnection||(e.surfaceConnection={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){t.squareMainSymmetries=[function(t){return new e.XYZ(1-t.x,t.y,t.z)},function(t){return new e.XYZ(t.x,1-t.y,t.z)},function(t){return new e.XYZ(1-t.x,1-t.y,t.z)}];var i;(function(e){e.verticalAxis="symI";e.horizontalAxis="symJ";e.slashAxis="symIJ";e.rotation="rotation"})(i=t.keyWords||(t.keyWords={}));function r(t,r,s){if(s===void 0){s=false}var a=new e.StringMap;a.putValue(i.verticalAxis,function(i){var r=t;if(i.y%2==1&&s)r++;return new e.XYZ(r-1-i.x,i.y,i.z)});a.putValue(i.horizontalAxis,function(t){return new e.XYZ(t.x,r-1-t.y,t.z)});a.putValue(i.slashAxis,function(i){var a=t;if(i.y%2==1&&s)a++;return new e.XYZ(a-1-i.x,r-1-i.y,i.z)});return a}t.cartesian=r;function s(e,t,i){if(i===void 0){i=false}var s=r(e,t,i);var a=[];for(var n=0,o=s.allValues();n<o.length;n++){var h=o[n];a.push(h)}return a}t.cartesianAsArray=s;function a(t){var r=new e.StringMap;var s=function(s){var a=Math.PI*2/t*s;r.putValue(i.rotation+s,function(t){var i=new e.XYZ(0,0,0);i.x=t.x*Math.cos(a)-t.y*Math.sin(a);i.y=t.x*Math.sin(a)+t.y*Math.cos(a);i.z=t.z;return i})};for(var a=1;a<t;a++){s(a)}return r}t.polygonRotations=a;function n(e){var t=a(e);var i=[];for(var r=0,s=t.allValues();r<s.length;r++){var n=s[r];i.push(n)}return i}t.getAllPolygonalRotations=n})(t=e.symmetries||(e.symmetries={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){function i(e){if(e==null||e.length==0)throw"empty list";var t=e[0];var i=0;for(var r=1;r<e.length;r++){if(e[r]>t){t=e[r];i=r}}return i}t.maxIndex=i;function r(e){return e[i(e)]}t.maxValue=r;function s(e){return e[i(e)]}t.maxValueString=s;function a(e){if(e==null||e.length==0)throw"empty list";var t=e[0];var i=0;for(var r=1;r<e.length;r++){if(e[r]<t){t=e[r];i=r}}return i}t.minIndex=a;function n(e){return e[a(e)]}t.minValue=n;function o(e){return e[a(e)]}t.minValueString=o;function h(e,t){if(e==null||e.length==0)throw"empty list";var i=e[0];var r=0;for(var s=1;s<e.length;s++){if(t(e[s],i)<0){i=e[s];r=s}}return r}t.minIndexOb=h;function l(e,t){return e[h(e,t)]}t.minValueOb=l;function u(e){while(e.length>0)e.pop()}t.clearArray=u;function c(e,t){var i=e.indexOf(t);if(i!=-1)e.splice(i,1);else{cc("l'objet n'est pas dans le tableau",t);throw"l'objet précédent n'est pas dans le tableau:"}}t.removeFromArray=c;function m(e,t){var i=[];for(var r=0,s=e;r<s.length;r++){var a=s[r];if(!t(a))i.push(a)}return i}t.arrayMinusElements=m;function d(e,t){var i=[];for(var r=0;r<e.length;r++){if(t.indexOf(r)!=-1)i.push(e[r])}return i}t.arrayKeepingSomeIndices=d;function f(e,t){var i=[];for(var r=0;r<e.length;r++){if(t.indexOf(r)==-1)i.push(e[r])}return i}t.arrayMinusSomeIndices=f;function p(e,t,i){var r=[];for(var s=0;s<e.length;s+=i){if(t.indexOf(s)==-1){for(var a=0;a<i;a++){r.push(e[s+a])}}}return r}t.arrayMinusBlocksIndices=p;function v(t){var i=Number.MAX_VALUE;var r=-1;for(var s=0;s<t.length;s++){if(t[s]<i){i=t[s];r=s}}if(r==-1)e.logger.c("an empty line has no minimum");return r}t.minIndexOfNumericList=v;function g(e){var t=Number.NEGATIVE_INFINITY;var i=-1;for(var r=0;r<e.length;r++){if(e[r]>t){t=e[r];i=r}}return i}t.maxIndexOfNumericList=g;function w(t){if(t.length==0){e.logger.c("an empty line has no minimum");return-1}var i=t[0];var r=0;for(var s=0;s<t.length;s++){if(t[s]<i){i=t[s];r=s}}return r}t.minIndexOfStringList=w;function y(e){var t=v(e);var i=[];for(var r=0;r<e.length;r++){i[r]=e[(r+t)%e.length]}return JSON.stringify(i)}t.indicesUpPermutationToString=y;var b=function(){function e(e,t,i){this.dicoOfExistingBlocks={};this.removeAlsoCircularPermutation=true;this.longList=e;this.blockSize=t;if(i==null){this.listToRemove=e;this.removeOnlyDoublon=true}else{this.listToRemove=i;this.removeOnlyDoublon=false}}e.prototype.go=function(){for(var e=0;e<this.listToRemove.length;e+=this.blockSize){try{var t=[];for(var i=0;i<this.blockSize;i++)t.push(this.listToRemove[e+i].hashString);this.dicoOfExistingBlocks[this.key(t)]=1}catch(e){throw"a block is not in your list"}}var r=[];for(var e=0;e<this.longList.length;e+=this.blockSize){var t=[];for(var i=0;i<this.blockSize;i++)t.push(this.longList[e+i].hashString);if(!this.removeOnlyDoublon){if(this.dicoOfExistingBlocks[this.key(t)]==null){for(var i=0;i<this.blockSize;i++)r.push(this.longList[e+i])}}else{if(this.dicoOfExistingBlocks[this.key(t)]==1){for(var i=0;i<this.blockSize;i++)r.push(this.longList[e+i]);this.dicoOfExistingBlocks[this.key(t)]++}}}return r};e.prototype.key=function(e){var t=[];if(!this.removeAlsoCircularPermutation)t=e;else{t=[];var i=w(e);for(var r=0;r<e.length;r++)t[r]=e[(r+i)%e.length]}var s="";t.forEach(function(e){s+=e+","});return s};return e}();t.ArrayMinusBlocksElements=b})(t=e.tab||(e.tab={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(t,i,r){this.nbSegments=32;this.meshModel=null;this.meshModels=null;this.useCloneInsteadOfInstances=false;this.checkCollision=false;this.color=e.color.thema.defaultVertexColor;this.constantRadius=null;this.radiusProp=.1;this.vertexToCopiedMeshes=new e.HashMap;if(e.deconnectViewerForTest)return;if(t instanceof e.Mamesh)this.vertices=t.vertices;else this.vertices=t;if(i==null)throw"scene is null";else this.scene=i;this.positionings=r}t.prototype.checkArgs=function(){if(this.vertices==null||this.vertices[0]==null)cc("no vertex to draw")};t.prototype.go=function(){if(e.deconnectViewerForTest)return;this.checkArgs();if(this.meshModel==null&&this.meshModels==null){this.meshModel=BABYLON.Mesh.CreateSphere("",this.nbSegments,2,this.scene);this.meshModels=[this.meshModel]}else{if(this.meshModels==null)this.meshModels=[];if(this.meshModel!=null)this.meshModels.push(this.meshModel);for(var t=0,i=this.meshModels;t<i.length;t++){var r=i[t];r.bakeCurrentTransformIntoVertices()}}for(var s=0,a=this.meshModels;s<a.length;s++){var r=a[s];if(r.material==null){var n=new BABYLON.StandardMaterial("",this.scene);n.diffuseColor=this.color.toBABYLON_Color3();r.material=n}}for(var o=0,h=this.meshModels;o<h.length;o++){var r=h[o];r.scaling=new e.XYZ(0,0,0)}if(this.positionings==null){this.positionings=new e.HashMap;for(var l=0,u=this.vertices;l<u.length;l++){var c=u[l];var m=void 0;if(this.constantRadius==null){var d=Number.MAX_VALUE;if(c.links.length!=0){for(var f=0,p=c.links;f<p.length;f++){var v=p[f];var g=e.geo.distance(c.position,v.to.position);if(g<d)d=g}}else{for(var w=0,y=this.vertices;w<y.length;w++){var b=y[w];if(!b.position.almostEqual(c.position)){var g=e.geo.distance(c.position,b.position);if(g<d)d=g}}}m=d*this.radiusProp}else m=this.constantRadius;var T=new e.Positioning;T.frontDir=new e.XYZ(1,0,0);T.upVector=new e.XYZ(0,1,0);T.scaling=new e.XYZ(m,m,m);this.positionings.putValue(c,T)}}this.buildVertexVisu()};t.prototype.clear=function(){var e=this;this.vertices.forEach(function(t){if(e.vertexToCopiedMeshes.getValue(t)!=null){for(var i=0,r=e.vertexToCopiedMeshes.getValue(t);i<r.length;i++){var s=r[i];s.dispose()}}})};t.prototype.buildVertexVisu=function(e,t){var i=this;if(e===void 0){e=this.vertices}if(t===void 0){t=[]}t.forEach(function(e){if(i.vertexToCopiedMeshes.getValue(e)!=null){for(var t=0,r=i.vertexToCopiedMeshes.getValue(e);t<r.length;t++){var s=r[t];s.dispose()}}i.vertexToCopiedMeshes.removeKey(e)});e.forEach(function(e){var t=[];if(i.useCloneInsteadOfInstances){for(var r=0,s=i.meshModels;r<s.length;r++){var a=s[r];t.push(a.clone(""))}}else{for(var n=0,o=i.meshModels;n<o.length;n++){var a=o[n];t.push(a.createInstance(""))}}for(var h=0,l=t;h<l.length;h++){var a=l[h];a.checkCollisions=i.checkCollision;if(i.parentNode!=null)a.parent=i.parentNode}if(i.vertexToCopiedMeshes.getValue(e)!=null){for(var u=0,c=i.vertexToCopiedMeshes.getValue(e);u<c.length;u++){var a=c[u];a.dispose()}}i.vertexToCopiedMeshes.putValue(e,t);i.updatePositioning(e)})};t.prototype.updatePositionings=function(e){var t=this;if(e===void 0){e=this.vertices}e.forEach(function(e){return t.updatePositioning(e)})};t.prototype.updatePositioning=function(t){var i=e.XYZ.newFrom(t.position);for(var r=0,s=this.vertexToCopiedMeshes.getValue(t);r<s.length;r++){var a=s[r];if(this.positionings.getValue(t)==null)throw"a vertex without associated positioning";if(Math.abs(this.positionings.getValue(t).scaling.x)<e.geo.epsilon){a.visibility=0}else{a.visibility=1;a.rotationQuaternion=this.positionings.getValue(t).quaternion();a.position=i;a.scaling=this.positionings.getValue(t).scaling}}};return t}();t.VerticesViewer=i;var r=function(){function t(t,i){this.parentNode=null;this.sideOrientation=BABYLON.Mesh.DOUBLESIDE;this.normalDuplication=s.duplicateOnlyWhenNormalsAreTooFarr;this.maxAngleBetweenNormals=Math.PI/4;this.color=e.color.thema.defaultSurfaceColor;this.alpha=.4;this.backFaceCulling=true;this.mamesh=t;this.scene=i}t.prototype.checkArgs=function(){if(this.scene==null)throw"the scene must but not null"};t.prototype.go=function(){if(e.deconnectViewerForTest)return;var t=[];var i=[];for(var r=0,s=this.mamesh.vertices;r<s.length;r++){var a=s[r];t.push(a.position.x,a.position.y,a.position.z)}var n=[];for(var o=0;o<this.mamesh.vertices.length;o++)n[this.mamesh.vertices[o].hashNumber]=o;var h=[];for(var l=0;l<this.mamesh.smallestTriangles.length;l+=3){var u=this.mamesh.smallestTriangles[l];var c=this.mamesh.smallestTriangles[l+1];var m=this.mamesh.smallestTriangles[l+2];h.push(n[u.hashNumber],n[c.hashNumber],n[m.hashNumber])}for(var l=0;l<this.mamesh.smallestSquares.length;l+=4){var u=this.mamesh.smallestSquares[l];var c=this.mamesh.smallestSquares[l+1];var m=this.mamesh.smallestSquares[l+2];var d=this.mamesh.smallestSquares[l+3];h.push(n[u.hashNumber],n[c.hashNumber],n[d.hashNumber]);h.push(n[c.hashNumber],n[m.hashNumber],n[d.hashNumber])}var f=this.computeOneNormalPerTriangle(t,h);var p=this.computeVertexNormalFromTrianglesNormal(t,h,f);this._ComputeSides(this.sideOrientation,t,h,p,i);var v=new BABYLON.VertexData;v.indices=h;v.positions=t;v.normals=p;v.uvs=i;var g=new BABYLON.Mesh("",this.scene);v.applyToMesh(g);if(this.parentNode!=null)g.parent=this.parentNode;if(this.material==null){var w=new BABYLON.StandardMaterial("",this.scene);w.diffuseColor=this.color.toBABYLON_Color3();this.material=w;this.material.backFaceCulling=this.backFaceCulling;if(!this.backFaceCulling)e.logger.c("backFaceCulling is desactivate on this mamesh.");this.material.sideOrientation=BABYLON.Mesh.BACKSIDE;w.alpha=this.alpha}g.material=this.material;return g};t.prototype._ComputeSides=function(e,t,i,r,s){var a=i.length;var n=r.length;var o;var h;e=e||BABYLON.Mesh.DEFAULTSIDE;switch(e){case BABYLON.Mesh.FRONTSIDE:break;case BABYLON.Mesh.BACKSIDE:var l;for(o=0;o<a;o+=3){l=i[o];i[o]=i[o+2];i[o+2]=l}for(h=0;h<n;h++){r[h]=-r[h]}break;case BABYLON.Mesh.DOUBLESIDE:var u=t.length;var c=u/3;for(var m=0;m<u;m++){t[u+m]=t[m]}for(o=0;o<a;o+=3){i[o+a]=i[o+2]+c;i[o+1+a]=i[o+1]+c;i[o+2+a]=i[o]+c}for(h=0;h<n;h++){r[n+h]=-r[h]}var d=s.length;for(var f=0;f<d;f++){s[f+d]=s[f]}break}};t.prototype.computeOneNormalPerTriangle=function(t,i){var r=[];var s=0;var a=0;var n=0;var o=0;var h=0;var l=0;var u=0;var c=0;var m=0;var d=0;var f=0;var p=0;var v=0;var g=i.length/3;for(var w=0;w<g;w++){f=i[w*3];p=i[w*3+1];v=i[w*3+2];s=t[f*3]-t[p*3];a=t[f*3+1]-t[p*3+1];n=t[f*3+2]-t[p*3+2];o=t[v*3]-t[p*3];h=t[v*3+1]-t[p*3+1];l=t[v*3+2]-t[p*3+2];u=a*l-n*h;c=n*o-s*l;m=s*h-a*o;d=Math.sqrt(u*u+c*c+m*m);d=d===0?1:d;u/=d;c/=d;m/=d;r[w]=new e.XYZ(u,c,m)}return r};t.prototype.computeVertexNormalFromTrianglesNormal=function(t,i,r){var a=this;var n=[];for(var o=0;o<t.length/3;o++)n[o]=new e.XYZ(0,0,0);if(this.normalDuplication==s.none){for(var o=0;o<i.length;o+=3){var h=Math.floor(o/3);n[i[o]].add(r[h]);n[i[o+1]].add(r[h]);n[i[o+2]].add(r[h])}n.forEach(function(e){e.normalize()})}else if(this.normalDuplication==s.duplicateVertex||this.normalDuplication==s.duplicateOnlyWhenNormalsAreTooFarr){var l=function(r,o,h,l,u,c){if(a.normalDuplication==s.duplicateOnlyWhenNormalsAreTooFarr){if(e.geo.xyzAlmostZero(r)||e.geo.xyzAlmostZero(o)||e.geo.angleBetweenTwoVectorsBetween0andPi(r,o)<a.maxAngleBetweenNormals){r.add(o)}else{var m=t.length/3;t.push(h,l,u);i[c]=m;n.push(o)}}else{var m=t.length/3;t.push(h,l,u);i[c]=m;n.push(o)}};for(var o=0;o<i.length;o+=3){var h=Math.floor(o/3);var u=i[o];l(n[u],r[h],t[3*u],t[3*u+1],t[3*u+2],o);u=i[o+1];l(n[u],r[h],t[3*u],t[3*u+1],t[3*u+2],o+1);u=i[o+2];l(n[u],r[h],t[3*u],t[3*u+1],t[3*u+2],o+2)}}else throw"wtf";var c=[];n.forEach(function(e){c.push(e.x,e.y,e.z)});return c};return t}();t.SurfaceViewer=r;(function(e){e[e["none"]=0]="none";e[e["duplicateOnlyWhenNormalsAreTooFarr"]=1]="duplicateOnlyWhenNormalsAreTooFarr";e[e["duplicateVertex"]=2]="duplicateVertex"})(t.NormalDuplication||(t.NormalDuplication={}));var s=t.NormalDuplication;var a=function(){function t(t,i){this.lateralScalingConstant=null;this.lateralScalingProp=.05;this.tesselation=12;this.material=null;this.color=e.color.thema.defaultLinkColor;this.res=[];this.pairVertexToLateralDirection=null;this.segmentOrientationFunction=null;this.clonesInsteadOfInstances=false;this.checkCollision=true;this.barycenter=null;this.middle=new e.XYZ(0,0,0);this.mamesh=t;this.scene=i}t.prototype.checkArgs=function(){if(this.scene==null)throw"scene is null";if(this.mamesh.vertices.length==0)cc("your IN_mamesh has no vertex")};t.prototype.go=function(){if(e.deconnectViewerForTest)return;this.checkArgs();if(this.meshModel==null){if(this.material==null){this.material=new BABYLON.StandardMaterial("",this.scene);this.material.diffuseColor=this.color.toBABYLON_Color3()}this.meshModel=BABYLON.Mesh.CreateCylinder("",1,1,1,this.tesselation,5,this.scene);this.meshModel.material=this.material}this.meshModel.scaling=new e.XYZ(0,0,0);if(this.lateralScalingConstant==null){var t=0;var i=0;for(var r=0,s=this.mamesh.vertices;r<s.length;r++){var a=s[r];if(a.links.length!=0){var n=Number.MAX_VALUE;for(var o=0,h=a.links;o<h.length;o++){var l=h[o];var u=e.geo.distance(a.position,l.to.position);if(u<n)n=u}t+=n;i++}}t/=i;this.lateralScalingConstant=t*this.lateralScalingProp}var c=new e.StringMap;for(var m=0,d=this.mamesh.vertices;m<d.length;m++){var f=d[m];for(var p=0,v=f.links;p<v.length;p++){var g=v[p];var w=e.tab.indicesUpPermutationToString([f.hashNumber,g.to.hashNumber]);if(c.getValue(w)==null){this.drawOneLink(f,g.to);c.putValue(w,true)}}}return this.res};t.prototype.drawOneLink=function(t,i){if(this.segmentOrientationFunction!=null){if(this.segmentOrientationFunction(t,i)==0)return;if(this.segmentOrientationFunction(t,i)<0){var r=t;t=i;i=r}}var s;if(this.clonesInsteadOfInstances)s=this.meshModel.clone("");else s=this.meshModel.createInstance("");s.checkCollisions=this.checkCollision;var a=new o(t.position,i.position,s);a.lateralScaling=this.lateralScalingConstant;if(this.pairVertexToLateralDirection!=null){a.lateralDirection=this.pairVertexToLateralDirection(t,i)}else{if(this.barycenter==null){this.barycenter=new e.XYZ(0,0,0);for(var n=0,h=this.mamesh.vertices;n<h.length;n++){var l=h[n];this.barycenter.add(l.position)}this.barycenter.scale(1/this.mamesh.vertices.length)}this.middle.copyFrom(t.position).add(i.position).scale(.5);this.middle.substract(this.barycenter);a.lateralDirection.copyFrom(this.middle)}a.goChanging();if(this.parentNode!=null)s.parent=this.parentNode;this.res.push(s)};return t}();t.LinksViewer=a;var n=function(){function t(t,i){this.vertices=null;this.doNotDrawLinesContainingOnlyInvisibleVertices=true;this.color=null;this.lineToColor=null;this.lineToLevel=null;this.levelPropToColorFunc=function(t){return new e.Color(new e.HSV_01(t*.7,1,.8))};this.cap=BABYLON.Mesh.NO_CAP;this.tesselation=10;this.interpolationOption=new e.geometry.InterpolationOption;this.isThin=false;this.constantRadius=null;this.radiusProp=.05;this.radiusFunction=null;this.res=[];if(t instanceof e.Mamesh){var r=t;if(!r.linesWasMade)r.fillLineCatalogue();this.lines=r.lines}else{this.lines=t}this.scene=i}t.prototype.go=function(){this.buildLineToColor();if(e.deconnectViewerForTest)return;if(this.scene==null)throw"scene is null";for(var t=0,i=this.lines;t<i.length;t++){var r=i[t];if(this.lineToColor.getValue(r)!=null)this.drawOneLine(r)}return this.res};t.prototype.clear=function(){for(var e=0,t=this.res;e<t.length;e++){var i=t[e];i.dispose()}};t.prototype.buildLineToColor=function(){if(this.color!=null){this.lineToColor=new e.HashMap;for(var t=0,i=this.lines;t<i.length;t++){var r=i[t];this.lineToColor.putValue(r,this.color)}return}if(this.lineToColor!=null)return;if(this.lineToLevel==null){this.lineToLevel=new e.HashMap;for(var s=0;s<this.lines.length;s++)this.lineToLevel.putValue(this.lines[s],s)}var a=e.tab.maxValue(this.lineToLevel.allValues());var n=e.tab.minValue(this.lineToLevel.allValues());this.lineToColor=new e.HashMap;for(var o=0,h=this.lines;o<h.length;o++){var r=h[o];var l=this.lineToLevel.getValue(r);if(l!=null){var u=(l-n)/(a-n);this.lineToColor.putValue(r,this.levelPropToColorFunc(u))}else this.lineToColor.putValue(r,null)}};t.prototype.drawOneLine=function(e){var t=[];var i=true;e.vertices.forEach(function(e){t.push(e.position);if(!e.isInvisible)i=false});if(i&&this.doNotDrawLinesContainingOnlyInvisibleVertices)return;var r=this.drawOnePath(e,t);this.res.push(r)};t.prototype.drawOnePath=function(t,i){var r=this;var s;var a;if(this.interpolationOption!=null&&this.interpolationOption.interpolationStyle!=e.geometry.InterpolationStyle.none){var n=new e.geometry.LineInterpoler(i);n.options=this.interpolationOption;if(t.isLoop)n.options.loopLine=true;a=n.go()}else{a=i;if(t.isLoop)a.push(i[0])}i=a;var o=this.lineToColor.getValue(t).toBABYLON_Color3();if(this.isThin){var h=BABYLON.Mesh.CreateLines("",i,this.scene);h.color=o;s=h}else{var l=null;if(this.radiusFunction!=null){var u=0;for(var c=0;c<i.length-1;c++){u+=e.geo.distance(i[c],i[c+1])}l=function(e,t){return r.radiusFunction(e,t/u)};s=BABYLON.Mesh.CreateTube("",i,null,this.tesselation,l,this.cap,this.scene,true,BABYLON.Mesh.FRONTSIDE)}else{if(this.constantRadius==null){var m=0;var d=0;for(var f=0,p=this.lines;f<p.length;f++){var v=p[f];for(var c=0;c<v.vertices.length-1;c++){m+=e.geo.distance(v.vertices[c].position,v.vertices[c+1].position);d++}}this.constantRadius=m/d*this.radiusProp}s=BABYLON.Mesh.CreateTube("",i,this.constantRadius,this.tesselation,null,this.cap,this.scene,true,BABYLON.Mesh.FRONTSIDE)}}var g=new BABYLON.StandardMaterial("",this.scene);g.diffuseColor=o;s.material=g;if(this.parentNode!=null)s.parent=this.parentNode;return s};return t}();t.LinesViewer=n;var o=function(){function t(t,i,r){this.lateralScaling=.05;this.lateralDirection=new e.XYZ(0,0,1);this.yAxis=new e.XYZ(0,1,0);this.zAxis=new e.XYZ(0,0,1);this.direction=new e.XYZ(0,0,0);this.nothing=new e.XYZ(0,0,0);this.begin=t;this.end=i;this.modelMesh=r}t.prototype.goChanging=function(){this.direction.copyFrom(this.end).substract(this.begin);var t=this.direction.length();this.direction.normalize();var i=new e.XYZ(0,0,0);i.add(this.begin).add(this.end).scale(.5);this.modelMesh.scaling=new e.XYZ(this.lateralScaling,t,this.lateralScaling);this.modelMesh.position=i;var r=new e.XYZ(0,0,0);var s=new e.XYZ(0,0,0);e.geo.cross(this.direction,this.lateralDirection,this.nothing);if(this.nothing.lengthSquared()<e.geo.epsilon)s.copyFromFloats(Math.random(),Math.random(),Math.random());else s.copyFrom(this.lateralDirection);e.geo.orthonormalizeKeepingFirstDirection(this.direction,s,this.nothing,r);var a=new e.XYZW(0,0,0,0);e.geo.aQuaternionMovingABtoCD(this.yAxis,this.zAxis,this.direction,r,a,true);this.modelMesh.rotationQuaternion=a;return this.modelMesh};return t}();t.ElongateAMeshFromBeginToEnd=o})(t=e.visu3d||(e.visu3d={}))})(mathis||(mathis={}));var cc;var showDevMessages=true;if(showDevMessages){cc=console.log.bind(window.console)}else cc=function(){};var mathis;(function(e){e.geo=new e.Geo;e.logger=new e.Logger;e.deconnectViewerForTest=false})(mathis||(mathis={}));