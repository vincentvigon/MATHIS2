var __extends=this&&this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};var mathis;(function(e){var t=BABYLON.Color3;var i;(function(i){var r=BABYLON.StandardMaterial;function s(){var t=document.getElementById("mainDiv");var i=new e.MathisFrame("surfaceMathisFrame",false);var r=new e.MathisFrame("sphereMathisFrame",false);var s=e.legend("30px",t,false);new o(i,r,s)}i.start=s;var n=function(){function i(i,r,s,n,a){this.sizes=new e.XYZ(1,1,1);this.arrowColor=new t(1,0,0);this.planeColor=new t(0,0,1);this.planeRadius=.2;this.tangentDiameter=.1;this.cartes=i;this.surfaceScene=r;this.cam=n;this.sphereScene=s;this.surface=a}i.prototype.checkOrientation=function(t,i,r){var s=e.XYZ.newFrom(this.cam.trueCamPos.position).substract(r.X(t,i));if(e.geo.dot(s,r.newN(t,i))<0)r.orientationCoef*=-1};i.prototype.oneArrowOnOneScene=function(t,i,r,s){var n=new e.creation3D.ArrowCreator(r);var a=n.go();a.position=t;a.rotationQuaternion=i;var o=new BABYLON.StandardMaterial("",r);o.diffuseColor=this.arrowColor;a.material=o;a.scaling=s;return a};i.prototype.drawNormalVectors=function(t,i,r){this.checkOrientation(t,i,r);var s=new e.Positioning;s.upVector=r.newN(t,i);var n=s.quaternion();var a=this.oneArrowOnOneScene(r.X(t,i),n,this.surfaceScene,this.sizes);var o=this.oneArrowOnOneScene(new e.XYZ(0,0,0),n.clone(),this.sphereScene,new e.XYZ(this.sizes.x,1,this.sizes.z));return{initial:a,onSphere:o}};i.prototype.oneTangentPlane=function(t,i,r,s,n){if(n===void 0){n=null}var a=BABYLON.Mesh.CreateDisc("",this.planeRadius,60,s);var o=new e.XYZW(0,0,0,0);e.geo.aQuaternionMovingABtoCD(new e.XYZ(0,0,1),new e.XYZ(1,0,0),t.scale(-1),i,o,false);a.rotationQuaternion=o;a.position=r;var h=new BABYLON.StandardMaterial("",s);h.sideOrientation=BABYLON.Mesh.DOUBLESIDE;h.diffuseColor=this.planeColor;h.backFaceCulling=false;a.material=h;if(n!=null){a.onClick=n}return a};i.prototype.drawOneTangentVector=function(i,s,n){if(e.geo.distance(i,s)<2*e.geo.epsilon)return;var a=new e.creation3D.ArrowCreator(n);a.arrowFootAtOrigin=false;var o=a.go();var h=new r("",n);h.diffuseColor=new t(1,0,0);o.material=h;var l=new e.visu3d.ElongateAMeshFromBeginToEnd(i,s,o);l.lateralScaling=this.tangentDiameter*2;l.goChanging();return o};i.prototype.drawTangentPlanes=function(t,i,r,s,n){var a=this;this.checkOrientation(t,i,r);var o=null;if(s){this.surface.isPickable=false;o=function(s){n.push(a.drawOneTangentVector(r.X(t,i),s,a.surfaceScene));var o=e.XYZ.newFrom(s).substract(r.X(t,i));var h=r.dNaction(t,i,o);var l=r.newN(t,i);var u=e.XYZ.newFrom(l).add(h);n.push(a.drawOneTangentVector(l,u,a.sphereScene))}}n.push(this.oneTangentPlane(r.newN(t,i),r.Xu(t,i),r.X(t,i),this.surfaceScene,o));n.push(this.oneTangentPlane(r.newN(t,i),r.Xu(t,i),r.newN(t,i),this.sphereScene))};return i}();var a;(function(e){e[e["vue_libre"]=0]="vue_libre";e[e["vue_de_face"]=1]="vue_de_face";e[e["vue_de_dos"]=2]="vue_de_dos";e[e["vue_de_gauche"]=3]="vue_de_gauche";e[e["vue_de_droite"]=4]="vue_de_droite";e[e["vue_du_haut"]=5]="vue_du_haut";e[e["vue_du_bas"]=6]="vue_du_bas"})(a||(a={}));var o=function(){function i(t,i,r){var s=this;this.meshesToDispose=[];this.normalize=false;this.mode=0;this.$tangentSpace=null;this.$surfaceName=null;this.$pointOfVue=null;this.$courbure=null;this.recul=-3;this.pointOfViewToPos=[null,new e.XYZ(0,0,this.recul),new e.XYZ(0,0,-this.recul),new e.XYZ(this.recul,0,0),new e.XYZ(-this.recul,0,0),new e.XYZ(0,this.recul,0),new e.XYZ(0,-this.recul,0)];this.pointOfViewToUpVector=[null,new e.XYZ(0,1,0),new e.XYZ(0,1,0),new e.XYZ(0,1,0),new e.XYZ(0,1,0),new e.XYZ(0,0,1),new e.XYZ(0,0,1)];this.surfaceScene=t.scene;this.sphereScene=i.scene;this.surfaceMathisFrame=t;this.localButtonPlace=r;this.createGaussSphereScene(i);this.createSurfaceScene(t);this.createSurface(e.riemann.SurfaceName.torus);this.drawNormalVector=new n(this.surface.cartes,this.surfaceScene,this.sphereScene,this.surfaceCamera,this.meshSurf);this.drawNormalVector.sizes=new e.XYZ(.1,.1,.1);this.resetInitialClick();this.addControlButton();this.surfaceCamera.onPositioningChange=function(e){s.onPositioningChange(e)}}i.prototype.createSurface=function(t){var i=new e.riemann.SurfaceMaker(t);this.surface=i.go();this.drawMesh(this.surface.wholeSurfaceMesh)};i.prototype.onPositioningChange=function(e){{var t=this.sphereCamera.trueCamPos.position.length();e.position.normalize().scale(t);this.sphereCamera.trueCamPos.copyFrom(e);this.sphereCamera.whishedCamPos.copyFrom(e);this.$pointOfVue.selectedIndex=0}};i.prototype.setMapMode=function(){this.mode=0;this.normalize=false};i.prototype.setDifferenceMode=function(){this.mode=1;this.normalize=false};i.prototype.setNormalisedDifferenceMode=function(){this.mode=2;this.normalize=true};i.prototype.setDeriveMode=function(){this.mode=3;this.normalize=false;this.$tangentSpace.selectedIndex=2};i.prototype.addControlButton=function(){var t=this;window.onload=function(){{var i=e.allStringValueOfEnume(e.riemann.SurfaceName);t.$surfaceName=document.createElement("select");t.localButtonPlace.appendChild(t.$surfaceName);for(var r=0;r<i.length;r++){var s=document.createElement("option");s.value=i[r];s.text=i[r];t.$surfaceName.appendChild(s)}t.$surfaceName.onchange=function(){t.clearAll();t.createSurface(t.$surfaceName.selectedIndex);t.drawNormalVector=new n(t.surface.cartes,t.surfaceScene,t.sphereScene,t.surfaceCamera,t.meshSurf);t.drawNormalVector.sizes=new e.XYZ(.1,.1,.1)}}{var o=e.allStringValueOfEnume(a);t.$pointOfVue=document.createElement("select");t.localButtonPlace.appendChild(t.$pointOfVue);for(var r=0;r<o.length;r++){var s=document.createElement("option");s.value=o[r];s.text=o[r];t.$pointOfVue.appendChild(s)}t.$pointOfVue.onchange=function(i){if(t.$pointOfVue.selectedIndex>0){var r=e.XYZ.newFrom(t.pointOfViewToPos[t.$pointOfVue.selectedIndex]);var s=e.XYZ.newFrom(t.pointOfViewToUpVector[t.$pointOfVue.selectedIndex]);var n=new e.Positioning;n.position=r;n.frontDir=e.XYZ.newFrom(r).scale(-1);n.upVector=s;t.surfaceCamera.trueCamPos.copyFrom(n);t.surfaceCamera.whishedCamPos.copyFrom(n);t.sphereCamera.trueCamPos.copyFrom(n);t.sphereCamera.whishedCamPos.copyFrom(n)}};t.$pointOfVue.selectedIndex=1;t.$pointOfVue.onchange(null)}{var h=["gauss map","difference","différence normalisé"];var l=document.createElement("select");t.localButtonPlace.appendChild(l);for(var r=0;r<h.length;r++){var s=document.createElement("option");s.value=h[r];s.text=h[r];l.appendChild(s)}l.onchange=function(){if(l.selectedIndex==0)t.setMapMode();else if(l.selectedIndex==1)t.setDifferenceMode();else if(l.selectedIndex==2)t.setNormalisedDifferenceMode();else if(l.selectedIndex==3)t.setDeriveMode()}}{var h=["pas d'espace tangent","petit espace tangent","grand espace tangent"];t.$tangentSpace=document.createElement("select");t.localButtonPlace.appendChild(t.$tangentSpace);for(var r=0;r<h.length;r++){var s=document.createElement("option");s.value=h[r];s.text=h[r];t.$tangentSpace.appendChild(s)}}{var u=document.createElement("button");u.classList.add("buttonClear");u.innerHTML='<i class="fa fa-eraser"></i>';u.onclick=function(){t.clearAllSecondaryMeshes()};t.localButtonPlace.appendChild(u);t.$courbure=document.createElement("span");t.localButtonPlace.appendChild(t.$courbure);t.$surfaceName.selectedIndex=e.riemann.SurfaceName.torus}}};i.prototype.clearAllSecondaryMeshes=function(){this.meshesToDispose.forEach(function(e){if(e!=null)e.dispose()});this.meshesToDispose=[];this.resetInitialClick()};i.prototype.resetInitialClick=function(){var e=this;this.meshSurf.isPickable=true;this.meshSurf.onClick=function(t){e.firstClick(t)}};i.prototype.clearAll=function(){this.clearAllSecondaryMeshes();this.meshSurf.dispose();this.linesOnSurf.forEach(function(e){return e.dispose()});this.$pointOfVue.selectedIndex=1;this.$pointOfVue.onchange(null)};i.prototype.firstClick=function(i){var r=this;var s=this.surface.findBestCarte(i);var n=s.uv;var a=s.carte;var o;if(this.mode==0)o=new t(Math.random(),Math.random(),Math.random());else o=new t(0,1,0);this.drawNormalVector.arrowColor=o;var h=this.drawNormalVector.drawNormalVectors(n.u,n.v,a);this.meshesToDispose.push(h.initial);this.meshesToDispose.push(h.onSphere);if(this.$tangentSpace.selectedIndex!=0){if(this.$tangentSpace.selectedIndex==1)this.drawNormalVector.planeRadius=.03;else if(this.$tangentSpace.selectedIndex==2)this.drawNormalVector.planeRadius=.1;this.drawNormalVector.drawTangentPlanes(n.u,n.v,a,this.mode==3,this.meshesToDispose)}if(this.mode==1||this.mode==2){this.meshSurf.onClick=function(e){var t=r.surface.findBestCarte(e);if(t.carte!=a){cc("the second click is too far from the first: they arrived on different cart-image")}else{r.secondClick(n,t.uv,t.carte)}r.resetInitialClick()}}var l=e.roundWithGivenPrecision(a.dNinTangentBasis(n.u,n.v).determinant(),1);this.$courbure.textContent=" Courbure:"+l};i.prototype.secondClick=function(t,i,r){var s=this;var n=e.geo.distance(r.X(t.u,t.v),r.X(i.u,i.v));var a=e.geo.distance(r.newN(t.u,t.v),r.newN(i.u,i.v));var o=[];var h=.01;var l=0;var u=this.mode==1?.8:.95;while(l<u){o.push(l);l+=h}var c=0;var m=r.X(t.u,t.v);var p=null;var f={initial:null,onSphere:null};var d=new e.PeriodicAction(function(){var h=new e.UV(0,0);e.geo.betweenUV(i,t,o[c],h);if(p!=null){p.initial.dispose();p.onSphere.dispose()}p=s.drawNormalVector.drawNormalVectors(h.u,h.v,r);c++;if(c!=o.length+1){if(f.initial!=null)f.initial.dispose();if(f.onSphere!=null)f.onSphere.dispose()}var l;var u;if(s.normalize){var d=r.X(h.u,h.v).substract(m);if(d.lengthSquared()<e.geo.epsilonSquare)return;d.normalize().scale(n);l=e.XYZ.newFrom(m).add(d);var v=r.newN(h.u,h.v).substract(r.newN(t.u,t.v));if(v.length()>e.geo.epsilon)v.normalize().scale(a);u=e.XYZ.newFrom(r.newN(t.u,t.v)).add(v)}else{l=r.X(h.u,h.v);u=r.newN(h.u,h.v)}f.initial=s.drawNormalVector.drawOneTangentVector(m,l,s.surfaceScene);f.onSphere=s.drawNormalVector.drawOneTangentVector(r.newN(t.u,t.v),u,s.sphereScene);s.meshesToDispose.push(f.initial);s.meshesToDispose.push(f.onSphere)});d.nbTimesThisActionMustBeFired=o.length+1;d.timeIntervalMilli=3e3/o.length;this.surfaceMathisFrame.pushPeriodicAction(d)};i.prototype.createGaussSphereScene=function(i){var r=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-1,1,-1),i.scene);r.diffuse=new BABYLON.Color3(1,1,1);r.specular=new BABYLON.Color3(1,1,1);r.groundColor=new BABYLON.Color3(0,0,0);var s=new e.macamera.SphericalGrabber(i.scene,new e.XYZ(1,1,1));s.endOfZone1=0;s.endOfZone2=0;s.mesh.visibility=1;s.showGrabberOnlyWhenGrabbing=false;var n=new BABYLON.StandardMaterial("",i.scene);n.alpha=.3;n.diffuseColor=new t(1,1,1);s.mesh.material=n;var a=new e.macamera.GrabberCamera(i,s);a.useFreeModeWhenCursorOutOfGrabber=false;this.sphereCamera=a};i.prototype.createSurfaceScene=function(t){var i=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-1,1,-1),t.scene);i.diffuse=new BABYLON.Color3(1,1,1);i.specular=new BABYLON.Color3(1,1,1);i.groundColor=new BABYLON.Color3(0,0,0);var r=new e.macamera.SphericalGrabber(t.scene,new e.XYZ(1,1,1));r.endOfZone1=2;r.endOfZone2=2;r.showGrabberOnlyWhenGrabbing=true;var s=new e.macamera.GrabberCamera(t,r);s.showPredefinedConsoleLog=false;s.useFreeModeWhenCursorOutOfGrabber=false;this.surfaceCamera=s};i.prototype.drawMesh=function(t){var i=new e.lineModule.LineComputer(t);i.startingVertices=[];for(var r=0,s=t.vertices;r<s.length;r++){var n=s[r];if(n.param.x%4==0&&n.param.y==0)i.startingVertices.push(n);if(n.param.x==0&&n.param.y%4==0)i.startingVertices.push(n)}i.go();var a=new e.visu3d.LinesViewer(t,this.surfaceScene);a.constantRadius=.004;this.linesOnSurf=a.go();this.linesOnSurf.forEach(function(e){return e.isPickable=false});var o=new e.visu3d.SurfaceViewer(t,this.surfaceScene);this.meshSurf=o.go();this.resetInitialClick()};return i}()})(i=e.gauss||(e.gauss={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){function i(){var t=new e.MathisFrame(null,false);t.resetScene();t.addDefaultCamera();t.addDefaultLight();var i=BABYLON.Mesh.CreateBox("",1,t.scene);var r=new BABYLON.StandardMaterial("",t.scene);r.diffuseColor=new BABYLON.Color3(1,0,0);i.material=r}t.start=i;function r(t){var i=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-1,1,-1),t.scene);i.diffuse=new BABYLON.Color3(1,1,1);i.specular=new BABYLON.Color3(1,1,1);i.groundColor=new BABYLON.Color3(.5,.5,.5);var r=new e.XYZ(3,0,0);var s=2;var n=new e.macamera.SphericalGrabber(t.scene,new e.XYZ(s,s,s),r);n.mesh.material.alpha=.6;n.showGrabberOnlyWhenGrabbing=false;n.endOfZone1=0;n.endOfZone2=0;var a=new e.macamera.GrabberCamera(t,n);a.useFreeModeWhenCursorOutOfGrabber=false;a.changePosition(new e.XYZ(-1,-1,-10),false);a.attachControl(t.canvas);var o=BABYLON.Mesh.CreateBox("",1,t.scene);var h=new BABYLON.StandardMaterial("",t.scene);h.diffuseColor=new BABYLON.Color3(1,0,0);o.material=h}function s(t){var i=5;var r=2;var s=new e.XYZ(-i/2,-r/2,0);function n(e,t){t.copyFrom(e);t.substract(s);t.x/=i;t.y/=r}function a(e,t){t.copyFrom(e);t.x*=i;t.y*=r;t.add(s)}var o;{var h=new e.XYZ(0,0,0);var l=function(e){return.4*Math.sin(.5*e)};var u=function(e){return.2*Math.sin(.5*e)};var c=function(e){return 0};var m=function(e){return 0};var p=function(e){return 0};var f=function(e){return 0};o=function(e,t,i){n(t,h);var r=(h.x-.5)*2;var s=(h.y-.5)*4;i.x=-r*s*s;i.y=-r*r*s;i.x+=h.x*(l(e)+c(e)*h.x+m(e)*h.y);i.y+=h.y*(u(e)+p(e)*h.x+f(e)*h.y)}}var d=new e.differentialSystem.TwoDim(o,t);d.go()}function n(t){var i=new e.mecaStat.IsingOnMesh(t);i.go()}function a(t){var i=new e.infiniteWorlds.InfiniteCartesian(t);i.nbRepetition=8;i.nbSubdivision=3;i.fondamentalDomainSize=6;i.nbHorizontalDecays=1;i.nbVerticalDecays=1;i.nameOfResau3d=e.infiniteWorlds.NameOfReseau3D.cube;i.collisionForCamera=true;i.collisionOnLinks=true;i.collisionOnVertices=true;var r=BABYLON.Mesh.CreateSphere("",5,10,t.scene);r.position=new e.XYZ(1,1,1);i.go();i.seeWorldFromInside()}})(t=e.testFront||(e.testFront={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){(function(e){e[e["basic"]=0]="basic";e[e["tool"]=1]="tool";e[e["math"]=2]="math";e[e["forDeveloper"]=3]="forDeveloper";e[e["proba"]=4]="proba"})(t.Keywords||(t.Keywords={}));var i=t.Keywords;var r;(function(e){e.$$$="$$$";e.spacesToSuppress="                ";e.toIncludeAtTheBeginOfTheFirstHiddenPiece=["var mathisFrame=new mathis.MathisFrame()"];e.traitementsForEachLine=[function(e){return e.replace(/this.mathisFrame\./g,"mathisFrame.")}];e.begin=["$$$begin","$$$b"];e.beginHidden=["$$$beginHidden","$$$bh"];e.end=["$$$end","$$$e"];e.endHidden=["$$$endHidden","$$$eh"]})(r=t.conv||(t.conv={}));(function(e){e[e["select"]=0]="select";e[e["button"]=1]="button"})(t.ChoicesOptionsType||(t.ChoicesOptionsType={}));var s=t.ChoicesOptionsType;var n=function(){function e(e,t){if(t===void 0){t=null}this.$select=null;this.$button=null;this.values=e;if(t!=null)this.options=t;else this.options={}}e.prototype.changePossibleValues=function(e,t,i){if(t===void 0){t=null}if(i===void 0){i=null}if(t!=null&&e.length!=t.length)throw"values.length and visualValues.length must be equal for:"+this.key;this.values=e;if(t!=null)this.options.visualValues=t;if(this.$select!=null){for(var r=0;r<this.$select.options.length;r++){this.$select.options[r]=null}for(var r=0;r<this.values.length;r++){var s=document.createElement("option");s.value=this.values[r];var n="";if(i&&i.testMode)n=this.key+":";if(this.options.visualValues!=null){n+=this.options.visualValues[r]}else n+=this.values[r];s.text=n;this.$select.appendChild(s)}}else if(this.$button!=null){if(this.options.visualValues!=null)this.$button.visualValues=this.options.visualValues;else for(var r=0;r<this.values.length;r++){this.$button.visualValues.push(this.values[r])}}};e.prototype.show=function(){this.$parent.show()};e.prototype.hide=function(){this.$parent.hide()};return e}();t.Choices=n;function a(t){if(t.COMMAND_DICO!=null)throw"command dico was already made for the piece of code:"+t.NAME;var i=new e.StringMap;for(var s in t){if(t.hasOwnProperty(s)&&s.slice(0,3)==r.$$$){var a=s.slice(3);var o=t[s];if($.isArray(o)){o=new n(o);t[s]=o}else if(!(o instanceof n))throw"the attribute '$$$"+a+"'  must be an array or of Type Choices because it start by 3$";o.key=a;if(i.getValue(a)!=null)throw"a configuration attribute is duplicated ";i.putValue(a,o)}}for(var h=0,l=i.allKeys();h<l.length;h++){var a=l[h];if(t[a]===undefined)throw"no attribute associate to  $$$"+a}t.COMMAND_DICO=i}t.buildCommandDico=a;var o=function(){function t(t,i,r){this.pieceOfCode=t;this.defaultContainer=i;this.mathisFrame=r;this.selectAndAroundClassName=null;this.keyTo$select=new e.StringMap;this.keyTo$button=new e.StringMap;this.containersToPutCommand=new e.StringMap;this.pushState=false;this.go_fired=false;if(i!=null){if(!(i instanceof jQuery))throw"defaultContainer must be null or a jQuery object";if(i.length!=1)throw"defaultContainer must contain a unique HTMLElement"}if(t.COMMAND_DICO==null)a(this.pieceOfCode)}t.prototype.setAllSelectsAccordingToPieceOfCode=function(){for(var e=0,t=this.pieceOfCode.COMMAND_DICO.allKeys();e<t.length;e++){var i=t[e];var r=null;var s=this.pieceOfCode.COMMAND_DICO.getValue(i);for(var n=0;n<s.values.length;n++){if(s.values[n]===null||this.pieceOfCode[i]===null){if(s.values[n]===null&&this.pieceOfCode[i]===null)r=n}else{if(JSON.stringify(s.values[n])==JSON.stringify(this.pieceOfCode[i]))r=n}}if(r!=null){var a=this.keyTo$select.getValue(i);if(a!=null)a.selectedIndex=r;else{var o=this.keyTo$button.getValue(i);if(o!=null){o.selectedIndex=r;o.updateVisual()}}}else{var h="";for(var l=0,u=s.values;l<u.length;l++){var c=u[l];h+=JSON.stringify(c)+","}throw"in the pieceOfCode:"+this.pieceOfCode.NAME+", for the configuration-attribute:"+i+", the value:"+JSON.stringify(this.pieceOfCode[i])+" does not appear in the possible choices:"+h}}};t.prototype.go=function(){var e=this;if(this.go_fired)throw"Binder.go can be fired only once";this.go_fired=true;if(this.defaultContainer!=null){this.containersToPutCommand.putValue("default",this.defaultContainer)}if(this.mathisFrame!=null){this.containersToPutCommand.putValue("NW",this.mathisFrame.subWindow_NW.$visual);this.containersToPutCommand.putValue("NE",this.mathisFrame.subWindow_NE.$visual);this.containersToPutCommand.putValue("N",this.mathisFrame.subWindow_N.$visual);this.containersToPutCommand.putValue("SW",this.mathisFrame.subWindow_SW.$visual);this.containersToPutCommand.putValue("SE",this.mathisFrame.subWindow_SE.$visual);this.containersToPutCommand.putValue("S",this.mathisFrame.subWindow_S.$visual);this.containersToPutCommand.putValue("W",this.mathisFrame.subWindow_W.$visual);this.containersToPutCommand.putValue("E",this.mathisFrame.subWindow_E.$visual);if(this.containersToPutCommand.getValue("default")==null)this.containersToPutCommand.putValue("default",this.mathisFrame.subWindow_NW.$visual)}var t=function(t){var r=i.pieceOfCode.COMMAND_DICO.getValue(t);r.initialValueMemorized=i.pieceOfCode[t];var n=void 0;var a=void 0;if(r.options.containerName!=null){a=i.containersToPutCommand.getValue(r.options.containerName);if(a==null||a.length==0)throw"the container name:"+r.options.containerName+" has no corresponding container"}else a=i.containersToPutCommand.getValue("default");var o=a.find("."+t);if(o==null||o.length==0){o=$("<span>").addClass(t);a.append($("<div>").append(o));n=true}else if(o.length>1)throw"several places for the element with name:"+t;else if(o.length==1){n=false}if(i.selectAndAroundClassName!=null){o.addClass(i.selectAndAroundClassName)}r.$parent=o;var l=$("<span>");var u=r.options.before==null?"":r.options.before;var c=r.options.label==null?t+":":r.options.label;if(n)l.append(c).append(u);else l.append(u);if(r.options.type==null||r.options.type==s.select){r.$select=document.createElement("select");i.keyTo$select.putValue(t,r.$select);o.append(l);o.append(r.$select);r.changePossibleValues(r.values,null,i.indexPage);r.$select.onchange=function(){e.pieceOfCode[r.key]=r.values[r.$select.selectedIndex];e.whenSelectOrButtonChange(r)}}else if(r.options.type==s.button){r.$button=new h;i.keyTo$button.putValue(t,r.$button);o.append(r.$button.$visual);r.changePossibleValues(r.values,null,i.indexPage);r.$button.onclick=function(){r.$button.increment();r.$button.updateVisual();e.pieceOfCode[r.key]=r.values[r.$button.selectedIndex];e.whenSelectOrButtonChange(r)}}};var i=this;for(var r=0,n=this.pieceOfCode.COMMAND_DICO.allKeys();r<n.length;r++){var a=n[r];t(a)}this.setAllSelectsAccordingToPieceOfCode()};t.prototype.whenSelectOrButtonChange=function(e){if(this.indexPage!=null&&this.pushState){this.indexPage.navigator.pushState({type:"part",name:this.pieceOfCode.NAME,configuration:l(this.pieceOfCode)})}if(e.options.onchange!=null)e.options.onchange();else this.pieceOfCode.go();if(this.onConfigChange!=null)this.onConfigChange()};return t}();t.Binder=o;var h=function(){function e(){var e=this;this.visualValues=[];this.selectedIndex=0;this.$visual=$('<div class="clickable appliButton" "></div>');this.$visual.on("click touch",function(){e.onclick()})}e.prototype.increment=function(){this.selectedIndex=(this.selectedIndex+1)%this.visualValues.length};e.prototype.updateVisual=function(){this.$visual.empty().append(this.visualValues[this.selectedIndex])};return e}();t.$Button=h;function l(e){var t={};for(var i in e){if(i.slice(0,3)==r.$$$){var s=i.slice(3);if(s!="name"&&s!="title"&&s!="creator"&&s!="keyWords"){t[s]=e[s]}}}return t}t.pieceOfCodeToConfiguration=l;function u(e){var t=[];for(var i in e){if(i.slice(0,3)==r.$$$){var s=i.slice(3);if(s!="name"&&s!="title"&&s!="creator"&&s!="keyWords"){t.push(s)}}}return t.sort()}t.pieceOfCodeToSrotedConfigurationAttributes=u})(t=e.appli||(e.appli={}))})(mathis||(mathis={}));var mathis;(function(e){e.myFavoriteColors={green:new BABYLON.Color3(124/255,252/255,0)};var t=function(){function e(e,t){this.u=e;this.v=t}return e}();e.UV=t;var i=function(){function e(){this.m11=0;this.m12=0;this.m21=0;this.m22=0}e.prototype.determinant=function(){return this.m11*this.m22-this.m21*this.m12};e.prototype.inverse=function(){var t=new e;var i=this.determinant();t.m11=this.m22/i;t.m22=this.m11/i;t.m12=-this.m12/i;t.m21=-this.m21/i;return t};e.prototype.multiplyUV=function(e){return new t(this.m11*e.u+this.m12*e.v,this.m21*e.u+this.m22*e.v)};return e}();e.M22=i;var r=function(t){__extends(i,t);function i(e,i,r){t.call(this,e,i,r)}i.resetDefaultNbDecimalForHash=function(){i.nbDecimalForHash=5};Object.defineProperty(i.prototype,"hashString",{get:function(){return e.roundWithGivenPrecision(this.x,i.nbDecimalForHash)+","+e.roundWithGivenPrecision(this.y,i.nbDecimalForHash)+","+e.roundWithGivenPrecision(this.z,i.nbDecimalForHash)},enumerable:true,configurable:true});i.newZero=function(){return new i(0,0,0)};i.newFrom=function(e){if(e==null)return null;return new i(e.x,e.y,e.z)};i.newOnes=function(){return new i(1,1,1)};i.newRandom=function(){return new i(Math.random(),Math.random(),Math.random())};i.temp0=function(e,t,i){s.copyFromFloats(e,t,i);return s};i.temp1=function(e,t,i){n.copyFromFloats(e,t,i);return n};i.prototype.add=function(t){e.geo.add(this,t,this);return this};i.prototype.resizes=function(e){this.x*=e.x;this.y*=e.y;this.z*=e.z;return this};i.prototype.multiply=function(e){this.x*=e.x;this.y*=e.y;this.z*=e.z;return this};i.prototype.substract=function(t){e.geo.substract(this,t,this);return this};i.prototype.scale=function(t){e.geo.scale(this,t,this);return this};i.prototype.copyFrom=function(e){this.x=e.x;this.y=e.y;this.z=e.z;return this};i.prototype.copyFromFloats=function(e,t,i){this.x=e;this.y=t;this.z=i;return this};i.prototype.changeBy=function(e,t,i){this.x=e;this.y=t;this.z=i;return this};i.prototype.normalize=function(){var t=e.geo.norme(this);if(t<e.geo.epsilon)throw"be careful, you have normalized a very small vector";return this.scale(1/t)};i.prototype.almostEqual=function(t){return e.geo.xyzAlmostEquality(this,t)};i.prototype.toString=function(e){if(e===void 0){e=2}return"("+this.x.toFixed(e)+","+this.y.toFixed(e)+","+this.z.toFixed(e)+")"};i.lexicalOrder=function(e,t){if(e.x!=t.x)return e.x-t.x;else if(e.y!=t.y)return e.y-t.y;else if(e.z!=t.z)return e.z-t.z;else return 0};i.lexicalOrderInverse=function(e,t){return-i.lexicalOrder(e,t)};i.nbDecimalForHash=5;return i}(BABYLON.Vector3);e.XYZ=r;var s=new r(0,0,0);var n=new r(0,0,0);var a=function(t){__extends(i,t);function i(e,i,r,s){t.call(this,e,i,r,s)}i.prototype.multiply=function(t){e.geo.quaternionMultiplication(t,this,this);return this};return i}(BABYLON.Quaternion);e.XYZW=a;var o=function(){function e(){}e.segment=function(e,t){return f.segmentId(e.hashNumber,t.hashNumber)};e.segmentOrd=function(e,t){if(e.hashNumber>t.hashNumber)i=[t,e],e=i[0],t=i[1];return[e,t];var i};e.quad=function(t,i,r,s){n=e.quadOrd(t,i,r,s),t=n[0],i=n[1],r=n[2],s=n[3];return t.hashNumber+","+i.hashNumber+","+r.hashNumber+","+s.hashNumber;var n};e.quadOrd=function(e,t,i,r){while(e.hashNumber>t.hashNumber||e.hashNumber>i.hashNumber||e.hashNumber>r.hashNumber)s=[t,i,r,e],e=s[0],t=s[1],i=s[2],r=s[3];if(t.hashNumber<r.hashNumber)n=[r,t],t=n[0],r=n[1];return[e,t,i,r];var s,n};return e}();e.Hash=o;var h=function(){function t(){this.position=new r(0,0,0);this.frontDir=new r(1,0,0);this.upVector=new r(0,1,0);this.scaling=new r(1,1,1);this.defaultUpDirIfTooSmall=new r(1,1,0);this.defaultFrontDirIfTooSmall=new r(0,0,1)}t.prototype.copyFrom=function(e){this.position=r.newFrom(e.position);this.upVector=r.newFrom(e.upVector);this.frontDir=r.newFrom(e.frontDir);this.scaling=r.newFrom(e.scaling)};t.prototype.changeFrontDir=function(t){e.geo.orthonormalizeKeepingFirstDirection(t,this.upVector,this.frontDir,this.upVector)};t.prototype.changeUpVector=function(t){e.geo.orthonormalizeKeepingFirstDirection(this.upVector,t,this.upVector,this.frontDir)};t.prototype.setOrientation=function(t,i){this.upVector=new r(0,0,0);this.frontDir=new r(0,0,0);e.geo.orthonormalizeKeepingFirstDirection(t,i,this.frontDir,this.upVector)};t.prototype.quaternion=function(t){if(t===void 0){t=true}if(this.frontDir==null&&this.upVector==null)throw"you must precise a frontDir or a upVector or both of them";else if(this.frontDir==null){this.frontDir=new r(0,0,0);e.geo.getOneOrthonormal(this.upVector,this.frontDir)}else if(this.upVector==null){this.upVector=new r(0,0,0);e.geo.getOneOrthonormal(this.frontDir,this.upVector)}if(this.frontDir.length()<e.geo.epsilon){this.frontDir=this.defaultFrontDirIfTooSmall;e.logger.c("a tangent was too small, and so replaced by a default one")}if(this.upVector.length()<e.geo.epsilon){this.upVector=this.defaultUpDirIfTooSmall;e.logger.c("a normal was too small, and so replaced by a default one")}var i=new a(0,0,0,1);e.geo.twoVectorsToQuaternion(this.frontDir,this.upVector,!t,i);return i};t.prototype.applyToMeshes=function(e){var t=null;if(this.frontDir!=null||this.upVector!=null)t=this.quaternion();for(var i=0,r=e;i<r.length;i++){var s=r[i];if(this.scaling!=null)s.scaling=this.scaling;if(t!=null)s.rotationQuaternion=t;if(this.position!=null)s.position=this.position}};t.prototype.applyToVertices=function(t){var i=this.quaternion();var r=new l;e.geo.quaternionToMatrix(i,r);for(var s=0,n=t;s<n.length;s++){var a=n[s];a.position.multiply(this.scaling);e.geo.multiplicationMatrixVector(r,a.position,a.position);a.position.add(this.position)}};return t}();e.Positioning=h;var l=function(t){__extends(i,t);function i(){t.call(this)}i.newIdentity=function(){var e=new i;e.m[0]=1;e.m[5]=1;e.m[10]=1;e.m[15]=1;return e};i.newFrom=function(e){var t=new i;for(var r=0;r<16;r++)t.m[r]=e.m[r];return t};i.newRandomMat=function(){var e=new i;for(var t=0;t<16;t++)e.m[t]=Math.random();return e};i.newZero=function(){return new i};i.prototype.equal=function(t){return e.geo.matEquality(this,t)};i.prototype.almostEqual=function(t){return e.geo.matAlmostEquality(this,t)};i.prototype.leftMultiply=function(t){e.geo.multiplyMatMat(t,this,this);return this};i.prototype.rightMultiply=function(t){e.geo.multiplyMatMat(this,t,this);return this};i.prototype.inverse=function(){e.geo.inverse(this,this);return this};i.prototype.copyFrom=function(t){e.geo.copyMat(t,this);return this};i.prototype.transpose=function(){e.geo.transpose(this,this);return this};i.prototype.toString=function(){return"\n"+this.m[0]+this.m[1]+this.m[2]+this.m[3]+"\n"+this.m[4]+this.m[5]+this.m[6]+this.m[7]+"\n"+this.m[8]+this.m[9]+this.m[10]+this.m[11]+"\n"+this.m[12]+this.m[13]+this.m[14]+this.m[15]+"\n"};return i}(BABYLON.Matrix);e.MM=l;var u=function(){function e(e){this.customerOb=null;if(e==null)throw"a links is construct with a null vertex";this.to=e}return e}();e.Link=u;var c=function(){function t(){this.links=[];this.isInvisible=false;this.dichoLevel=0;this.markers=[];this.customerObject={};this._hashCode=t.hashCount++}Object.defineProperty(t.prototype,"hashNumber",{get:function(){return this._hashCode},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"hashString",{get:function(){return this._hashCode+""},enumerable:true,configurable:true});t.prototype.setPosition=function(e,t,i,s){if(s===void 0){s=true}this.position=new r(e,t,i);if(s)this.param=new r(e,t,i);return this};t.prototype.hasMark=function(e){return this.markers.indexOf(e)!=-1};t.prototype.getOpposites=function(e){var t=this.findLink(e);if(t==null)throw"the vertex is not a neighbor. Probably your neighborhood relation is not symetric. "+"Please, perform the graph analysis, with the help of the function linkModule.checkTheRegularityOfAGRaph";if(t.opposites==null)return null;var i=[];for(var r=0,s=t.opposites;r<s.length;r++){var n=s[r];i.push(n.to)}return i};t.prototype.hasBifurcations=function(){for(var e=0,t=this.links;e<t.length;e++){var i=t[e];if(i.opposites!=null&&i.opposites.length>1)return true}return false};t.prototype.hasVoisin=function(e){for(var t=0,i=this.links;t<i.length;t++){var r=i[t];if(r.to==e)return true}return false};t.prototype.isBorder=function(){return this.hasMark(t.Markers.border)};t.prototype.findLink=function(e){for(var t=0,i=this.links;t<i.length;t++){var r=i[t];if(r.to==e)return r}return null};t.prototype.setTwoOppositeLinks=function(e,t){var i=this.findLink(e);var r=this.findLink(t);if(i==null){i=new u(e);this.links.push(i)}if(r==null){r=new u(t);this.links.push(r)}if(i.opposites==null)i.opposites=[];if(r.opposites==null)r.opposites=[];i.opposites.push(r);r.opposites.push(i);return this};t.prototype.setOneLink=function(e){if(e==this)throw"it is forbidden to link to itself";this.suppressOneLink(e);this.links.push(new u(e));return this};t.separateTwoVoisins=function(e,t){e.suppressOneLink(t);t.suppressOneLink(e)};t.prototype.suppressOneLink=function(t){var i=this.findLink(t);if(i==null)return;e.tab.removeFromArray(this.links,i);if(i.opposites!=null){for(var r=0,s=i.opposites;r<s.length;r++){var n=s[r];if(n.opposites.length>=2)e.tab.removeFromArray(n.opposites,i);else n.opposites=null}}};t.prototype.changeToLinkWithoutOpposite=function(t){var i=this.findLink(t);if(i==null)return;if(i.opposites!=null){for(var r=0,s=i.opposites;r<s.length;r++){var n=s[r];if(n.opposites.length>=2)e.tab.removeFromArray(n.opposites,i);else n.opposites=null}}i.opposites=null};t.prototype.toString=function(e){var t=this.hashNumber-e+"";return t};t.prototype.toStringComplete=function(e){var i=this.hashNumber-e+"|links:";for(var r=0,s=this.links;r<s.length;r++){var n=s[r];var a="";if(n.opposites!=null){a+=",";for(var o=0,h=n.opposites;o<h.length;o++){var l=h[o];a+=l.to.hashNumber-e+","}}i+="("+(n.to.hashNumber-e)+a+")"}if(this.position!=null)i+="|pos:"+this.position.toString(1)+",";i+="|mark:";for(var u=0,c=this.markers;u<c.length;u++){var m=c[u];i+=t.Markers[m]+","}return i};t.hashCount=0;return t}();e.Vertex=c;var c;(function(e){(function(e){e[e["honeyComb"]=0]="honeyComb";e[e["corner"]=1]="corner";e[e["center"]=2]="center";e[e["border"]=3]="border";e[e["polygonCenter"]=4]="polygonCenter";e[e["selectedForLineDrawing"]=5]="selectedForLineDrawing"})(e.Markers||(e.Markers={}));var t=e.Markers})(c=e.Vertex||(e.Vertex={}));var m=function(){function t(){this.vertices=[];this.smallestTriangles=[];this.smallestSquares=[];this.hexahedrons=[];this.cutSegmentsDico={}}Object.defineProperty(t.prototype,"polygons",{get:function(){var e=[];for(var t=0;t<this.smallestSquares.length;t+=4)e.push([this.smallestSquares[t],this.smallestSquares[t+1],this.smallestSquares[t+2],this.smallestSquares[t+3]]);for(var t=0;t<this.smallestTriangles.length;t+=3)e.push([this.smallestTriangles[t],this.smallestTriangles[t+1],this.smallestTriangles[t+2]]);return e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"linesWasMade",{get:function(){return this.lines!=null},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"segments",{get:function(){var e=[];for(var t=0,i=this.vertices;t<i.length;t++){var r=i[t];for(var s=0,n=r.links;s<n.length;s++){var a=n[s];if(r.hashNumber<a.to.hashNumber)e.push([r,a.to])}}return e},enumerable:true,configurable:true});t.prototype.addATriangle=function(e,t,i){this.smallestTriangles.push(e,t,i);return this};t.prototype.addASquare=function(e,t,i,r){this.smallestSquares.push(e,t,i,r);return this};t.prototype.addHexahedron=function(e){this.hexahedrons.concat(e);return this};t.prototype.getVertex=function(e){var t=this.findVertexFromParam(e);if(t==null)t=this.newVertex(e);return t};t.prototype.newVertex=function(e,t,i){if(t===void 0){t=0}var r=new c;r.position=e;r.param=i?i:e;r.dichoLevel=t;this.addVertex(r);return r};t.prototype.findVertexFromParam=function(e){for(var t=0,i=this.vertices;t<i.length;t++){var r=i[t];if(r.param.hashString==e.hashString)return r}return null};t.prototype.addVertex=function(e){this.vertices.push(e)};t.prototype.hasVertex=function(e){for(var t=0,i=this.vertices;t<i.length;t++){var r=i[t];if(r.hashNumber==e.hashNumber)return true}return false};t.prototype.getStraightLines=function(){var e=[];for(var t=0,i=this.lines;t<i.length;t++){var r=i[t];if(!r.isLoop)e.push(r)}return e};t.prototype.getLoopLines=function(){var e=[];for(var t=0,i=this.lines;t<i.length;t++){var r=i[t];if(r.isLoop)e.push(r)}return e};t.prototype.getStraightLinesAsVertices=function(){var e=[];for(var t=0,i=this.lines;t<i.length;t++){var r=i[t];if(!r.isLoop)e.push(r.vertices)}return e};t.prototype.getLoopLinesAsVertices=function(){var e=[];for(var t=0,i=this.lines;t<i.length;t++){var r=i[t];if(r.isLoop)e.push(r.vertices)}return e};t.prototype.toString=function(e){if(e===void 0){e=true}var t=0;if(e){t=Number.MAX_VALUE;for(var i=0,r=this.vertices;i<r.length;i++){var s=r[i];if(s.hashNumber<t)t=s.hashNumber}}var n="\n";if(this.name!=null)n+=this.name+"\n";for(var a=0,o=this.vertices;a<o.length;a++){var s=o[a];n+=s.toStringComplete(t)+"\n"}n+="tri:";for(var h=0;h<this.smallestTriangles.length;h+=3){n+="["+(this.smallestTriangles[h].hashNumber-t)+","+(this.smallestTriangles[h+1].hashNumber-t)+","+(this.smallestTriangles[h+2].hashNumber-t)+"]"}n+="\nsqua:";for(var h=0;h<this.smallestSquares.length;h+=4){n+="["+(this.smallestSquares[h].hashNumber-t)+","+(this.smallestSquares[h+1].hashNumber-t)+","+(this.smallestSquares[h+2].hashNumber-t)+","+(this.smallestSquares[h+3].hashNumber-t)+"]"}if(this.linesWasMade){n+="\nstrai:";for(var l=0,u=this.getStraightLines();l<u.length;l++){var c=u[l];n+="[";for(var m=0,p=c.vertices;m<p.length;m++){var f=p[m];n+=f.hashNumber-t+","}n+="]"}n+="\nloop:";for(var d=0,v=this.getLoopLines();d<v.length;d++){var c=v[d];n+="[";for(var g=0,y=c.vertices;g<y.length;g++){var f=y[g];n+=f.hashNumber-t+","}n+="]"}}n+="\ncutSegments";for(var b in this.cutSegmentsDico){var w=this.cutSegmentsDico[b];n+="{"+(w.a.hashNumber-t)+","+(w.middle.hashNumber-t)+","+(w.b.hashNumber-t)+"}"}return n};t.prototype.fillLineCatalogue=function(t){if(t===void 0){t=this.vertices}this.lines=e.lineModule.makeLineCatalogue2(t,true)};t.prototype.addSimpleLinksAroundPolygons=function(){new e.linkModule.SimpleLinkFromPolygonCreator(this).goChanging()};t.prototype.addOppositeLinksAroundPolygons=function(){new e.linkModule.SimpleLinkFromPolygonCreator(this).goChanging();new e.linkModule.OppositeLinkAssocierByAngles(this.vertices).goChanging()};t.prototype.isolateMameshVerticesFromExteriorVertices=function(){var e=[];for(var t=0,i=this.vertices;t<i.length;t++){var r=i[t];for(var s=0,n=r.links;s<n.length;s++){var a=n[s];if(!this.hasVertex(a.to))e.push({vertex:r,link:a})}}for(var o=0,h=e;o<h.length;o++){var l=h[o];c.separateTwoVoisins(l.link.to,l.vertex)}};t.prototype.getOrCreateSegment=function(e,t,i){var r=this.cutSegmentsDico[f.segmentId(e.hashNumber,t.hashNumber)];if(r==null){r=new f(e,t);this.cutSegmentsDico[f.segmentId(e.hashNumber,t.hashNumber)]=r}i[f.segmentId(e.hashNumber,t.hashNumber)]=r};t.prototype.maxLinkLength=function(){var t=-1;this.vertices.forEach(function(i){i.links.forEach(function(r){var s=e.geo.distance(i.position,r.to.position);if(s>t)t=s})});if(t==-1)throw"your IN_mamesh seems empty";return t};t.prototype.clearLinksAndLines=function(){this.vertices.forEach(function(t){e.tab.clearArray(t.links)});this.lines=null};t.prototype.clearOppositeInLinks=function(){this.vertices.forEach(function(e){e.links.forEach(function(e){e.opposites=null})})};t.prototype.allLinesAsASortedString=function(t){if(t===void 0){t=true}var i="";var r;var s;if(t){s=Number.MAX_VALUE;for(var n=0,a=this.vertices;n<a.length;n++){var o=a[n];if(o.hashNumber<s)s=o.hashNumber}}if(this.linesWasMade){var h=this.getStraightLines();var l=this.getLoopLines();if(this.linesWasMade&&h.length>0){r=[];h.forEach(function(e){var t=e.vertices;var i=[];t.forEach(function(e){i.push(e.hashNumber-s)});r.push(JSON.stringify(i))});r.sort();i="straightLines:"+JSON.stringify(r)}if(l.length>0){r=[];l.forEach(function(t){var i=t.vertices;var n=[];i.forEach(function(e){n.push(e.hashNumber-s)});var a=e.tab.minIndexOfNumericList(n);var o=[];for(var h=0;h<n.length;h++){o[h]=n[(h+a)%n.length]}r.push(JSON.stringify(o))});r.sort();i+="|loopLines:"+JSON.stringify(r)}}return i};t.prototype.allSquareAndTrianglesAsSortedString=function(e){if(e===void 0){e=true}var t=0;if(e){t=Number.MAX_VALUE;for(var i=0,r=this.vertices;i<r.length;i++){var s=r[i];if(s.hashNumber<t)t=s.hashNumber}}var n="square:"+this.allSquaresOrTrianglesAsASortedString(this.smallestSquares,4,t);var a="triangle:"+this.allSquaresOrTrianglesAsASortedString(this.smallestTriangles,3,t);return n+a};t.prototype.allSquaresOrTrianglesAsASortedString=function(t,i,r){var s="";var n;var a=[];for(var o=0;o<t.length;o+=i){var h=[];for(var l=0;l<i;l++)h.push(t[o+l]);a.push(h)}n=[];a.forEach(function(t){var i=[];t.forEach(function(e){i.push(e.hashNumber-r)});var s=e.tab.minIndexOfNumericList(i);var a=[];for(var o=0;o<i.length;o++){a[o]=i[(o+s)%i.length]}n.push(JSON.stringify(a))});n.sort();s+=JSON.stringify(n);return s};return t}();e.Mamesh=m;var p=function(){function t(e,t){this.vertices=e;this.isLoop=t}t.prototype.getVertex=function(e,t){if(t===void 0){t=true}if(this.isLoop&&t)return this.vertices[e%this.vertices.length];else return this.vertices[e]};t.prototype.hashForDirected=function(){var t=[];if(!this.isLoop){for(var i=0,r=this.vertices;i<r.length;i++){var s=r[i];t.push(s.hashNumber)}}else{var n=e.tab.minIndexOb(this.vertices,function(e,t){return e.hashNumber-t.hashNumber});for(var a=0;a<this.vertices.length;a++)t.push(this.vertices[(a+n)%this.vertices.length].hashNumber)}return JSON.stringify(t)};t.prototype.inverted=function(){var e=[];for(var i=0;i<this.vertices.length;i++)e.push(this.vertices[this.vertices.length-1-i]);return new t(e,this.isLoop)};t.prototype.positionList=function(){var e=[];for(var t=0,i=this.vertices;t<i.length;t++){var r=i[t];e.push(r.position)}return e};Object.defineProperty(t.prototype,"hashString",{get:function(){var e=this.hashForDirected();var t=this.inverted().hashForDirected();return e<t?e:t},enumerable:true,configurable:true});t.prototype.positionnalHashForDirected=function(t){if(t===void 0){t=1}var i=[];r.nbDecimalForHash=t;if(!this.isLoop){for(var s=0,n=this.vertices;s<n.length;s++){var a=n[s];i.push(a.position.hashString)}}else{var o=this.positionList();var h=e.tab.minIndexOb(o,r.lexicalOrder);for(var l=0;l<o.length;l++)i.push(o[(l+h)%o.length].hashString)}r.resetDefaultNbDecimalForHash();return JSON.stringify(i)};t.prototype.positionnalHash=function(e){if(e===void 0){e=1}var t=this.positionnalHashForDirected(e);var i=this.inverted().positionnalHashForDirected(e);return t<i?t:i};t.prototype.hashStringUpToSymmetries=function(i,r){var s=[this.positionnalHash()];for(var n=0,a=i;n<a.length;n++){var o=a[n];var h=[];for(var l=0,u=this.vertices;l<u.length;l++){var m=u[l];var p=new c;if(r)p.position=o(m.position);else p.position=o(m.param);h.push(p)}var f=new t(h,this.isLoop);s.push(f.positionnalHash())}return e.tab.minValueString(s)};t.prototype.allSegments=function(){var e=[];var t=this.isLoop?1:0;for(var i=0;i<this.vertices.length-1+t;i++){e.push(new f(this.vertices[i],this.vertices[(i+1)%this.vertices.length]))}return e};return t}();e.Line=p;var f=function(){function e(e,t){this.a=e.hashNumber<t.hashNumber?e:t;this.b=e.hashNumber<t.hashNumber?t:e}e.segmentId=function(e,t){if(e<t)return e+","+t;else return t+","+e};Object.defineProperty(e.prototype,"hashString",{get:function(){return e.segmentId(this.a.hashNumber,this.b.hashNumber)},enumerable:true,configurable:true});e.prototype.equals=function(e){return this.a==e.a&&this.b==e.b};e.prototype.getOther=function(e){if(e==this.a)return this.b;else return this.a};e.prototype.getFirst=function(){return this.a};e.prototype.getSecond=function(){return this.b};e.prototype.has=function(e){return e==this.a||e==this.b};return e}();e.Segment=f})(mathis||(mathis={}));var mathis;(function(e){var t=function(){function e(e){if(typeof e==="number"){var t=this.hex2rgb(this.intToColorName(e));this.rgb=new r(t[0],t[1],t[2])}else if(typeof e==="string"){var t=this.hex2rgb(e);this.rgb=new r(t[0],t[1],t[2])}else if(e instanceof r){this.rgb=e}else if(e instanceof i){this.rgb=e.toRGB()}}e.prototype.hex2rgb=function(e){var t=e.replace("#","");t=t.match(new RegExp("(.{"+t.length/3+"})","g"));for(var i=0;i<t.length;i++)t[i]=parseInt(t[i].length==1?t[i]+t[i]:t[i],16);return t};e.prototype.lighten=function(e){this.rgb=this.rgb.lighten(e);return this};e.prototype.darken=function(e){this.rgb=this.rgb.darken(e);return this};e.prototype.toBABYLON_Color4=function(){return new BABYLON.Color4(this.rgb.r/255,this.rgb.g/255,this.rgb.b/255,this.rgb.alpha)};e.prototype.toBABYLON_Color3=function(){return new BABYLON.Color3(this.rgb.r/255,this.rgb.g/255,this.rgb.b/255)};e.prototype.toString=function(){return this.rgb.toString()};e.prototype.intToColorName=function(t){var i=226-78;var r=0;for(var s in e.names){if(e.names.hasOwnProperty(s)){if(r==t*763%i){return e.names[s]}r++}}};e.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};return e}();e.Color=t;var i=function(){function e(e,t,i,r){if(r===void 0){r=1}this.h=e;this.s=t;this.v=i;this.alpha=r}e.HSV_01_toRGB_01=function(e,t,i){var r,s,n,a,o,h,l,u;a=Math.floor(e*6);o=e*6-a;h=i*(1-t);l=i*(1-o*t);u=i*(1-(1-o)*t);switch(a%6){case 0:r=i;s=u;n=h;break;case 1:r=l;s=i;n=h;break;case 2:r=h;s=i;n=u;break;case 3:r=h;s=l;n=i;break;case 4:r=u;s=h;n=i;break;case 5:r=i;s=h;n=l;break}return{r:r,g:s,b:n}};e.prototype.toRGB=function(){var t=e.HSV_01_toRGB_01(this.h,this.s,this.v);return new r(t.r*255,t.g*255,t.b*255,1)};return e}();e.HSV_01=i;var r=function(){function e(e,t,i,r){if(r===void 0){r=1}this.r=0;this.g=0;this.b=0;this.alpha=1;this.setRed(e).setGreen(t).setBlue(i).setAlpha(r)}e.prototype.getHexPart=function(e){var t=e.toString(16);return t.length>1?t:"0"+t};e.prototype.setRed=function(e){this.r=e>255?255:e<0?0:Math.floor(e);return this};e.prototype.setGreen=function(e){this.g=e>255?255:e<0?0:Math.floor(e);return this};e.prototype.setBlue=function(e){this.b=e>255?255:e<0?0:Math.floor(e);return this};e.prototype.setAlpha=function(e){this.alpha=e<=1&&e>=0?e:1;return this};e.prototype.lighten=function(e){this.setRed(this.r+e).setBlue(this.g+e).setGreen(this.b+e);return this};e.prototype.darken=function(e){this.setRed(this.r-e).setBlue(this.g-e).setGreen(this.b-e);return this};e.prototype.toString=function(){return this.alpha<1?"rgba("+this.r+","+this.g+","+this.b+","+this.alpha+")":"rgb("+this.r+","+this.g+","+this.b+")"};return e}();e.RGB_range255=r;var s;(function(e){var i;(function(e){e.defaultSurfaceColor=new t(new r(255,50,50));e.defaultVertexColor=new t(new r(255,50,50));e.defaultLinkColor=new t(new r(124,252,0))})(i=e.thema||(e.thema={}))})(s=e.color||(e.color={}));function n(e,t,i,r){if(r===void 0){r=true}var s,n,a,o,h,l,u,c;o=Math.floor(e*6);h=e*6-o;l=i*(1-t);u=i*(1-h*t);c=i*(1-(1-h)*t);switch(o%6){case 0:s=i;n=c;a=l;break;case 1:s=u;n=i;a=l;break;case 2:s=l;n=i;a=c;break;case 3:s=l;n=u;a=i;break;case 4:s=c;n=l;a=i;break;case 5:s=i;n=l;a=u;break}if(r){s=Math.floor(s*255);n=Math.floor(n*255);a=Math.floor(a*255);return"rgb("+s+","+n+","+a+")"}else return{r:s,g:n,b:a}}e.HSVtoRGB=n;function a(e,t){if(t===void 0){t=false}var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);var r=t?1:255;return i?{r:parseInt(i[1],16)/r,g:parseInt(i[2],16)/r,b:parseInt(i[3],16)/r}:null}e.hexToRgb=a;function o(e){var t=e.toString(16);return t.length==1?"0"+t:t}function h(e,t,i){return"#"+o(e)+o(t)+o(i)}e.rgbToHex=h})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){(function(e){e[e["triangulatedTriangle"]=0]="triangulatedTriangle";e[e["triangulatedRect"]=1]="triangulatedRect";e[e["square"]=2]="square";e[e["polygon3"]=3]="polygon3";e[e["polygon4"]=4]="polygon4";e[e["polygon5"]=5]="polygon5";e[e["polygon6"]=6]="polygon6";e[e["polygon7"]=7]="polygon7";e[e["polygon8"]=8]="polygon8";e[e["polygon9"]=9]="polygon9";e[e["polygon10"]=10]="polygon10";e[e["polygon11"]=11]="polygon11";e[e["polygon12"]=12]="polygon12"})(t.PartShape||(t.PartShape={}));var i=t.PartShape;var r=function(){function t(t,r){this.SUB_gratAndStick=new e.grateAndGlue.ConcurrentMameshesGraterAndSticker;this.SUB_oppositeLinkAssocierByAngles=new e.linkModule.OppositeLinkAssocierByAngles(null);this.SUB_mameshCleaner=new e.mameshModification.MameshCleaner(null);this.origine=new e.XYZ(0,0,0);this.end=new e.XYZ(1,1,0);this.rotation=.001;this.shapes=[i.square];this.proportions=[new e.UV(1,1),new e.UV(1,1)];this.individualScales=[new e.UV(1,1)];this.individualRotations=[0];this.individualTranslation=[new e.XYZ(0,0,0),new e.XYZ(0,0,0)];this.nbPatches=2;this.toleranceToBeOneOfTheClosest=.55;this.stratesToSuppressFromCorners=[0];this.scalingBeforeOppositeLinkAssociations=null;this.exponentOfRoundingFunction=[1];this.percolationProba=[0];this.forceToGrate=[.1];this.nbI=t;this.nbJ=r}t.prototype.go=function(){var t=[];var r=function(r){var n=r%s.shapes.length;var a=s.shapes[n];var o=i[a];var h=Math.round(s.nbI*s.proportions[r%s.proportions.length].u);var l=Math.round(s.nbJ*s.proportions[r%s.proportions.length].v);var u=.5*s.individualScales[r%s.individualScales.length].u*s.proportions[r%s.proportions.length].u;var c=.5*s.individualScales[r%s.individualScales.length].v*s.proportions[r%s.proportions.length].v;var m=void 0;if(o.indexOf("polygon")!=-1){var p=parseInt(o.slice(7,o.length));var f=new e.reseau.TriangulatedPolygone(p);f.origin=new e.XYZ(-u,-c,0);f.end=new e.XYZ(u,c,0);f.nbSubdivisionInARadius=Math.floor((h+l)/4);m=f.go()}else if(a==i.square||a==i.triangulatedRect){var d=new e.reseau.BasisForRegularReseau;d.origin=new e.XYZ(-u,-c,0);d.end=new e.XYZ(u,c,0);d.nbI=h;d.nbJ=l;if(a==i.triangulatedRect)d.squareMailleInsteadOfTriangle=false;d.go();var v=new e.reseau.Regular(d);if(a==i.triangulatedRect)v.oneMoreVertexForOddLine=true;m=v.go()}else if(a==i.triangulatedTriangle){var g=new e.reseau.TriangulatedTriangle;g.origin=new e.XYZ(-u,-c,0);g.end=new e.XYZ(u,c,0);g.nbSubdivisionInSide=(h+l)/2;m=g.go()}if(s.propBeginToRound||s.propEndToRound||s.integerBeginToRound||s.integerEndToRound){var y=new e.spacialTransformations.RoundSomeStrates(m);if(s.propBeginToRound==null)y.propBeginToRound=0;else y.propBeginToRound=s.propBeginToRound[r%s.propBeginToRound.length];if(s.propEndToRound==null)y.propEndToRound=1;else y.propEndToRound=s.propEndToRound[r%s.propEndToRound.length];if(s.integerBeginToRound!=null)y.integerBeginToRound=s.integerBeginToRound[r%s.integerBeginToRound.length];if(s.integerEndToRound!=null)y.integerEndToRound=s.integerEndToRound[r%s.integerEndToRound.length];y.exponentOfRoundingFunction=s.exponentOfRoundingFunction[r%s.exponentOfRoundingFunction.length];y.referenceRadiusIsMinVersusMaxVersusMean=2;y.preventStratesCrossings=true;y.goChanging()}var b=s.percolationProba[r*s.percolationProba.length];if(b>0){var w=new e.mameshModification.PercolationOnLinks(m);w.percolationProba=b;w.goChanging()}if(s.stratesToSuppressFromCorners[r%s.stratesToSuppressFromCorners.length]>0){var M=new e.grateAndGlue.ExtractCentralPart(m,s.stratesToSuppressFromCorners[r%s.stratesToSuppressFromCorners.length]);M.suppressFromBorderVersusCorner=false;m=M.go();m.isolateMameshVerticesFromExteriorVertices()}t.push(m);var x=s.individualTranslation[r%s.individualTranslation.length];var C=s.individualRotations[r%s.individualRotations.length];var T=new e.MM;e.geo.axisAngleToMatrix(new e.XYZ(0,0,-1),C,T);m.vertices.forEach(function(t){e.geo.multiplicationMatrixVector(T,t.position,t.position);t.position.add(x)})};var s=this;for(var n=0;n<this.nbPatches;n++){r(n)}var a;if(this.nbPatches>1){this.SUB_gratAndStick.IN_mameshes=t;this.SUB_gratAndStick.toleranceToBeOneOfTheClosest=this.toleranceToBeOneOfTheClosest;this.SUB_gratAndStick.SUB_grater.proportionOfSeeds=this.forceToGrate;a=this.SUB_gratAndStick.goChanging()}else{a=t[0];e.spacialTransformations.adjustInASquare(a,new e.XYZ(0,0,0),new e.XYZ(1,1,0));a.clearOppositeInLinks()}if(this.scalingBeforeOppositeLinkAssociations!=null)e.spacialTransformations.adjustInASquare(a,new e.XYZ(0,0,0),new e.XYZ(this.scalingBeforeOppositeLinkAssociations.x,this.scalingBeforeOppositeLinkAssociations.y,0));this.SUB_oppositeLinkAssocierByAngles.vertices=a.vertices;this.SUB_oppositeLinkAssocierByAngles.goChanging();this.SUB_mameshCleaner.IN_mamesh=a;this.SUB_mameshCleaner.goChanging();new e.spacialTransformations.Similitude(a.vertices,this.rotation).goChanging();e.spacialTransformations.adjustInASquare(a,this.origine,this.end);return a};return t}();t.Concentric=r;var s=function(t){__extends(i,t);function i(e,i,r,s){t.call(this,e,i);this.nbPatchesI=2;this.nbPatchesJ=2;this.patchesInQuinconce=false;this.oddPatchLinesAreTheSameVersusLongerVersusShorter=0;this.alternateShapeAccordingIPlusJVersusCounter=true;this.nbPatchesI=r;this.nbPatchesJ=s;this.nbPatches=0;this.individualTranslation=[]}i.prototype.go=function(){this.individualTranslation=[];this.nbPatches=0;var i=[];var r=0;for(var s=0;s<this.nbPatchesJ;s++){var n=0;if(s%2==1){if(this.oddPatchLinesAreTheSameVersusLongerVersusShorter==0)n=0;else if(this.oddPatchLinesAreTheSameVersusLongerVersusShorter==1)n=1;else if(this.oddPatchLinesAreTheSameVersusLongerVersusShorter==2)n=-1;else throw"must be 0 or 1 or 2"}for(var a=0;a<this.nbPatchesI+n;a++){this.nbPatches++;var o=0;if(this.patchesInQuinconce&&s%2==1){if(this.oddPatchLinesAreTheSameVersusLongerVersusShorter==0)o=-.5;if(this.oddPatchLinesAreTheSameVersusLongerVersusShorter==1)o=-.5;if(this.oddPatchLinesAreTheSameVersusLongerVersusShorter==2)o=.5}this.individualTranslation.push(new e.XYZ(a+o,s,0));r++;var h=this.alternateShapeAccordingIPlusJVersusCounter?a+n+s:r;i.push(this.shapes[h%this.shapes.length])}}this.shapes=i;return t.prototype.go.call(this)};return i}(r);t.Patchwork=s})(t=e.creation2D||(e.creation2D={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(t){this.maxLength=500;this.curentLength=0;this.serpentRadius=.03;this.path=[];this.sliceInsteadOfElongateWhenMaxLengthIsReached=true;this.initialPosition=new e.XYZ(0,0,0);this.mathisFrame=t}t.prototype.go=function(){for(var t=0;t<this.maxLength;t++)this.path.push(this.initialPosition);this.serpentMesh=BABYLON.Mesh.CreateTube("",this.path,this.serpentRadius,10,null,BABYLON.Mesh.CAP_ALL,this.mathisFrame.scene,true);var i=new BABYLON.StandardMaterial("",this.mathisFrame.scene);i.diffuseColor=e.myFavoriteColors.green;this.serpentMesh.material=i;this.headSerpent=BABYLON.Mesh.CreateSphere("",10,this.serpentRadius*2.5,this.mathisFrame.scene);var r=new BABYLON.StandardMaterial("",this.mathisFrame.scene);r.diffuseColor=new BABYLON.Color3(1,0,0);this.headSerpent.material=r;this.headSerpent.position.copyFrom(this.initialPosition)};t.prototype.contractInOnePoint=function(e){for(var t=0;t<this.maxLength;t++)this.path[t]=e;this.curentLength=0;this.updateMeshes()};t.prototype.elongateTo=function(e){if(this.curentLength<this.maxLength){for(var t=this.curentLength;t<this.maxLength;t++)this.path[t]=e;this.curentLength++;this.updateMeshes()}else if(this.sliceInsteadOfElongateWhenMaxLengthIsReached)this.bobySliceTo(e);else throw"snake reaches his maximal length"};t.prototype.bobySliceTo=function(e){this.path.splice(0,1);this.path.push(e);this.updateMeshes()};t.prototype.updateMeshes=function(){this.serpentMesh=BABYLON.Mesh.CreateTube("",this.path,this.serpentRadius,null,null,null,null,true,null,this.serpentMesh);this.headSerpent.position=this.getHeadPosition()};t.prototype.getHeadPosition=function(){return this.path[this.path.length-1]};return t}();t.Snake=i;var r=function(){function t(e){this.totalHeight=1;this.bodyProp=3/4;this.headProp=1/4;this.bodyDiameterProp=.1;this.headDiameterProp=.2;this.headUp=true;this.arrowFootAtOrigin=true;this.quaternion=null;this.subdivision=6;this.scene=e}t.prototype.go=function(){var t=this.bodyProp*this.totalHeight;var i=this.headProp*this.totalHeight;var r=BABYLON.Mesh.CreateCylinder("",t,this.bodyDiameterProp*this.totalHeight,this.bodyDiameterProp*this.totalHeight,this.subdivision,null,this.scene);r.position=new e.XYZ(0,t/2,0);var s=BABYLON.Mesh.CreateCylinder("",i,0,this.headDiameterProp*this.totalHeight,this.subdivision,null,this.scene);s.position=new e.XYZ(0,t+i/2,0);var n=BABYLON.Mesh.MergeMeshes([r,s]);if(!this.arrowFootAtOrigin){n.position.addInPlace(new e.XYZ(0,-this.totalHeight/2,0));n.bakeCurrentTransformIntoVertices()}var a=new e.XYZW(0,0,0,1);if(!this.headUp)e.geo.axisAngleToQuaternion(new e.XYZ(1,0,0),Math.PI,a);if(this.quaternion!=null)a.multiply(this.quaternion);n.rotationQuaternion=a;n.bakeCurrentTransformIntoVertices();if(this.color!=null){var o=new BABYLON.StandardMaterial("",this.scene);o.diffuseColor=this.color.toBABYLON_Color3();n.material=o}return n};return t}();t.ArrowCreator=r;var s=function(){function e(e){this.scene=e;this.twoOrThreeAxis=new n(this.scene)}e.prototype.go=function(){this.twoOrThreeAxis.addColor=false;var e=this.twoOrThreeAxis.go();var t=BABYLON.Mesh.MergeMeshes(e);var i=e[0].getTotalIndices();var r=e[1].getTotalIndices();var s=e[2].getTotalIndices();var n=new BABYLON.StandardMaterial("",this.scene);n.diffuseColor=new BABYLON.Color3(1,0,0);var a=new BABYLON.StandardMaterial("",this.scene);a.diffuseColor=new BABYLON.Color3(0,1,0);var o=new BABYLON.StandardMaterial("",this.scene);o.diffuseColor=new BABYLON.Color3(0,0,1);var h=t.getTotalVertices();t.subMeshes=[];t.subMeshes.push(new BABYLON.SubMesh(0,0,h,0,i,t));t.subMeshes.push(new BABYLON.SubMesh(1,0,h,i,r,t));t.subMeshes.push(new BABYLON.SubMesh(2,0,h,i+r,s,t));var l=new BABYLON.MultiMaterial("multi",this.scene);l.subMaterials.push(n);l.subMaterials.push(a);l.subMaterials.push(o);t.material=l;return t};return e}();t.TwoOrThreeAxisMerged=s;var n=function(){function i(e){this.isLeftHandSided=true;this.addColor=true;this.threeVersusTwoAxis=true;this.addLabelsXYZ=false;this.scene=e;this.SUB_x_axisCreator=new r(this.scene);this.SUB_y_axisCreator=new r(this.scene);this.SUB_z_axisCreator=new r(this.scene)}i.prototype.go=function(){if(this.addColor){this.SUB_x_axisCreator.color=new e.Color(e.Color.names.red);this.SUB_y_axisCreator.color=new e.Color(e.Color.names.green);this.SUB_z_axisCreator.color=new e.Color(e.Color.names.blue)}var i=[];if(this.addLabelsXYZ){var r=new t.FlagWithText(this.scene);r.text="x";var s=r.go();s.position=new e.XYZ(1.1,0,0);i.push(s);var n=new t.FlagWithText(this.scene);n.text="y";var a=n.go();a.position=new e.XYZ(0,1.15,0);i.push(a);var o=new t.FlagWithText(this.scene);o.text="z";var h=o.go();h.position=new e.XYZ(0,.1,1);i.push(h)}var l=this.SUB_y_axisCreator.go();l.bakeCurrentTransformIntoVertices();var u=this.SUB_x_axisCreator.go();e.geo.axisAngleToQuaternion(new e.XYZ(0,0,1),-Math.PI/2,u.rotationQuaternion);u.bakeCurrentTransformIntoVertices();if(this.threeVersusTwoAxis){var c=this.SUB_z_axisCreator.go();var m=this.isLeftHandSided?Math.PI/2:-Math.PI/2;e.geo.axisAngleToQuaternion(new e.XYZ(1,0,0),m,c.rotationQuaternion);c.bakeCurrentTransformIntoVertices();return[u,l,c].concat(i)}else return[u,l].concat(i)};return i}();t.TwoOrTreeAxis=n;var a=function(){function e(e){this.text="TOTO";this.font="bold 140px verdana";this.color="black";this.backgroundColor="transparent";this.scene=e}e.prototype.go=function(){var e=new BABYLON.DynamicTexture("dynamic texture",512,this.scene,true);e.drawText(this.text,null,300,this.font,this.color,this.backgroundColor);e.hasAlpha=true;var t=BABYLON.Mesh.CreatePlane("textPlane",1,this.scene,false);var i=new BABYLON.StandardMaterial("textPlane",this.scene);i.diffuseTexture=e;i.specularColor=new BABYLON.Color3(0,0,0);i.emissiveColor=new BABYLON.Color3(1,1,1);i.backFaceCulling=false;t.material=i;return t};return e}();t.FlagWithText=a})(t=e.creation3D||(e.creation3D={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){function i(e){var t=[];for(var i=0,r=e;i<r.length;i++){var s=r[i];t.push(s.hashNumber)}return JSON.stringify(t.sort())}t.verticesToString=i;function r(t){var i=[];for(var r=0,s=t;r<s.length;r++){var n=s[r];var a=[];for(var o=0,h=n;o<h.length;o++){var l=h[o];a.push(l.hashNumber)}i.push(e.tab.indicesUpPermutationToString(a))}return JSON.stringify(i.sort())}t.verticesFamilyToString=r;function s(e){var t="";for(var i=0,r=e;i<r.length;i++){var s=r[i];t+=s.toString()}return t}t.objToString=s;function n(e){for(var t=0,i=e;t<i.length;t++){var r=i[t];var s=null;for(var n=0,a=r.links;n<a.length;n++){s=a[n];if(!s.to.hasVoisin(r))throw"neighborhood relation is not reflexive. The vertex:"+r.toString(0)+"\n has a link which gos to:"+s.to.toString(0)+"\n but no link in the other direction. A possible cause: you vertices is only a part of a graph";if(s.opposites!=null){for(var o=0,h=s.opposites;o<h.length;o++){var l=h[o];if(r.links.indexOf(l)==-1)throw"a link attached to a vertex has an opposite link which is not attached of this vertex \n "+"problem takes place at vertex:"+r.toString(0)+"\n link going to:"+s.to.toString(0)+"\n opposite link going to:"+l.to.toString(0);if(l.opposites.indexOf(s)==-1)throw"opposite of  opposite do not give the same link"}}}}}t.checkTheRegularityOfAGraph=n})(t=e.debug||(e.debug={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(t,i){this.originMath=new e.XYZ(0,0,0);this.endMath=new e.XYZ(1,1,0);this.originView=new e.XYZ(-1,-1,0);this.endView=new e.XYZ(1,1,0);this.nbI=20;this.nbJ=20;this.departure=new e.XYZ(0,0,0);this.deltaT=.1;this.vectorsAreArrowsVersusCone=true;this.scaleVectorsAccordingToTheirNorm=false;this.makeLightAndCamera=true;this.generator=new e.reseau.BasisForRegularReseau;this.stochasticVariation=new e.XYZ(0,0,0);this.dW=new e.XYZ(0,0,0);this.scaler=null;this.functionToSortvertex=function(e,t){return e.customerObject.squareLengthOfTangent-t.customerObject.squareLengthOfTangent};this.vectorField=t;this.mathisFrame=i}t.prototype.go=function(){if(this.randomExitation==null)this.randomExitation=function(){return new e.XYZ(Math.random()-.5,Math.random()-.5,Math.random()-.5)};this.generator.nbI=this.nbI;this.generator.nbJ=this.nbJ;this.generator.origin=this.originView;this.generator.end=this.endView;this.makePlanForClick();if(this.makeLightAndCamera)this.lightAndCamera();this.arrowModel=this.createArrowModel();this.scaler=e.geo.affineTransformGenerator(this.originView,this.endView,this.originMath,this.endMath);this.loadVectorFields();this.mameshAndPositioning();if(this.scaleVectorsAccordingToTheirNorm)this.prepareRescaling();this.start()};t.prototype.makePlanForClick=function(){this.planForClick=BABYLON.Mesh.CreatePlane("",1,this.mathisFrame.scene);var t=e.XYZ.newFrom(this.generator.end).substract(this.generator.origin);var i=e.XYZ.newFrom(this.generator.origin).add(this.generator.end).scale(.5);this.planForClick.scaling=new e.XYZ(t.x,t.y,0);this.planForClick.position=new e.XYZ(i.x,i.y,.06);this.planForClick.bakeCurrentTransformIntoVertices();this.planForClick.visibility=0};t.prototype.lightAndCamera=function(){var t=e.XYZ.newFrom(this.generator.end).substract(this.generator.origin);var i=new e.macamera.PlanarGrabber(this.mathisFrame.scene,new e.XYZ(t.x,t.y,.061));i.mesh.visibility=0;var r=new e.macamera.GrabberCamera(this.mathisFrame,i);r.checkCollisions=false;r.useFreeModeWhenCursorOutOfGrabber=false;r.changePosition(new e.XYZ(0,0,-2),false);r.attachControl(this.mathisFrame.canvas);var s=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-1,1,-1),this.mathisFrame.scene);s.diffuse=new BABYLON.Color3(.5,.5,.5);s.specular=new BABYLON.Color3(.7,.7,.7);s.groundColor=new BABYLON.Color3(1,1,1)};t.prototype.computeNewPathPoint=function(e,t,i){this.vectorFieldScaled(t,e,i);i.scale(this.deltaT);if(this.vectorFieldForNoiseScaled!=null){this.vectorFieldForNoiseScaled(t,e,this.stochasticVariation);this.stochasticVariation.multiply(this.randomExitation()).scale(Math.sqrt(this.deltaT));i.add(this.stochasticVariation)}i.add(e)};t.prototype.mameshAndPositioning=function(){var t=new e.reseau.Regular(this.generator);t.squareVersusTriangleMaille=false;this.mamesh=t.go();var i=new e.mameshAroundComputations.PositioningComputerForMameshVertices(this.mamesh);i.computeTangent=false;i.sizesProp=new e.XYZ(.15,.15,.15);this.positionings=i.go();this.vectorReferencesize=this.positionings.getValue(this.mamesh.vertices[0]).scaling.x};t.prototype.createArrowModel=function(){var t;var i=new e.XYZW(0,0,0,0);e.geo.axisAngleToQuaternion(new e.XYZ(0,0,1),-Math.PI/2,i);if(this.vectorsAreArrowsVersusCone){var r=new e.creation3D.ArrowCreator(this.mathisFrame.scene);r.quaternion=i;r.arrowFootAtOrigin=false;r.totalHeight=3;r.bodyDiameterProp=.2;r.headDiameterProp=.4;t=r.go()}else{t=BABYLON.Mesh.CreateCylinder("",2,0,1,6,null,this.mathisFrame.scene);t.rotationQuaternion=i;t.bakeCurrentTransformIntoVertices()}var s=new BABYLON.StandardMaterial("",this.mathisFrame.scene);s.diffuseColor=new BABYLON.Color3(0,0,1);t.material=s;return t};t.prototype.loadVectorFields=function(){var t=this;var i=new e.XYZ(0,0,0);this.vectorFieldScaled=function(e,r,s){t.scaler(r,i);t.vectorField(e,i,s)};if(this.vectorFieldForNoise!=null){var r=new e.XYZ(0,0,0);this.vectorFieldForNoiseScaled=function(e,i,s){t.scaler(i,r);t.vectorFieldForNoise(e,r,s)}}};t.prototype.start=function(){var t=this;var i=new e.creation3D.Snake(this.mathisFrame);i.initialPosition=this.departure;i.serpentRadius=.01;i.go();this.mamesh.vertices.forEach(function(e){t.vectorFieldScaled(0,e.position,t.positionings.getValue(e).frontDir)});var r=new e.visu3d.VerticesViewer(this.mamesh,this.mathisFrame.scene,this.positionings);r.meshModel=this.arrowModel;r.go();var s=0;var n=new e.PeriodicAction(function(){s+=t.deltaT;var n=new e.XYZ(0,0,0);t.computeNewPathPoint(i.getHeadPosition(),s,n);i.elongateTo(n);t.mamesh.vertices.forEach(function(e){var i=t.positionings.getValue(e);t.vectorFieldScaled(s,e.position,i.frontDir)});if(t.scaleVectorsAccordingToTheirNorm)t.rescaleVectors(t.vectorReferencesize);r.updatePositionings()});n.id="main action";n.frameInterval=1;this.mathisFrame.pushPeriodicAction(n);this.planForClick.onClick=function(r){var s=new e.PeriodicAction(function(){i.contractInOnePoint(r)});s.frameInterval=1;s.nbTimesThisActionMustBeFired=1;s.id="click action";s.passageOrderIndex=2;t.mathisFrame.pushPeriodicAction(s)}};t.prototype.prepareRescaling=function(){var e=this;this.verticeSorted=[];this.mamesh.vertices.forEach(function(t){return e.verticeSorted.push(t)})};t.prototype.rescaleVectors=function(e){var t=this;this.mamesh.vertices.forEach(function(e){e.customerObject.squareLengthOfTangent=t.positionings.getValue(e).frontDir.lengthSquared()});this.verticeSorted.sort(this.functionToSortvertex);for(var i=0;i<this.verticeSorted.length;i++)this.verticeSorted[i].customerObject.scaleFromOrder=i/this.verticeSorted.length;this.mamesh.vertices.forEach(function(i){var r=t.positionings.getValue(i);r.scaling.x=2*e*(i.customerObject.scaleFromOrder+1/4);var s=e*Math.max(1,i.customerObject.scaleFromOrder+1/2);r.scaling.y=s;r.scaling.z=s})};return t}();t.TwoDim=i})(t=e.differentialSystem||(e.differentialSystem={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){(function(e){e[e["cube"]=0]="cube";e[e["hexagone"]=1]="hexagone";e[e["doubleHexagone"]=2]="doubleHexagone"})(t.NameOfReseau3D||(t.NameOfReseau3D={}));var i=t.NameOfReseau3D;var r=function(){function t(e){this.nameOfResau3d=i.cube;this.nbVerticalDecays=0;this.nbHorizontalDecays=0;this.fondamentalDomainSize=9;this.nbSubdivision=3;this.nbRepetition=8;this.fogDensity=.05;this.drawFondamentalDomain=false;this.recenterCamera=true;this.notDrawMeshesAtFarCorners=true;this.population=[];this.collisionOnLinks=false;this.collisionOnVertices=false;this.collisionForCamera=false;this.nbSidesOfLinks=4;this.buildLightCameraSkyboxAndFog=true;this.mathisFrame=e}t.prototype.go=function(){if(this.buildLightCameraSkyboxAndFog)this.cameraLight();this.creationOfReseau();var e=new BABYLON.Texture("assets/texture/escher.jpg",this.mathisFrame.scene);this.vertexVisualization(this.mamesh,e);this.linksVisualization(this.mamesh,e);this.addAndMultiplyPopulation();if(this.buildLightCameraSkyboxAndFog){this.seeWorldFromInside();this.fogAndSkybox()}};t.prototype.addAndMultiplyPopulation=function(){var t=this.notDrawMeshesAtFarCorners?this.getTotalSize()*.6:this.getTotalSize();var i=new e.periodicWorld.Multiply(this.fd,t,this.nbRepetition);for(var r=0,s=this.population;r<s.length;r++){var n=s[r];i.addAbstractMesh(n)}};t.prototype.seeWorldFromOutside=function(){var t=this.getTotalSize();this.getCamera().changePosition(new e.XYZ(0,0,-t*2),false);this.getCamera().changeFrontDir(new e.XYZ(0,0,1),false);this.recenterCamera=false;this.getGrabber().mesh.visibility=1;this.getCamera().useOnlyFreeMode=false;this.mathisFrame.scene.fogMode=BABYLON.Scene.FOGMODE_NONE};t.prototype.seeWorldFromInside=function(){this.recenterCamera=true;this.getCamera().changePosition(new e.XYZ(0,0,0),false);this.getCamera().changeFrontDir(new e.XYZ(-.5,-.5,-1),false);this.getGrabber().mesh.visibility=0;this.getCamera().useOnlyFreeMode=true;this.mathisFrame.scene.fogMode=BABYLON.Scene.FOGMODE_EXP2};t.prototype.getCamera=function(){return this.mathisFrame.scene.activeCamera};t.prototype.getGrabber=function(){return this.getCamera().currentGrabber};t.prototype.cameraLight=function(){var t=this;var i=this.getTotalSize()*.6;var r=new e.macamera.SphericalGrabber(this.mathisFrame.scene,new e.XYZ(i,i,i));r.focusOnMyCenterWhenCameraGoDownWard=false;r.mesh.visibility=0;var s=new e.macamera.GrabberCamera(this.mathisFrame,r);s.translationSpeed=this.fondamentalDomainSize*.5;s.checkCollisions=this.collisionForCamera;s.keysFrontward=[66,78];s.keysBackward=[32];s.attachControl(this.mathisFrame.canvas);this.mathisFrame.scene.activeCamera=s;var n=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-1,1,-1),this.mathisFrame.scene);n.diffuse=new BABYLON.Color3(1,1,1);n.specular=new BABYLON.Color3(0,0,0);n.groundColor=new BABYLON.Color3(0,0,.3);var a=new e.XYZ(0,0,0);var o=new e.periodicWorld.Domain(0,0,0);var h=new e.XYZ(0,0,0);this.fd=new e.periodicWorld.CartesianFundamentalDomain(new e.XYZ(this.fondamentalDomainSize,0,0),new e.XYZ(0,this.fondamentalDomainSize,0),new e.XYZ(0,0,this.fondamentalDomainSize));if(this.drawFondamentalDomain){this.fd.drawMe(this.mathisFrame.scene);this.fd.getArretes(this.mathisFrame.scene)}s.onTranslate=function(){if(t.recenterCamera){t.fd.pointToWebCoordinate(s.trueCamPos.position,a);o.whichContains(a);o.getCenter(t.fd,h);s.changePosition(s.whishedCamPos.getPosition().substract(h),false)}}};t.prototype.creationOfReseau=function(){var t=new e.reseau.BasisForRegularReseau;t.end=new e.XYZ(this.fondamentalDomainSize,this.fondamentalDomainSize,0);t.nbI=this.nbSubdivision;t.nbJ=this.nbSubdivision;t.origin=new e.XYZ(0,0,0);t.nbVerticalDecays=this.nbVerticalDecays;t.nbHorizontalDecays=this.nbHorizontalDecays;var r=t.go();var s=new e.reseau.Regular3D;s.nbI=this.nbSubdivision*this.nbRepetition;s.nbJ=this.nbSubdivision*this.nbRepetition;s.nbK=this.nbSubdivision*this.nbRepetition;s.Vi=r.Vi;s.Vj=r.Vj;s.Vk=new e.XYZ(0,0,this.fondamentalDomainSize/(this.nbSubdivision-1));s.makeTriangleOrSquare=false;s.createIKSquaresOrTriangles=false;s.createJKSquares=false;if(this.nameOfResau3d==i.hexagone||this.nameOfResau3d==i.doubleHexagone){s.strateHaveSquareMailleVersusTriangleMaille=false}if(this.nameOfResau3d==i.doubleHexagone){s.interStrateMailleAreSquareVersusTriangle=false;s.decayOddStrates=true}var n=this.getTotalSize();s.origine=new e.XYZ(-n/2,-n/2,-n/2);if(this.notDrawMeshesAtFarCorners)s.putAVertexOnlyAtXYZCheckingThisCondition=function(e){return e.length()<n*.6};this.mamesh=s.go();this.mamesh.fillLineCatalogue()};t.prototype.getTotalSize=function(){return this.nbRepetition*this.fondamentalDomainSize};t.prototype.vertexVisualization=function(t,i){var r=BABYLON.Mesh.CreateBox("",.5,this.mathisFrame.scene);var s=new BABYLON.StandardMaterial("",this.mathisFrame.scene);s.diffuseTexture=i;r.material=s;r.convertToFlatShadedMesh();var n=new e.visu3d.VerticesViewer(t,this.mathisFrame.scene);n.meshModel=r;n.checkCollision=this.collisionOnVertices;var a=new e.Positioning;a.upVector=new e.XYZ(1,0,0);a.frontDir=new e.XYZ(0,1,0);n.positionings=new e.HashMap;for(var o=0,h=t.vertices;o<h.length;o++){var l=h[o];n.positionings.putValue(l,a)}n.go()};t.prototype.linksVisualization=function(t,i){var r;if(this.nbSidesOfLinks==4)r=BABYLON.Mesh.CreateBox("",1,this.mathisFrame.scene);else r=BABYLON.Mesh.CreateCylinder("",1,1,1,this.nbSidesOfLinks,null,this.mathisFrame.scene);var s=new BABYLON.StandardMaterial("",this.mathisFrame.scene);s.diffuseColor=new BABYLON.Color3(.6,.6,.6);s.diffuseTexture=i;r.material=s;r.convertToFlatShadedMesh();var n=new e.visu3d.LinksViewer(t,this.mathisFrame.scene);n.lateralScalingConstant=.2;n.checkCollision=this.collisionOnLinks;n.meshModel=r;var a=new e.XYZ(1,0,0);var o=new e.XYZ(0,1,0);n.pairVertexToLateralDirection=function(t,i){if(Math.abs(e.geo.dot(e.XYZ.newFrom(t.position).substract(i.position),a))<1e-4)return a;else return o};n.go()};t.prototype.fogAndSkybox=function(){var e=BABYLON.Mesh.CreateBox("skyBox",50*this.fondamentalDomainSize,this.mathisFrame.scene);this.mathisFrame.skybox=e;e.visibility=1;var t=new BABYLON.StandardMaterial("skyBox",this.mathisFrame.scene);t.backFaceCulling=false;e.material=t;t.diffuseColor=new BABYLON.Color3(0,0,0);t.specularColor=new BABYLON.Color3(0,0,0);t.reflectionTexture=new BABYLON.CubeTexture("assets/skybox/skybox",this.mathisFrame.scene,["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]);t.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE;this.mathisFrame.scene.fogDensity=this.fogDensity;this.mathisFrame.scene.fogColor=new BABYLON.Color3(1,1,1)};return t}();t.InfiniteCartesian=r})(t=e.infiniteWorlds||(e.infiniteWorlds={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(e){this.q=1.1;this.beta=.5;this.sphereRadius=1;this.frameInterval=5;this.nbActionsPerIteration=100;this.defineLightAndCamera=true;this.nbDicho=4;this.mathisFrame=e}t.prototype.go=function(){if(this.defineLightAndCamera)this.lightAndCam();this.meshAndIsing()};t.prototype.lightAndCam=function(){var t=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-1,1,-1),this.mathisFrame.scene);t.diffuse=new BABYLON.Color3(1,1,1);t.specular=new BABYLON.Color3(1,1,1);t.groundColor=new BABYLON.Color3(.5,.5,.5);var i=new e.XYZ(0,0,0);var r=new e.macamera.SphericalGrabber(this.mathisFrame.scene,new e.XYZ(this.sphereRadius,this.sphereRadius,this.sphereRadius),i);r.mesh.material.alpha=.6;r.showGrabberOnlyWhenGrabbing=false;r.endOfZone1=0;r.endOfZone2=0;var s=new e.macamera.GrabberCamera(this.mathisFrame,r);s.useFreeModeWhenCursorOutOfGrabber=false;s.changePosition(new e.XYZ(0,0,-4*this.sphereRadius),false);s.attachControl(this.mathisFrame.canvas)};t.prototype.meshAndIsing=function(){var t=this;var i=new e.polyhedron.Polyhedron("dodecahedron");var r=i.go();for(var s=0;s<this.nbDicho;s++){var n=new e.mameshModification.TriangleDichotomer(r);n.makeLinks=true;n.go()}r.vertices.forEach(function(e){e.position.normalize().scale(t.sphereRadius)});var a=new e.metropolis.IsingModel(r.vertices);a.beta=this.beta;a.q=this.q;a.nbActionsPerIteration=this.nbActionsPerIteration;a.go();var o=this.sphereModel(new BABYLON.Color3(1,0,0));var h=this.sphereModel(new BABYLON.Color3(0,0,1));var l=new e.mameshAroundComputations.PositioningComputerForMameshVertices(r);l.sizesProp=new e.XYZ(1,1,1);var u=l.go();var c=new e.HashMap;r.vertices.forEach(function(t){var i=new e.Positioning;i.copyFrom(u.getValue(t));i.scaling.copyFromFloats(0,0,0);c.putValue(t,i)});var m=new e.HashMap;r.vertices.forEach(function(t){var i=new e.Positioning;i.copyFrom(u.getValue(t));i.scaling.copyFromFloats(0,0,0);m.putValue(t,i)});var p=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);p.positionings=c;p.meshModel=o;p.go();var f=new e.visu3d.VerticesViewer(r,this.mathisFrame.scene);f.positionings=m;f.meshModel=h;f.go();var d=u.getValue(r.vertices[0]).scaling;var v=new e.PeriodicAction(function(){var e=a.iterateAndGetChangedVertices();e.allKeys().forEach(function(e){if(e.customerObject.value==0){c.getValue(e).scaling.copyFromFloats(0,0,0);m.getValue(e).scaling.copyFromFloats(0,0,0)}else if(e.customerObject.value==1){c.getValue(e).scaling.copyFrom(d);m.getValue(e).scaling.copyFromFloats(0,0,0)}else if(e.customerObject.value==-1){m.getValue(e).scaling.copyFrom(d);c.getValue(e).scaling.copyFromFloats(0,0,0)}});p.updatePositionings();f.updatePositionings()});v.frameInterval=this.frameInterval;this.mathisFrame.pushPeriodicAction(v)};t.prototype.sphereModel=function(t){var i=BABYLON.Mesh.CreateSphere("",6,1,this.mathisFrame.scene);var r=new BABYLON.StandardMaterial("",this.mathisFrame.scene);r.diffuseColor=t;i.material=r;var s=new e.XYZW(0,0,0,0);e.geo.axisAngleToQuaternion(new e.XYZ(1,0,0),Math.PI/2,s);i.rotationQuaternion=s;return i};return t}();t.IsingOnMesh=i})(t=e.mecaStat||(e.mecaStat={}))})(mathis||(mathis={}));var mathis;(function(e){var t=function(){function t(){this.epsilon=1e-8;this.epsilonSquare=this.epsilon*this.epsilon;this.epsitlonForAlmostEquality=1e-6;this._resultTransp=new e.MM;this.baryResult=new e.XYZ(0,0,0);this._scaled=new e.XYZ(0,0,0);this._matUn=new e.MM;this._source=new e.XYZ(0,0,0);this._axis=new e.XYZ(0,0,0);this._ortBasisV1=new e.XYZ(0,0,0);this._ortBasisV2=new e.XYZ(0,0,0);this._ortBasisV3=new e.XYZ(0,0,0);this._ortBasisAll=new e.MM;this._basisOrtho0=new e.XYZ(0,0,0);this._basisOrtho1=new e.XYZ(0,0,0);this._basisOrtho2=new e.XYZ(0,0,0);this._basisMatrix=new e.MM;this._transposedBasisMatrix=new e.MM;this._diagoMatrix=new e.MM;this.matt1=new e.MM;this.matt2=new e.MM;this.oor1=new e.XYZ(0,0,0);this.oor2=new e.XYZ(0,0,0);this.copA=new e.XYZ(0,0,0);this.copB=new e.XYZ(0,0,0);this.copC=new e.XYZ(0,0,0);this.copD=new e.XYZ(0,0,0);this.matBefore=new e.MM;this.v1nor=new e.XYZ(0,0,0);this.v2nor=new e.XYZ(0,0,0);this._aCros=new e.XYZ(0,0,0);this._quat0=new e.XYZW(0,0,0,0);this._quat1=new e.XYZW(0,0,0,0);this._quatAlpha=new e.XYZW(0,0,0,0);this._mat0=new e.MM;this._mat1=new e.MM;this._matAlpha=new e.MM;this._c0=new e.XYZ(0,0,0);this._c1=new e.XYZ(0,0,0);this._crossResult=new e.XYZ(0,0,0);this.v1forSubstraction=new e.XYZ(0,0,0);this.randV2=new e.XYZ(0,0,0);this._result1=new e.XYZ(0,0,0);this._result2=new e.XYZ(0,0,0);this.spheCentToRayOri=new e.XYZ(0,0,0);this._resultInters=new e.XYZ(0,0,0);this.difference=new e.XYZ(0,0,0);this._xAxis=e.XYZ.newZero();this._yAxis=e.XYZ.newZero();this._zAxis=e.XYZ.newZero()}t.prototype.copyXYZ=function(e,t){t.x=e.x;t.y=e.y;t.z=e.z;return t};t.prototype.copyXyzFromFloat=function(e,t,i,r){r.x=e;r.y=t;r.z=i;return r};t.prototype.copyMat=function(e,t){for(var i=0;i<16;i++)t.m[i]=e.m[i];return t};t.prototype.matEquality=function(e,t){for(var i=0;i<16;i++){if(e.m[i]!=t.m[i])return false}return true};t.prototype.matAlmostEquality=function(e,t){for(var i=0;i<16;i++){if(!this.almostEquality(e.m[i],t.m[i]))return false}return true};t.prototype.xyzEquality=function(e,t){return e.x==t.x&&e.y==t.y&&e.z==t.z};t.prototype.xyzAlmostEquality=function(e,t){return Math.abs(e.x-t.x)<this.epsitlonForAlmostEquality&&Math.abs(e.y-t.y)<this.epsitlonForAlmostEquality&&Math.abs(e.z-t.z)<this.epsitlonForAlmostEquality};t.prototype.xyzwAlmostEquality=function(e,t){return Math.abs(e.x-t.x)<this.epsitlonForAlmostEquality&&Math.abs(e.y-t.y)<this.epsitlonForAlmostEquality&&Math.abs(e.z-t.z)<this.epsitlonForAlmostEquality&&Math.abs(e.w-t.w)<this.epsitlonForAlmostEquality};t.prototype.almostLogicalEqual=function(t,i){return e.geo.xyzwAlmostEquality(t,i)||e.geo.almostEquality(t.x,-i.x)&&e.geo.almostEquality(t.y,-i.y)&&e.geo.almostEquality(t.z,-i.z)&&e.geo.almostEquality(t.w,-i.w)};t.prototype.xyzAlmostZero=function(e){return Math.abs(e.x)<this.epsilon&&Math.abs(e.y)<this.epsilon&&Math.abs(e.z)<this.epsilon};t.prototype.almostEquality=function(e,t){return Math.abs(t-e)<this.epsitlonForAlmostEquality};t.prototype.inverse=function(e,t){var i=e.m[0];var r=e.m[1];var s=e.m[2];var n=e.m[3];var a=e.m[4];var o=e.m[5];var h=e.m[6];var l=e.m[7];var u=e.m[8];var c=e.m[9];var m=e.m[10];var p=e.m[11];var f=e.m[12];var d=e.m[13];var v=e.m[14];var g=e.m[15];var y=m*g-p*v;var b=c*g-p*d;var w=c*v-m*d;var M=u*g-p*f;var x=u*v-m*f;var C=u*d-c*f;var T=o*y-h*b+l*w;var V=-(a*y-h*M+l*x);var S=a*b-o*M+l*C;var k=-(a*w-o*x+h*C);var O=1/(i*T+r*V+s*S+n*k);var A=h*g-l*v;var P=o*g-l*d;var _=o*v-h*d;var F=a*g-l*f;var N=a*v-h*f;var B=a*d-o*f;var L=h*p-l*m;var Y=o*p-l*c;var X=o*m-h*c;var I=a*p-l*u;var Z=a*m-h*u;var D=a*c-o*u;t.m[0]=T*O;t.m[4]=V*O;t.m[8]=S*O;t.m[12]=k*O;t.m[1]=-(r*y-s*b+n*w)*O;t.m[5]=(i*y-s*M+n*x)*O;t.m[9]=-(i*b-r*M+n*C)*O;t.m[13]=(i*w-r*x+s*C)*O;t.m[2]=(r*A-s*P+n*_)*O;t.m[6]=-(i*A-s*F+n*N)*O;t.m[10]=(i*P-r*F+n*B)*O;t.m[14]=-(i*_-r*N+s*B)*O;t.m[3]=-(r*L-s*Y+n*X)*O;t.m[7]=(i*L-s*I+n*Z)*O;t.m[11]=-(i*Y-r*I+n*D)*O;t.m[15]=(i*X-r*Z+s*D)*O};t.prototype.transpose=function(t,i){this._resultTransp.m[0]=t.m[0];this._resultTransp.m[1]=t.m[4];this._resultTransp.m[2]=t.m[8];this._resultTransp.m[3]=t.m[12];this._resultTransp.m[4]=t.m[1];this._resultTransp.m[5]=t.m[5];this._resultTransp.m[6]=t.m[9];this._resultTransp.m[7]=t.m[13];this._resultTransp.m[8]=t.m[2];this._resultTransp.m[9]=t.m[6];this._resultTransp.m[10]=t.m[10];this._resultTransp.m[11]=t.m[14];this._resultTransp.m[12]=t.m[3];this._resultTransp.m[13]=t.m[7];this._resultTransp.m[14]=t.m[11];this._resultTransp.m[15]=t.m[15];e.geo.copyMat(this._resultTransp,i)};t.prototype.multiplyMatMat=function(e,t,i){var r=e.m[0];var s=e.m[1];var n=e.m[2];var a=e.m[3];var o=e.m[4];var h=e.m[5];var l=e.m[6];var u=e.m[7];var c=e.m[8];var m=e.m[9];var p=e.m[10];var f=e.m[11];var d=e.m[12];var v=e.m[13];var g=e.m[14];var y=e.m[15];var b=t.m[0];var w=t.m[1];var M=t.m[2];var x=t.m[3];var C=t.m[4];var T=t.m[5];var V=t.m[6];var S=t.m[7];var k=t.m[8];var O=t.m[9];var A=t.m[10];var P=t.m[11];var _=t.m[12];var F=t.m[13];var N=t.m[14];var B=t.m[15];i.m[0]=r*b+s*C+n*k+a*_;i.m[1]=r*w+s*T+n*O+a*F;i.m[2]=r*M+s*V+n*A+a*N;i.m[3]=r*x+s*S+n*P+a*B;i.m[4]=o*b+h*C+l*k+u*_;i.m[5]=o*w+h*T+l*O+u*F;i.m[6]=o*M+h*V+l*A+u*N;i.m[7]=o*x+h*S+l*P+u*B;i.m[8]=c*b+m*C+p*k+f*_;i.m[9]=c*w+m*T+p*O+f*F;i.m[10]=c*M+m*V+p*A+f*N;i.m[11]=c*x+m*S+p*P+f*B;i.m[12]=d*b+v*C+g*k+y*_;i.m[13]=d*w+v*T+g*O+y*F;i.m[14]=d*M+v*V+g*A+y*N;i.m[15]=d*x+v*S+g*P+y*B};t.prototype.baryCenter=function(t,i,r){this.baryResult.x=0;this.baryResult.y=0;this.baryResult.z=0;for(var s=0;s<t.length;s++){e.geo.copyXYZ(t[s],this._scaled);this.scale(this._scaled,i[s],this._scaled);this.add(this.baryResult,this._scaled,this.baryResult)}e.geo.copyXYZ(this.baryResult,r)};t.prototype.between=function(e,t,i,r){r.x=e.x*(1-i)+t.x*i;r.y=e.y*(1-i)+t.y*i;r.z=e.z*(1-i)+t.z*i};t.prototype.betweenUV=function(e,t,i,r){r.u=e.u*(1-i)+t.u*i;r.v=e.v*(1-i)+t.v*i};t.prototype.unproject=function(t,i,r,s,n,a,o){e.geo.copyXYZ(t,this._source);if(s!=null){this.multiplyMatMat(s,n,this._matUn);this.multiplyMatMat(this._matUn,a,this._matUn)}else{this.multiplyMatMat(n,a,this._matUn)}this.inverse(this._matUn,this._matUn);this._source.x=this._source.x/i*2-1;this._source.y=-(this._source.y/r*2-1);this.multiplicationMatrixVector(this._matUn,this._source,o);var h=t.x*this._matUn.m[3]+t.y*this._matUn.m[7]+t.z*this._matUn.m[11]+this._matUn.m[15];if(this.withinEpsilon(h,1)){this.scale(o,1/h,o)}};t.prototype.withinEpsilon=function(e,t){var i=e-t;return-1.401298e-45<=i&&i<=1.401298e-45};t.prototype.axisAngleToMatrix=function(t,i,r){var s=Math.sin(-i);var n=Math.cos(-i);var a=1-n;e.geo.copyXYZ(t,this._axis);this.normalize(this._axis,this._axis);r.m[0]=this._axis.x*this._axis.x*a+n;r.m[1]=this._axis.x*this._axis.y*a-this._axis.z*s;r.m[2]=this._axis.x*this._axis.z*a+this._axis.y*s;r.m[3]=0;r.m[4]=this._axis.y*this._axis.x*a+this._axis.z*s;r.m[5]=this._axis.y*this._axis.y*a+n;r.m[6]=this._axis.y*this._axis.z*a-this._axis.x*s;r.m[7]=0;r.m[8]=this._axis.z*this._axis.x*a-this._axis.y*s;r.m[9]=this._axis.z*this._axis.y*a+this._axis.x*s;r.m[10]=this._axis.z*this._axis.z*a+n;r.m[11]=0;r.m[12]=0;r.m[13]=0;r.m[14]=0;r.m[15]=1};t.prototype.multiplicationMatrixVector=function(e,t,i){var r=t.x*e.m[0]+t.y*e.m[4]+t.z*e.m[8]+e.m[12];var s=t.x*e.m[1]+t.y*e.m[5]+t.z*e.m[9]+e.m[13];var n=t.x*e.m[2]+t.y*e.m[6]+t.z*e.m[10]+e.m[14];var a=t.x*e.m[3]+t.y*e.m[7]+t.z*e.m[11]+e.m[15];i.x=r/a;i.y=s/a;i.z=n/a};t.prototype.axisAngleToQuaternion=function(e,t,i){var r=Math.sin(t/2);i.w=Math.cos(t/2);i.x=e.x*r;i.y=e.y*r;i.z=e.z*r};t.prototype.matrixToQuaternion=function(e,t){var i,r,s,n,a,o,h,l,u;i=e.m[0];n=e.m[1];h=e.m[2];r=e.m[4];a=e.m[5];l=e.m[6];s=e.m[8];o=e.m[9];u=e.m[10];var c,m,p,f;var d=i+a+u;if(d>0){var v=Math.sqrt(d+1)*2;f=.25*v;c=(l-o)/v;m=(s-h)/v;p=(n-r)/v}else if(i>a&&i>u){var v=Math.sqrt(1+i-a-u)*2;f=(l-o)/v;c=.25*v;m=(r+n)/v;p=(s+h)/v}else if(a>u){var v=Math.sqrt(1+a-i-u)*2;f=(s-h)/v;c=(r+n)/v;m=.25*v;p=(o+l)/v}else{var v=Math.sqrt(1+u-i-a)*2;f=(n-r)/v;c=(s+h)/v;m=(o+l)/v;p=.25*v}t.x=c;t.y=m;t.z=p;t.w=f};t.prototype.twoVectorsToQuaternion=function(t,i,r,s){if(r){e.geo.orthonormalizeKeepingFirstDirection(t,i,this._ortBasisV1,this._ortBasisV2)}else{e.geo.orthonormalizeKeepingFirstDirection(i,t,this._ortBasisV2,this._ortBasisV1)}e.geo.cross(this._ortBasisV1,this._ortBasisV2,this._ortBasisV3);e.geo.matrixFromLines(this._ortBasisV1,this._ortBasisV2,this._ortBasisV3,this._ortBasisAll);e.geo.matrixToQuaternion(this._ortBasisAll,s)};t.prototype.orthogonalProjectionOnLine=function(e,t){this.normalize(e,this._basisOrtho0);this.getOneOrthonormal(e,this._basisOrtho1);this.cross(this._basisOrtho0,this._basisOrtho1,this._basisOrtho2);this.matrixFromLines(this._basisOrtho0,this._basisOrtho1,this._basisOrtho2,this._basisMatrix);this.transpose(this._basisMatrix,this._transposedBasisMatrix);this._diagoMatrix.m[0]=1;this._diagoMatrix.m[15]=1;this.multiplyMatMat(this._transposedBasisMatrix,this._diagoMatrix,t);this.multiplyMatMat(t,this._basisMatrix,t)};t.prototype.orthogonalProjectionOnPlane=function(e,t,i){this.orthonormalizeKeepingFirstDirection(e,t,this._basisOrtho0,this._basisOrtho1);this.cross(this._basisOrtho0,this._basisOrtho1,this._basisOrtho2);this.matrixFromLines(this._basisOrtho0,this._basisOrtho1,this._basisOrtho2,this._basisMatrix);this.transpose(this._basisMatrix,this._transposedBasisMatrix);this._diagoMatrix.m[0]=1;this._diagoMatrix.m[5]=1;this._diagoMatrix.m[15]=1;this.multiplyMatMat(this._transposedBasisMatrix,this._diagoMatrix,i);this.multiplyMatMat(i,this._basisMatrix,i)};t.prototype.translationOnMatrix=function(e,t){t.m[12]=e.x;t.m[13]=e.y;t.m[14]=e.z};t.prototype.quaternionToMatrix=function(e,t){var i=e.x*e.x;var r=e.y*e.y;var s=e.z*e.z;var n=e.x*e.y;var a=e.z*e.w;var o=e.z*e.x;var h=e.y*e.w;var l=e.y*e.z;var u=e.x*e.w;t.m[0]=1-2*(r+s);t.m[1]=2*(n+a);t.m[2]=2*(o-h);t.m[3]=0;t.m[4]=2*(n-a);t.m[5]=1-2*(s+i);t.m[6]=2*(l+u);t.m[7]=0;t.m[8]=2*(o+h);t.m[9]=2*(l-u);t.m[10]=1-2*(r+i);t.m[11]=0;t.m[12]=0;t.m[13]=0;t.m[14]=0;t.m[15]=1};t.prototype.quaternionMultiplication=function(e,t,i){var r=e.x*t.w+e.y*t.z-e.z*t.y+e.w*t.x;var s=-e.x*t.z+e.y*t.w+e.z*t.x+e.w*t.y;var n=e.x*t.y-e.y*t.x+e.z*t.w+e.w*t.z;var a=-e.x*t.x-e.y*t.y-e.z*t.z+e.w*t.w;i.x=r;i.y=s;i.z=n;i.w=a};t.prototype.anOrthogonalMatrixMovingABtoCD=function(e,t,i,r,s,n){if(n===void 0){n=false}if(n){this.copA.copyFrom(e);this.copB.copyFrom(t);this.copC.copyFrom(i);this.copD.copyFrom(r)}else{this.orthonormalizeKeepingFirstDirection(e,t,this.copA,this.copB);this.orthonormalizeKeepingFirstDirection(i,r,this.copC,this.copD)}this.cross(this.copA,this.copB,this.oor1);this.matrixFromLines(this.copA,this.copB,this.oor1,this.matt1);this.cross(this.copC,this.copD,this.oor2);this.matrixFromLines(this.copC,this.copD,this.oor2,this.matt2);this.transpose(this.matt1,this.matt1);this.multiplyMatMat(this.matt1,this.matt2,s)};t.prototype.aQuaternionMovingABtoCD=function(e,t,i,r,s,n){if(n===void 0){n=false}this.anOrthogonalMatrixMovingABtoCD(e,t,i,r,this.matBefore,n);this.matrixToQuaternion(this.matBefore,s)};t.prototype.slerp=function(e,t,i,r){var s;var n;var a=i;var o=e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w;var h=false;if(o<0){h=true;o=-o}if(o>.999999){n=1-a;s=h?-a:a}else{var l=Math.acos(o);var u=1/Math.sin(l);n=Math.sin((1-a)*l)*u;s=h?-Math.sin(a*l)*u:Math.sin(a*l)*u}r.x=n*e.x+s*t.x;r.y=n*e.y+s*t.y;r.z=n*e.z+s*t.z;r.w=n*e.w+s*t.w};t.prototype.matrixFromLines=function(e,t,i,r){r.m[0]=e.x;r.m[1]=e.y;r.m[2]=e.z;r.m[3]=0;r.m[4]=t.x;r.m[5]=t.y;r.m[6]=t.z;r.m[7]=0;r.m[8]=i.x;r.m[9]=i.y;r.m[10]=i.z;r.m[11]=0;r.m[12]=0;r.m[13]=0;r.m[14]=0;r.m[15]=1};t.prototype.angleBetweenTwoVectorsBetween0andPi=function(t,i){if(e.geo.xyzAlmostZero(t)||e.geo.xyzAlmostZero(i)){throw"be aware: you compute angle between two vectors, one of them being almost zero"}this.normalize(t,this.v1nor);this.normalize(i,this.v2nor);var r=this.dot(this.v1nor,this.v2nor);if(r>1)return 0;if(r<-1)return Math.PI;else return Math.acos(r)};t.prototype.almostParallel=function(e,t,i,r){if(i===void 0){i=true}if(r===void 0){r=.001}var s=this.angleBetweenTwoVectorsBetween0andPi(e,t);if(s<r)return true;if(i&&Math.PI-s<r)return true;return false};t.prototype.angleBetweenTwoVectorsBetweenMinusPiAndPi=function(t,i,r){var s=this.angleBetweenTwoVectorsBetween0andPi(t,i);e.geo.cross(t,i,this._aCros);var n=e.geo.dot(r,this._aCros)<0?-1:1;return n*s};t.prototype.slerpTwoOrthogonalVectors=function(t,i,r,s,n,a,o){this.cross(t,i,this._c0);this.cross(r,s,this._c1);this.matrixFromLines(t,i,this._c0,this._mat0);this.matrixFromLines(r,s,this._c1,this._mat1);this.matrixToQuaternion(this._mat0,this._quat0);this.matrixToQuaternion(this._mat1,this._quat1);this.slerp(this._quat0,this._quat1,n,this._quatAlpha);this.quaternionToMatrix(this._quatAlpha,this._matAlpha);e.geo.copyXyzFromFloat(this._matAlpha.m[0],this._matAlpha.m[1],this._matAlpha.m[2],a);e.geo.copyXyzFromFloat(this._matAlpha.m[4],this._matAlpha.m[5],this._matAlpha.m[7],o)};t.prototype.interpolateTwoVectors=function(e,t,i,r){r.x=e.x*(1-i)+t.x*i;r.y=e.y*(1-i)+t.y*i;r.z=e.z*(1-i)+t.z*i};t.prototype.scale=function(e,t,i){i.x=e.x*t;i.y=e.y*t;i.z=e.z*t};t.prototype.add=function(e,t,i){i.x=e.x+t.x;i.y=e.y+t.y;i.z=e.z+t.z};t.prototype.substract=function(e,t,i){i.x=e.x-t.x;i.y=e.y-t.y;i.z=e.z-t.z};t.prototype.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z};t.prototype.norme=function(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)};t.prototype.squareNorme=function(e){return e.x*e.x+e.y*e.y+e.z*e.z};t.prototype.cross=function(t,i,r){this._crossResult.x=t.y*i.z-t.z*i.y;this._crossResult.y=t.z*i.x-t.x*i.z;this._crossResult.z=t.x*i.y-t.y*i.x;e.geo.copyXYZ(this._crossResult,r)};t.prototype.orthonormalizeKeepingFirstDirection=function(t,i,r,s){this.normalize(t,this._result1);e.geo.copyXYZ(t,this.v1forSubstraction);this.scale(this.v1forSubstraction,this.dot(t,i),this.v1forSubstraction);this.substract(i,this.v1forSubstraction,this._result2);if(this.squareNorme(this._result2)<e.geo.epsilon*e.geo.epsilon){e.geo.copyXyzFromFloat(Math.random(),Math.random(),Math.random(),this.randV2);e.logger.c("beware: you try to orthonormalize two co-linear vectors");return this.orthonormalizeKeepingFirstDirection(t,this.randV2,r,s)}this.normalize(this._result2,this._result2);e.geo.copyXYZ(this._result1,r);e.geo.copyXYZ(this._result2,s)};t.prototype.getOneOrthonormal=function(t,i){if(Math.abs(t.x)+Math.abs(t.y)>1e-4)i.copyFromFloats(-t.y,t.x,0);else i.copyFromFloats(0,-t.z,t.y);e.geo.normalize(i,i)};t.prototype.normalize=function(t,i){var r=this.norme(t);if(r<e.geo.epsilon)throw"one can not normalize a the almost zero vector:"+t;this.scale(t,1/r,i)};t.prototype.intersectionBetweenRayAndSphereFromRef=function(t,i,r,s,n,a){e.geo.copyXYZ(t,this.spheCentToRayOri);this.substract(this.spheCentToRayOri,s,this.spheCentToRayOri);var o=this.squareNorme(i);var h=2*this.dot(i,this.spheCentToRayOri);var l=this.squareNorme(this.spheCentToRayOri)-r*r;var u=h*h-4*o*l;if(u<0){return false}else{var c=(-h+Math.sqrt(u))/2/o;var m=(-h-Math.sqrt(u))/2/o;e.geo.copyXYZ(i,this._resultInters);this.scale(this._resultInters,c,this._resultInters);this.add(this._resultInters,t,this._resultInters);e.geo.copyXYZ(this._resultInters,n);e.geo.copyXYZ(i,this._resultInters);this.scale(this._resultInters,m,this._resultInters);this.add(this._resultInters,t,this._resultInters);e.geo.copyXYZ(this._resultInters,a);return true}};t.prototype.distance=function(e,t){this.copyXYZ(e,this.difference);this.substract(this.difference,t,this.difference);return this.norme(this.difference)};t.prototype.squaredDistance=function(e,t){this.copyXYZ(e,this.difference);this.substract(this.difference,t,this.difference);return this.squareNorme(this.difference)};t.prototype.closerOf=function(e,t,i,r){var s=this.distance(e,i);var n=this.distance(t,i);if(s<n)this.copyXYZ(e,r);else this.copyXYZ(t,r);return s<n?s:n};t.prototype.LookAtLH=function(t,i,r,s){this.substract(i,t,this._zAxis);this.normalize(this._zAxis,this._zAxis);this.cross(r,this._zAxis,this._xAxis);if(e.geo.xyzAlmostZero(this._xAxis)){this._xAxis.x=1}else{this._xAxis.normalize()}this.cross(this._zAxis,this._xAxis,this._yAxis);this._yAxis.normalize();var n=-this.dot(this._xAxis,t);var a=-this.dot(this._yAxis,t);var o=-this.dot(this._zAxis,t);this.numbersToMM(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,n,a,o,1,s)};t.prototype.OrthoOffCenterLH=function(e,t,i,r,s,n,a){a.m[0]=2/(t-e);a.m[1]=a.m[2]=a.m[3]=0;a.m[5]=2/(r-i);a.m[4]=a.m[6]=a.m[7]=0;a.m[10]=-1/(s-n);a.m[8]=a.m[9]=a.m[11]=0;a.m[12]=(e+t)/(e-t);a.m[13]=(r+i)/(i-r);a.m[14]=s/(s-n);a.m[15]=1};t.prototype.PerspectiveFovLH=function(e,t,i,r,s){var n=1/Math.tan(e*.5);var a=true;if(a){s.m[0]=n/t}else{s.m[0]=n}s.m[1]=s.m[2]=s.m[3]=0;if(a){s.m[5]=n}else{s.m[5]=n*t}s.m[4]=s.m[6]=s.m[7]=0;s.m[8]=s.m[9]=0;s.m[10]=-r/(i-r);s.m[11]=1;s.m[12]=s.m[13]=s.m[15]=0;s.m[14]=i*r/(i-r)};t.prototype.numbersToMM=function(e,t,i,r,s,n,a,o,h,l,u,c,m,p,f,d,v){v.m[0]=e;v.m[1]=t;v.m[2]=i;v.m[3]=r;v.m[4]=s;v.m[5]=n;v.m[6]=a;v.m[7]=o;v.m[8]=h;v.m[9]=l;v.m[10]=u;v.m[11]=c;v.m[12]=m;v.m[13]=p;v.m[14]=f;v.m[15]=d};t.prototype.newHermite=function(t,i,r,s,n){var a=n*n;var o=n*a;var h=2*o-3*a+1;var l=-2*o+3*a;var u=o-2*a+n;var c=o-a;var m=t.x*h+r.x*l+i.x*u+s.x*c;var p=t.y*h+r.y*l+i.y*u+s.y*c;var f=t.z*h+r.z*l+i.z*u+s.z*c;return new e.XYZ(m,p,f)};t.prototype.hermiteSpline=function(t,i,r,s,n,a){e.tab.clearArray(a);var o=1/n;for(var h=0;h<n;h++){a.push(this.newHermite(t,i,r,s,h*o))}};t.prototype.quadraticBezier=function(t,i,r,s,n){e.tab.clearArray(n);s=s>2?s:3;var a=function(e,t,i,r){var s=(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*r;return s};for(var o=0;o<s;o++){n.push(new e.XYZ(a(o/s,t.x,i.x,r.x),a(o/s,t.y,i.y,r.y),a(o/s,t.z,i.z,r.z)))}};t.prototype.cubicBezier=function(t,i,r,s,n,a){e.tab.clearArray(a);n=n>3?n:4;var o=function(e,t,i,r,s){var n=(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*r+e*e*e*s;return n};for(var h=0;h<n;h++){a.push(new e.XYZ(o(h/n,t.x,i.x,r.x,s.x),o(h/n,t.y,i.y,r.y,s.y),o(h/n,t.z,i.z,r.z,s.z)))}};t.prototype.affineTransformGenerator=function(t,i,r,s){var n=e.XYZ.newFrom(i).substract(t);var a=e.XYZ.newFrom(s).substract(r);if(n.x==0&&a.x!=0)throw"impossible affine transform from a rectangle to a pavé";if(n.y==0&&a.y!=0)throw"impossible affine transform from a rectangle to a pavé";if(n.z==0&&a.z!=0)throw"impossible affine transform from a rectangle to a pavé";var o=0;if(n.x==0)o++;if(n.y==0)o++;if(n.z==0)o++;if(o>=2)throw"intrance pavé is too degenerated";var h=new e.XYZ(n.x==0?1:1/n.x,n.y==0?1:1/n.y,n.z==0?1:1/n.z);var l=function(e,i){i.copyFrom(e).substract(t).multiply(h).multiply(a).add(r)};return l};return t}();e.Geo=t;var i;(function(t){var i=function(){function t(t,i,r){this.nbDistinctPoint=1e3;this.maxDistToBeClose=null;this.deformationFunction=function(e){return e};this.mins=new e.XYZ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.maxs=new e.XYZ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);this.nbDistinctPoint=r;this.recepteurList=t;if(i==null||t==i){this.sourceList=t;this.sourceEqualRecepter=true}else{this.sourceList=i;this.sourceEqualRecepter=false}}t.prototype.go=function(){this.buildScaler();var t=new e.XYZ(Math.max(1,this.maxs.x-this.mins.x),Math.max(1,this.maxs.y-this.mins.y),Math.max(1,this.maxs.z-this.mins.z));var i={};for(var r=0;r<this.recepteurList.length;r++){var s=this.deformationFunction(this.recepteurList[r]);var n=Math.round((s.x-this.mins.x)/t.x*this.nbDistinctPoint);var a=Math.round((s.y-this.mins.y)/t.y*this.nbDistinctPoint);var o=Math.round((s.z-this.mins.z)/t.z*this.nbDistinctPoint);var h=n+","+a+","+o;if(i[h]==null)i[h]=r;else if(!this.sourceEqualRecepter)e.logger.c("strange: the recepterList has several XYZ very close. This is, in general, only possible, when recepter equal source")}var l={};for(var r=0;r<this.sourceList.length;r++){var s=this.deformationFunction(this.sourceList[r]);var n=Math.round((s.x-this.mins.x)/t.x*this.nbDistinctPoint);var a=Math.round((s.y-this.mins.y)/t.y*this.nbDistinctPoint);var o=Math.round((s.z-this.mins.z)/t.z*this.nbDistinctPoint);var u=i[n+","+a+","+o];if(u!=null){if(this.sourceEqualRecepter){if(u!=r)l[r]=u}else l[r]=u}}return l};t.prototype.buildScaler=function(){var t=this;this.recepteurList.forEach(function(e){var i=t.deformationFunction(e);if(i.x<t.mins.x)t.mins.x=i.x;if(i.y<t.mins.y)t.mins.y=i.y;if(i.z<t.mins.z)t.mins.z=i.z;if(i.x>t.maxs.x)t.maxs.x=i.x;if(i.y>t.maxs.y)t.maxs.y=i.y;if(i.z>t.maxs.z)t.maxs.z=i.z});if(!this.sourceEqualRecepter){this.sourceList.forEach(function(e){var i=t.deformationFunction(e);if(i.x<t.mins.x)t.mins.x=i.x;if(i.y<t.mins.y)t.mins.y=i.y;if(i.z<t.mins.z)t.mins.z=i.z;if(i.x>t.maxs.x)t.maxs.x=i.x;if(i.y>t.maxs.y)t.maxs.y=i.y;if(i.z>t.maxs.z)t.maxs.z=i.z})}if(this.maxDistToBeClose!=null){this.nbDistinctPoint=e.geo.distance(this.maxs,this.mins)/this.maxDistToBeClose}};return t}();t.CloseXYZfinder=i;var r=function(){function t(e){this.options=new n;this.hermite=new Array;this.points=e}t.prototype.checkArgs=function(){if(this.points==null||this.points.length<2)throw"too few points"};t.prototype.go=function(){var t=this;var i=new Array;if(this.points.length==2){i=[];for(var r=0;r<this.options.nbSubdivisions+1;r++){var n=new e.XYZ(0,0,0);e.geo.between(this.points[0],this.points[1],r/this.options.nbSubdivisions,n);i.push(n)}if(this.options.loopLine)i.push(e.XYZ.newFrom(this.points[0]))}else if(this.options.interpolationStyle==s.none){i=[];this.points.forEach(function(t){return i.push(e.XYZ.newFrom(t))});if(this.options.loopLine)i.push(e.XYZ.newFrom(this.points[0]))}else if(this.options.interpolationStyle==s.hermite){var a=e.XYZ.newZero();var o=e.XYZ.newZero();var h=function(r,s,n,h){e.geo.substract(s,r,a);e.geo.substract(h,n,o);a.scale(t.options.ratioTan);o.scale(t.options.ratioTan);e.geo.hermiteSpline(s,a,n,o,t.options.nbSubdivisions,t.hermite);t.hermite.forEach(function(e){i.push(e)})};var l=this.points.length-1;if(!this.options.loopLine)h(this.points[0],this.points[0],this.points[1],this.points[2]);else{h(this.points[l],this.points[0],this.points[1],this.points[2])}for(var r=1;r<this.points.length-2;r++){h(this.points[r-1],this.points[r],this.points[r+1],this.points[r+2])}if(!this.options.loopLine){h(this.points[l-2],this.points[l-1],this.points[l],this.points[l]);i.push(this.points[l])}else{h(this.points[l-2],this.points[l-1],this.points[l],this.points[0]);h(this.points[l-1],this.points[l],this.points[0],this.points[1]);i.push(this.points[0])}}else if(this.options.interpolationStyle==s.octavioStyle){if(this.points.length==2)return[e.XYZ.newFrom(this.points[0]),e.XYZ.newFrom(this.points[1])];var l=this.points.length-1;var u=e.XYZ.newZero();var c=e.XYZ.newZero();var h=function(r,s,n){e.geo.between(r,s,.5,u);e.geo.between(s,n,.5,c);e.geo.quadraticBezier(u,s,c,t.options.nbSubdivisions,t.hermite);t.hermite.forEach(function(e){i.push(e)})};if(!this.options.loopLine){var m=e.XYZ.newFrom(this.points[0]);i.push(m)}else{h(this.points[l],this.points[0],this.points[1])}for(var r=1;r<this.points.length-1;r++){h(this.points[r-1],this.points[r],this.points[r+1])}if(!this.options.loopLine){var p=e.XYZ.newFrom(this.points[l]);i.push(p)}else{h(this.points[l-1],this.points[l],this.points[0]);var f=e.XYZ.newZero();e.geo.between(this.points[l],this.points[0],.5,f);i.push(f)}}else throw"line interporler style unknown";return i};return t}();t.LineInterpoler=r;(function(e){e[e["hermite"]=0]="hermite";e[e["octavioStyle"]=1]="octavioStyle";e[e["none"]=2]="none"})(t.InterpolationStyle||(t.InterpolationStyle={}));var s=t.InterpolationStyle;var n=function(){function e(){this.loopLine=false;this.interpolationStyle=s.octavioStyle;this.nbSubdivisions=10;this.ratioTan=.5}return e}();t.InterpolationOption=n})(i=e.geometry||(e.geometry={}))})(mathis||(mathis={}));var mathis;(function(e){var t=function(){function e(e,t){this.a=e<t?e:t;this.b=e<t?t:e}return e}();var i;(function(t){function i(t,i){var r=[];var s=[];var n=t;var o=new e.HashMap;for(var h=0,l=t;h<l.length;h++){var u=l[h];r.push(u);o.putValue(u,true)}while(n.length>0){s=a(n);n=[];for(var c=0,m=s;c<m.length;c++){var u=m[c];if(!o.getValue(u)){if(i==null||i.getValue(u)){n.push(u);r.push(u)}o.putValue(u,true)}}}return r}t.getGroup=i;var r=function(){function t(t){this.OUT_distances_dico=new e.HashMap;this.centralCells=t}t.prototype.OUT_distance=function(e){return this.OUT_distances_dico.getValue(e)};t.prototype.OUT_allGeodesics=function(t,i){if(i===void 0){i=false}var r=[];var s=[t];var n=new e.HashMap;var o=this.OUT_distances_dico.getValue(t);while(s.length>0){r.push(s);o--;s=a(s,n);var h=[];for(var l=0,u=s;l<u.length;l++){var c=u[l];if(this.OUT_distances_dico.getValue(c)==o){h.push(c);if(i)break}}s=h}return r};t.prototype.go=function(){var t=new e.HashMap;if(this.centralCells==null||this.centralCells.length==0)throw"problème d argument";this.OUT_stratesAround=[];this.OUT_stratesAround.push(this.centralCells);var i=a(this.centralCells,t);while(i.length>0){this.OUT_stratesAround.push(i);i=a(i,t)}for(var r=0;r<this.OUT_stratesAround.length;r++){for(var s=0,n=this.OUT_stratesAround[r];s<n.length;s++){var o=n[s];this.OUT_distances_dico.putValue(o,r)}}};return t}();t.DistancesFromAGroup=r;var s=function(){function e(e){this.vertices=e;this.nbTimeOfNonEvolutionToStop=2;this.lookNonEvolutionWithDistanceVersusWithGroups=true;this.consecutiveExtremetDistances=[];this.OUT_nbIteration=0;this.OUT_twoChosenExtremeVertices=[]}e.prototype.go=function(){var e=[this.vertices[0]];var t=0;var i=[];var s;while(this.evolution()){this.OUT_nbIteration++;s=new r(e);s.go();t=s.OUT_stratesAround.length;var n=s.OUT_stratesAround[t-1][0];e=[n];this.consecutiveExtremetDistances.push(t);i.push(n)}this.OUT_twoChosenExtremeVertices=[i[this.OUT_nbIteration-1],i[this.OUT_nbIteration-2]];this.OUT_geodesicsBetweenChosenExtremeVertices=s.OUT_allGeodesics(i[this.OUT_nbIteration-1]);this.OUT_oneGeodesicBetweenChosenExtremeVertices=s.OUT_allGeodesics(i[this.OUT_nbIteration-1],true);return t-1};e.prototype.evolution=function(){if(this.lookNonEvolutionWithDistanceVersusWithGroups){var e=this.consecutiveExtremetDistances.length;if(e<this.nbTimeOfNonEvolutionToStop)return true;var t=this.consecutiveExtremetDistances[e-1];for(var i=1;i<this.nbTimeOfNonEvolutionToStop;i++){if(this.consecutiveExtremetDistances[e-1-i]!=t)return true}return false}else throw"TODO"};return e}();t.HeuristicDiameter=s;var n=function(){function t(t){this.OUT_allExtremeVertex=[];this.allCounters=new e.HashMap;this.allToTransmit=new e.HashMap;this.OUT_diameter=null;this.allVertices=t}t.prototype.OUT_distance=function(e,t){return this.allCounters.getValue(e).getValue(t)};t.prototype.OUT_allGeodesics=function(t,i,r){if(r===void 0){r=false}var s=[];var n=[t];var o=new e.HashMap;var h=this.allCounters.getValue(t).getValue(i);while(n.length>0){s.push(n);h--;n=a(n,o);var l=[];for(var u=0,c=n;u<c.length;u++){var m=c[u];if(this.allCounters.getValue(m).getValue(i)==h){l.push(m);if(r)break}}n=l}return s};t.prototype.go=function(){for(var t=0,i=this.allVertices;t<i.length;t++){var r=i[t];var s=new e.HashMap(true);s.putValue(r,0);this.allCounters.putValue(r,s);var n=new e.HashMap(true);n.putValue(r,0);this.allToTransmit.putValue(r,n)}var a=true;while(a){a=false;this.allFreshlyReceived=new e.HashMap;for(var o=0,h=this.allVertices;o<h.length;o++){var r=h[o];this.allFreshlyReceived.putValue(r,new e.HashMap(true))}for(var l=0,u=this.allVertices;l<u.length;l++){var r=u[l];var n=this.allToTransmit.getValue(r);for(var c=0,m=r.links;c<m.length;c++){var p=m[c];var f=this.allCounters.getValue(p.to);for(var d=0,v=n.allKeys();d<v.length;d++){var g=v[d];if(f.getValue(g)==null){a=true;f.putValue(g,n.getValue(g)+1);this.allFreshlyReceived.getValue(p.to).putValue(g,n.getValue(g)+1)}}}}this.allToTransmit=this.allFreshlyReceived;this.OUT_diameter=0;for(var y=0,b=this.allVertices;y<b.length;y++){var r=b[y];for(var w=0,M=this.allCounters.getValue(r).allEntries();w<M.length;w++){var x=M[w];if(x.value>this.OUT_diameter){this.OUT_diameter=x.value;this.OUT_aMaxCouple=[r,x.key];this.OUT_allExtremeVertex=[r]}if(x.value==this.OUT_diameter)this.OUT_allExtremeVertex.push(r)}}}};return t}();t.DistancesBetweenAllVertices=n;function a(t,i){if(i==null)i=new e.HashMap;var r=[];for(var s=0,n=t;s<n.length;s++){var a=n[s];i.putValue(a,true)}for(var o=0,h=t;o<h.length;o++){var a=h[o];for(var l=0,u=a.links;l<u.length;l++){var c=u[l];if(!i.getValue(c.to)){r.push(c.to)}i.putValue(c.to,true)}}return r}t.getEdge=a;function o(t,i,r){if(r===void 0){r=false}if(i==null)i=new e.HashMap;var s=a(t,i);var n=new e.HashMap;for(var o=0,h=s;o<h.length;o++){var l=h[o];n.putValue(l,true)}var u=s.concat(t);var c=a(u);for(var m=0,p=c;m<p.length;m++){var l=p[m];if(l.links.length<=4){var f=0;for(var d=0,v=l.links;d<v.length;d++){var g=v[d];if(n.getValue(g.to)!=null)f++}if(r&&f==2){s.push(l);i.putValue(l,true)}else if(f>=2){s.push(l);i.putValue(l,true)}}}return s}t.getEdgeConsideringAlsoDiagonalVoisin=o;function h(t){var i=new e.HashMap;if(t==null||t.length==0)throw"problème d argument";var r=[];r.push(t);var s=a(t,i);while(s.length>0){r.push(s);s=a(s,i)}return r}t.ringify=h;function l(e){if(e==null||e.length==0)throw"problème d argument";var t=[];t.push(e);var i=e;var r=o(i);while(r.length>0){t.push(r);i=i.concat(r);r=o(i)}return t}t.ringifyConsideringAlsoDiagonalVoisin=l})(i=e.graph||(e.graph={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(){this.IN_graphFamily=[];this.seedsList=null;this.seedComputedFromBarycentersVersusFromAllPossibleCells=true;this.barycenterDecay=new e.XYZ(2.34e-8,6.77e-10,9.87e-10);this.proximityCoefToGrate=[.7];this.proportionOfSeeds=[.1];this.asymmetriesForSeeds=null}t.prototype.checkArgs=function(){if(this.IN_graphFamily==null||this.IN_graphFamily.length<2)throw"SUB_grater works from 2 graphs"};t.prototype.suppressTooCloseVertex=function(e){var t=[];for(var i=0;i<e.length;i++){var r=this.proximityCoefToGrate[i%this.proximityCoefToGrate.length];t[i]=[];for(var s=0,n=e[i];s<n.length;s++){var a=n[s];var o=true;for(var h=0;h<e.length;h++){if(i!=h){o=!this.proximityMeasurer.isCloseToMe(a,e[h],r);if(!o)break}}if(o)t[i].push(a)}}return t};t.prototype.findSeeds=function(){var t=[];if(!this.seedComputedFromBarycentersVersusFromAllPossibleCells){t=this.suppressTooCloseVertex(this.IN_graphFamily)}else{for(var i=0;i<this.IN_graphFamily.length;i++){t[i]=[]}var r=[];for(var i=0;i<this.IN_graphFamily.length;i++){r[i]=new e.XYZ(0,0,0);for(var s=0,n=this.IN_graphFamily[i];s<n.length;s++){var a=n[s];r[i].add(a.position)}r[i].scale(1/this.IN_graphFamily[i].length);r[i].add(this.barycenterDecay)}var o=function(e,t){return t.distance-e.distance};for(var h=0;h<this.IN_graphFamily.length;h++){var l=new e.XYZ(0,0,0);for(var u=0;u<this.IN_graphFamily.length;u++)if(u!=h)l.add(r[u]);l.scale(1/(this.IN_graphFamily.length-1));var c=[];var m=new e.XYZ(0,0,0);for(var p=0,f=this.IN_graphFamily[h];p<f.length;p++){var a=f[p];m.copyFrom(a.position).substract(l);var d=e.geo.distance(a.position,l);if(this.asymmetriesForSeeds!=null&&this.asymmetriesForSeeds[h%this.asymmetriesForSeeds.length]!=null){var v=this.asymmetriesForSeeds[h%this.asymmetriesForSeeds.length];var g=e.geo.angleBetweenTwoVectorsBetween0andPi(m,v.direction);var y=Math.PI;if(v.modulo!=null){y=v.modulo;if(isNaN(y)||y<0||y>Math.PI)throw"modulo must be a number between 0 and PI, but is:"+y;g=e.modulo(g,y)}var b=1-g/y;d=d*(1-v.influence)+b*v.influence}c.push({vertex:a,distance:d})}c.sort(o);t[h]=[];var w=void 0;if(this.proportionOfSeeds[h%this.proportionOfSeeds.length]>0)w=c[0].distance*(1-this.proportionOfSeeds[h%this.proportionOfSeeds.length]);else w=c[0].distance*.99;var M=Number.MAX_VALUE;var i=0;while(M>=w&&i<c.length-1){t[h].push(c[i].vertex);i++;M=c[i].distance}}}t=this.suppressTooCloseVertex(t);for(var i=0;i<this.IN_graphFamily.length;i++)if(t[i].length==0)throw"an empty seeds, possible cause: 1/  two graphes are identical 2/ one of your graph is nearly includes into an other and you do not use the barycenter technique";return t};t.prototype.go=function(){this.checkArgs();if(this.proximityMeasurer==null)this.proximityMeasurer=new r;if(this.seedsList==null){this.seedsList=this.findSeeds();this.OUT_allSeeds=this.seedsList}var t=true;var i=[];for(var s=0;s<this.IN_graphFamily.length;s++){i[s]=[].concat(this.seedsList[s])}var n=new e.HashMap;while(t){t=false;for(var s=0;s<this.IN_graphFamily.length;s++){var a=this.proximityCoefToGrate[s%this.proximityCoefToGrate.length];var o=e.graph.getEdge(i[s],n);for(var h=0,l=o;h<l.length;h++){var u=l[h];var c=false;for(var m=0;m<this.IN_graphFamily.length;m++){if(s!=m&&this.proximityMeasurer.isCloseToMe(u,i[m],a)){c=true;break}}if(!c){i[s].push(u);t=true}}}}return i};return t}();t.GraphGrater=i;var r=function(){function t(){this.vertexToLinkLength=new e.HashMap}t.prototype.meanLinksDist=function(t){var i=this.vertexToLinkLength.getValue(t);if(i!=null)return i;var r=0;for(var s=0,n=t.links;s<n.length;s++){var a=n[s];r+=e.geo.distance(t.position,a.to.position)}r/=t.links.length;this.vertexToLinkLength.putValue(t,r);return r};t.prototype.isCloseToMe=function(e,t,i){for(var r=0,s=t;r<s.length;r++){var n=s[r];if(this.areClose(e,n,i))return true}return false};t.prototype.areClose=function(t,i,r){return e.geo.distance(t.position,i.position)<(this.meanLinksDist(t)+this.meanLinksDist(i))/2*r};t.prototype.areFar=function(t,i,r){return e.geo.distance(t.position,i.position)>(this.meanLinksDist(t)+this.meanLinksDist(i))/2*r};return t}();t.ProximityMeasurer=r;var s=function(){function t(e,t){this.verticesToKeepMustBeInMamesh=true;this.constructCutSegment=true;this.takeCareOfPolygons=true;this.addBorderPolygonInsteadOfSuppress=false;this.OUT_BorderPolygon=[];this.OUT_BorderVerticesInside=[];this.OUTBorderVerticesOutside=[];this.mamesh=e;this.verticesToKeep=t}t.prototype.go=function(){var t=this;var i=new e.Mamesh;this.verticesToKeep.forEach(function(e){if(t.mamesh.hasVertex(e)){i.addVertex(e)}else if(t.verticesToKeepMustBeInMamesh)throw'a vertex in the list to keep is not in the original mesh. If you want to allow this, please turn the boolean "verticesToKeepMustBeInMamesh" to false'});for(var r=0;r<this.mamesh.smallestSquares.length;r+=4){var s=0;if(i.hasVertex(this.mamesh.smallestSquares[r]))s++;if(i.hasVertex(this.mamesh.smallestSquares[r+1]))s++;if(i.hasVertex(this.mamesh.smallestSquares[r+2]))s++;if(i.hasVertex(this.mamesh.smallestSquares[r+3]))s++;if(s>0&&s<4)this.OUT_BorderPolygon.push([this.mamesh.smallestSquares[r],this.mamesh.smallestSquares[r+1],this.mamesh.smallestSquares[r+2],this.mamesh.smallestSquares[r+3]]);else if(s==4)i.smallestSquares.push(this.mamesh.smallestSquares[r],this.mamesh.smallestSquares[r+1],this.mamesh.smallestSquares[r+2],this.mamesh.smallestSquares[r+3])}for(var r=0;r<this.mamesh.smallestTriangles.length;r+=3){var s=0;if(i.hasVertex(this.mamesh.smallestTriangles[r]))s++;if(i.hasVertex(this.mamesh.smallestTriangles[r+1]))s++;if(i.hasVertex(this.mamesh.smallestTriangles[r+2]))s++;if(s>0&&s<3)this.OUT_BorderPolygon.push([this.mamesh.smallestTriangles[r],this.mamesh.smallestTriangles[r+1],this.mamesh.smallestTriangles[r+2]]);else if(s==3)i.smallestTriangles.push(this.mamesh.smallestTriangles[r],this.mamesh.smallestTriangles[r+1],this.mamesh.smallestTriangles[r+2])}for(var n=0,a=this.OUT_BorderPolygon;n<a.length;n++){var o=a[n];for(var h=0,l=o;h<l.length;h++){var u=l[h];if(i.hasVertex(u)){if(this.OUT_BorderVerticesInside.indexOf(u)==-1)this.OUT_BorderVerticesInside.push(u)}else{if(this.OUTBorderVerticesOutside.indexOf(u)==-1)this.OUTBorderVerticesOutside.push(u)}}}if(this.takeCareOfPolygons){if(this.addBorderPolygonInsteadOfSuppress){for(var c=0,m=this.OUT_BorderPolygon;c<m.length;c++){var o=m[c];if(o.length==3)i.smallestTriangles.push(o[0],o[1],o[2]);else if(o.length==4)i.smallestSquares.push(o[0],o[1],o[2],o[3])}for(var p=0,f=this.OUTBorderVerticesOutside;p<f.length;p++){var d=f[p];i.addVertex(d)}}else{var v=[];var g=[];for(var r=0;r<this.OUT_BorderVerticesInside.length;r++){var d=this.OUT_BorderVerticesInside[r];var y=false;for(var b=0,w=i.smallestSquares;b<w.length;b++){var u=w[b];if(u.hashNumber==d.hashNumber){y=true;break}}if(!y){for(var M=0,x=i.smallestTriangles;M<x.length;M++){var u=x[M];if(u.hashNumber==d.hashNumber){y=true;break}}}if(!y){g.push(i.vertices.indexOf(d));v.push(r)}}this.OUT_BorderVerticesInside=e.tab.arrayMinusSomeIndices(this.OUT_BorderVerticesInside,v);i.vertices=e.tab.arrayMinusSomeIndices(i.vertices,g)}}if(this.constructCutSegment){for(var C in this.mamesh.cutSegmentsDico){var T=this.mamesh.cutSegmentsDico[C];if(!i.hasVertex(T.a))continue;if(!i.hasVertex(T.b))continue;if(!i.hasVertex(T.middle))continue;i.cutSegmentsDico[C]=T}}return i};return t}();t.SubMameshExtractor=s;var n=function(){function i(e,t){this.markBorder=true;this.suppressFromBorderVersusCorner=true;this.mamesh=e;this.nb=t}i.prototype.go=function(){var i=[];if(this.suppressFromBorderVersusCorner){for(var r=0,s=this.mamesh.vertices;r<s.length;r++){var n=s[r];if(n.hasMark(e.Vertex.Markers.border))i.push(n)}}else{for(var a=0,o=this.mamesh.vertices;a<o.length;a++){var n=o[a];if(n.hasMark(e.Vertex.Markers.corner))i.push(n)}}var h=e.graph.ringify(i);var l=new e.HashMap;if(this.nb<0)this.nb=h.length+this.nb-1;if(this.nb>=h.length-1)throw"you want to suppress too much strates";for(var u=0;u<this.nb;u++){for(var c=0,m=h[u];c<m.length;c++){var p=m[c];l.putValue(p,true)}}var f=[];for(var d=0,v=this.mamesh.vertices;d<v.length;d++){var p=v[d];if(l.getValue(p)==null){f.push(p)}}if(this.markBorder)for(var g=0,y=h[this.nb];g<y.length;g++){var p=y[g];p.markers.push(e.Vertex.Markers.border)}var b=new t.SubMameshExtractor(this.mamesh,f);var w=b.go();return w};return i}();t.ExtractCentralPart=n;var a=function(){function t(e,t){this.receiver=e;this.source=t}t.prototype.checkArgs=function(){if(this.receiver.length%4!=0)throw"receiver is not a list representing squares";if(this.source.length%4!=0)throw"source is not a list representing squares"};t.prototype.go=function(){this.checkArgs();var t=new e.HashMap(true);var i=this.squareToBaryCenter(this.source);var r=this.squareToBaryCenter(this.receiver);for(var s=0;s<i.length;s++){var n=Number.MAX_VALUE;var a=-1;for(var o=0;o<r.length;o++){var h=e.geo.distance(i[s],r[o]);if(h<n){n=h;a=o}}var l=[this.receiver[4*a],this.receiver[4*a+1],this.receiver[4*a+2],this.receiver[4*a+3]];var u=[this.source[4*s],this.source[4*s+1],this.source[4*s+2],this.source[4*s+3]];var c=this.getBestPermutationOfReceiver(l,u);for(var m=0;m<4;m++){t.putValue(u[m],c[m])}}return t};t.prototype.getBestPermutationOfReceiver=function(t,i){var r=Number.MAX_VALUE;var s=-1;for(var n=0;n<4;n++){var a=[t[n],t[(n+1)%4],t[(n+2)%4],t[(n+3)%4]];var o=0;for(var h=0;h<4;h++)o+=e.geo.distance(i[h].position,a[h].position);if(o<r){r=o;s=n}}var l=s;return[t[l],t[(l+1)%4],t[(l+2)%4],t[(l+3)%4]]};t.prototype.squareToBaryCenter=function(t){var i=[];for(var r=0;r<t.length;r+=4){var s=[t[r].position,t[r+1].position,t[r+2].position,t[r+3].position];var n=new e.XYZ(0,0,0);e.geo.baryCenter(s,[1/4,1/4,1/4,1/4],n);i.push(n)}return i};return t}();var o=function(){function t(e,t){this.toleranceToBeOneOfTheClosest=.5;this.proximityCoef=.7;this.acceptOnlyDisjointReceiverAndSource=true;this.receiver=e;this.source=t}t.prototype.checkArgs=function(){if(this.acceptOnlyDisjointReceiverAndSource){var t=new e.HashMap;for(var i=0,r=this.source;i<r.length;i++){var s=r[i];t.putValue(s,true)}for(var n=0,a=this.receiver;n<a.length;n++){var s=a[n];if(t.getValue(s)!=null)throw"source and receiver must be disjoint"}}};t.prototype.go=function(){this.checkArgs();if(this.proximityMeasurer==null)this.proximityMeasurer=new r;this.checkArgs();var t=new e.HashMap(true);for(var i=0,s=this.source;i<s.length;i++){var n=s[i];var a=Number.POSITIVE_INFINITY;var o=new e.HashMap(true);var h=null;for(var l=0,u=this.receiver;l<u.length;l++){var c=u[l];var m=e.geo.distance(n.position,c.position);if(this.proximityMeasurer.areClose(n,c,this.proximityCoef)){o.putValue(c,m);if(m<a){a=m;h=c}}}if(h!=null){var p=[];p.push(h);for(var f=0,d=o.allKeys();f<d.length;f++){var c=d[f];if(c!=h&&o.getValue(c)<=a*(1+this.toleranceToBeOneOfTheClosest)){p.push(c)}}t.putValue(n,p)}}return t};return t}();t.FindSickingMapFromVertices=o;var h=function(){function r(){this.IN_mameshes=[];this.SUB_grater=new i;this.justGrateDoNotStick=false;this.proximityCoefToStick=[2];this.toleranceToBeOneOfTheClosest=.5;this.OUTBorderVerticesToStick=[];this.OUTGratedMameshes=[];this.takeCareOfPolygons=true;this.suppressLinksAngularlyTooClose=true;this.SUB_linkCleanerByAngle=new e.linkModule.LinksSorterAndCleanerByAngles(null,null);this.OUT_stickingMap=new e.HashMap(true);this.SUB_linkCleanerByAngle.suppressLinksAngularParam=2*Math.PI*.1}r.prototype.checkArgs=function(){};r.prototype.goChanging=function(){this.checkArgs();for(var i=0,r=this.IN_mameshes;i<r.length;i++){var s=r[i];for(var n=0,a=s.vertices;n<a.length;n++){var h=a[n];for(var l=0,u=h.links;l<u.length;l++){var m=u[l];m.opposites=null}}}var p=[];this.IN_mameshes.forEach(function(e){return p.push(e.vertices)});this.SUB_grater.IN_graphFamily=p;var f=this.SUB_grater.go();for(var d=0;d<this.IN_mameshes.length;d++){var v=new t.SubMameshExtractor(this.IN_mameshes[d],f[d]);v.takeCareOfPolygons=this.takeCareOfPolygons;v.addBorderPolygonInsteadOfSuppress=false;this.OUTGratedMameshes[d]=v.go();this.OUTBorderVerticesToStick[d]=[];for(var g=0,y=v.OUT_BorderVerticesInside;g<y.length;g++){var b=y[g];for(var w=0,M=b.links;w<M.length;w++){var x=M[w];if(this.IN_mameshes[d].hasVertex(x.to)&&!this.OUTGratedMameshes[d].hasVertex(x.to)){this.OUTBorderVerticesToStick[d].push(b);break}}}this.OUTGratedMameshes[d].isolateMameshVerticesFromExteriorVertices();for(var C=0,T=this.OUTGratedMameshes[d].vertices;C<T.length;C++){var V=T[C];if(V.hasMark(e.Vertex.Markers.border)&&this.OUTBorderVerticesToStick[d].indexOf(V)==-1)this.OUTBorderVerticesToStick[d].push(V)}}var S=this.OUTGratedMameshes[0];for(var k=1;k<this.IN_mameshes.length;k++){var O=new o(S.vertices,this.OUTBorderVerticesToStick[k]);O.toleranceToBeOneOfTheClosest=this.toleranceToBeOneOfTheClosest;O.proximityCoef=this.proximityCoefToStick[k%this.proximityCoefToStick.length];var A=O.go();this.OUT_stickingMap.extend(A);var P=new c(S,this.OUTGratedMameshes[k],A);P.zIndex1=k;P.cleanOppositeLinksAtBegin=false;P.createNewLinks=!this.justGrateDoNotStick;P.goChanging()}S.isolateMameshVerticesFromExteriorVertices();for(var _=0,F=S.vertices;_<F.length;_++){var h=F[_];if(h.links.length==0)throw" grating process produce a vertex with no links"}if(this.suppressLinksAngularlyTooClose){this.SUB_linkCleanerByAngle.mamesh=S;this.SUB_linkCleanerByAngle.goChanging()}return S};return r}();t.ConcurrentMameshesGraterAndSticker=h;var l=function(){function t(t,i){this.nbDistinctPoint=1e3;this.maxDistToBeClose=null;this.throwExceptionIfReceiverHaveCloseVertices=false;this.receiverAndSourceMustBeDisjoint=false;this.deformationFunction=function(e){return e};this.mins=new e.XYZ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.maxs=new e.XYZ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);this.receivers=t;this.sources=i}t.prototype.go=function(){this.buildScaler();var t=new e.XYZ(Math.max(1,this.maxs.x-this.mins.x),Math.max(1,this.maxs.y-this.mins.y),Math.max(1,this.maxs.z-this.mins.z));var i=new e.StringMap;for(var r=0,s=this.receivers;r<s.length;r++){var n=s[r];var a=this.deformationFunction(n.position);var o=Math.round((a.x-this.mins.x)/t.x*this.nbDistinctPoint);var h=Math.round((a.y-this.mins.y)/t.y*this.nbDistinctPoint);var l=Math.round((a.z-this.mins.z)/t.z*this.nbDistinctPoint);var u=o+","+h+","+l;if(i.getValue(u)==null)i.putValue(u,n);else if(this.throwExceptionIfReceiverHaveCloseVertices)throw"the receiver list has several XYZ very close, and you have forbidden that"}var c=new e.HashMap(true);for(var m=0,p=this.sources;m<p.length;m++){var f=p[m];var a=this.deformationFunction(f.position);var o=Math.round((a.x-this.mins.x)/t.x*this.nbDistinctPoint);var h=Math.round((a.y-this.mins.y)/t.y*this.nbDistinctPoint);var l=Math.round((a.z-this.mins.z)/t.z*this.nbDistinctPoint);var d=i.getValue(o+","+h+","+l);if(d!=null){if(d!=f){var v=c.getValue(d);if(v==null)c.putValue(f,[d]);else{if(e.geo.distance(d.position,f.position)<e.geo.distance(d.position,v[0].position)){c.putValue(f,[d].concat(v))}else v.push(d)}}else if(this.receiverAndSourceMustBeDisjoint)throw"receiver-list and source-list are not disjoint, and you have forbidden that"}}return c};t.prototype.buildScaler=function(){var t=this;this.receivers.forEach(function(e){var i=t.deformationFunction(e.position);if(i.x<t.mins.x)t.mins.x=i.x;if(i.y<t.mins.y)t.mins.y=i.y;if(i.z<t.mins.z)t.mins.z=i.z;if(i.x>t.maxs.x)t.maxs.x=i.x;if(i.y>t.maxs.y)t.maxs.y=i.y;if(i.z>t.maxs.z)t.maxs.z=i.z});this.sources.forEach(function(e){var i=t.deformationFunction(e.position);if(i.x<t.mins.x)t.mins.x=i.x;if(i.y<t.mins.y)t.mins.y=i.y;if(i.z<t.mins.z)t.mins.z=i.z;if(i.x>t.maxs.x)t.maxs.x=i.x;if(i.y>t.maxs.y)t.maxs.y=i.y;if(i.z>t.maxs.z)t.maxs.z=i.z});if(this.maxDistToBeClose!=null){this.nbDistinctPoint=e.geo.distance(this.maxs,this.mins)/this.maxDistToBeClose}};return t}();t.FindCloseVerticesFast=l;var u=function(){function t(t,i,r){this.sourceEqualRecepter=false;this.cleanDoubleLinks=false;this.cleanDoubleSquareAndTriangles=true;this.cleanLinksCrossingSegmentMiddle=true;this.suppressSomeTriangleAndSquareSuperposition=false;this.mergeLink=true;this.mergeTrianglesAndSquares=true;this.mergeSegmentsMiddle=true;this.destroySource=true;this.receiverMamesh=t;if(i==null||t==i){this.sourceMamesh=t;this.sourceEqualRecepter=true}else{this.sourceMamesh=i;this.sourceEqualRecepter=false}if(r==null)r=new l(this.receiverMamesh.vertices,this.sourceMamesh.vertices).go();this.merginMap=new e.HashMap(true);for(var s=0,n=r.allEntries();s<n.length;s++){var a=n[s];this.merginMap.putValue(a.key,a.value[0])}}t.prototype.checkArgs=function(){var e=this;if(!this.merginMap.memorizeKeys)throw"the merging map must memorize the keys";this.merginMap.allValues().forEach(function(t){if(e.merginMap.getValue(t)!=null)throw"a vertex cannot be the destination and the source of a merging"})};t.prototype.goChanging=function(){this.checkArgs();if(this.mergeLink)this.mergeVerticesAndLinks();else this.mergeOnlyVertices();if(this.mergeTrianglesAndSquares)this.letsMergeTrianglesAndSquares();if(this.mergeSegmentsMiddle)this.mergeCutSegment();this.receiverMamesh.lines=null;if(this.destroySource&&!this.sourceEqualRecepter)this.sourceMamesh.vertices=null};t.prototype.mergeOnlyVertices=function(){var t=this;if(!this.sourceEqualRecepter)this.receiverMamesh.vertices=this.receiverMamesh.vertices.concat(this.sourceMamesh.vertices);this.receiverMamesh.clearLinksAndLines();this.merginMap.allKeys().forEach(function(i){e.tab.removeFromArray(t.receiverMamesh.vertices,i)})};t.prototype.mergeVerticesAndLinks=function(){var t=this;if(!this.sourceEqualRecepter)this.receiverMamesh.vertices=this.receiverMamesh.vertices.concat(this.sourceMamesh.vertices);this.receiverMamesh.clearOppositeInLinks();this.merginMap.allKeys().forEach(function(e){var i=[];e.links.forEach(function(r){if(t.merginMap.getValue(r.to)==null){if(t.merginMap.getValue(e)!=r.to)i.push(r)}});t.merginMap.getValue(e).links=t.merginMap.getValue(e).links.concat(i)});var i=[];this.receiverMamesh.vertices.forEach(function(e){if(t.merginMap.allKeys().indexOf(e)==-1)i.push(e)});this.receiverMamesh.vertices=i;this.receiverMamesh.vertices.forEach(function(i){var r=null;i.links.forEach(function(e){if(t.merginMap.getValue(e.to)!=null){if(t.merginMap.getValue(e.to)!=i)e.to=t.merginMap.getValue(e.to);else{if(r==null)r=[];r.push(e)}}});if(r!=null){r.forEach(function(t){e.tab.removeFromArray(i.links,t)})}});if(this.cleanDoubleLinks){}};t.prototype.mergeCutSegment=function(){var t=this;if(!this.sourceEqualRecepter){for(var i in this.sourceMamesh.cutSegmentsDico)this.receiverMamesh.cutSegmentsDico[i]=this.sourceMamesh.cutSegmentsDico[i]}for(var i in this.receiverMamesh.cutSegmentsDico){var r=this.receiverMamesh.cutSegmentsDico[i];if(r.a.hashNumber==r.middle.hashNumber||r.b.hashNumber==r.middle.hashNumber||r.a.hashNumber==r.b.hashNumber){delete this.receiverMamesh.cutSegmentsDico[i];continue}var s=false;if(this.merginMap.getValue(r.a)!=null){r.a=this.merginMap.getValue(r.a);s=true}if(this.merginMap.getValue(r.b)!=null){r.b=this.merginMap.getValue(r.b);s=true}if(this.merginMap.getValue(r.middle)!=null){r.middle=this.merginMap.getValue(r.middle);s=true}if(s){delete this.receiverMamesh.cutSegmentsDico[i];this.receiverMamesh.cutSegmentsDico[e.Segment.segmentId(r.a.hashNumber,r.b.hashNumber)]=r}}if(this.cleanLinksCrossingSegmentMiddle){this.receiverMamesh.vertices.forEach(function(i){var r=[];for(var s=0;s<i.links.length;s++){var n=i.links[s];if(t.receiverMamesh.cutSegmentsDico[e.Segment.segmentId(i.hashNumber,n.to.hashNumber)]!=null)r.push(s)}i.links=e.tab.arrayMinusBlocksIndices(i.links,r,1)})}};t.prototype.letsMergeTrianglesAndSquares=function(){if(!this.sourceEqualRecepter){this.receiverMamesh.smallestSquares=this.receiverMamesh.smallestSquares.concat(this.sourceMamesh.smallestSquares);this.receiverMamesh.smallestTriangles=this.receiverMamesh.smallestTriangles.concat(this.sourceMamesh.smallestTriangles)}for(var t=0;t<this.receiverMamesh.smallestTriangles.length;t++){var i=this.receiverMamesh.smallestTriangles[t];if(this.merginMap.getValue(i)!=null)this.receiverMamesh.smallestTriangles[t]=this.merginMap.getValue(i)}var r=[];for(var t=0;t<this.receiverMamesh.smallestTriangles.length;t+=3){if(this.receiverMamesh.smallestTriangles[t]==this.receiverMamesh.smallestTriangles[t+1]||this.receiverMamesh.smallestTriangles[t+1]==this.receiverMamesh.smallestTriangles[t+2]||this.receiverMamesh.smallestTriangles[t+2]==this.receiverMamesh.smallestTriangles[t]){r.push(t)}}this.receiverMamesh.smallestTriangles=e.tab.arrayMinusBlocksIndices(this.receiverMamesh.smallestTriangles,r,3);this.receiverMamesh.smallestTriangles=new e.tab.ArrayMinusBlocksElements(this.receiverMamesh.smallestTriangles,3).go();for(var t=0;t<this.receiverMamesh.smallestSquares.length;t++){var i=this.receiverMamesh.smallestSquares[t];if(this.merginMap.getValue(i)!=null)this.receiverMamesh.smallestSquares[t]=this.merginMap.getValue(i)}var s=[];for(var t=0;t<this.receiverMamesh.smallestSquares.length;t+=4){var n=this.changeOneSquare([this.receiverMamesh.smallestSquares[t],this.receiverMamesh.smallestSquares[t+1],this.receiverMamesh.smallestSquares[t+2],this.receiverMamesh.smallestSquares[t+3]]);if(n==null){s.push(t)}else if(n.length==3){this.receiverMamesh.smallestTriangles.push(n[0],n[1],n[2]);s.push(t)}}this.receiverMamesh.smallestSquares=e.tab.arrayMinusBlocksIndices(this.receiverMamesh.smallestSquares,s,4);if(this.cleanDoubleSquareAndTriangles)this.receiverMamesh.smallestSquares=new e.tab.ArrayMinusBlocksElements(this.receiverMamesh.smallestSquares,4).go();if(this.suppressSomeTriangleAndSquareSuperposition){var a=new e.StringMap;for(var t=0;t<this.receiverMamesh.smallestSquares.length;t+=4){a.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[t].hashNumber,this.receiverMamesh.smallestSquares[t+1].hashNumber,this.receiverMamesh.smallestSquares[t+2].hashNumber]),true);a.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[t+2].hashNumber,this.receiverMamesh.smallestSquares[t+3].hashNumber,this.receiverMamesh.smallestSquares[t].hashNumber]),true);a.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[t].hashNumber,this.receiverMamesh.smallestSquares[t+1].hashNumber,this.receiverMamesh.smallestSquares[t+3].hashNumber]),true);a.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[t+1].hashNumber,this.receiverMamesh.smallestSquares[t+2].hashNumber,this.receiverMamesh.smallestSquares[t+3].hashNumber]),true)}var o=[];for(var t=0;t<this.receiverMamesh.smallestTriangles.length;t+=3){var h=e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestTriangles[t].hashNumber,this.receiverMamesh.smallestTriangles[t+1].hashNumber,this.receiverMamesh.smallestTriangles[t+2].hashNumber]);if(a.getValue(h)){o.push(t,t+1,t+2)}}this.receiverMamesh.smallestTriangles=e.tab.arrayMinusBlocksIndices(this.receiverMamesh.smallestTriangles,o,3);var l=new e.StringMap;for(var t=0;t<this.receiverMamesh.smallestSquares.length;t+=4){l.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[t].hashNumber,this.receiverMamesh.smallestSquares[t+2].hashNumber]),true);l.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[t+1].hashNumber,this.receiverMamesh.smallestSquares[t+3].hashNumber]),true)}var u=[];var c=[];for(var t=0;t<this.receiverMamesh.smallestSquares.length;t+=4){for(var m=0;m<4;m++){var p=[this.receiverMamesh.smallestSquares[t+m].hashNumber,this.receiverMamesh.smallestSquares[t+(m+1)%4].hashNumber];var f=[this.receiverMamesh.smallestSquares[t+(m+1)%4].hashNumber,this.receiverMamesh.smallestSquares[t+(m+2)%4].hashNumber];if(l.getValue(e.tab.indicesUpPermutationToString(p))&&l.getValue(e.tab.indicesUpPermutationToString(f))){u.push(t,t+1,t+2,t+3);c.push(this.receiverMamesh.smallestSquares[t+(m+2)%4],this.receiverMamesh.smallestSquares[t+(m+3)%4],this.receiverMamesh.smallestSquares[t+m%4])}}}if(c.length>0){this.receiverMamesh.smallestSquares=e.tab.arrayMinusBlocksIndices(this.receiverMamesh.smallestSquares,u,4);this.receiverMamesh.smallestTriangles=this.receiverMamesh.smallestTriangles.concat(c)}}};t.prototype.changeOneSquare=function(e){if(e[0]==e[2]||e[1]==e[3])return null;var t=null;var i=0;for(var r=0;r<4;r++){if(e[r]==e[(r+1)%4]){i++;t=r}}if(i==0)return e;if(i>1)return null;if(t==0)return[e[1],e[2],e[3]];if(t==1)return[e[2],e[3],e[0]];if(t==2)return[e[3],e[0],e[1]];if(t==3)return[e[0],e[1],e[2]]};return t}();t.Merger=u;var c=function(){function e(e,t,i){this.createNewLinks=true;this.cleanOppositeLinksAtBegin=true;this.twoMameshes=true;this.zIndex1=Math.random();if(e==t||t==null)this.twoMameshes=false;this.mamesh0=e;if(this.twoMameshes)this.mamesh1=t;else this.mamesh1=null;this.stickingMap=i}e.prototype.checkArgs=function(){if(!this.stickingMap.memorizeKeys)throw"the sticking map must memorize the keys";for(var e=0,t=this.stickingMap.allValues();e<t.length;e++){var i=t[e];for(var r=0,s=i;r<s.length;r++){var n=s[r];if(this.stickingMap.getValue(n)!=null)throw"a vertex cannot be the destination and the source of a sticking"}}};e.prototype.goChanging=function(){if(this.stickingMap.allKeys().length==0)return;this.checkArgs();if(this.cleanOppositeLinksAtBegin){this.mamesh0.clearOppositeInLinks();if(this.twoMameshes)this.mamesh1.clearOppositeInLinks()}if(this.twoMameshes){for(var e=0,t=this.mamesh1.vertices;e<t.length;e++){var i=t[e];i.param.z=this.zIndex1;this.mamesh0.addVertex(i)}this.mamesh0.smallestSquares=this.mamesh0.smallestSquares.concat(this.mamesh1.smallestSquares);this.mamesh0.smallestTriangles=this.mamesh0.smallestTriangles.concat(this.mamesh1.smallestTriangles)}this.mamesh0.cutSegmentsDico={};this.mamesh0.vertexToPositioning=null;this.mamesh0.lines=null;if(this.createNewLinks){for(var r=0,s=this.stickingMap.allKeys();r<s.length;r++){var n=s[r];for(var a=0,o=this.stickingMap.getValue(n);a<o.length;a++){var h=o[a];n.setOneLink(h);h.setOneLink(n)}}}};return e}();t.Sticker=c})(t=e.grateAndGlue||(e.grateAndGlue={}))})(mathis||(mathis={}));var mathis;(function(e){function t(t,i){var r=[];var s=e.roundWithGivenPrecision(100/t,2)+"%";for(var n=0;n<t;n++){var a=document.createElement("canvas");a.id="renderCanvas"+n;a.style.width=s;a.style.height="100%";a.style.backgroundColor="red";i.appendChild(a);r.push(a)}return r}e.nCanvasInOneLine=t;function i(t,i,r){var s=[];i.style.position="relative";var n=e.roundWithGivenPrecision(100/t,4);for(var a=0;a<t;a++){var o=document.createElement("div");o.id="divContainer"+a;o.style.display="inline-block";o.style.position="absolute";o.style.top="0";o.style.left=a*n+"%";o.style.width=n+"%";o.style.height="100%";if(r!=null&&a>0)o.style.borderLeft=r;i.appendChild(o);s.push(o)}return s}e.nDivInOneLine=i;function r(t,i,r){var s=[];var n=[];i.style.position="relative";var a=e.roundWithGivenPrecision(100/t,4);for(var o=0;o<t;o++){var h=document.createElement("div");h.id="divContainer"+o;h.style.display="inline-block";h.style.position="absolute";h.style.top="0";h.style.left=o*a+"%";h.style.width=a+"%";h.style.height="100%";if(r!=null&&o>0)h.style.borderLeft=r;i.appendChild(h);n.push(h);var l=document.createElement("canvas");l.id="renderCanvas"+o;l.style.width="100%";l.style.height="100%";h.appendChild(l);s.push(l)}return{divs:n,canvass:s}}e.nDivContainningCanvasInOneLine=r;function s(e,t,i,r){if(i===void 0){i=true}var s=document.createElement("div");s.style.display="inline-block";s.style.position="absolute";if(i)s.style.bottom="0";else s.style.top="0";s.style.left="0";s.style.width="100%";s.style.height=e;s.style.zIndex=parseInt(t.style.zIndex)+10+"";if(r!=null)s.style.borderTop=r;t.appendChild(s);return s}e.legend=s})(mathis||(mathis={}));var mathis;(function(e){function t(e){var t=[];for(var i in e){if(e.hasOwnProperty(i)){var r=parseInt(i);if(!isNaN(r))t.push(r)}}return t}e.allIntegerValueOfEnume=t;function i(e){var t=[];for(var i in e){if(e.hasOwnProperty(i)&&isNaN(parseInt(i))){t.push(i)}}return t}e.allStringValueOfEnume=i;var r=function(){function e(){this.showTrace=false;this.alreadyWroteWarning=[]}e.prototype.c=function(e,t){if(t===void 0){t=1}if(this.alreadyWroteWarning[e]!=null)this.alreadyWroteWarning[e]++;else this.alreadyWroteWarning[e]=1;if(this.alreadyWroteWarning[e]<=t){if(this.showTrace){var i=new Error;console.log("WARNING",e,"...........................................",i)}else{console.log("WARNING",e)}}};return e}();e.Logger=r;function s(e,t){e*=Math.pow(10,t);e=Math.round(e);e/=Math.pow(10,t);return e}e.roundWithGivenPrecision=s;function n(e,t){t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(i){if(i!=="constructor"){e.prototype[i]=t.prototype[i]}})})}e.applyMixins=n;function a(e,t){var i;if(document.getElementById&&(i=document.getElementById(e))){if(i.style)i.style.cursor=t}}e.setCursorByID=a;var o=function(){function e(){this.millisDuration=0;this.nbTested=0;this.nbOK=0;this.millisDep=performance.now()}e.prototype.computeTime=function(){this.millisDuration=performance.now()-this.millisDep};e.prototype.add=function(e){e.computeTime();this.nbTested+=e.nbTested;this.nbOK+=e.nbOK;this.millisDuration+=e.millisDuration};e.prototype.assertTrue=function(e){this.nbTested++;if(e)this.nbOK++;else{var t=new Error;console.log(t.stack)}};e.prototype.toString=function(){return"nbTest:"+this.nbTested+", nbOK:"+this.nbOK+", millisDuration:"+this.millisDuration.toFixed(2)};return e}();e.Bilan=o;function h(e,t,i){if(i===void 0){i=false}if(t<0)throw"second arg must be positif";var r=0;if(e>=0)r=e%t;else r=t- -e%t;if(i&&r>t/2)r=r-t;if(Math.abs(r-t)<Number.MIN_VALUE*10)r=0;return r}e.modulo=h;function l(e){var t=e.length,i,r;while(t>0){r=Math.floor(Math.random()*t);t--;i=e[t];e[t]=e[r];e[r]=i}return e}e.shuffle=l;var u=function(){function e(e,t){this.key=e;this.value=t}return e}();e.Entry=u;var c=function(){function e(e){if(e===void 0){e=false}this.values={};this.keys={};this.memorizeKeys=e}e.prototype.putValue=function(e,t,i){if(i===void 0){i=true}if(e==null){if(i)throw"key must be non null";else return null}this.values[e.hashString]=t;if(this.memorizeKeys)this.keys[e.hashString]=e};e.prototype.removeKey=function(e){delete this.values[e.hashString];if(this.memorizeKeys)delete this.keys[e.hashString]};e.prototype.getValue=function(e,t){if(t===void 0){t=true}if(e==null){if(t)throw"key must be non null";else return null}return this.values[e.hashString]};e.prototype.allValues=function(){var e=new Array;for(var t in this.values)e.push(this.values[t]);return e};e.prototype.allKeys=function(){if(!this.memorizeKeys)throw"this hashMap has not memorized keys. Please, put args=true in the constructor";var e=new Array;for(var t in this.keys)e.push(this.keys[t]);return e};e.prototype.allEntries=function(){if(!this.memorizeKeys)throw"this hashMap has not memorized keys. Please, put args=true in the constructor";var e=[];for(var t in this.keys)e.push(new u(this.keys[t],this.values[t]));return e};e.prototype.aRandomValue=function(){var e=Object.keys(this.values);return this.values[e[Math.floor(e.length*Math.random())]]};e.prototype.extend=function(e){if(!e.memorizeKeys)throw"cannot extend this  with a HashMap which do not memorize keys";for(var t=0,i=e.allEntries();t<i.length;t++){var r=i[t];this.putValue(r.key,r.value)}};e.prototype.size=function(){var e=0;for(var t in this.values)e++;return e};return e}();e.HashMap=c;var m=function(){function e(){this.values={}}e.prototype.putValue=function(e,t,i){if(i===void 0){i=true}if(e==null){if(i)throw"key must be non null";else return null}this.values[e]=t};e.prototype.removeKey=function(e){delete this.values[e]};e.prototype.getValue=function(e,t){if(t===void 0){t=true}if(e==null){if(t)throw"key must be non null";else return null}return this.values[e]};e.prototype.allValues=function(){var e=new Array;for(var t in this.values)e.push(this.values[t]);return e};e.prototype.allKeys=function(){return Object.keys(this.values)};e.prototype.aRandomValue=function(){var e=Object.keys(this.values);return this.values[e[Math.floor(e.length*Math.random())]]};e.prototype.size=function(){var e=0;for(var t in this.values)e++;return e};e.prototype.__serialize=function(){return this.values};e.prototype.__load=function(e){this.values=e};return e}();e.StringMap=m})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(e){this.cannotOverwriteExistingLines=true;this.startingVertices=null;this.restrictLinesToTheseVertices=null;this.lookAtBifurcation=true;this.mamesh=e}t.prototype.go=function(){if(this.mamesh==null)throw" a null mamesh";if(this.mamesh.vertices==null||this.mamesh.vertices.length==0)throw"no vertices in this mamesh";if(this.mamesh.linesWasMade&&this.cannotOverwriteExistingLines)throw"lines already exist for this mamesh";var t=s(this.mamesh.vertices,this.lookAtBifurcation);var i=[];if(this.startingVertices!=null){var n=new e.HashMap;for(var a=0,o=this.startingVertices;a<o.length;a++){var h=o[a];n.putValue(h,true)}for(var l=0,u=t;l<u.length;l++){var c=u[l];for(var m=0,p=c.vertices;m<p.length;m++){var f=p[m];if(n.getValue(f)!=null){i.push(c);break}}}}else i=t;if(this.restrictLinesToTheseVertices!=null){var d=new r(i,this.restrictLinesToTheseVertices);i=d.go()}this.mamesh.lines=i;return i};return t}();t.LineComputer=i;var r=function(){function t(e,t){this.lines=e;this.vertices=t}t.prototype.go=function(){var t=this;this.allPresentVertices=new e.HashMap;for(var i=0,r=this.vertices;i<r.length;i++){var s=r[i];this.allPresentVertices.putValue(s,true)}var n=[];this.lines.forEach(function(i){if(!i.isLoop){var r=t.cutOneLine(i.vertices);for(var s=0,a=r;s<a.length;s++){var o=a[s];n.push(new e.Line(o,false))}}});this.lines.forEach(function(i){if(i.isLoop){var r=i.vertices;var s=-1;for(var a=0;a<r.length;a++){if(t.allPresentVertices.getValue(r[a])==null){s=a;break}}if(s==-1)n.push(i);else{var o=[];for(var h=0;h<r.length;h++){o.push(r[(h+s)%r.length])}var l=t.cutOneLine(o);for(var u=0,c=l;u<c.length;u++){var m=c[u];n.push(new e.Line(m,false))}}}});return n};t.prototype.cutOneLine=function(e){var t=[];t[0]=[];var i=-1;var r=true;for(var s=0;s<e.length;s++){if(this.allPresentVertices.getValue(e[s])==true){if(!r)t[i].push(e[s]);else{i++;t[i]=[];t[i].push(e[s]);r=false}}else{r=true}}var n=[];t.forEach(function(e){if(e.length>=2)n.push(e)});return n};return t}();t.LinesCuter=r;function s(t,i){var r=new e.HashMap;var s=[];function n(t,a,o,h){var l=a[a.length-1];var u=a[a.length-2];r.putValue(new e.Segment(u,l),true);var c=l.getOpposites(u);if(c==null){if(t)throw"strange : probably, the function makeLineCatalogue2 have as args a non complete graph (call getGroup before)";s.push(new e.Line(a,false))}else if(c.length==0)throw"convention: is no opposite, the array opposite must be null, and not empty";else if(o.getValue(new e.Segment(u,l))==true){s.push(new e.Line(a,false))}else{o.putValue(new e.Segment(u,l),true);var m=c.length;if(!i)m=1;for(var p=0;p<m;p++){var f=c[p];if(f==a[0]){s.push(new e.Line(a,true));r.putValue(new e.Segment(l,a[0]),true)}else{if(p<m-1){var d=new e.HashMap;for(var v=0;v<a.length-1;v++)d.putValue(new e.Segment(a[v],a[v+1]),true);var g=a.concat([f]);n(t,g,d,true)}else{a.push(f);n(t,a,o,h)}}}}}t.forEach(function(t){t.links.forEach(function(s){if(s.opposites==null){if(i||r.getValue(new e.Segment(t,s.to))==null){var a=[t,s.to];var o=new e.HashMap;n(false,a,o,false)}}})});if(i){var a=new e.HashMap;var o=[];for(var h=0,l=s;h<l.length;h++){var u=l[h];if(a.getValue(u)==null)o.push(u);a.putValue(u,true)}s=o}t.forEach(function(t){t.links.forEach(function(i){if(r.getValue(new e.Segment(t,i.to))==null){var s=[t,i.to];var a=new e.HashMap;n(true,s,a,false)}})});return s}t.makeLineCatalogue2=s;var n=function(e){__extends(t,e);function t(){e.call(this,true)}return t}(e.HashMap);var a=function(){function t(e){this.packSymmetricLines=true;this.forSymmetriesUsePositionVersusParam=true;this.useConsecutiveIntegerForPackNumber=true;this.symmetries=null;this.OUT_nbFoundSymmetricLines=0;this.mamesh=e}t.prototype.go=function(){if(!this.mamesh.linesWasMade)throw"no line for this IN_mamesh";var t=[];var i=0;var r=new e.HashMap;for(var s=0,a=this.mamesh.lines;s<a.length;s++){var o=a[s];var h=[];var l=[];for(var u=0,c=o.allSegments();u<c.length;u++){var m=c[u];if(r.getValue(m)!=null)h.push(m);else l.push(m)}if(h.length==0){var p=new n;p.index=i++;for(var f=0,d=o.allSegments();f<d.length;f++){var m=d[f];p.putValue(m,true);r.putValue(m,p)}}else{var v=r.getValue(h[0]);for(var g=1;g<h.length;g++)this.segmentAndHisPackJoinNewPack(h[g],v,r);for(var y=0,b=l;y<b.length;y++){var w=b[y];v.putValue(w,true);r.putValue(w,v)}}}if(this.symmetries!=null){e.XYZ.nbDecimalForHash=1;var M=new e.StringMap;for(var g=0;g<this.mamesh.lines.length;g++){var o=this.mamesh.lines[g];var x=o.hashStringUpToSymmetries(this.symmetries,this.forSymmetriesUsePositionVersusParam);var C=M.getValue(x);if(C==null)M.putValue(x,r.getValue(new e.Segment(o.vertices[0],o.vertices[1])));else{this.OUT_nbFoundSymmetricLines++;var T=r.getValue(new e.Segment(o.vertices[0],o.vertices[1]));if(T.size()==C.size())T.index=C.index}}e.XYZ.nbDecimalForHash=5}for(var g=0;g<this.mamesh.lines.length;g++){var o=this.mamesh.lines[g];t[g]=r.getValue(new e.Segment(o.vertices[0],o.vertices[1])).index}if(this.useConsecutiveIntegerForPackNumber&&this.packSymmetricLines){var V=[];var S=e.tab.maxIndexOfNumericList(t);var k=t[S];var O=0;for(var A=0;A<=k;A++){var P=false;for(var _=0;_<t.length;_++){if(t[_]==A){V[_]=A-O;P=true}}if(!P)O++}t=V}var F=new e.HashMap;for(var g=0;g<this.mamesh.lines.length;g++){F.putValue(this.mamesh.lines[g],t[g])}return F};t.prototype.segmentAndHisPackJoinNewPack=function(e,t,i){var r=i.getValue(e);for(var s=0,n=r.allKeys();s<n.length;s++){var a=n[s];t.putValue(a,true);i.putValue(a,t)}i.putValue(e,t)};return t}();t.CreateAColorIndexRespectingBifurcationsAndSymmetries=a})(t=e.lineModule||(e.lineModule={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(e){this.mamesh=e}t.prototype.goChanging=function(){this.mamesh.clearLinksAndLines();var t=new e.StringMap;for(var i=0,r=this.mamesh.polygons;i<r.length;i++){var s=r[i];for(var n=0;n<s.length;n++){var a=e.Segment.segmentId(s[n].hashNumber,s[(n+1)%s.length].hashNumber);if(t.getValue(a)==null){t.putValue(a,true);s[n].setOneLink(s[(n+1)%s.length]);s[(n+1)%s.length].setOneLink(s[n])}}}};return t}();t.SimpleLinkFromPolygonCreator=i;var r=function(){function t(e,t){this.normals=t;this.suppressLinksAngularlyTooCloseVersusNot=true;this.suppressLinksAngularParam=2*Math.PI*.1;this.keepShorterLinksVersusGiveSomePriorityToLinksWithOpposite=true;this.mamesh=e}t.prototype.goChanging=function(){var t=this;if(this.mamesh==null)throw"mamesh is null";if(this.normals==null)this.vertexToPositioning=new e.mameshAroundComputations.PositioningComputerForMameshVertices(this.mamesh).go();else if(this.normals instanceof e.HashMap)this.vertexToPositioning=this.normals;else if(this.normals instanceof e.XYZ){this.vertexToPositioning=new e.HashMap;var i=new e.Positioning;i.upVector=this.normals;for(var r=0,s=this.mamesh.vertices;r<s.length;r++){var n=s[r];this.vertexToPositioning.putValue(n,i)}}this.mamesh.vertices.forEach(function(i){var r=[];for(var s=0;s<i.links.length;s++){r[s]=new e.XYZ(0,0,0).copyFrom(i.links[s].to.position).substract(i.position);if(r[s].length()<e.geo.epsilon)throw"a IN_mamesh with two voisins at the same position"}var n=[];n.push({angle:0,i:0});var a=t.vertexToPositioning.getValue(i).upVector;for(var s=1;s<i.links.length;s++){n.push({angle:e.geo.angleBetweenTwoVectorsBetweenMinusPiAndPi(r[0],r[s],a),i:s})}n.sort(function(e,t){return e.angle-t.angle});var o=[];for(var h=0;h<n.length;h++){o.push(i.links[n[h].i])}i.links=o});if(this.suppressLinksAngularlyTooCloseVersusNot)this.letsSuppressLinks()};t.prototype.letsSuppressLinks=function(){for(var t=0,i=this.mamesh.vertices;t<i.length;t++){var r=i[t];var s=0;var n=true;while(n&&r.links.length>=2){n=false;for(var a=s;a<s+r.links.length;a++){var o=a%r.links.length;var h=(a+1)%r.links.length;var l=e.XYZ.newFrom(r.links[o].to.position).substract(r.position);var u=e.XYZ.newFrom(r.links[h].to.position).substract(r.position);var c=e.geo.angleBetweenTwoVectorsBetween0andPi(l,u);if(c<this.suppressLinksAngularParam){var m=e.geo.distance(r.position,r.links[o].to.position);var p=e.geo.distance(r.position,r.links[h].to.position);var f=void 0;if(this.keepShorterLinksVersusGiveSomePriorityToLinksWithOpposite){if(m<p)f=r.links[h];else f=r.links[o]}else{var d=m/(m+p);if(d<.6&&d>.4){if(r.links[h].opposites==null&&r.links[o].opposites!=null)f=r.links[h];else f=r.links[o]}else{if(m<p)f=r.links[h];else f=r.links[o]}}e.Vertex.separateTwoVoisins(r,f.to);n=true;s=h+1;break}}}}};return t}();t.LinksSorterAndCleanerByAngles=r;var s=function(){function t(e){this.maxAngleToAssociateLinks=Math.PI*.3;this.clearAllExistingOppositeBefore=false;this.canCreateBifurcations=true;this.doNotBranchOnBorder=false;this.OUT_nbBranching=0;this.vertices=e}t.prototype.associateOppositeLinks=function(){var t=this;var i=[];this.vertices.forEach(function(i){var r=0;for(var s=0,n=i.links;s<n.length;s++){var a=n[s];if(a.opposites==null)r++}var o=[];for(var h=0;h<i.links.length;h++){o[h]=new e.XYZ(0,0,0).copyFrom(i.links[h].to.position).substract(i.position);if(o[h].lengthSquared()<e.geo.epsilonSquare)throw"the IN_mamesh has two voisins at the same position"}var l=[];var u=[];for(var h=0;h<i.links.length;h++){u[h]=Number.POSITIVE_INFINITY;for(var c=h+1;c<i.links.length;c++){var m=Math.abs(e.modulo(e.geo.angleBetweenTwoVectorsBetween0andPi(o[h],o[c])-Math.PI,Math.PI*2,true));if(m<t.maxAngleToAssociateLinks&&(i.links[h].opposites==null&&i.links[c].opposites==null)){if(m<u[h])u[h]=m;l.push({angle:m,i:h,j:c})}}}l.sort(function(e,t){return t.angle-e.angle});if(!t.canCreateBifurcations||t.doNotBranchOnBorder&&i.hasMark(e.Vertex.Markers.border)){while(l.length>0){var p=l.pop();var f=i.links[p.i];var d=i.links[p.j];f.opposites=[d];d.opposites=[f];l=e.tab.arrayMinusElements(l,function(e){return e.i==p.i||e.j==p.i||e.i==p.j||e.j==p.j})}}else{while(l.length>0){var p=l.pop();var v=l[l.length-1];var f=void 0;var d=void 0;var g=void 0;if(r==3&&v!=null){if(p.i==v.i){f=i.links[p.i];d=i.links[p.j];g=i.links[v.j]}else if(p.i==v.j){f=i.links[p.i];d=i.links[p.j];g=i.links[v.i]}else if(p.j==v.i){f=i.links[p.j];d=i.links[p.i];g=i.links[v.j]}else if(p.j==v.j){f=i.links[p.j];d=i.links[p.i];g=i.links[v.i]}else{f=i.links[p.i];d=i.links[p.j]}}else{f=i.links[p.i];d=i.links[p.j]}if(g==null){f.opposites=[d];d.opposites=[f];l=e.tab.arrayMinusElements(l,function(e){return e.i==p.i||e.j==p.i||e.i==p.j||e.j==p.j});r-=2}else{t.OUT_nbBranching++;l.pop();f.opposites=[d,g];d.opposites=[f];g.opposites=[f];r-=1;l=e.tab.arrayMinusElements(l,function(e){return e.i==p.i||e.j==p.i||e.i==p.j||e.j==p.j||e.i==v.i||e.j==v.i||e.i==v.j||e.j==v.j})}}}})};t.prototype.goChanging=function(){if(this.clearAllExistingOppositeBefore){this.vertices.forEach(function(e){e.links.forEach(function(e){e.opposites=null})})}if(this.maxAngleToAssociateLinks!=null)this.associateOppositeLinks()};return t}();t.OppositeLinkAssocierByAngles=s;var n=function(){function t(t){this.interiorTJonction=new e.HashMap;this.borderTJonction=new e.HashMap;this.forcedOpposite=new e.HashMap;this.polygonesAroundEachVertex=new e.HashMap;this.polygones=[];this.markIsolateVertexAsCorner=true;this.markBorder=true;this.forceOppositeLinksAtCorners=false;this.mamesh=t}t.prototype.goChanging=function(){this.checkArgs();this.createPolygonesFromSmallestTrianglesAnSquares();this.detectBorder();this.createLinksTurningAround();this.makeLinksFinaly()};t.prototype.checkArgs=function(){if((this.mamesh.smallestSquares==null||this.mamesh.smallestSquares.length==0)&&(this.mamesh.smallestTriangles==null||this.mamesh.smallestTriangles.length==0))throw"no triangles nor squares given";this.mamesh.clearLinksAndLines()};t.prototype.createPolygonesFromSmallestTrianglesAnSquares=function(){var t=this;for(var i=0;i<this.mamesh.smallestTriangles.length;i+=3){this.polygones.push(new a([this.mamesh.smallestTriangles[i],this.mamesh.smallestTriangles[i+1],this.mamesh.smallestTriangles[i+2]]))}for(var i=0;i<this.mamesh.smallestSquares.length;i+=4){this.polygones.push(new a([this.mamesh.smallestSquares[i],this.mamesh.smallestSquares[i+1],this.mamesh.smallestSquares[i+2],this.mamesh.smallestSquares[i+3]]))}for(var r=0,s=this.polygones;r<s.length;r++){var n=s[r];var o=n.points.length;for(var i=0;i<o;i++){var h=n.points[i%o];var l=n.points[(i+1)%o];this.subdivideSegment(n,h,l,this.mamesh.cutSegmentsDico)}}this.mamesh.vertices.forEach(function(e){t.polygonesAroundEachVertex.putValue(e,new Array)});this.polygones.forEach(function(e){e.points.forEach(function(i){t.polygonesAroundEachVertex.getValue(i).push(e)})});if(this.markIsolateVertexAsCorner){this.mamesh.vertices.forEach(function(i){if(t.polygonesAroundEachVertex.getValue(i).length==1){i.markers.push(e.Vertex.Markers.corner);e.logger.c("new corners was added when we automatically create then links from the triangulatedRect/square")}})}};t.prototype.detectBorder=function(){var t=this;for(var i=0;i<this.mamesh.vertices.length;i++){var r=this.mamesh.vertices[i];var s=this.polygonesAroundEachVertex.getValue(r);var n=new e.HashMap(true);for(var a=0,o=s;a<o.length;a++){var h=o[a];var l=h.theTwoAnglesAdjacentFrom(r);var u=l[0];var c=l[1];if(n.getValue(u)==null)n.putValue(u,1);else n.putValue(u,n.getValue(u)+1);if(n.getValue(c)==null)n.putValue(c,1);else n.putValue(c,n.getValue(c)+1)}var m=0;n.allKeys().forEach(function(i){if(n.getValue(i)==1){m++;if(t.borderTJonction.getValue(r)==null){t.borderTJonction.putValue(r,new Array);if(t.markBorder)r.markers.push(e.Vertex.Markers.border)}t.borderTJonction.getValue(r).push(i)}else if(n.getValue(i)>2)throw" non conform mesh: a link appear strictly more than 2 times as side of polygones turning around a vertex   "});if(!(m==0||m==2))throw"strange mesh (perhaps too holy): the vertex: "+r.toString(0)+" has:"+m+" link with multiplicity 1"}};t.prototype.createLinksTurningAround=function(){var t=this;var i=function(i,r){var s=t.mamesh.cutSegmentsDico[e.Segment.segmentId(i.hashNumber,r.hashNumber)];if(s!=null){if(t.interiorTJonction.getValue(s.middle)!=null){console.log("attention, une double interiorTjonction")}else t.interiorTJonction.putValue(s.middle,true);t.forcedOpposite.putValue(s.middle,[i,r])}};for(var r=0,s=this.polygones;r<s.length;r++){var n=s[r];var a=n.points.length;if(a>3){if(a==4){i(n.points[0],n.points[2]);i(n.points[1],n.points[3])}else{for(var o=0;o<a;o++){var h=n.points[o];var l=n.points[(o+2)%a];i(h,l)}}}}this.mamesh.vertices.forEach(function(i){var r=t.polygonesAroundEachVertex.getValue(i);if(t.borderTJonction.getValue(i)!=null&&t.interiorTJonction.getValue(i)!=null)throw"a vertex cannot be a interior and border T-jonction";if(t.borderTJonction.getValue(i)==null){var s=r[0];if(s==null)e.logger.c("some vertex was not around a square/triangulatedRect");else t.createLinksTurningFromOnePolygone(i,s,r,false)}else{var n=t.findAPolygoneWithOrientedEdge(i,t.borderTJonction.getValue(i)[0],r);if(n==null)n=t.findAPolygoneWithOrientedEdge(i,t.borderTJonction.getValue(i)[1],r);t.createLinksTurningFromOnePolygone(i,n,r,true)}})};t.prototype.makeLinksFinaly=function(){var t=this;this.mamesh.vertices.forEach(function(i){if(t.forceOppositeLinksAtCorners||!i.hasMark(e.Vertex.Markers.corner)){var r=i.links.length;if(t.borderTJonction.getValue(i)!=null){var s=i.links[0];var n=i.links[r-1];s.opposites=[n];n.opposites=[s]}else{if(r%2==0){for(var a=0;a<r;a++){var s=i.links[a];var n=i.links[(a+r/2)%r];s.opposites=[n];n.opposites=[s]}}if(t.forcedOpposite.getValue(i)!=null){var o=t.forcedOpposite.getValue(i)[0];var h=t.forcedOpposite.getValue(i)[1];i.changeToLinkWithoutOpposite(o);i.changeToLinkWithoutOpposite(h);i.setTwoOppositeLinks(o,h)}}}})};t.prototype.findAPolygoneWithOrientedEdge=function(e,t,i){for(var r=0,s=i;r<s.length;r++){var n=s[r];var a=n.points.length;for(var o=0;o<a;o++){if(n.points[o%a].hashNumber==e.hashNumber&&n.points[(o+1)%a].hashNumber==t.hashNumber)return n}}return null};t.prototype.findAPolygoneWithThisEdge=function(t,i,r){for(var s=0,n=r;s<n.length;s++){var a=n[s];var o=a.points.length;for(var h=0;h<o;h++){var l=e.Segment.segmentId(a.points[h%o].hashNumber,a.points[(h+1)%o].hashNumber);var u=e.Segment.segmentId(t.hashNumber,i.hashNumber);if(l==u)return a}}return null};t.prototype.createLinksTurningFromOnePolygone=function(t,i,r,s){var n=i.theOutgoingAnglesAdjacentFrom(t);var a=i;var o=true;while(r.length>0){t.links.push(new e.Link(n));if(o)n=a.theIngoingAnglesAdjacentFrom(t);else{var h=a.theTwoAnglesAdjacentFrom(t);if(h[0].hashNumber==n.hashNumber)n=h[1];else n=h[0]}e.tab.removeFromArray(r,a);a=this.findAPolygoneWithOrientedEdge(t,n,r);if(a==null){a=this.findAPolygoneWithOrientedEdge(n,t,r);o=false}}if(s){t.links.push(new e.Link(n))}};t.prototype.subdivideSegment=function(t,i,r,s){var n=s[e.Segment.segmentId(i.hashNumber,r.hashNumber)];if(n!=null){var a=t.points.indexOf(i);var o=t.points.indexOf(r);var h=Math.min(a,o);var l=Math.max(a,o);if(l==t.points.length-1&&h==0)t.points.splice(length,0,n.middle);else t.points.splice(h+1,0,n.middle);this.subdivideSegment(t,i,n.middle,s);this.subdivideSegment(t,r,n.middle,s)}};return t}();t.LinkCreaterSorterAndBorderDetecterByPolygons=n;var a=function(){function e(e){this.points=e}e.prototype.hasAngle=function(e){for(var t=0,i=this.points;t<i.length;t++){var r=i[t];if(r.hashNumber==e.hashNumber)return true}return false};e.prototype.theOutgoingAnglesAdjacentFrom=function(e){var t=this.points.length;for(var i=0;i<t;i++){if(this.points[i]==e){return this.points[(i+1)%t]}}throw"we do not find the point in this polygone"};e.prototype.theIngoingAnglesAdjacentFrom=function(e){var t=this.points.length;for(var i=0;i<t;i++){if(this.points[i]==e){return this.points[(i-1+t)%t]}}throw"we do not find the point in this polygone"};e.prototype.theTwoAnglesAdjacentFrom=function(e){var t=this.points.length;for(var i=0;i<t;i++){if(this.points[i]==e){return[this.points[(i-1+t)%t],this.points[(i+1)%t]]}}throw"we do not find the point in this polygone"};e.prototype.toString=function(){var e="[";for(var t=0,i=this.points;t<i.length;t++){var r=i[t];e+=r.hashNumber+","}return e+"]"};return e}();t.Polygone=a})(t=e.linkModule||(e.linkModule={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=BABYLON.Tools;var r=BABYLON.Collider;var s=function(t){__extends(s,t);function s(s,o){t.call(this,name,new BABYLON.Vector3(0,0,-10),s.scene);this.translationSpeed=1;this.checkCollisions=false;this.showPredefinedConsoleLog=false;this.grabbers=[];this.useOnlyFreeMode=false;this.useFreeModeWhenCursorOutOfGrabber=true;this.onGrabberChange=null;this.onTranslate=null;this.tooSmallAngle=.001;this.tooBigAngle=.3;this.cumulatedAngle=0;this.relativeCursorPositionOnGrabber=new e.XYZ(0,0,0);this.cursorPositionOnGrabberOld=new e.XYZ(0,0,0);this.angleOfRotationAroundGrabber=0;this.axeOfRotationAroundGrabber=new e.XYZ(0,0,0);this.camDir=new e.XYZ(0,0,0);this.oldCamDir=new e.XYZ(0,0,0);this.angleForCamRot=0;this.axisForCamRot=new e.XYZ(0,0,0);this.myNullVector=new e.XYZ(123,234,345);this.frozonProjectionMatrix=new e.MM;this.frozonViewMatrix=new e.MM;this.pickingRay={origin:new e.XYZ(0,0,0),direction:new e.XYZ(0,0,0)};this.aPartOfTheFrontDir=new e.XYZ(0,0,0);this.whishedCamPos=new a(this);this.trueCamPos=new n(this);this._paralDisplacement=new e.XYZ(0,0,0);this._matrixRotationAroundCam=new e.MM;this._matrixRotationAroundZero=new e.MM;this.camRelativePos=new e.XYZ(0,0,0);this._collider=new r;this.correctionToRecenter=new e.XYZ(0,0,0);this._deltaPosition=new e.XYZ(0,0,0);this._popo=new e.XYZ(0,0,0);this._babylonRay=new BABYLON.Ray(new BABYLON.Vector3(0,0,0),new BABYLON.Vector3(0,0,1));this.pointerIsOnCurrentGrabber=false;this._tempCN=new e.XYZ(0,0,0);this._end=new e.XYZ(0,0,0);this.pointerIsDown=false;this._lookForTheBestGrabber=true;this._target=e.XYZ.newZero();this.viewMM=new e.MM;this._keys=[];this.keysUp=[38];this.keysDown=[40];this.keysLeft=[37];this.keysRight=[39];this.keysFrontward=[];this.keysBackward=[];this._axeForKeyRotation=new e.XYZ(0,0,0);this._additionnalVec=new e.XYZ(0,0,0);this.wheelPrecision=1;this.eventPrefix=i.GetPointerPrefix();this.scene=s.scene;e.geo.copyXYZ(this.myNullVector,this.cursorPositionOnGrabberOld);e.geo.copyXYZ(this.myNullVector,this.oldCamDir);this.$canvasElement=s.canvas;this.toogleIconCursor("cursorDefault");this.replaceTheFirstGrabber(o);this.attachControl(s.canvas)}s.prototype.changePosition=function(e,t){if(t===void 0){t=true}this.whishedCamPos.changePosition(e);if(!t){this.trueCamPos.position=e}};s.prototype.changeFrontDir=function(e,t){if(t===void 0){t=true}this.whishedCamPos.changeFrontDir(e);if(!t){this.trueCamPos.changeFrontDir(e)}};s.prototype.changeUpVector=function(e,t){if(t===void 0){t=true}this.whishedCamPos.changeUpVector(e);if(!t){this.trueCamPos.changeUpVector(e)}};s.prototype.addGrabber=function(e){e.checkArgs();this.grabbers.push(e)};s.prototype.replaceTheFirstGrabber=function(e){if(this.grabbers[0]!=null)this.grabbers[0].dispose();e.checkArgs();e.grabberCamera=this;this.grabbers[0]=e;this.currentGrabber=this.grabbers[0]};s.prototype.freeRotation=function(){if(this.showPredefinedConsoleLog)console.log("free rotation angle",this.angleForCamRot.toFixed(4));this.rotate(this.axisForCamRot,this.angleForCamRot);this.toogleIconCursor("cursorMove")};s.prototype.grabberMovement=function(){if(this.currentGrabber.parallelDisplacementInsteadOfRotation){this._paralDisplacement.copyFrom(this.relativeCursorPositionOnGrabber).substract(this.cursorPositionOnGrabberOld).scale(-1);this._paralDisplacement.add(this.whishedCamPos.getPosition());this.whishedCamPos.changePosition(this._paralDisplacement)}else{if(this.showPredefinedConsoleLog)console.log("grabber rotation angle",this.angleOfRotationAroundGrabber.toFixed(4));this.rotateAroundCenter(this.axeOfRotationAroundGrabber,this.angleOfRotationAroundGrabber,this.currentGrabber.referenceCenter)}this.toogleIconCursor("cursorGrabbing");if(this.currentGrabber.showGrabberOnlyWhenGrabbing)this.currentGrabber.mesh.visibility=1};s.prototype.mixedRotation=function(e){if(this.showPredefinedConsoleLog)console.log("free rotation angle",this.angleForCamRot.toFixed(4),"grabber rotation angle",this.angleOfRotationAroundGrabber.toFixed(4));this.twoRotations(this.axisForCamRot,this.angleForCamRot,this.axeOfRotationAroundGrabber,this.angleOfRotationAroundGrabber,e);this.toogleIconCursor("cursorGrabbing");if(this.currentGrabber.showGrabberOnlyWhenGrabbing)this.currentGrabber.mesh.visibility=1};s.prototype.rotate=function(t,i){e.geo.axisAngleToMatrix(t,i,this._matrixRotationAroundCam);e.geo.multiplicationMatrixVector(this._matrixRotationAroundCam,this.whishedCamPos.frontDir,this.whishedCamPos.frontDir);e.geo.multiplicationMatrixVector(this._matrixRotationAroundCam,this.whishedCamPos.upVector,this.whishedCamPos.upVector)};s.prototype.rotateAroundCenter=function(t,i,r){if(this.currentGrabber.referenceCenter==null)return;e.geo.axisAngleToMatrix(t,i,this._matrixRotationAroundZero);e.geo.multiplicationMatrixVector(this._matrixRotationAroundZero,this.whishedCamPos.frontDir,this.whishedCamPos.frontDir);e.geo.multiplicationMatrixVector(this._matrixRotationAroundZero,this.whishedCamPos.upVector,this.whishedCamPos.upVector);this.camRelativePos.copyFrom(this.whishedCamPos.getPosition()).substract(r);e.geo.multiplicationMatrixVector(this._matrixRotationAroundZero,this.camRelativePos,this.camRelativePos);this.camRelativePos.add(r);this.whishedCamPos.changePosition(this.camRelativePos)};s.prototype.twoRotations=function(e,t,i,r,s){this.rotate(e,t*(1-s));this.rotateAroundCenter(i,r*s,this.currentGrabber.referenceCenter)};s.prototype.translateCam=function(t){var i=t*this.translationSpeed;if(t<0&&this.currentGrabber.focusOnMyCenterWhenCameraGoDownWard&&this.currentGrabber.referenceCenter!=null){var r=Math.min(1,e.geo.distance(this.whishedCamPos.getPosition(),this.currentGrabber.referenceCenter)/this.currentGrabber.endOfZone3);r=r*r*.1;e.geo.scale(this.whishedCamPos.frontDir,1-r,this.aPartOfTheFrontDir);e.geo.substract(this.currentGrabber.referenceCenter,this.whishedCamPos.getPosition(),this.correctionToRecenter);if(this.correctionToRecenter.lengthSquared()>e.geo.epsilon){e.geo.normalize(this.correctionToRecenter,this.correctionToRecenter);e.geo.scale(this.correctionToRecenter,r,this.correctionToRecenter);e.geo.add(this.correctionToRecenter,this.aPartOfTheFrontDir,this.aPartOfTheFrontDir)}this.whishedCamPos.changeFrontDir(this.aPartOfTheFrontDir)}if(i!=0){e.geo.scale(this.whishedCamPos.frontDir,i,this._deltaPosition);e.geo.add(this.whishedCamPos.getPosition(),this._deltaPosition,this._popo);this.whishedCamPos.changePosition(this._popo);if(this.onTranslate!=null)this.onTranslate()}};s.prototype.onPointerMove=function(t,i){if(!this.pointerIsDown)return;var r=true;var s=true;this.createPickingRayWithFrozenCamera(t,i,this.currentGrabber.mesh.getWorldMatrix(),this.frozonViewMatrix,this.frozonProjectionMatrix,this.pickingRay);e.geo.copyXYZ(this.pickingRay.direction,this.camDir);this._babylonRay.direction=this.pickingRay.direction;this._babylonRay.origin=this.pickingRay.origin;var n=this.currentGrabber.mesh.intersects(this._babylonRay,false);this.pointerIsOnCurrentGrabber=n.hit;var a=n.distance;if(this.pointerIsOnCurrentGrabber){this.relativeCursorPositionOnGrabber.x=n.pickedPoint.x;this.relativeCursorPositionOnGrabber.y=n.pickedPoint.y;this.relativeCursorPositionOnGrabber.z=n.pickedPoint.z}if(this.currentGrabber.referenceCenter!=null)this.relativeCursorPositionOnGrabber.substract(this.currentGrabber.referenceCenter);var o=this.currentGrabber.interpolationCoefAccordingToCamPosition(this.trueCamPos.position,a);if(this.showPredefinedConsoleLog)console.log("alpha",o);if(e.geo.xyzEquality(this.oldCamDir,this.myNullVector)){e.geo.copyXYZ(this.camDir,this.oldCamDir);s=false}if(e.geo.xyzEquality(this.cursorPositionOnGrabberOld,this.myNullVector)){if(this.pointerIsOnCurrentGrabber){e.geo.copyXYZ(this.relativeCursorPositionOnGrabber,this.cursorPositionOnGrabberOld)}r=false}else if(!this.pointerIsOnCurrentGrabber){e.geo.copyXYZ(this.myNullVector,this.cursorPositionOnGrabberOld);r=false}if(s){this.angleForCamRot=e.geo.angleBetweenTwoVectorsBetween0andPi(this.camDir,this.oldCamDir);if(this.angleForCamRot>this.tooSmallAngle){e.geo.cross(this.camDir,this.oldCamDir,this.axisForCamRot);e.geo.normalize(this.axisForCamRot,this.axisForCamRot)}else s=false}if(r){this.angleOfRotationAroundGrabber=e.geo.angleBetweenTwoVectorsBetween0andPi(this.relativeCursorPositionOnGrabber,this.cursorPositionOnGrabberOld);if(this.angleOfRotationAroundGrabber>this.tooSmallAngle){e.geo.cross(this.relativeCursorPositionOnGrabber,this.cursorPositionOnGrabberOld,this.axeOfRotationAroundGrabber);this.axeOfRotationAroundGrabber.normalize()}else r=false}if(r&&this.angleOfRotationAroundGrabber>this.tooBigAngle){console.log("a too big angle around zero : ignored"+this.angleOfRotationAroundGrabber.toFixed(4));e.geo.copyXYZ(this.relativeCursorPositionOnGrabber,this.cursorPositionOnGrabberOld);return}if(this.useOnlyFreeMode&&s)this.freeRotation();else if(this.pointerIsOnCurrentGrabber){if(o==0){if(s)this.freeRotation()}else if(o<1&&o>0){if(s&&r){this.mixedRotation(o)}else if(r)this.grabberMovement()}else if(o==1&&r)this.grabberMovement()}else if(this.useFreeModeWhenCursorOutOfGrabber&&s)this.freeRotation();if(r)e.geo.copyXYZ(this.relativeCursorPositionOnGrabber,this.cursorPositionOnGrabberOld);if(s)e.geo.copyXYZ(this.camDir,this.oldCamDir);if(r)this.cumulatedAngle+=this.angleOfRotationAroundGrabber;if(s)this.cumulatedAngle+=this.angleForCamRot;if(this.cumulatedAngle>Math.PI/12){e.geo.copyMat(this.getProjectionMatrix(),this.frozonProjectionMatrix);e.geo.copyMat(this.getViewMatrix(),this.frozonViewMatrix);this.cumulatedAngle=0;e.geo.copyXYZ(this.myNullVector,this.oldCamDir);e.geo.copyXYZ(this.myNullVector,this.cursorPositionOnGrabberOld);if(this.showPredefinedConsoleLog)console.log("nouvelles matrices enregistrées")}};s.prototype.createPickingRayWithFrozenCamera=function(e,t,i,r,s,n){var a=this.getEngine();var o=this.viewport;var h=o.toGlobal(a.getRenderWidth(),a.getRenderHeight());e=e/a.getHardwareScalingLevel()-h.x;t=t/a.getHardwareScalingLevel()-(a.getRenderHeight()-h.y-h.height);this.createNewRay(e,t,h.width,h.height,i,r,s,n)};s.prototype.createNewRay=function(t,i,r,s,n,a,o,h){e.geo.unproject(e.geo.copyXyzFromFloat(t,i,0,this._tempCN),r,s,n,a,o,h.origin);e.geo.unproject(e.geo.copyXyzFromFloat(t,i,1,this._tempCN),r,s,n,a,o,this._end);e.geo.substract(this._end,h.origin,h.direction);e.geo.normalize(h.direction,h.direction)};s.prototype.onPointerDown=function(t,i){this.pointerIsDown=true;e.geo.copyMat(this.getProjectionMatrix(),this.frozonProjectionMatrix);e.geo.copyMat(this.getViewMatrix(),this.frozonViewMatrix);this.cumulatedAngle=0;if(this._lookForTheBestGrabber&&this.grabbers.length>1){this.lookForTheBestGrabber(t,i);this._lookForTheBestGrabber=false}};s.prototype.lookForTheBestGrabber=function(t,i){var r=Number.POSITIVE_INFINITY;var s=null;for(var n=0,a=this.grabbers;n<a.length;n++){var o=a[n];this.createPickingRayWithFrozenCamera(t,i,o.mesh.getWorldMatrix(),this.frozonViewMatrix,this.frozonProjectionMatrix,this.pickingRay);e.geo.copyXYZ(this.pickingRay.direction,this.camDir);this._babylonRay.direction=this.pickingRay.direction;this._babylonRay.origin=this.pickingRay.origin;var h=o.mesh.intersects(this._babylonRay,true);if(h.hit){if(h.distance<r){r=h.distance;s=o}}}if(s!=null&&s!=this.currentGrabber){if(this.onGrabberChange!=null)this.onGrabberChange(this.currentGrabber,s);this.currentGrabber=s;console.log("we have changed grabber, the new one is: ",s.name)}};s.prototype.onPointerUp=function(){this._lookForTheBestGrabber=true;this.toogleIconCursor("cursorDefault");if(this.currentGrabber.showGrabberOnlyWhenGrabbing)this.currentGrabber.mesh.visibility=0;this.pointerIsDown=false;e.geo.copyXYZ(this.myNullVector,this.oldCamDir);e.geo.copyXYZ(this.myNullVector,this.cursorPositionOnGrabberOld)};s.prototype.reset=function(){this._keys=[]};s.prototype.toogleIconCursor=function(e){if(this.cursorActualStyle!=e){this.$canvasElement.className=e;this.cursorActualStyle=e}};s.prototype._isSynchronizedViewMatrix=function(){if(!t.prototype._isSynchronizedViewMatrix.call(this)){return false}return this.trueCamPos.almostEqual(this.whishedCamPos)};s.prototype._getViewMatrix=function(){e.geo.copyXYZ(this.trueCamPos.position,this._target);e.geo.add(this._target,this.trueCamPos.frontDir,this._target);e.geo.LookAtLH(this.trueCamPos.position,this._target,this.trueCamPos.upVector,this.viewMM);return this.viewMM};s.prototype.update=function(){this.checkForKeyPushed();if(!this.trueCamPos.almostEqual(this.whishedCamPos)){this.trueCamPos.goCloser(this.whishedCamPos)}this.position.copyFrom(this.trueCamPos.position);this.upVector.copyFrom(this.trueCamPos.upVector)};s.prototype.onKeyDown=function(e){if(this.keysUp.indexOf(e.keyCode)!==-1||this.keysDown.indexOf(e.keyCode)!==-1||this.keysLeft.indexOf(e.keyCode)!==-1||this.keysRight.indexOf(e.keyCode)!==-1||this.keysBackward.indexOf(e.keyCode)!==-1||this.keysFrontward.indexOf(e.keyCode)!==-1){var t=this._keys.indexOf(e.keyCode);if(t===-1){this._keys.push(e.keyCode)}if(e.preventDefault){e.preventDefault()}}};s.prototype.onKeyUp=function(e){if(this.keysUp.indexOf(e.keyCode)!==-1||this.keysDown.indexOf(e.keyCode)!==-1||this.keysLeft.indexOf(e.keyCode)!==-1||this.keysRight.indexOf(e.keyCode)!==-1||this.keysBackward.indexOf(e.keyCode)!==-1||this.keysFrontward.indexOf(e.keyCode)!==-1){var t=this._keys.indexOf(e.keyCode);if(t>=0){this._keys.splice(t,1)}if(e.preventDefault){e.preventDefault()}}};s.prototype.checkForKeyPushed=function(){if(this._keys.length==0)return;e.geo.copyXyzFromFloat(0,0,0,this._axeForKeyRotation);for(var t=0;t<this._keys.length;t++){var i=this._keys[t];if(this.keysLeft.indexOf(i)!==-1){e.geo.copyXYZ(this.whishedCamPos.upVector,this._additionnalVec);e.geo.scale(this._additionnalVec,-1,this._additionnalVec);e.geo.add(this._axeForKeyRotation,this._additionnalVec,this._axeForKeyRotation)}if(this.keysUp.indexOf(i)!==-1){e.geo.cross(this.whishedCamPos.frontDir,this.whishedCamPos.upVector,this._additionnalVec);e.geo.add(this._additionnalVec,this._axeForKeyRotation,this._axeForKeyRotation)}if(this.keysRight.indexOf(i)!==-1){e.geo.copyXYZ(this.whishedCamPos.upVector,this._additionnalVec);e.geo.add(this._additionnalVec,this._axeForKeyRotation,this._axeForKeyRotation)}if(this.keysDown.indexOf(i)!==-1){e.geo.cross(this.whishedCamPos.upVector,this.whishedCamPos.frontDir,this._additionnalVec);e.geo.add(this._additionnalVec,this._axeForKeyRotation,this._axeForKeyRotation)}if(this.keysBackward.indexOf(i)!==-1)this.translateCam(-.1);else if(this.keysFrontward.indexOf(i)!==-1)this.translateCam(.1)}if(e.geo.squareNorme(this._axeForKeyRotation)<e.geo.epsilon)return;var r=-.02;this.rotate(this._axeForKeyRotation,r)};s.prototype.deltaNotToBigFunction=function(e){if(e>.1)return.1;if(e<-.1)return-.1;return e};s.prototype.attachControl=function(e,t){var r=this;var s;if(this._attachedElement){return}this._attachedElement=e;this._onPointerDown=function(i){if(s){return}s=i.pointerId;if(!t){i.preventDefault()}var n=e.getBoundingClientRect();r.onPointerDown(i.clientX-n.left,i.clientY-n.top)};this._onPointerUp=function(e){s=null;if(!t){e.preventDefault()}r.onPointerUp()};this._onPointerMove=function(i){if(s!==i.pointerId){return}var n=e.getBoundingClientRect();r.onPointerMove(i.clientX-n.left,i.clientY-n.top);if(!t){i.preventDefault()}};this._onMouseMove=this._onPointerMove;this._wheel=function(e){var i=0;if(e.wheelDelta){i=r.deltaNotToBigFunction(e.wheelDelta/(r.wheelPrecision*300))}else if(e.detail){i=r.deltaNotToBigFunction(-e.detail/(r.wheelPrecision*30))}if(i)r.translateCam(i);if(e.preventDefault){if(!t){e.preventDefault()}}};this._onKeyDown=function(e){r.onKeyDown(e)};this._onKeyUp=function(e){r.onKeyUp(e)};this._onLostFocus=function(){r._keys=[];s=null};this._onGestureStart=function(t){if(window.MSGesture===undefined){return}if(!r._MSGestureHandler){r._MSGestureHandler=new MSGesture;r._MSGestureHandler.target=e}r._MSGestureHandler.addPointer(t.pointerId)};this._onGesture=function(e){};this._reset=function(){r.reset();s=null};e.addEventListener(this.eventPrefix+"down",this._onPointerDown,false);e.addEventListener(this.eventPrefix+"up",this._onPointerUp,false);e.addEventListener(this.eventPrefix+"out",this._onPointerUp,false);e.addEventListener(this.eventPrefix+"move",this._onPointerMove,false);e.addEventListener("mousemove",this._onMouseMove,false);e.addEventListener("MSPointerDown",this._onGestureStart,false);e.addEventListener("MSGestureChange",this._onGesture,false);e.addEventListener("mousewheel",this._wheel,false);e.addEventListener("DOMMouseScroll",this._wheel,false);i.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}])};s.prototype.detachControl=function(e){if(this._attachedElement!=e){return}e.removeEventListener(this.eventPrefix+"down",this._onPointerDown);e.removeEventListener(this.eventPrefix+"up",this._onPointerUp);e.removeEventListener(this.eventPrefix+"out",this._onPointerUp);e.removeEventListener(this.eventPrefix+"move",this._onPointerMove);e.removeEventListener("mousemove",this._onMouseMove);e.removeEventListener("MSPointerDown",this._onGestureStart);e.removeEventListener("MSGestureChange",this._onGesture);e.removeEventListener("mousewheel",this._wheel);e.removeEventListener("DOMMouseScroll",this._wheel);i.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]);this._MSGestureHandler=null;this._attachedElement=null;if(this._reset){this._reset()}};return s}(BABYLON.Camera);t.GrabberCamera=s;var n=function(t){__extends(i,t);function i(i){t.call(this);this.grabberPilot=i;this.position=new e.XYZ(0,0,-3);this.upVector=new e.XYZ(0,1,0);this.frontDir=new e.XYZ(0,0,1);this.sizes=new e.XYZ(1,1,1);this.smoothParam=.5;this.positioningCopy=new e.Positioning}i.prototype.almostEqual=function(t){return e.geo.xyzAlmostEquality(this.position,t.getPosition())&&e.geo.xyzAlmostEquality(this.upVector,t.upVector)&&e.geo.xyzAlmostEquality(this.frontDir,t.frontDir)};i.prototype.goCloser=function(t){e.geo.between(t.position,this.position,this.smoothParam,this.position);e.geo.between(t.upVector,this.upVector,this.smoothParam,this.upVector);e.geo.between(t.frontDir,this.frontDir,this.smoothParam,this.frontDir);if(this.upVector.lengthSquared()<e.geo.epsilonSquare){this.upVector.copyFrom(t.upVector).scale(-1);e.logger.c("a wished upVector was opposite to the true upVector")}if(this.frontDir.lengthSquared()<e.geo.epsilonSquare){this.frontDir.copyFrom(t.frontDir).scale(-1);e.logger.c("a wished frontDir was opposite to the true frontDir")}if(this.grabberPilot.onPositioningChange!=null){this.positioningCopy.copyFrom(this);this.grabberPilot.onPositioningChange(this.positioningCopy)}};i.prototype.copyFrom=function(t){e.geo.copyXYZ(t.position,this.position);e.geo.copyXYZ(t.upVector,this.upVector);e.geo.copyXYZ(t.frontDir,this.frontDir)};i.prototype.changeFrontDir=function(t){e.geo.orthonormalizeKeepingFirstDirection(t,this.upVector,this.frontDir,this.upVector)};i.prototype.changeUpVector=function(t){e.geo.orthonormalizeKeepingFirstDirection(this.upVector,t,this.upVector,this.frontDir)};return i}(e.Positioning);t.CamPositioning=n;var a=function(t){__extends(i,t);function i(i){var s=this;t.call(this);this.camera=i;this.upVector=new e.XYZ(0,1,0);this.frontDir=new e.XYZ(0,0,1);this.position=new e.XYZ(0,0,-3);this._newPositionBeforCollision=new e.XYZ(0,0,0);this._velocity=new e.XYZ(0,0,0);this._collider=new r;this.ellipsoid=new e.XYZ(1,1,1);this._oldPosition=new e.XYZ(0,0,0);this._diffPosition=new e.XYZ(0,0,0);this._newPosition=new e.XYZ(0,0,0);this._inter=new e.XYZ(0,0,0);this._upPerturbation=new e.XYZ(0,0,0);this._onCollisionPositionChange=function(e,t,i){if(i===void 0){i=null}s._newPosition.copyFrom(t);s._newPosition.subtractToRef(s._oldPosition,s._diffPosition).scale(2);if(i!=null){console.log("collision");s._upPerturbation.copyFrom(s.upVector).scale(.005);s.position.add(s._diffPosition).add(s._upPerturbation)}else s.position.copyFrom(s._oldPosition)}}i.prototype.getPosition=function(){return this.position};i.prototype.changePosition=function(e){if(this.camera.positionChangesBiaiser!=null){this._newPositionBeforCollision.copyFrom(this.camera.positionChangesBiaiser(this.position,e,this.camera.currentGrabber))}else this._newPositionBeforCollision.copyFrom(e);if(this.camera.checkCollisions){this._velocity.copyFrom(this._newPositionBeforCollision).substract(this.camera.trueCamPos.position);this._collideWithWorld(this._velocity,this._newPositionBeforCollision)}else this.position.copyFrom(this._newPositionBeforCollision)};i.prototype._collideWithWorld=function(e,t){this._collider.radius=this.ellipsoid;this._oldPosition.copyFrom(t);this.camera.scene.collisionCoordinator.getNewPosition(this._oldPosition,e,this._collider,3,null,this._onCollisionPositionChange,-13)};return i}(e.Positioning);t.WishedPositioning=a;var o=function(){function t(t){this.parallelDisplacementInsteadOfRotation=false;this.showGrabberOnlyWhenGrabbing=true;this.referenceCenter=null;this.onGrabbingActions=new e.StringMap;this.endOfZone1=1;this.endOfZone2=3;this.endOfZone3=10;this.zoneAreDefinedFromCenterRatherFromSurface=true;this.focusOnMyCenterWhenCameraGoDownWard=true;this.scene=t;this.material=new BABYLON.StandardMaterial("",this.scene);this.material=new BABYLON.StandardMaterial("texture1",this.scene);this.material.alpha=.3;this.material.diffuseColor=new BABYLON.Color3(1,1,1)}t.prototype.dispose=function(){this.mesh.dispose()};t.prototype.interpolationCoefAccordingToCamPosition=function(t,i){var r=0;if(this.zoneAreDefinedFromCenterRatherFromSurface)r=e.geo.distance(t,this.referenceCenter);else r=i;if(r<=this.endOfZone1)return 0;if(r>=this.endOfZone2)return 1;return(r-this.endOfZone1)/(this.endOfZone2-this.endOfZone1)};t.prototype.checkArgs=function(){if(this.zoneAreDefinedFromCenterRatherFromSurface&&this.referenceCenter==null)throw"you must define a reference center when zoneAreDefinedFromCenterRatherFromSurface";if(this.focusOnMyCenterWhenCameraGoDownWard&&this.referenceCenter==null)throw"you must define a reference center when focusOnMyCenterWhenCameraGoDownWard";if(this.endOfZone1>this.endOfZone2)throw"zone2 must contains zone1";if(this.endOfZone2>this.endOfZone3)throw"zone3 must contains zone2"};return t}();t.Grabber=o;var h=function(t){__extends(i,t);function i(i,r,s,n){if(r===void 0){r=new e.XYZ(1,1,1)}if(s===void 0){s=new e.XYZ(0,0,0)}if(n===void 0){n=false}t.call(this,i);this.radius=1;this.radius=r.x;this.endOfZone1=this.radius;this.endOfZone2=3*this.radius;this.endOfZone3=10*this.radius;this.referenceCenter=s;this.focusOnMyCenterWhenCameraGoDownWard=true;this.parallelDisplacementInsteadOfRotation=false;this.showGrabberOnlyWhenGrabbing=true;this.mesh=BABYLON.Mesh.CreateSphere("default sphere for grabbing",10,2,i);this.mesh.position=s;this.mesh.scaling=r;this.mesh.material=this.material;this.mesh.isPickable=n}return i}(o);t.SphericalGrabber=h;var l=function(t){__extends(i,t);function i(i,r,s,n,a){if(r===void 0){r=new e.XYZ(1,1,1)}if(s===void 0){s=new e.XYZ(0,0,0)}if(n===void 0){n=new e.XYZW(0,0,0,1)}if(a===void 0){a=false}t.call(this,i);this.referenceCenter=null;this.focusOnMyCenterWhenCameraGoDownWard=false;this.parallelDisplacementInsteadOfRotation=true;this.zoneAreDefinedFromCenterRatherFromSurface=false;this.endOfZone1=0;this.endOfZone2=0;this.mesh=BABYLON.Mesh.CreatePlane("default plane for grabbing",1,i);this.mesh.position=s;this.mesh.scaling=r;this.mesh.rotationQuaternion=n;this.mesh.material=this.material;this.mesh.isPickable=a}return i}(o);t.PlanarGrabber=l})(t=e.macamera||(e.macamera={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(t){this.attractionOfTangent=new e.XYZ(1,.0123456721,.00078654343);this.computeTangent=true;this.computeNormal=true;this.computeSizes=true;this.sizesProp=new e.XYZ(.3,.3,.3);this.allVerticesHaveSameSizes=true;this.temp=new e.XYZ(0,0,0);this._side1=new e.XYZ(0,0,0);this._side2=new e.XYZ(0,0,0);this.mamesh=t}t.prototype.checkArgs=function(){if(this.mamesh.smallestSquares.length==0&&this.mamesh.smallestTriangles.length==0)throw"no triangles nor Square. The normals cannot be computed"};t.prototype.go=function(){var t=this;var i=new e.HashMap;if(this.mamesh.vertices.length==0){e.logger.c("you try to compute normal, tangent, diameter for an empty mamesh");return}this.mamesh.vertices.forEach(function(t){var r=new e.Positioning;r.position=t.position;r.upVector=new e.XYZ(0,0,0);r.frontDir=new e.XYZ(0,0,0);i.putValue(t,r)});if(this.computeTangent){this.mamesh.vertices.forEach(function(r){var s=Number.NEGATIVE_INFINITY;var n=Number.POSITIVE_INFINITY;var a=new e.XYZ(0,0,0);var o=new e.XYZ(0,0,0);if(r.links.length==0)throw"a vertex with no links. Impossible to compute a tangent";var h=t.attractionOfTangent.length();for(var l=0;l<r.links.length;l++){t.temp.copyFrom(r.links[l].to.position).substract(r.position);if(t.temp.length()<e.geo.epsilon){e.logger.c("a mamesh has two vertices at almost the same position")}else{var u=e.geo.dot(t.temp,t.attractionOfTangent)/t.temp.length()/h;if(u>s){s=u;a.copyFrom(t.temp)}if(u<n){n=u;o.copyFrom(t.temp)}}}if(-n>2*s)i.getValue(r).frontDir.copyFrom(o.scale(-1));else i.getValue(r).frontDir.copyFrom(a)})}if(this.computeNormal){var r=[];for(var s=0;s<this.mamesh.smallestTriangles.length/3;s++){this._side1.copyFrom(this.mamesh.smallestTriangles[3*s+1].position).substract(this.mamesh.smallestTriangles[3*s].position);this._side2.copyFrom(this.mamesh.smallestTriangles[3*s+2].position).substract(this.mamesh.smallestTriangles[3*s].position);r[s]=new e.XYZ(0,0,0);e.geo.cross(this._side1,this._side2,r[s]);r[s].normalize()}var n=[];for(var s=0;s<this.mamesh.smallestSquares.length/4;s++){this._side1.copyFrom(this.mamesh.smallestSquares[4*s+1].position).substract(this.mamesh.smallestSquares[4*s].position);this._side2.copyFrom(this.mamesh.smallestSquares[4*s+3].position).substract(this.mamesh.smallestSquares[4*s].position);n[s]=new e.XYZ(0,0,0);e.geo.cross(this._side1,this._side2,n[s]);try{n[s].normalize()}catch(e){throw"the square"+this.mamesh.smallestSquares[4*s].hashNumber+","+this.mamesh.smallestSquares[4*s+1].hashNumber+","+this.mamesh.smallestSquares[4*s+2].hashNumber+","+this.mamesh.smallestSquares[4*s+3].hashNumber+" is degenerated"}}for(var s=0;s<r.length;s++){var a=this.mamesh.smallestTriangles[3*s];var o=this.mamesh.smallestTriangles[3*s+1];var h=this.mamesh.smallestTriangles[3*s+2];i.getValue(a).upVector.add(r[s]);i.getValue(o).upVector.add(r[s]);i.getValue(h).upVector.add(r[s])}for(var s=0;s<n.length;s++){var a=this.mamesh.smallestSquares[4*s];var o=this.mamesh.smallestSquares[4*s+1];var h=this.mamesh.smallestSquares[4*s+2];var l=this.mamesh.smallestSquares[4*s+3];i.getValue(a).upVector.add(n[s]);i.getValue(o).upVector.add(n[s]);i.getValue(h).upVector.add(n[s]);i.getValue(l).upVector.add(n[s])}var u=[];this.mamesh.vertices.forEach(function(t){try{i.getValue(t).upVector.normalize()}catch(i){e.logger.c("a too small upVector for a vertex, probably a vertex which is not in any polygone. The upVector will be the mean of other upVector");u.push(t)}});if(u.length>0){var c=new e.XYZ(0,0,0);for(var m=0,p=this.mamesh.vertices;m<p.length;m++){var f=p[m];c.add(i.getValue(f).upVector)}try{c.normalize()}catch(e){throw"canot manage to compute upVector for any vertex"}for(var d=0,v=u;d<v.length;d++){var g=v[d];i.getValue(g).upVector.copyFrom(c)}}}if(this.computeSizes){if(!this.allVerticesHaveSameSizes){this.mamesh.vertices.forEach(function(r){var s=0;r.links.forEach(function(t){s+=e.geo.distance(r.position,t.to.position)});i.getValue(r).scaling.copyFrom(t.sizesProp).scale(s/r.links.length)})}else{var y=0;var b=this.mamesh.vertices[0];var w=0;b.links.forEach(function(t){w+=e.geo.distance(b.position,t.to.position)});y=w/b.links.length;this.mamesh.vertices.forEach(function(e){return i.getValue(e).scaling.copyFrom(t.sizesProp).scale(y)})}}return i};return t}();t.PositioningComputerForMameshVertices=i})(t=e.mameshAroundComputations||(e.mameshAroundComputations={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){function i(t,i,r,s){if(r.middle==null){var n=new e.XYZ(0,0,0);e.geo.between(r.a.position,r.b.position,.5,n);r.middle=i.newVertex(n,Math.max(r.a.dichoLevel,r.b.dichoLevel)+1,t(r.a.param,r.b.param));if(r.a.hasMark(e.Vertex.Markers.border)&&r.b.hasMark(e.Vertex.Markers.border))r.middle.markers.push(e.Vertex.Markers.border);if(s!=null)r.orth1=s}else if(s!=null)r.orth2=s}var r=function(){function t(t){this.makeLinks=true;this.trianglesToCut=null;this.nbDicho=1;this.newParamForMiddle=function(t,i){var r=new e.XYZ(0,0,0);e.geo.between(t,i,1/2,r);return r};this.mamesh=t}t.prototype.checkArgs=function(){if(this.mamesh.smallestTriangles.length==0)e.logger.c("no triangulatedRect for triangulatedRect dichotomy")};t.prototype.go=function(){this.checkArgs();if(!this.makeLinks)this.mamesh.clearLinksAndLines();var t;if(this.trianglesToCut==null){this.trianglesToCut=this.mamesh.smallestTriangles;t=new Array}else{t=new e.tab.ArrayMinusBlocksElements(this.mamesh.smallestTriangles,3,this.trianglesToCut).go()}var r=this.createAndAddSegmentsFromTriangles(this.trianglesToCut);for(var s=0;s<this.trianglesToCut.length;s+=3){var n=this.trianglesToCut[s];var a=this.trianglesToCut[s+1];var o=this.trianglesToCut[s+2];var h=r[e.Segment.segmentId(n.hashNumber,a.hashNumber)];var l=r[e.Segment.segmentId(a.hashNumber,o.hashNumber)];var u=r[e.Segment.segmentId(o.hashNumber,n.hashNumber)];if(this.makeLinks){i(this.newParamForMiddle,this.mamesh,h,o);i(this.newParamForMiddle,this.mamesh,l,n);i(this.newParamForMiddle,this.mamesh,u,a)}else{i(this.newParamForMiddle,this.mamesh,h);i(this.newParamForMiddle,this.mamesh,l);i(this.newParamForMiddle,this.mamesh,u)}var c=h.middle;var m=l.middle;var p=u.middle;t.push(n,c,p);t.push(a,m,c);t.push(o,p,m);t.push(c,m,p)}if(this.makeLinks){for(var f in r){var d=r[f];var v=r[e.Segment.segmentId(d.a.hashNumber,d.orth1.hashNumber)];var g=r[e.Segment.segmentId(d.b.hashNumber,d.orth1.hashNumber)];if(d.orth2!=null){var y=r[e.Segment.segmentId(d.a.hashNumber,d.orth2.hashNumber)];var b=r[e.Segment.segmentId(d.b.hashNumber,d.orth2.hashNumber)];d.middle.setTwoOppositeLinks(v.middle,b.middle);d.middle.setTwoOppositeLinks(y.middle,g.middle)}else{d.middle.setOneLink(v.middle);d.middle.setOneLink(g.middle)}try{var w=function(e,t,i){var r=e.findLink(t);r.to=i};w(d.a,d.b,d.middle);w(d.b,d.a,d.middle);d.middle.setTwoOppositeLinks(d.a,d.b)}catch(e){throw"a bad segment, probably your triangles are not corrects (e.g. one missing, or one more)"}}}this.mamesh.smallestTriangles=t};t.prototype.createAndAddSegmentsFromTriangles=function(e){var t={};for(var i=0;i<e.length;i+=3){var r=e[i];var s=e[i+1];var n=e[i+2];this.mamesh.getOrCreateSegment(r,s,t);this.mamesh.getOrCreateSegment(s,n,t);this.mamesh.getOrCreateSegment(n,r,t)}return t};return t}();t.TriangleDichotomer=r;var s=function(){function t(i){this.makeLinks=true;this.squareToCut=null;this.dichoStyle=t.DichoStyle.fourSquares;this.newParamForMiddle=function(t,i){var r=new e.XYZ(0,0,0);e.geo.between(t,i,1/2,r);return r};this.newParamForCenter=function(t,i,r,s){var n=new e.XYZ(0,0,0);e.geo.baryCenter([t,i,r,s],[1/4,1/4,1/4,1/4],n);return n};this.mamesh=i}t.prototype.checkArgs=function(){if(this.mamesh.smallestSquares.length==0)throw"no square for square dichotomy";this.mamesh.clearLinksAndLines()};t.prototype.go=function(){this.checkArgs();var r;if(this.squareToCut==null){this.squareToCut=this.mamesh.smallestSquares;r=new Array}else{r=new e.tab.ArrayMinusBlocksElements(this.mamesh.smallestSquares,4,this.squareToCut).go()}var s=this.createAndAddSegmentsFromSquare(this.squareToCut);for(var n=0;n<this.squareToCut.length;n+=4){var a=this.squareToCut[n];var o=this.squareToCut[n+1];var h=this.squareToCut[n+2];var l=this.squareToCut[n+3];var u=s[e.Segment.segmentId(a.hashNumber,o.hashNumber)];var c=s[e.Segment.segmentId(o.hashNumber,h.hashNumber)];var m=s[e.Segment.segmentId(h.hashNumber,l.hashNumber)];var p=s[e.Segment.segmentId(l.hashNumber,a.hashNumber)];i(this.newParamForMiddle,this.mamesh,u);i(this.newParamForMiddle,this.mamesh,c);i(this.newParamForMiddle,this.mamesh,m);i(this.newParamForMiddle,this.mamesh,p);var f=u.middle;var d=c.middle;var v=m.middle;var g=p.middle;if(this.dichoStyle==t.DichoStyle.fourSquares){var y=new e.XYZ(0,0,0);e.geo.baryCenter([u.a.position,u.b.position,m.a.position,m.b.position],[1/4,1/4,1/4,1/4],y);var b=Math.max(u.a.dichoLevel,u.b.dichoLevel,m.a.dichoLevel,m.b.dichoLevel)+1;var w=this.mamesh.newVertex(y,b,this.newParamForCenter(u.a.param,u.b.param,m.a.param,m.b.param));var M=new e.Segment(f,v);M.middle=w;this.mamesh.cutSegmentsDico[e.Segment.segmentId(f.hashNumber,v.hashNumber)]=M;r.push(a,f,w,g);r.push(o,d,w,f);r.push(h,v,w,d);r.push(l,g,w,v)}else if(this.dichoStyle==t.DichoStyle.fourTriangles){r.push(f,d,v,g);this.mamesh.smallestTriangles.push(a,f,g);this.mamesh.smallestTriangles.push(o,d,f);this.mamesh.smallestTriangles.push(h,v,d);this.mamesh.smallestTriangles.push(l,g,v)}else throw"ho ho"}this.mamesh.smallestSquares=r;if(this.makeLinks){var x=new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(this.mamesh);x.goChanging()}};t.prototype.createAndAddSegmentsFromSquare=function(e){var t={};for(var i=0;i<e.length;i+=4){var r=e[i];var s=e[i+1];var n=e[i+2];var a=e[i+3];this.mamesh.getOrCreateSegment(r,s,t);this.mamesh.getOrCreateSegment(s,n,t);this.mamesh.getOrCreateSegment(n,a,t);this.mamesh.getOrCreateSegment(a,r,t)}return t};return t}();t.SquareDichotomer=s;var n=function(){function t(t){this.makeLinks=true;this.squareToCut=null;this.dichoStyle=s.DichoStyle.fourSquares;this.newParamForMiddle=function(t,i){var r=new e.XYZ(0,0,0);e.geo.between(t,i,1/2,r);return r};this.newParamForCenter=function(t,i,r,s){var n=new e.XYZ(0,0,0);e.geo.baryCenter([t,i,r,s],[1/4,1/4,1/4,1/4],n);return n};this.mamesh=t}t.prototype.checkArgs=function(){if(this.mamesh.smallestSquares.length==0)throw"no square for square dichotomy";this.mamesh.clearLinksAndLines()};t.prototype.go=function(){this.checkArgs();var t;if(this.squareToCut==null){this.squareToCut=this.mamesh.smallestSquares;t=new Array}else{t=new e.tab.ArrayMinusBlocksElements(this.mamesh.smallestSquares,4,this.squareToCut).go()}var r=this.createAndAddSegmentsFromSquare(this.squareToCut);for(var n=0;n<this.squareToCut.length;n+=4){var a=this.squareToCut[n];var o=this.squareToCut[n+1];var h=this.squareToCut[n+2];var l=this.squareToCut[n+3];var u=r[e.Segment.segmentId(a.hashNumber,o.hashNumber)];var c=r[e.Segment.segmentId(o.hashNumber,h.hashNumber)];var m=r[e.Segment.segmentId(h.hashNumber,l.hashNumber)];var p=r[e.Segment.segmentId(l.hashNumber,a.hashNumber)];i(this.newParamForMiddle,this.mamesh,u);i(this.newParamForMiddle,this.mamesh,c);i(this.newParamForMiddle,this.mamesh,m);i(this.newParamForMiddle,this.mamesh,p);var f=u.middle;var d=c.middle;var v=m.middle;var g=p.middle;if(this.dichoStyle==s.DichoStyle.fourSquares){var y=new e.XYZ(0,0,0);e.geo.baryCenter([u.a.position,u.b.position,m.a.position,m.b.position],[1/4,1/4,1/4,1/4],y);var b=Math.max(u.a.dichoLevel,u.b.dichoLevel,m.a.dichoLevel,m.b.dichoLevel)+1;var w=this.mamesh.newVertex(y,b,this.newParamForCenter(u.a.param,u.b.param,m.a.param,m.b.param));var M=new e.Segment(f,v);M.middle=w;this.mamesh.cutSegmentsDico[e.Segment.segmentId(f.hashNumber,v.hashNumber)]=M;t.push(a,f,w,g);t.push(o,d,w,f);t.push(h,v,w,d);t.push(l,g,w,v)}else if(this.dichoStyle==s.DichoStyle.fourTriangles){t.push(f,d,v,g);this.mamesh.smallestTriangles.push(a,f,g);this.mamesh.smallestTriangles.push(o,d,f);this.mamesh.smallestTriangles.push(h,v,d);this.mamesh.smallestTriangles.push(l,g,v)}else throw"ho ho"}this.mamesh.smallestSquares=t;if(this.makeLinks){var x=new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(this.mamesh);x.goChanging()}};t.prototype.createAndAddSegmentsFromSquare=function(e){var t={};for(var i=0;i<e.length;i+=4){var r=e[i];var s=e[i+1];var n=e[i+2];var a=e[i+3];this.mamesh.getOrCreateSegment(r,s,t);this.mamesh.getOrCreateSegment(s,n,t);this.mamesh.getOrCreateSegment(n,a,t);this.mamesh.getOrCreateSegment(a,r,t)}return t};return t}();t.SimplestSquareDichotomer=n;var s;(function(e){(function(e){e[e["fourSquares"]=0]="fourSquares";e[e["fourTriangles"]=1]="fourTriangles"})(e.DichoStyle||(e.DichoStyle={}));var t=e.DichoStyle})(s=t.SquareDichotomer||(t.SquareDichotomer={}));var a=function(){function t(e){this.subdivider=3;this.hexahedronsToCut=null;this.suppressVolumes=null;this.createdPointsPerSegment={};this.createdPointsPerSurface={};this.newHexahedrons=null;this.points=null;this.mamesh=e}t.prototype.checkArgs=function(){if(this.hexahedronsToCut==null&&this.mamesh.hexahedrons.length==0||this.hexahedronsToCut!=null&&this.hexahedronsToCut.length==0)e.logger.c("HexahedronSubdivider : No input")};t.prototype.go=function(){this.checkArgs();if(this.hexahedronsToCut==null)this.hexahedronsToCut=this.mamesh.hexahedrons;this.points=new Array(this.subdivider+1);for(var e=0;e<=this.subdivider;e++){this.points[e]=new Array(this.subdivider+1);for(var t=0;t<=this.subdivider;t++)this.points[e][t]=new Array(this.subdivider+1)}this.subdivideHexahedrons()};t.prototype.subdivideHexahedronInVertices=function(t){var i=this;var r=this.subdivider;var s=[[0,0,0],[r,0,0],[r,0,r],[0,0,r],[0,r,r],[0,r,0],[r,r,0],[r,r,r]];s.forEach(function(e,r){var s=e[0],n=e[1],a=e[2];i.points[s][n][a]=i.hexahedronsToCut[t+r]});var n=[[0,1],[1,2],[2,3],[3,0],[0,5],[1,6],[2,7],[3,4],[4,5],[5,6],[6,7],[7,4]];for(var a=0,o=n;a<o.length;a++){var h=o[a],l=h[0],u=h[1];var c=e.Hash.segment(this.hexahedronsToCut[t+l],this.hexahedronsToCut[t+u]);if(this.hexahedronsToCut[t+l].hashNumber>this.hexahedronsToCut[t+u].hashNumber)z=[u,l],l=z[0],u=z[1];var m=s[l],p=m[0],f=m[1],d=m[2];var v=s[u],g=v[0],y=v[1],b=v[2];for(var w=1;w<r;w++)this.points[p+(g-p)/r*w][f+(y-f)/r*w][d+(b-d)/r*w]=this.createdPointsPerSegment[c][w]}var M=[[0,1,2,3],[4,7,6,5],[0,3,4,5],[1,6,7,2],[2,7,4,3],[0,5,6,1]];for(var x=0,C=M;x<C.length;x++){var T=C[x],l=T[0],u=T[1],V=T[2],S=T[3];var c=e.Hash.quad(this.hexahedronsToCut[t+l],this.hexahedronsToCut[t+u],this.hexahedronsToCut[t+V],this.hexahedronsToCut[t+S]);while(this.hexahedronsToCut[t+l].hashNumber>this.hexahedronsToCut[t+u].hashNumber||this.hexahedronsToCut[t+l].hashNumber>this.hexahedronsToCut[t+V].hashNumber||this.hexahedronsToCut[t+l].hashNumber>this.hexahedronsToCut[t+S].hashNumber)E=[u,V,S,l],l=E[0],u=E[1],V=E[2],S=E[3];if(this.hexahedronsToCut[t+u].hashNumber>this.hexahedronsToCut[t+S].hashNumber)q=[S,u],u=q[0],S=q[1];var k=s[l],p=k[0],f=k[1],d=k[2];var O=s[u],g=O[0],y=O[1],b=O[2];var A=s[V],P=A[0],_=A[1],F=A[2];for(var w=1;w<r;w++)for(var N=1;N<r;N++)this.points[p+(g-p)/r*w+(P-g)/r*N][f+(y-f)/r*w+(_-y)/r*N][d+(b-d)/r*w+(F-b)/r*N]=this.createdPointsPerSurface[c][w][N]}for(var B=1;B<r;B++){for(var L=1;L<r;L++){for(var Y=1;Y<r;Y++){var X=new e.XYZ(0,0,0);var I=B/r;var Z=L/r;var D=Y/r;e.geo.baryCenter([this.hexahedronsToCut[t].position,this.hexahedronsToCut[t+1].position,this.hexahedronsToCut[t+2].position,this.hexahedronsToCut[t+3].position,this.hexahedronsToCut[t+4].position,this.hexahedronsToCut[t+5].position,this.hexahedronsToCut[t+6].position,this.hexahedronsToCut[t+7].position],[(1-I)*(1-Z)*(1-D),I*(1-Z)*(1-D),I*(1-Z)*D,(1-I)*(1-Z)*D,(1-I)*Z*D,(1-I)*Z*(1-D),I*Z*(1-D),I*Z*D],X);this.points[B][L][Y]=this.mamesh.newVertex(X)}}}var z,E,q};t.prototype.makeNewHexahedronsFromPoints=function(){if(this.suppressVolumes==null)this.suppressVolumes=[];var e=this.subdivider;var t=function(t){var r=function(r){var s=function(e){if(i.suppressVolumes.some(function(i){return i[0]==t&&i[1]==r&&i[2]==e}))return"continue";i.newHexahedrons.push.apply(i.newHexahedrons,[i.points[t][r][e],i.points[t+1][r][e],i.points[t+1][r][e+1],i.points[t][r][e+1],i.points[t][r+1][e+1],i.points[t][r+1][e],i.points[t+1][r+1][e],i.points[t+1][r+1][e+1]])};for(var n=0;n<e;n++){s(n)}};for(var s=0;s<e;s++){r(s)}};var i=this;for(var r=0;r<e;r++){t(r)}};t.prototype.makeSurfacesVertices=function(){var t=[[0,1,2,3],[4,7,6,5],[0,3,4,5],[1,6,7,2],[2,7,4,3],[0,5,6,1]];for(var i=0;i<this.hexahedronsToCut.length;i+=8){for(var r=0,s=t;r<s.length;r++){var n=s[r],a=n[0],o=n[1],h=n[2],l=n[3];if(this.createdPointsPerSurface[e.Hash.quad(this.hexahedronsToCut[i+a],this.hexahedronsToCut[i+o],this.hexahedronsToCut[i+h],this.hexahedronsToCut[i+l])]==null)this.createdPointsPerSurface[e.Hash.quad(this.hexahedronsToCut[i+a],this.hexahedronsToCut[i+o],this.hexahedronsToCut[i+h],this.hexahedronsToCut[i+l])]=this.subdivideSurface(this.hexahedronsToCut[i+a],this.hexahedronsToCut[i+o],this.hexahedronsToCut[i+h],this.hexahedronsToCut[i+l])}}};t.prototype.makeSegmentsVertices=function(){var t=[[0,1],[1,2],[2,3],[3,0],[0,5],[1,6],[2,7],[3,4],[4,5],[5,6],[6,7],[7,4]];for(var i=0;i<this.hexahedronsToCut.length;i+=8){for(var r=0,s=t;r<s.length;r++){var n=s[r],a=n[0],o=n[1];if(this.createdPointsPerSegment[e.Hash.segment(this.hexahedronsToCut[i+a],this.hexahedronsToCut[i+o])]==null)this.createdPointsPerSegment[e.Hash.segment(this.hexahedronsToCut[i+a],this.hexahedronsToCut[i+o])]=this.subdivideSegment(this.hexahedronsToCut[i+a],this.hexahedronsToCut[i+o])}}};t.prototype.subdivideSegment=function(t,i){h=e.Hash.segmentOrd(t,i),t=h[0],i=h[1];var r=[];var s=this.subdivider;for(var n=1;n<s;n++){var a=new e.XYZ(0,0,0);var o=n/s;e.geo.baryCenter([t.position,i.position],[1-o,o],a);r[n]=this.mamesh.newVertex(a)}return r;var h};t.prototype.subdivideSurface=function(t,i,r,s){p=e.Hash.quadOrd(t,i,r,s),t=p[0],i=p[1],r=p[2],s=p[3];var n=[];var a=this.subdivider;for(var o=1;o<a;o++){n[o]=[];for(var h=1;h<a;h++){var l=new e.XYZ(0,0,0);var u=[h/a,o/a],c=u[0],m=u[1];e.geo.baryCenter([t.position,i.position,r.position,s.position],[(1-c)*(1-m),c*(1-m),c*m,(1-c)*m],l);n[o][h]=this.mamesh.newVertex(l)}}return n;var p};t.prototype.subdivideHexahedrons=function(){this.makeSegmentsVertices();this.makeSurfacesVertices();var e=this.hexahedronsToCut.length/8;this.newHexahedrons=[];for(var t=0;t<e;t++){this.subdivideHexahedronInVertices(t*8);this.makeNewHexahedronsFromPoints()}};return t}();t.HexahedronSubdivider=a;var o=function(){function t(e){this.hexahedronsToDraw=null;this.newSurfaces=null;this.surfacesSet={};this.mamesh=e}t.prototype.checkArgs=function(){if(this.hexahedronsToDraw==null&&(this.mamesh.hexahedrons==null||this.mamesh.hexahedrons.length==0)||this.hexahedronsToDraw!=null&&this.hexahedronsToDraw.length==0)e.logger.c("SurfacesFromHexahedrons : No input")};t.prototype.go=function(){this.checkArgs();if(this.hexahedronsToDraw==null)this.hexahedronsToDraw=this.mamesh.hexahedrons;var t=[[0,3,2,1],[4,5,6,7],[0,5,4,3],[1,2,7,6],[2,3,4,7],[0,1,6,5]];this.newSurfaces=[];for(var i=0;i<this.hexahedronsToDraw.length;i+=8){for(var r=0,s=t;r<s.length;r++){var n=s[r],a=n[0],o=n[1],h=n[2],l=n[3];var u=e.Hash.quad(this.hexahedronsToDraw[i+a],this.hexahedronsToDraw[i+o],this.hexahedronsToDraw[i+h],this.hexahedronsToDraw[i+l]);if(this.surfacesSet[u]==null)this.surfacesSet[u]=[this.hexahedronsToDraw[i+a],this.hexahedronsToDraw[i+o],this.hexahedronsToDraw[i+h],this.hexahedronsToDraw[i+l]];else delete this.surfacesSet[u]}}for(var c in this.surfacesSet)this.newSurfaces.push.apply(this.newSurfaces,this.surfacesSet[c]);var m=this.newSurfaces.length;for(var a=0;a<m;a+=5e3)this.mamesh.smallestSquares.push.apply(this.mamesh.smallestSquares,this.newSurfaces.slice(a,a+5e3))};return t}();t.SurfacesFromHexahedrons=o;var h=function(){function t(e){this.copyCutSegmentsDico=true;this.copyLines=true;this.oldMamesh=e}t.prototype.go=function(){var t=new e.HashMap;var i=new e.Mamesh;this.oldMamesh.vertices.forEach(function(r){var s=e.XYZ.newFrom(r.param);var n=i.newVertex(r.position,r.dichoLevel,s);t.putValue(r,n);n.importantMarker=r.importantMarker;r.markers.forEach(function(e){return n.markers.push(e)})});this.oldMamesh.vertices.forEach(function(i){var r=t.getValue(i);for(var s=0;s<i.links.length;s++){r.links[s]=new e.Link(t.getValue(i.links[s].to))}for(var s=0;s<i.links.length;s++){var n=i.links[s];var a=r.links[s];if(n.opposites!=null){a.opposites=[];for(var o=0,h=n.opposites;o<h.length;o++){var l=h[o];var u=i.links.indexOf(l);a.opposites.push(r.links[u])}}}});this.oldMamesh.smallestTriangles.forEach(function(e){i.smallestTriangles.push(t.getValue(e))});this.oldMamesh.smallestSquares.forEach(function(e){i.smallestSquares.push(t.getValue(e))});if(this.copyLines){if(this.oldMamesh.linesWasMade){var r=this.oldMamesh.getStraightLinesAsVertices();var s=this.oldMamesh.getLoopLinesAsVertices();i.lines=[];r.forEach(function(r){var s=[];r.forEach(function(e){s.push(t.getValue(e))});i.lines.push(new e.Line(s,false))});s.forEach(function(r){var s=[];r.forEach(function(e){s.push(t.getValue(e))});i.lines.push(new e.Line(s,true))})}}if(this.copyCutSegmentsDico){for(var n in this.oldMamesh.cutSegmentsDico){var a=this.oldMamesh.cutSegmentsDico[n];var o=t.getValue(a.a);var h=t.getValue(a.b);var l=new e.Segment(o,h);l.middle=t.getValue(a.middle);if(a.orth1!=null)l.orth1=t.getValue(a.orth1);if(a.orth2!=null)l.orth2=t.getValue(a.orth2);i.cutSegmentsDico[e.Segment.segmentId(o.hashNumber,h.hashNumber)]=l}}else this.copyCutSegmentsDico=null;return i};return t}();t.MameshDeepCopier=h;var l=function(){function t(t){var i=this;this.percolationProba=.5;this.probaToPercolateFunction=function(e){if(e.links.length==3)return 0;if(e.links.length==4)return.3*i.percolationProba;if(e.links.length==5)return.6*i.percolationProba;if(e.links.length>=6)return i.percolationProba};this.SUB_random=new e.proba.Random;this.doNotPercolateOnBorder=true;this.maxPercolationForAVertexAlreadyPercolate=0;if(t instanceof e.Mamesh){this.IN_vertices=t.vertices}else{this.IN_vertices=t}}t.prototype.goChanging=function(){if(this.IN_vertices==null)throw"vertices must be specifiate";var t=new e.HashMap;for(var i=0,r=this.IN_vertices;i<r.length;i++){var s=r[i];t.putValue(s,s.links.length)}for(var n=0,a=this.IN_vertices;n<a.length;n++){var s=a[n];if(!(this.doNotPercolateOnBorder&&s.hasMark(e.Vertex.Markers.border))){if(this.SUB_random.pseudoRand()<this.probaToPercolateFunction(s)){var o=this.SUB_random.pseudoRandInt(s.links.length);var h=s.links[o].to;if(h.links.length>=t.getValue(h)-this.maxPercolationForAVertexAlreadyPercolate)e.Vertex.separateTwoVoisins(s,h)}}}};return t}();t.PercolationOnLinks=l;var u=function(){function t(e){this.OUT_nbLinkSuppressed=0;this.OUT_nbVerticesSuppressed=0;this.suppressCellWithNoVoisin=true;this.suppressLinkWithoutOppositeFunction=function(e){return e.links.length>=5};this.IN_mamesh=e}t.prototype.goChanging=function(){if(this.IN_mamesh==null)throw"a Mamesh is require as IN_arg";if(this.suppressLinkWithoutOppositeFunction!=null)this.suppressLinkWithoutOpposite()};t.prototype.suppressLinkWithoutOpposite=function(){var t=true;while(t){t=false;for(var i=0,r=this.IN_mamesh.vertices;i<r.length;i++){var s=r[i];if(this.suppressLinkWithoutOppositeFunction(s)){for(var n=0;n<s.links.length;n++){var a=s.links[n];if(a.opposites==null){t=true;e.Vertex.separateTwoVoisins(s,a.to);this.OUT_nbLinkSuppressed++;break}}}}}if(this.suppressCellWithNoVoisin){var o=[];for(var n=0;n<this.IN_mamesh.vertices.length;n++){if(this.IN_mamesh.vertices[n].links.length==0){o.push(n);this.OUT_nbVerticesSuppressed++}}this.IN_mamesh.vertices=e.tab.arrayMinusSomeIndices(this.IN_mamesh.vertices,o)}};return t}();t.MameshCleaner=u})(t=e.mameshModification||(e.mameshModification={}))})(mathis||(mathis={}));var mathis;(function(e){function t(e){if(e===void 0){e=false}if(typeof $!=="undefined")return true;if(e)throw"jQuery is not present";else return false}e.jQueryOK=t;var i=function(){function e(e){this.nbTimesThisActionMustBeFired=Number.POSITIVE_INFINITY;this.isPaused=false;this.firedCount=0;this.id="";this.frameInterval=null;this.timeIntervalMilli=null;this.passageOrderIndex=1;this.action=e;this.lastTimeFired=performance.now()}return e}();e.PeriodicAction=i;var r=function(){function i(i,r,a){var o=this;if(i===void 0){i=null}if(r===void 0){r=true}if(a===void 0){a=false}this.callbackIfWebglNotHere=null;this.periodicActions=[];this.sortAction=function(e,t){return e.passageOrderIndex-t.passageOrderIndex};this.backgroundColor=new e.Color("#d3d3d3");this.parentWidth=null;if(a)return;if(i==null){var h=document.getElementsByTagName("html")[0];h.style.height="100%";h.style.width="100%";h.style.padding="0";h.style.margin="0";this.canvasParent=document.getElementsByTagName("body")[0];this.canvasParent.style.height="100%";this.canvasParent.style.width="100%";this.canvasParent.style.padding="0";this.canvasParent.style.margin="0"}else{if(typeof i=="string"){this.canvasParent=document.getElementById(i);if(this.canvasParent==null)throw"the id:"+i+" does not correspond to any HTMLElement"}else if(i instanceof HTMLElement)this.canvasParent=i;else throw"htmlElementOrId must be an htmlElement or the id of an html element"}if(this.canvasParent.offsetHeight<10)throw"the container-height is too small. Perhaps no css-included ?";if(this.canvasParent.offsetWidth<10)throw"the container-width is too small.  Perhaps no css-included ?";this.canvas=document.createElement("canvas");this.canvas.style.touchAction="none";this.canvasParent.appendChild(this.canvas);var l=getComputedStyle(this.canvasParent);if(l.position==null||l.position==""){throw"the proposed place for mathisFrame, had no a style.position given (must be relative, absolute or fixed). "+"So it is automatically put to relative "}this.set100(this.canvas);this.callbackIfWebglNotHere=function(){setTimeout(function(){var e=document.createElement("DIV");e.id="noWebGL";e.innerHTML="<h3> Activez WebGL et relancez la page.</h3>\n                     <p> Safari: Développement > Activer WebGL</p>";o.canvasParent.appendChild(e);o.canvasParent.style.position="absolute";o.canvasParent.style.top="0";o.canvasParent.style.left="0";o.canvasParent.style.textAlign="center";o.canvasParent.style.zIndex="1001";o.canvasParent.style.backgroundColor="red"},100)};try{this.engine=new BABYLON.Engine(this.canvas,true)}catch(t){e.logger.c("webGL seems to not be present. Here is the message from Babylon:"+t);this.callbackIfWebglNotHere();this.engine=null}if(this.engine!=null){this.resetScene();var u=0;var c=0;var m=0;this.engine.runRenderLoop(function(){m++;for(var t in o.periodicActions){var i=o.periodicActions[t];if(i.isPaused)continue;if(i.timeIntervalMilli==null&&i.frameInterval==null){i.frameInterval=1;e.logger.c("no intervalle given for a periodic action: by default the action is fired every frame")}if(i.timeIntervalMilli!=null){var r=performance.now();if(r-i.lastTimeFired>i.timeIntervalMilli){o.fireAction(i);i.lastTimeFired=r}}else if(i.frameInterval!=null&&m%i.frameInterval==0)o.fireAction(i)}o.scene.render();u++;var s=o.engine.getFps();if(s<c)c=s;if(u%100==0){if(o.$info!=null)o.$info.textContent=c.toFixed();c=Number.MAX_VALUE}});this.domEventsHandler()}if(r){this.addDefaultLight();this.addDefaultCamera()}if(t()){this.messageDiv=new n(this);this.subWindow_NE=new s(this,"NE");this.subWindow_NW=new s(this,"NW");this.subWindow_N=new s(this,"N");this.subWindow_SE=new s(this,"SE");this.subWindow_SW=new s(this,"SW");this.subWindow_S=new s(this,"S");this.subWindow_W=new s(this,"W");this.subWindow_E=new s(this,"E")}}i.prototype.showFPSinCorner=function(){this.$info=document.createElement("DIV");this.canvasParent.appendChild(this.$info);this.$info.style.position="absolute";this.$info.style.top="0";this.$info.style.left="0";this.$info.style.width="100px";this.$info.style.height="20px";this.$info.style.backgroundColor="red";this.$info.style.zIndex="1000"};i.prototype.dispose=function(){this.engine.dispose()};i.prototype.resetScene=function(){if(this.scene!=null)this.scene.dispose();this.scene=new BABYLON.Scene(this.engine);this.scene.clearColor=this.backgroundColor.toBABYLON_Color4()};i.prototype.clearScene=function(t,i,r){if(t===void 0){t=true}if(i===void 0){i=true}if(r===void 0){r=true}if(this.scene==null)throw"no scene to clear";var s=[];if(this.scene.activeCamera!=null&&!t){if(this.scene.activeCamera instanceof e.macamera.GrabberCamera){var n=this.scene.activeCamera;for(var a=0,o=n.grabbers;a<o.length;a++){var h=o[a];s.push(h.mesh)}}}else{this.scene.cameras=[];if(this.scene.activeCamera!=null)this.scene.activeCamera.detachControl(this.canvas);this.scene.activeCamera=null}if(!r)s.push(this.skybox);else this.skybox=null;this.scene.meshes=s;if(i)this.scene.lights=[]};i.prototype.emptyAllCorner=function(){t(true);this.subWindow_NW.empty();this.subWindow_NE.empty();this.subWindow_N.empty();this.subWindow_SW.empty();this.subWindow_SE.empty();this.subWindow_S.empty();this.subWindow_W.empty();this.subWindow_E.empty()};i.prototype.addDefaultLight=function(){var e=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-1,1,-1),this.scene);e.diffuse=new BABYLON.Color3(1,1,1);e.specular=new BABYLON.Color3(1,1,1);e.groundColor=new BABYLON.Color3(.5,.5,.5)};i.prototype.getGrabberCamera=function(){if(this.scene.activeCamera==null)throw"no camera defined";if(this.scene.activeCamera instanceof e.macamera.GrabberCamera)return this.scene.activeCamera;else throw"active camera is not a grabber camera"};i.prototype.addDefaultCamera=function(){var t=new e.macamera.SphericalGrabber(this.scene);this.scene.activeCamera=new e.macamera.GrabberCamera(this,t);this.scene.activeCamera.attachControl(this.canvas)};i.prototype.pushPeriodicAction=function(e){this.periodicActions.push(e);this.periodicActions.sort(this.sortAction)};i.prototype.suppressPeriodicAction=function(e){var t=this.periodicActions.indexOf(e);if(t==-1)throw"this action is not registered";this.periodicActions.splice(t,1)};i.prototype.cleanAllPeriodicActions=function(){this.periodicActions=[]};i.prototype.pauseAllPeriodicActions=function(){for(var e=0,t=this.periodicActions;e<t.length;e++){var i=t[e];i.isPaused=true}};i.prototype.unpauseAllPeriodicActions=function(){for(var e=0,t=this.periodicActions;e<t.length;e++){var i=t[e];i.isPaused=false}};i.prototype.fireAction=function(e){e.action();e.firedCount++;if(e.firedCount>=e.nbTimesThisActionMustBeFired){this.suppressPeriodicAction(e)}};i.prototype.set100=function(e){e.style.position="absolute";e.style.top="0";e.style.left="0";e.style.width="100%";e.style.height="100%"};i.prototype.onParentDimChange=function(){var e=this.canvasParent.offsetWidth;if(this.parentWidth==null)this.parentWidth=e;else{if(e!=this.parentWidth){this.parentWidth=e;this.engine.resize();console.log("dim of parent of canvas  changes")}}};i.prototype.domEventsHandler=function(){var e=this;this.parentWidth=this.canvasParent.offsetWidth;window.addEventListener("resize",function(){e.onParentDimChange()});setInterval(function(){e.onParentDimChange()},1e3);var t=function(){var t=e.scene.pick(e.scene.pointerX,e.scene.pointerY,function(e){return e.isPickable},false);if(t.pickedMesh!=null){var i=t.pickedMesh.onClick;if(i!=null){i(t.pickedPoint)}}};var i;var r=function(){i=performance.now()};var s=function(){if(performance.now()-i<500)t()};var n=BABYLON.Tools.GetPointerPrefix();this.canvas.addEventListener(n+"down",r,false);this.canvas.addEventListener(n+"up",s,false)};return i}();e.MathisFrame=r;var s=function(){function e(e,i){this.mathisFrame=e;t(true);this.$visual=$('<div class="subWindow">');this.$visual.addClass(i);this.mathisFrame.canvasParent.appendChild(this.$visual[0])}e.prototype.appendAndGoToLine=function(e){this.$visual.append($("<div>").append(e))};e.prototype.append=function(e){this.$visual.append(e)};e.prototype.empty=function(){this.$visual.empty()};return e}();e.SubWindow=s;var n=function(){function e(e){this.mathisFrame=e}e.prototype.addInMathisFrame=function(){this.$logDiv=document.createElement("DIV");this.mathisFrame.canvasParent.appendChild(this.$logDiv);this.$logDiv.style.position="absolute";this.$logDiv.style.top="0";this.$logDiv.style.left="0";this.$logDiv.style.width="100%";this.$logDiv.style.backgroundColor="white";this.$logDiv.style.zIndex="900"};e.prototype.append=function(e){if(this.$logDiv==null)this.addInMathisFrame();var t=document.createElement("DIV");t.innerHTML=e;this.$logDiv.appendChild(t)};e.prototype.empty=function(){if(this.$logDiv==null)return;this.$logDiv.innerHTML=""};return e}();e.MessageDiv=n;var a=function(e){__extends(t,e);function t(){e.apply(this,arguments)}t.prototype.addInMathisFrame=function(){};t.prototype.append=function(e){};t.prototype.empty=function(){};return t}(n);e.EmptyMessageDivForTest=a;var o=function(e){__extends(t,e);function t(){e.call(this,null,null,true);this.messageDiv=new a(this)}t.prototype.dispose=function(){};t.prototype.resetScene=function(){};t.prototype.clearScene=function(e,t,i){if(e===void 0){e=true}if(t===void 0){t=true}if(i===void 0){i=true}};t.prototype.addDefaultLight=function(){};t.prototype.getGrabberCamera=function(){return new h};t.prototype.addDefaultCamera=function(){};t.prototype.pushPeriodicAction=function(e){};t.prototype.set100=function(e){};return t}(r);e.EmptyMathisFrameForFastTest=o;var h=function(){function e(){}e.prototype.changePosition=function(e,t){if(t===void 0){t=true}};e.prototype.changeFrontDir=function(e,t){if(t===void 0){t=true}};e.prototype.changeUpVector=function(e,t){if(t===void 0){t=true}};return e}();e.EmptyGrabberCameraForTest=h})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=BABYLON.Vector3;var r=BABYLON.StandardMaterial;var s=function(){function t(t,i,r){this.vecA=t;this.vecB=i;this.vecC=r;this.matWebCoordinateToPoint=new e.MM;this.matPointToWebCoordinate=new e.MM;this.isCartesian=false;this.pointWC=new e.XYZ(0,0,0);this.domainCenter=new e.XYZ(0,0,0);this.domainAroundCenter=new e.XYZ(0,0,0);this._positionWC=new a(0,0,0);this._domainPosition=new o(0,0,0);this._domainPositioncenter=new e.XYZ(0,0,0);this._zero=new e.XYZ(0,0,0);e.geo.matrixFromLines(t,i,r,this.matWebCoordinateToPoint);e.geo.inverse(this.matWebCoordinateToPoint,this.matPointToWebCoordinate)}t.prototype.contains=function(e){throw"must be override"};t.prototype.webCoordinateToPoint=function(t,i){return e.geo.multiplicationMatrixVector(this.matWebCoordinateToPoint,t,i)};t.prototype.pointToWebCoordinate=function(t,i){e.geo.multiplicationMatrixVector(this.matPointToWebCoordinate,t,i)};t.prototype.getDomainContaining=function(e){this.pointToWebCoordinate(e,this.pointWC);if(this.isCartesian)return new o(this.pointWC.x,this.pointWC.y,this.pointWC.z);else{for(var t=-1;t<=1;t++){for(var i=-1;i<=1;i++){for(var r=-1;r<=1;r++){var s=new o(this.pointWC.x+t,this.pointWC.y+i,this.pointWC.z+r);if(s.contains(e,this))return s}}}}};t.prototype.getDomainsAround=function(t,i,r){if(r===void 0){r=true}var s=[];var n=Math.floor(t/=2);var a=new e.XYZ(n,n,n);for(var h=-a.x;h<=a.x;h++){for(var l=-a.y;l<=a.y;l++){for(var u=-a.z;u<=a.z;u++){var c=new o(h,l,u);if(!(r&&h==0&&l==0&&u==0)){c.getCenter(this,this.domainAroundCenter);if(e.XYZ.DistanceSquared(this.domainAroundCenter,this.domainCenter)<i*i)s.push(c)}}}}return s};t.prototype.modulo=function(e,t){this.pointToWebCoordinate(e,this._positionWC);this._domainPosition.whichContains(this._positionWC);this._domainPosition.getCenter(this,this._domainPositioncenter);t.copyFrom(e).substract(this._domainPositioncenter)};return t}();t.FundamentalDomain=s;var n=function(t){__extends(s,t);function s(i,r,s){t.call(this,i,r,s);this.pointWC2=new e.XYZ(0,0,0);this.isCartesian=true}s.prototype.contains=function(e){t.prototype.pointToWebCoordinate.call(this,e,this.pointWC2);if(Math.abs(this.pointWC2.x)>1/2)return false;if(Math.abs(this.pointWC2.y)>1/2)return false;if(Math.abs(this.pointWC2.z)>1/2)return false;return true};s.prototype.drawMe=function(e){var t=BABYLON.Mesh.CreateBox("",1,e);t.scaling=new i(this.vecA.length(),this.vecB.length(),this.vecC.length());t.material=new r("",e);t.material.alpha=.2};s.prototype.getCorner=function(){var t=new e.XYZ(0,0,0);t.add(this.vecA).add(this.vecB).add(this.vecC);t.scaleInPlace(-.5);return t};s.prototype.getArretes=function(t){var i=this.getCorner();var r=new Array;var s=1;var n=BABYLON.Mesh.CreateCylinder("",1,s,s,12,null,t);var a=BABYLON.Mesh.CreateCylinder("",1,s,s,12,null,t);var o=BABYLON.Mesh.CreateCylinder("",1,s,s,12,null,t);new e.visu3d.ElongateAMeshFromBeginToEnd(i,e.XYZ.newFrom(i).add(this.vecA),n).goChanging();new e.visu3d.ElongateAMeshFromBeginToEnd(i,e.XYZ.newFrom(i).add(this.vecB),a).goChanging();new e.visu3d.ElongateAMeshFromBeginToEnd(i,e.XYZ.newFrom(i).add(this.vecC),o).goChanging();r.push(n);r.push(a);r.push(o);return r};return s}(s);t.CartesianFundamentalDomain=n;var a=function(e){__extends(t,e);function t(){e.apply(this,arguments)}return t}(e.XYZ);t.WebCoordinate=a;var o=function(t){__extends(i,t);function i(i,r,s){t.call(this,Math.round(i),Math.round(r),Math.round(s));this._point=new e.XYZ(0,0,0);this._domainCenter=new e.XYZ(0,0,0)}i.prototype.whichContains=function(e){this.x=Math.round(e.x);this.y=Math.round(e.y);this.z=Math.round(e.z);return this};i.prototype.equals=function(e){if(e.x!=this.x)return false;if(e.y!=this.y)return false;if(e.z!=this.z)return false;return true};i.prototype.getCenter=function(e,t){e.webCoordinateToPoint(this,t)};i.prototype.contains=function(e,t){this._point.copyFrom(e);this.getCenter(t,this._domainCenter);this._point.substract(this._domainCenter);return t.contains(this._point)};return i}(a);t.Domain=o;var h=function(){function t(e,t,i){this.fd=e;this.maxDistance=t;this.nbRepetitions=i}t.prototype.addMesh=function(t){var i=this;var r=this.fd.getDomainsAround(this.nbRepetitions,this.maxDistance);r.forEach(function(r){var s=new e.XYZ(0,0,0);var n=t.createInstance("");r.getCenter(i.fd,s);n.position.addInPlace(s);n.visibility=1;n.isVisible=true})};t.prototype.addInstancedMesh=function(t){var i=this;var r=this.fd.getDomainsAround(this.nbRepetitions,this.maxDistance);r.forEach(function(r){var s=new e.XYZ(0,0,0);var n=t.sourceMesh.createInstance("");n.scaling.copyFrom(t.scaling);n.position.copyFrom(t.position);n.rotationQuaternion=new BABYLON.Quaternion(0,0,0,0);n.rotationQuaternion.copyFrom(t.rotationQuaternion);r.getCenter(i.fd,s);n.position.addInPlace(s);n.visibility=1;n.isVisible=true})};t.prototype.addAbstractMesh=function(e){if(e instanceof BABYLON.Mesh)this.addMesh(e);else if(e instanceof BABYLON.InstancedMesh)this.addInstancedMesh(e)};return t}();t.Multiply=h})(t=e.periodicWorld||(e.periodicWorld={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){t.platonic=["tetrahedron","cube","octahedron","dodecahedron","icosahedron"];t.archimedean=["truncated tetrahedron","cuboctahedron","truncated cube","truncated octahedron","rhombicuboctahedron","truncated cuboctahedron","snub cube","icosidodecahedron","truncated dodecahedron","truncated icosahedron","rhombicosidodecahedron","truncated icosidodecahedron","snub dodecahedron"];t.antiprisms=["square antiprism","pentagonal antiprism","hexagonal antiprism","octagonal antiprism","decagonal antiprism"];t.johnson=["square pyramid","pentagonal pyramid","triangular cupola","square cupola","pentagonal cupola","pentagonal rotunda","elongated triangular pyramid","elongated square pyramid","elongated pentagonal pyramid","gyroelongated square pyramid","gyroelongated pentagonal pyramid","triangular bipyramid","pentagonal bipyramid","elongated triangular bipyramid","elongated square bipyramid","elongated pentagonal bipyramid","gyroelongated square bipyramid","elongated triangular cupola","elongated square cupola","elongated pentagonal cupola","elongated pentagonal rotunda","gyroelongated triangular cupola","gyroelongated square cupola","gyroelongated pentagonal cupola","gyroelongated pentagonal rotunda","gyrobifastigium","triangular orthobicupola","square orthobicupola","square gyrobicupola","pentagonal orthobicupola","pentagonal gyrobicupola","pentagonal orthocupolarotunda","pentagonal gyrocupolarotunda","pentagonal orthobirotunda","elongated triangular orthobicupola","elongated triangular gyrobicupola","elongated square gyrobicupola","elongated pentagonal orthobicupola","elongated pentagonal gyrobicupola","elongated pentagonal orthocupolarotunda","elongated pentagonal gyrocupolarotunda","elongated pentagonal orthobirotunda","elongated pentagonal gyrobirotunda","gyroelongated triangular bicupola","gyroelongated square bicupola","gyroelongated pentagonal bicupola","gyroelongated pentagonal cupolarotunda","gyroelongated pentagonal birotunda","augmented triangular prism","biaugmented triangular prism","triaugmented triangular prism","augmented pentagonal prism","biaugmented pentagonal prism","augmented hexagonal prism","parabiaugmented hexagonal prism","metabiaugmented hexagonal prism","triaugmented hexagonal prism","augmented dodecahedron","parabiaugmented dodecahedron","metabiaugmented dodecahedron","triaugmented dodecahedron","metabidiminished icosahedron","tridiminished icosahedron","augmented tridiminished icosahedron","augmented truncated tetrahedron","augmented truncated cube","biaugmented truncated cube","augmented truncated dodecahedron","parabiaugmented truncated dodecahedron","metabiaugmented truncated dodecahedron","triaugmented truncated dodecahedron","gyrate rhombicosidodecahedron","parabigyrate rhombicosidodecahedron","metabigyrate rhombicosidodecahedron","trigyrate rhombicosidodecahedron","diminished rhombicosidodecahedron","paragyrate diminished rhombicosidodecahedron","metagyrate diminished rhombicosidodecahedron","bigyrate diminished rhombicosidodecahedron","parabidiminished rhombicosidodecahedron","metabidiminished rhombicosidodecahedron","gyrate bidiminished rhombicosidodecahedron","tridiminished rhombicosidodecahedron","snub disphenoid","snub square antiprism","sphenocorona","augmented sphenocorona","sphenomegacorona","hebesphenomegacorona","disphenocingulum","bilunabirotunda","triangular hebesphenorotunda"];t.prisms=["triangular prism","pentagonal prism","hexagonal prism","octagonal prism","decagonal prism"];var i=function(){function t(e){this.makeLinks=true;this.type=e.toLowerCase()}t.dataToMamesh=function(t){var i=new e.Mamesh;for(var r=0,s=t.vertices;r<s.length;r++){var n=s[r];i.newVertex(new e.XYZ(n[0],n[1],n[2]))}var a=Number.MIN_VALUE;for(var o=0,h=i.vertices;o<h.length;o++){var l=h[o];var u=l.position.length();if(u>a)a=u}for(var c=0,m=i.vertices;c<m.length;c++){var l=m[c];l.position.scale(1/a)}var p=0;for(var f=0,d=t.faces;f<d.length;f++){var v=d[f];if(v.length==3)i.addATriangle(i.vertices[v[0]],i.vertices[v[1]],i.vertices[v[2]]);else if(v.length==4)i.addASquare(i.vertices[v[0]],i.vertices[v[1]],i.vertices[v[2]],i.vertices[v[3]]);else if(v.length>=5){var g=i.newVertex(new e.XYZ(0,0,0));g.markers.push(e.Vertex.Markers.polygonCenter);p=1/v.length;var y=[i.vertices[v[0]]];var b=[y[0].position];var w=[p];for(var M=1;M<v.length;M++){y.push(i.vertices[v[M]]);b.push(y[M].position);w.push(p)}e.geo.baryCenter(b,w,g.position);for(var M=0;M<v.length;M++)i.addATriangle(y[M],y[(M+1)%v.length],g)}}new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(i).goChanging();return i};t.prototype.go=function(){var i=[];i["tetrahedron"]={vertices:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],faces:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]};i["cube"]={vertices:[[0,0,1.224745],[1.154701,0,.4082483],[-.5773503,1,.4082483],[-.5773503,-1,.4082483],[.5773503,1,-.4082483],[.5773503,-1,-.4082483],[-1.154701,0,-.4082483],[0,0,-1.224745]],faces:[[0,1,4,2],[0,2,6,3],[0,3,5,1],[1,5,7,4],[2,4,7,6],[3,6,7,5]]};i["octahedron"]={vertices:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]};i["dodecahedron"]={vertices:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],faces:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]};i["icosahedron"]={vertices:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]};i["truncated tetrahedron"]={vertices:[[0,0,1.105542],[.8528029,0,.7035265],[-.7106691,.4714045,.7035265],[.3316456,-.7856742,.7035265],[.9949367,.4714045,-.1005038],[-1.089693,.1571348,-.1005038],[-.5685352,.942809,-.1005038],[-.04737794,-1.099944,-.1005038],[.6159132,.1571348,-.904534],[.2842676,.942809,-.5025189],[-.758047,-.6285394,-.5025189],[.09475587,-.6285394,-.904534]],faces:[[0,3,1],[2,6,5],[4,8,9],[7,10,11],[0,1,4,9,6,2],[0,2,5,10,7,3],[1,3,7,11,8,4],[5,6,9,8,11,10]]};i["truncated cube"]={vertices:[[0,0,1.042011],[.5621693,0,.8773552],[-.4798415,.2928932,.8773552],[.2569714,-.5,.8773552],[.8773552,.2928932,.4798415],[-.9014684,.2071068,.4798415],[-.5962706,.7071068,.4798415],[.1405423,-.9142136,.4798415],[1.017898,.2071068,-.08232778],[.7609261,.7071068,.08232778],[-1.017898,-.2071068,.08232778],[-.2810846,1,.08232778],[-.2810846,-1,.08232778],[.2810846,-1,-.08232778],[.9014684,-.2071068,-.4798415],[.2810846,1,-.08232778],[-.7609261,-.7071068,-.08232778],[-.8773552,-.2928932,-.4798415],[-.1405423,.9142136,-.4798415],[.5962706,-.7071068,-.4798415],[.4798415,-.2928932,-.8773552],[-.5621693,0,-.8773552],[-.2569714,.5,-.8773552],[0,0,-1.042011]],faces:[[0,3,1],[2,6,5],[4,8,9],[7,12,13],[10,17,16],[11,15,18],[14,19,20],[21,22,23],[0,1,4,9,15,11,6,2],[0,2,5,10,16,12,7,3],[1,3,7,13,19,14,8,4],[5,6,11,18,22,21,17,10],[8,14,20,23,22,18,15,9],[12,16,17,21,23,20,19,13]]};i["truncated octahedron"]={vertices:[[0,0,1.054093],[.6324555,0,.843274],[-.421637,.4714045,.843274],[-.07027284,-.6285394,.843274],[.843274,.4714045,.421637],[.5621827,-.6285394,.6324555],[-.9135469,.3142697,.421637],[-.2108185,.942809,.421637],[-.5621827,-.7856742,.421637],[.9838197,.3142697,-.2108185],[.421637,.942809,.2108185],[.7027284,-.7856742,0],[-.7027284,.7856742,0],[-.9838197,-.3142697,.2108185],[-.421637,-.942809,-.2108185],[.5621827,.7856742,-.421637],[.9135469,-.3142697,-.421637],[.2108185,-.942809,-.421637],[-.5621827,.6285394,-.6324555],[-.843274,-.4714045,-.421637],[.07027284,.6285394,-.843274],[.421637,-.4714045,-.843274],[-.6324555,0,-.843274],[0,0,-1.054093]],faces:[[0,3,5,1],[2,7,12,6],[4,9,15,10],[8,13,19,14],[11,17,21,16],[18,20,23,22],[0,1,4,10,7,2],[0,2,6,13,8,3],[1,5,11,16,9,4],[3,8,14,17,11,5],[6,12,18,22,19,13],[7,10,15,20,18,12],[9,16,21,23,20,15],[14,19,22,23,21,17]]};i["truncated dodecahedron"]={vertices:[[0,0,1.014485],[.3367628,0,.9569589],[-.2902233,.1708204,.9569589],[.1634681,-.2944272,.9569589],[.5914332,.1708204,.806354],[-.5963465,.1527864,.806354],[-.4230517,.4472136,.806354],[.1377417,-.6,.806354],[.8302037,.1527864,.5626702],[.6667356,.4472136,.6201961],[-.8014407,-.0472136,.6201961],[-.3477493,.7236068,.6201961],[-.06735256,-.8,.6201961],[.2694102,-.8,.5626702],[.9618722,-.0472136,.3189863],[.5339072,.7236068,.4695912],[-.8271671,-.3527864,.4695912],[-.9599955,-.0763932,.3189863],[-.3992021,.8763932,.3189863],[-.09307895,.8944272,.4695912],[-.3734757,-.818034,.4695912],[.5081808,-.818034,.3189863],[.9361459,-.3527864,.1683814],[1.011448,-.0763932,-.0177765],[.4824544,.8763932,.1683814],[.2436839,.8944272,.4120653],[-.663699,-.6472136,.4120653],[-1.011448,.0763932,.0177765],[-.5577569,.8472136,.0177765],[-.5320305,-.8472136,.1683814],[.5577569,-.8472136,-.0177765],[.7628511,-.6472136,.1683814],[.9599955,.0763932,-.3189863],[.5320305,.8472136,-.1683814],[-.9618722,.0472136,-.3189863],[-.9361459,.3527864,-.1683814],[-.7628511,.6472136,-.1683814],[-.5081808,.818034,-.3189863],[-.4824544,-.8763932,-.1683814],[.3992021,-.8763932,-.3189863],[.8014407,.0472136,-.6201961],[.8271671,.3527864,-.4695912],[.663699,.6472136,-.4120653],[.3734757,.818034,-.4695912],[-.8302037,-.1527864,-.5626702],[-.2694102,.8,-.5626702],[-.5339072,-.7236068,-.4695912],[-.2436839,-.8944272,-.4120653],[.09307895,-.8944272,-.4695912],[.3477493,-.7236068,-.6201961],[.5963465,-.1527864,-.806354],[.06735256,.8,-.6201961],[-.6667356,-.4472136,-.6201961],[-.5914332,-.1708204,-.806354],[-.1377417,.6,-.806354],[.4230517,-.4472136,-.806354],[.2902233,-.1708204,-.9569589],[-.3367628,0,-.9569589],[-.1634681,.2944272,-.9569589],[0,0,-1.014485]],faces:[[0,3,1],[2,6,5],[4,8,9],[7,12,13],[10,17,16],[11,19,18],[14,22,23],[15,24,25],[20,26,29],[21,30,31],[27,35,34],[28,37,36],[32,40,41],[33,42,43],[38,46,47],[39,48,49],[44,53,52],[45,51,54],[50,55,56],[57,58,59],[0,1,4,9,15,25,19,11,6,2],[0,2,5,10,16,26,20,12,7,3],[1,3,7,13,21,31,22,14,8,4],[5,6,11,18,28,36,35,27,17,10],[8,14,23,32,41,42,33,24,15,9],[12,20,29,38,47,48,39,30,21,13],[16,17,27,34,44,52,46,38,29,26],[18,19,25,24,33,43,51,45,37,28],[22,31,30,39,49,55,50,40,32,23],[34,35,36,37,45,54,58,57,53,44],[40,50,56,59,58,54,51,43,42,41],[46,52,53,57,59,56,55,49,48,47]]};i["truncated icosahedron"]={vertices:[[0,0,1.021],[.4035482,0,.9378643],[-.2274644,.3333333,.9378643],[-.1471226,-.375774,.9378643],[.579632,.3333333,.7715933],[.5058321,-.375774,.8033483],[-.6020514,.2908927,.7715933],[-.05138057,.6666667,.7715933],[.1654988,-.6080151,.8033483],[-.5217096,-.4182147,.7715933],[.8579998,.2908927,.4708062],[.3521676,.6666667,.6884578],[.7841999,-.4182147,.5025612],[-.657475,.5979962,.5025612],[-.749174,-.08488134,.6884578],[-.3171418,.8302373,.5025612],[.1035333,-.8826969,.5025612],[-.5836751,-.6928964,.4708062],[.8025761,.5979962,.2017741],[.9602837,-.08488134,.3362902],[.4899547,.8302373,.3362902],[.7222343,-.6928964,.2017741],[-.8600213,.5293258,.1503935],[-.9517203,-.1535518,.3362902],[-.1793548,.993808,.1503935],[.381901,-.9251375,.2017741],[-.2710537,-.9251375,.3362902],[-.8494363,-.5293258,.2017741],[.8494363,.5293258,-.2017741],[1.007144,-.1535518,-.06725804],[.2241935,.993808,.06725804],[.8600213,-.5293258,-.1503935],[-.7222343,.6928964,-.2017741],[-1.007144,.1535518,.06725804],[-.381901,.9251375,-.2017741],[.1793548,-.993808,-.1503935],[-.2241935,-.993808,-.06725804],[-.8025761,-.5979962,-.2017741],[.5836751,.6928964,-.4708062],[.9517203,.1535518,-.3362902],[.2710537,.9251375,-.3362902],[.657475,-.5979962,-.5025612],[-.7841999,.4182147,-.5025612],[-.9602837,.08488134,-.3362902],[-.1035333,.8826969,-.5025612],[.3171418,-.8302373,-.5025612],[-.4899547,-.8302373,-.3362902],[-.8579998,-.2908927,-.4708062],[.5217096,.4182147,-.7715933],[.749174,.08488134,-.6884578],[.6020514,-.2908927,-.7715933],[-.5058321,.375774,-.8033483],[-.1654988,.6080151,-.8033483],[.05138057,-.6666667,-.7715933],[-.3521676,-.6666667,-.6884578],[-.579632,-.3333333,-.7715933],[.1471226,.375774,-.9378643],[.2274644,-.3333333,-.9378643],[-.4035482,0,-.9378643],[0,0,-1.021]],faces:[[0,3,8,5,1],[2,7,15,13,6],[4,10,18,20,11],[9,14,23,27,17],[12,21,31,29,19],[16,26,36,35,25],[22,32,42,43,33],[24,30,40,44,34],[28,39,49,48,38],[37,47,55,54,46],[41,45,53,57,50],[51,52,56,59,58],[0,1,4,11,7,2],[0,2,6,14,9,3],[1,5,12,19,10,4],[3,9,17,26,16,8],[5,8,16,25,21,12],[6,13,22,33,23,14],[7,11,20,30,24,15],[10,19,29,39,28,18],[13,15,24,34,32,22],[17,27,37,46,36,26],[18,28,38,40,30,20],[21,25,35,45,41,31],[23,33,43,47,37,27],[29,31,41,50,49,39],[32,34,44,52,51,42],[35,36,46,54,53,45],[38,48,56,52,44,40],[42,51,58,55,47,43],[48,49,50,57,59,56],[53,54,55,58,59,57]]};i["cuboctahedron"]={vertices:[[0,0,1.154701],[1,0,.5773503],[.3333333,.942809,.5773503],[-1,0,.5773503],[-.3333333,-.942809,.5773503],[1,0,-.5773503],[.6666667,-.942809,0],[-.6666667,.942809,0],[.3333333,.942809,-.5773503],[-1,0,-.5773503],[-.3333333,-.942809,-.5773503],[0,0,-1.154701]],faces:[[0,1,2],[0,3,4],[1,6,5],[2,8,7],[3,7,9],[4,10,6],[5,11,8],[9,11,10],[0,2,7,3],[0,4,6,1],[1,5,8,2],[3,9,10,4],[5,6,10,11],[7,8,11,9]]};i["truncated cuboctahedron"]={vertices:[[0,0,1.024117],[.4314788,0,.928785],[-.02106287,.4309644,.928785],[-.3410582,-.2642977,.928785],[.4104159,.4309644,.833453],[.7006238,-.2642977,.6986333],[-.3831839,.5976311,.7381211],[-.3919084,-.6380712,.6986333],[-.7031792,-.09763107,.7381211],[.6584981,.5976311,.5079694],[.6497736,-.6380712,.4684816],[.948706,-.09763107,.3731496],[-.4638216,.8333333,.3731496],[-.7242421,.3333333,.6427891],[-.7540295,-.4714045,.5079694],[-.1227634,-.9023689,.4684816],[.5778604,.8333333,.1429979],[.9276431,.3333333,.2778177],[.8978557,-.4714045,.1429979],[.3087154,-.9023689,.3731496],[-.8048797,.5690356,.2778177],[-.2157394,1,.04766598],[-.8470055,-.5690356,.08715377],[-.2157394,-1,.04766598],[.8470055,.5690356,-.08715377],[.2157394,1,-.04766598],[.8048797,-.5690356,-.2778177],[.2157394,-1,-.04766598],[-.8978557,.4714045,-.1429979],[-.3087154,.9023689,-.3731496],[-.9276431,-.3333333,-.2778177],[-.5778604,-.8333333,-.1429979],[.7540295,.4714045,-.5079694],[.1227634,.9023689,-.4684816],[.7242421,-.3333333,-.6427891],[.4638216,-.8333333,-.3731496],[-.948706,.09763107,-.3731496],[-.6497736,.6380712,-.4684816],[-.6584981,-.5976311,-.5079694],[.7031792,.09763107,-.7381211],[.3919084,.6380712,-.6986333],[.3831839,-.5976311,-.7381211],[-.7006238,.2642977,-.6986333],[-.4104159,-.4309644,-.833453],[.3410582,.2642977,-.928785],[.02106287,-.4309644,-.928785],[-.4314788,0,-.928785],[0,0,-1.024117]],faces:[[0,1,4,2],[3,8,14,7],[5,10,18,11],[6,12,20,13],[9,17,24,16],[15,23,27,19],[21,25,33,29],[22,30,38,31],[26,35,41,34],[28,37,42,36],[32,39,44,40],[43,46,47,45],[0,2,6,13,8,3],[1,5,11,17,9,4],[7,14,22,31,23,15],[10,19,27,35,26,18],[12,21,29,37,28,20],[16,24,32,40,33,25],[30,36,42,46,43,38],[34,41,45,47,44,39],[0,3,7,15,19,10,5,1],[2,4,9,16,25,21,12,6],[8,13,20,28,36,30,22,14],[11,18,26,34,39,32,24,17],[23,31,38,43,45,41,35,27],[29,33,40,44,47,46,42,37]]};i["rhombicuboctahedron"]={vertices:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],faces:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]};i["snub cube"]={vertices:[[0,0,1.077364],[.7442063,0,.7790187],[.3123013,.6755079,.7790187],[-.482096,.5669449,.7790187],[-.7169181,-.1996786,.7790187],[-.1196038,-.7345325,.7790187],[.6246025,-.7345325,.4806734],[1.056508,-.1996786,.06806912],[.8867128,.5669449,.2302762],[.2621103,1.042774,.06806912],[-.532287,.9342111,.06806912],[-1.006317,.3082417,.2302762],[-.7020817,-.784071,.2302762],[.02728827,-1.074865,.06806912],[.6667271,-.784071,-.3184664],[.8216855,-.09111555,-.6908285],[.6518908,.6755079,-.5286215],[-.1196038,.8751866,-.6168117],[-.8092336,.4758293,-.5286215],[-.9914803,-.2761507,-.3184664],[-.4467414,-.825648,-.5286215],[.1926974,-.5348539,-.915157],[.1846311,.2587032,-1.029416],[-.5049987,-.1406541,-.9412258]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[1,6,7],[1,7,8],[1,8,2],[2,8,9],[3,10,11],[3,11,4],[4,12,5],[5,12,13],[5,13,6],[6,13,14],[6,14,7],[7,14,15],[8,16,9],[9,16,17],[9,17,10],[10,17,18],[10,18,11],[11,18,19],[12,19,20],[12,20,13],[14,21,15],[15,21,22],[15,22,16],[16,22,17],[18,23,19],[19,23,20],[20,23,21],[21,23,22],[0,5,6,1],[2,9,10,3],[4,11,19,12],[7,15,16,8],[13,20,21,14],[17,22,23,18]]};i["icosidodecahedron"]={vertices:[[0,0,1.051462],[.618034,0,.8506508],[.2763932,.5527864,.8506508],[-.618034,0,.8506508],[-.2763932,-.5527864,.8506508],[1,0,.3249197],[.7236068,-.5527864,.5257311],[-.1708204,.8944272,.5257311],[.4472136,.8944272,.3249197],[-1,0,.3249197],[-.7236068,.5527864,.5257311],[.1708204,-.8944272,.5257311],[-.4472136,-.8944272,.3249197],[1,0,-.3249197],[.8944272,.5527864,0],[.5527864,-.8944272,0],[-.5527864,.8944272,0],[.4472136,.8944272,-.3249197],[-1,0,-.3249197],[-.8944272,-.5527864,0],[-.4472136,-.8944272,-.3249197],[.618034,0,-.8506508],[.7236068,-.5527864,-.5257311],[.1708204,-.8944272,-.5257311],[-.7236068,.5527864,-.5257311],[-.1708204,.8944272,-.5257311],[.2763932,.5527864,-.8506508],[-.618034,0,-.8506508],[-.2763932,-.5527864,-.8506508],[0,0,-1.051462]],faces:[[0,1,2],[0,3,4],[1,6,5],[2,8,7],[3,10,9],[4,12,11],[5,13,14],[6,11,15],[7,16,10],[8,14,17],[9,18,19],[12,19,20],[13,22,21],[15,23,22],[16,25,24],[17,26,25],[18,24,27],[20,28,23],[21,29,26],[27,29,28],[0,2,7,10,3],[0,4,11,6,1],[1,5,14,8,2],[3,9,19,12,4],[5,6,15,22,13],[7,8,17,25,16],[9,10,16,24,18],[11,12,20,23,15],[13,21,26,17,14],[18,27,28,20,19],[21,22,23,28,29],[24,25,26,29,27]]};i["truncated icosidodecahedron"]={vertices:[[0,0,1.008759],[.2629922,0,.973874],[-.00462747,.2629515,.973874],[-.2211363,-.1423503,.973874],[.2583647,.2629515,.9389886],[.4673861,-.1423503,.8825429],[-.2303913,.3835526,.9041033],[-.3159502,-.372678,.8825429],[-.4469001,-.02174919,.9041033],[.4581312,.3835526,.8127722],[.5351104,-.372678,.7696515],[.6671526,-.02174919,.7563265],[-.3326926,.5786893,.7563265],[-.4515276,.2412023,.8692179],[-.541714,-.2520769,.8127722],[-.248226,-.6030057,.7696515],[.518368,.5786893,.6434351],[.6625252,.2412023,.7214412],[.7348768,-.2520769,.6434351],[.4402965,-.6030057,.6783205],[-.5538289,.436339,.7214412],[-.2724557,.7738261,.5869894],[-.6997536,-.3618034,.6301101],[-.04383203,-.745356,.6783205],[-.4062656,-.7127322,.5869894],[.722762,.436339,.552104],[.4160667,.7738261,.4956583],[.8398294,-.3618034,.4258876],[.2191601,-.745356,.6434351],[.5452491,-.7127322,.460773],[-.7147284,.4891254,.5172187],[-.07268925,.8944272,.460773],[-.4333553,.8266125,.3827669],[-.8606531,-.309017,.4258876],[-.6320294,-.5921311,.5172187],[-.2018716,-.8550825,.4956583],[.8248546,.4891254,.3129962],[.1903029,.8944272,.4258876],[.5181594,.8266125,.2565505],[.9419221,-.309017,.1867798],[.7450156,-.5921311,.3345566],[.3241127,-.8550825,.4258876],[-.8727679,.3793989,.3345566],[-.6544916,.6842621,.3478816],[-.2335888,.9472136,.2565505],[-.7929289,-.5393447,.3129962],[-.9629544,-.1138803,.2781109],[-.096919,-.9648091,.2781109],[.9298072,.3793989,.09544872],[.7225533,.6842621,.1652194],[.2923956,.9472136,.1867798],[.8471082,-.5393447,.09544872],[1.002159,-.1138803,.01744268],[.1660732,-.9648091,.2432255],[-.8125311,.5745356,.1652194],[-.9675818,.1490712,.2432255],[-.1314961,1,.01744268],[-.8275059,-.5745356,.05232804],[-.9975315,-.1490712,.01744268],[-.1314961,-1,.01744268],[.8275059,.5745356,-.05232804],[.9975315,.1490712,-.01744268],[.1314961,1,-.01744268],[.8125311,-.5745356,-.1652194],[.9675818,-.1490712,-.2432255],[.1314961,-1,-.01744268],[-.8471082,.5393447,-.09544872],[-1.002159,.1138803,-.01744268],[-.1660732,.9648091,-.2432255],[-.7225533,-.6842621,-.1652194],[-.9298072,-.3793989,-.09544872],[-.2923956,-.9472136,-.1867798],[.7929289,.5393447,-.3129962],[.9629544,.1138803,-.2781109],[.096919,.9648091,-.2781109],[.6544916,-.6842621,-.3478816],[.8727679,-.3793989,-.3345566],[.2335888,-.9472136,-.2565505],[-.7450156,.5921311,-.3345566],[-.9419221,.309017,-.1867798],[-.3241127,.8550825,-.4258876],[-.8248546,-.4891254,-.3129962],[-.5181594,-.8266125,-.2565505],[-.1903029,-.8944272,-.4258876],[.6320294,.5921311,-.5172187],[.8606531,.309017,-.4258876],[.2018716,.8550825,-.4956583],[.7147284,-.4891254,-.5172187],[.4333553,-.8266125,-.3827669],[.07268925,-.8944272,-.460773],[-.8398294,.3618034,-.4258876],[-.5452491,.7127322,-.460773],[-.2191601,.745356,-.6434351],[-.722762,-.436339,-.552104],[-.4160667,-.7738261,-.4956583],[.6997536,.3618034,-.6301101],[.4062656,.7127322,-.5869894],[.04383203,.745356,-.6783205],[.5538289,-.436339,-.7214412],[.2724557,-.7738261,-.5869894],[-.7348768,.2520769,-.6434351],[-.4402965,.6030057,-.6783205],[-.6625252,-.2412023,-.7214412],[-.518368,-.5786893,-.6434351],[.541714,.2520769,-.8127722],[.248226,.6030057,-.7696515],[.4515276,-.2412023,-.8692179],[.3326926,-.5786893,-.7563265],[-.6671526,.02174919,-.7563265],[-.5351104,.372678,-.7696515],[-.4581312,-.3835526,-.8127722],[.4469001,.02174919,-.9041033],[.3159502,.372678,-.8825429],[.2303913,-.3835526,-.9041033],[-.4673861,.1423503,-.8825429],[-.2583647,-.2629515,-.9389886],[.2211363,.1423503,-.973874],[.00462747,-.2629515,-.973874],[-.2629922,0,-.973874],[0,0,-1.008759]],faces:[[0,1,4,2],[3,8,14,7],[5,10,18,11],[6,12,20,13],[9,17,25,16],[15,24,35,23],[19,28,41,29],[21,31,44,32],[22,33,45,34],[26,38,50,37],[27,40,51,39],[30,43,54,42],[36,48,60,49],[46,55,67,58],[47,59,65,53],[52,64,73,61],[56,62,74,68],[57,70,81,69],[63,75,87,76],[66,78,90,79],[71,82,94,83],[72,85,95,84],[77,89,99,88],[80,92,101,91],[86,96,105,97],[93,102,110,103],[98,107,113,106],[100,109,114,108],[104,111,116,112],[115,118,119,117],[0,2,6,13,8,3],[1,5,11,17,9,4],[7,14,22,34,24,15],[10,19,29,40,27,18],[12,21,32,43,30,20],[16,25,36,49,38,26],[23,35,47,53,41,28],[31,37,50,62,56,44],[33,46,58,70,57,45],[39,51,63,76,64,52],[42,54,66,79,67,55],[48,61,73,85,72,60],[59,71,83,89,77,65],[68,74,86,97,92,80],[69,81,93,103,94,82],[75,88,99,107,98,87],[78,91,101,109,100,90],[84,95,104,112,105,96],[102,108,114,118,115,110],[106,113,117,119,116,111],[0,3,7,15,23,28,19,10,5,1],[2,4,9,16,26,37,31,21,12,6],[8,13,20,30,42,55,46,33,22,14],[11,18,27,39,52,61,48,36,25,17],[24,34,45,57,69,82,71,59,47,35],[29,41,53,65,77,88,75,63,51,40],[32,44,56,68,80,91,78,66,54,43],[38,49,60,72,84,96,86,74,62,50],[58,67,79,90,100,108,102,93,81,70],[64,76,87,98,106,111,104,95,85,73],[83,94,103,110,115,117,113,107,99,89],[92,97,105,112,116,119,118,114,109,101]]};i["rhombicosidodecahedron"]={vertices:[[0,0,1.026054],[.447838,0,.9231617],[-.02363976,.4472136,.9231617],[-.4050732,.190983,.9231617],[-.1693344,-.4145898,.9231617],[.4241982,.4472136,.8202696],[.7673818,.190983,.6537868],[.5552827,-.4145898,.7566788],[-.2312241,.7562306,.6537868],[-.5744076,-.2236068,.8202696],[-.6126576,.5,.6537868],[.1738492,-.6708204,.7566788],[-.4669629,-.6381966,.6537868],[.493393,.7562306,.4873039],[.8748265,-.2236068,.4873039],[.8365765,.5,.320821],[.7054921,-.6381966,.3844118],[.08831973,.9472136,.3844118],[-.5434628,.809017,.320821],[-.8866463,-.1708204,.4873039],[-.9102861,.2763932,.3844118],[-.1237794,-.8944272,.4873039],[.3240586,-.8944272,.3844118],[-.7792016,-.5854102,.320821],[.6289922,.809017,.05144604],[1.010426,-.1708204,.05144604],[.9867859,.2763932,-.05144604],[.8410913,-.5854102,-.05144604],[-.223919,1,.05144604],[.223919,1,-.05144604],[-.8410913,.5854102,.05144604],[-.9867859,-.2763932,.05144604],[-1.010426,.1708204,-.05144604],[-.223919,-1,.05144604],[.223919,-1,-.05144604],[-.6289922,-.809017,-.05144604],[.7792016,.5854102,-.320821],[.9102861,-.2763932,-.3844118],[.8866463,.1708204,-.4873039],[.5434628,-.809017,-.320821],[-.3240586,.8944272,-.3844118],[.1237794,.8944272,-.4873039],[-.7054921,.6381966,-.3844118],[-.8365765,-.5,-.320821],[-.8748265,.2236068,-.4873039],[-.08831973,-.9472136,-.3844118],[-.493393,-.7562306,-.4873039],[.4669629,.6381966,-.6537868],[.6126576,-.5,-.6537868],[.5744076,.2236068,-.8202696],[.2312241,-.7562306,-.6537868],[-.1738492,.6708204,-.7566788],[-.5552827,.4145898,-.7566788],[-.7673818,-.190983,-.6537868],[-.4241982,-.4472136,-.8202696],[.1693344,.4145898,-.9231617],[.4050732,-.190983,-.9231617],[.02363976,-.4472136,-.9231617],[-.447838,0,-.9231617],[0,0,-1.026054]],faces:[[0,2,3],[1,6,5],[4,9,12],[7,16,14],[8,18,10],[11,21,22],[13,15,24],[17,29,28],[19,31,23],[20,30,32],[25,27,37],[26,38,36],[33,45,34],[35,43,46],[39,50,48],[40,41,51],[42,52,44],[47,49,55],[53,58,54],[56,57,59],[0,1,5,2],[0,3,9,4],[1,7,14,6],[2,8,10,3],[4,12,21,11],[5,6,15,13],[7,11,22,16],[8,17,28,18],[9,19,23,12],[10,18,30,20],[13,24,29,17],[14,16,27,25],[15,26,36,24],[19,20,32,31],[21,33,34,22],[23,31,43,35],[25,37,38,26],[27,39,48,37],[28,29,41,40],[30,42,44,32],[33,35,46,45],[34,45,50,39],[36,38,49,47],[40,51,52,42],[41,47,55,51],[43,53,54,46],[44,52,58,53],[48,50,57,56],[49,56,59,55],[54,58,59,57],[0,4,11,7,1],[2,5,13,17,8],[3,10,20,19,9],[6,14,25,26,15],[12,23,35,33,21],[16,22,34,39,27],[18,28,40,42,30],[24,36,47,41,29],[31,32,44,53,43],[37,48,56,49,38],[45,46,54,57,50],[51,55,59,58,52]]};i["snub dodecahedron"]={vertices:[[0,0,1.028031],[.4638569,0,.9174342],[.2187436,.4090409,.9174342],[-.2575486,.3857874,.9174342],[-.4616509,-.04518499,.9174342],[-.177858,-.4284037,.9174342],[.5726782,-.4284037,.7384841],[.8259401,-.04518499,.6104342],[.6437955,.3857874,.702527],[.349648,.7496433,.6104342],[-.421009,.7120184,.6104342],[-.6783139,.3212396,.702527],[-.6031536,-.4466658,.702527],[-.2749612,-.7801379,.6104342],[.1760766,-.6931717,.7384841],[.5208138,-.7801379,.4206978],[.8552518,-.4466658,.3547998],[1.01294,-.03548596,.1718776],[.7182239,.661842,.3208868],[.3633691,.9454568,.1758496],[-.04574087,.9368937,.4206978],[-.4537394,.905564,.1758496],[-.7792791,.5887312,.3208868],[-.9537217,.1462217,.3547998],[-.9072701,-.3283699,.3547998],[-.6503371,-.7286577,.3208868],[.08459482,-.9611501,.3547998],[.3949153,-.9491262,-.007072558],[.9360473,-.409557,-.1136978],[.9829382,.02692292,-.2999274],[.9463677,.4014808,-.007072558],[.6704578,.7662826,-.1419366],[-.05007646,1.025698,-.04779978],[-.4294337,.8845784,-.2999274],[-.9561681,.3719321,-.06525234],[-1.022036,-.1000338,-.04779978],[-.8659056,-.5502712,-.06525234],[-.5227761,-.8778535,-.1136978],[-.06856319,-1.021542,-.09273844],[.2232046,-.8974878,-.4489366],[.6515438,-.7200947,-.3373472],[.7969535,-.3253959,-.5619888],[.8066872,.4395354,-.461425],[.4468035,.735788,-.5619888],[.001488801,.8961155,-.503809],[-.3535403,.6537658,-.7102452],[-.7399517,.5547758,-.4489366],[-.9120238,.1102196,-.461425],[-.6593998,-.6182798,-.4896639],[-.2490651,-.8608088,-.503809],[.4301047,-.5764987,-.734512],[.5057577,-.1305283,-.8854492],[.5117735,.3422252,-.8232973],[.09739587,.5771941,-.8451093],[-.6018946,.2552591,-.7933564],[-.6879024,-.2100741,-.734512],[-.3340437,-.5171509,-.8232973],[.08570633,-.3414376,-.9658797],[.1277354,.1313635,-1.011571],[-.3044499,-.06760332,-.979586]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[1,6,7],[1,7,8],[1,8,2],[2,8,9],[3,10,11],[3,11,4],[4,12,5],[5,12,13],[5,13,14],[6,14,15],[6,15,16],[6,16,7],[7,16,17],[8,18,9],[9,18,19],[9,19,20],[10,20,21],[10,21,22],[10,22,11],[11,22,23],[12,24,25],[12,25,13],[13,26,14],[14,26,15],[15,26,27],[16,28,17],[17,28,29],[17,29,30],[18,30,31],[18,31,19],[19,32,20],[20,32,21],[21,32,33],[22,34,23],[23,34,35],[23,35,24],[24,35,36],[24,36,25],[25,36,37],[26,38,27],[27,38,39],[27,39,40],[28,40,41],[28,41,29],[29,42,30],[30,42,31],[31,42,43],[32,44,33],[33,44,45],[33,45,46],[34,46,47],[34,47,35],[36,48,37],[37,48,49],[37,49,38],[38,49,39],[39,50,40],[40,50,41],[41,50,51],[42,52,43],[43,52,53],[43,53,44],[44,53,45],[45,54,46],[46,54,47],[47,54,55],[48,55,56],[48,56,49],[50,57,51],[51,57,58],[51,58,52],[52,58,53],[54,59,55],[55,59,56],[56,59,57],[57,59,58],[0,5,14,6,1],[2,9,20,10,3],[4,11,23,24,12],[7,17,30,18,8],[13,25,37,38,26],[15,27,40,28,16],[19,31,43,44,32],[21,33,46,34,22],[29,41,51,52,42],[35,47,55,48,36],[39,49,56,57,50],[45,53,58,59,54]]};i["triangular prism"]={vertices:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],faces:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]};i["pentagonal prism"]={vertices:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],faces:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]};i["hexagonal prism"]={vertices:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],faces:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]};i["square pyramid"]={vertices:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],faces:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]};i["pentagonal pyramid"]={vertices:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],faces:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]};i["triangular bipyramid"]={vertices:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],faces:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]};i["pentagonal bipyramid"]={vertices:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],faces:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]};var r=i[this.type];if(r==null){e.logger.c("no internal data associated to the name:"+this.type);return null}else return t.dataToMamesh(r)};return t}();t.Polyhedron=i;function r(e,t){var r=new i(e).go();if(r!=null){t(r)}else{var s=new XMLHttpRequest;s.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var e=i.dataToMamesh(JSON.parse(this.responseText));t(e)}};var n=e.replace(/\s+/g,"-").toLowerCase();s.open("GET","TS/polyhedron/polyhedra/"+n+".json",true);s.send()}}t.getPolyhedronAsync=r})(t=e.polyhedron||(e.polyhedron={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){(function(e){e[e["square"]=0]="square";e[e["triangle"]=1]="triangle";e[e["diamond"]=2]="diamond";e[e["hexagonal"]=3]="hexagonal";e[e["slash"]=4]="slash";e[e["croisillon"]=5]="croisillon"})(t.Maille||(t.Maille={}));var i=t.Maille;var r=function(){function t(e){this.makeLinks=true;this.markCorners=true;this.addALoopLineAround=false;this.mamesh=e}t.prototype.go=function(){var t=this.mamesh.newVertex(new e.XYZ(0,0,0));var i=this.mamesh.newVertex(new e.XYZ(0,1,0));var r=this.mamesh.newVertex(new e.XYZ(1,0,0));this.mamesh.addATriangle(t,i,r);if(this.markCorners){t.markers.push(e.Vertex.Markers.corner);i.markers.push(e.Vertex.Markers.corner);r.markers.push(e.Vertex.Markers.corner)}if(this.makeLinks){if(!this.addALoopLineAround){t.setOneLink(i);t.setOneLink(r);i.setOneLink(t);i.setOneLink(r);r.setOneLink(t);r.setOneLink(i)}else{t.setTwoOppositeLinks(i,r);i.setTwoOppositeLinks(r,t);r.setTwoOppositeLinks(t,i)}}};return t}();t.SingleTriangle=r;var s=function(){function t(){this.markCorner=true;this.markBorder=true;this.origin=new e.XYZ(-1,-1,0);this.end=new e.XYZ(1,1,0);this.nbSubdivisionInSide=6;this.setAllDichoLevelTo0=true;this.mamesh=new e.Mamesh}t.prototype.go=function(){for(var t=0;t<3;t++){var i=new e.XYZ(Math.cos(2*Math.PI*t/3-Math.PI/2),Math.sin(2*Math.PI*t/3-Math.PI/2),0);var r=e.XYZ.newFrom(i);var s=this.mamesh.newVertex(r,0,i);s.markers.push(e.Vertex.Markers.corner)}this.mamesh.addATriangle(this.mamesh.vertices[0],this.mamesh.vertices[1],this.mamesh.vertices[2]);var n=Math.floor(Math.log(this.nbSubdivisionInSide)/Math.log(2));for(var a=0;a<n;a++){var o=new e.mameshModification.TriangleDichotomer(this.mamesh);o.makeLinks=false;o.go()}if(Math.pow(2,n)!=this.nbSubdivisionInSide){var o=new e.mameshModification.TriangleDichotomer(this.mamesh);o.makeLinks=false;o.go()}var h=new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(this.mamesh);h.markIsolateVertexAsCorner=false;h.goChanging();if(Math.pow(2,n)!=this.nbSubdivisionInSide){var l=new e.grateAndGlue.ExtractCentralPart(this.mamesh,Math.floor((Math.pow(2,n+1)-this.nbSubdivisionInSide)/3));l.markBorder=this.markBorder;this.mamesh=l.go();this.mamesh.isolateMameshVerticesFromExteriorVertices()}if(this.markCorner){for(var u=0,c=this.mamesh.vertices;u<c.length;u++){var s=c[u];if(s.links.length==2)s.markers.push(e.Vertex.Markers.corner)}}if(this.setAllDichoLevelTo0)for(var m=0,p=this.mamesh.vertices;m<p.length;m++){var f=p[m];f.dichoLevel=0}e.spacialTransformations.adjustInASquare(this.mamesh,this.origin,this.end);return this.mamesh};return t}();t.TriangulatedTriangle=s;var n=function(){function t(t){this.markCorner=true;this.markBorder=true;this.origin=new e.XYZ(-1,-1,0);this.end=new e.XYZ(1,1,0);this.nbSubdivisionInARadius=1;this.setAllDichoLevelTo0=true;this.mamesh=new e.Mamesh;this.nbSides=t}t.prototype.go=function(){var t=this.mamesh.newVertex(new e.XYZ(0,0,0),0,new e.XYZ(0,0,0));t.markers.push(e.Vertex.Markers.center);for(var i=0;i<this.nbSides;i++){var r=new e.XYZ(Math.cos(2*Math.PI*i/this.nbSides-Math.PI/2),Math.sin(2*Math.PI*i/this.nbSides-Math.PI/2),0);var s=e.XYZ.newFrom(r);var n=this.mamesh.newVertex(s,0,r);if(this.markBorder)n.markers.push(e.Vertex.Markers.border)}for(var i=1;i<this.nbSides+1;i++){this.mamesh.addATriangle(this.mamesh.vertices[0],this.mamesh.vertices[i],this.mamesh.vertices[i%this.nbSides+1])}if(this.nbSides%2==0){for(var i=1;i<=this.nbSides/2;i++){t.setTwoOppositeLinks(this.mamesh.vertices[i],this.mamesh.vertices[i+this.nbSides/2])}}else{for(var i=1;i<=this.nbSides;i++)t.setOneLink(this.mamesh.vertices[i])}for(var i=1;i<=this.nbSides;i++){var a=this.mamesh.vertices[i];var o=i==this.nbSides?this.mamesh.vertices[1]:this.mamesh.vertices[i+1];var h=i==1?this.mamesh.vertices[this.nbSides]:this.mamesh.vertices[i-1];a.setOneLink(t);a.setOneLink(o);a.setOneLink(h)}var l=Math.log(this.nbSubdivisionInARadius)/Math.log(2);for(var u=0;u<l;u++){var c=new e.mameshModification.TriangleDichotomer(this.mamesh);c.makeLinks=true;c.go()}if(l!=Math.floor(l)){var c=new e.mameshModification.TriangleDichotomer(this.mamesh);c.makeLinks=true;c.go();var m=new e.grateAndGlue.ExtractCentralPart(this.mamesh,-this.nbSubdivisionInARadius);m.markBorder=this.markBorder;this.mamesh=m.go();this.mamesh.isolateMameshVerticesFromExteriorVertices()}if(this.markCorner){for(var p=0,f=this.mamesh.vertices;p<f.length;p++){var n=f[p];if(n.links.length==3)n.markers.push(e.Vertex.Markers.corner)}}e.spacialTransformations.adjustInASquare(this.mamesh,this.origin,this.end);if(this.setAllDichoLevelTo0)for(var d=0,v=this.mamesh.vertices;d<v.length;d++){var g=v[d];g.dichoLevel=0}return this.mamesh};return t}();t.TriangulatedPolygone=n;var a=function(){function t(){this.nbI=3;this.set_nbJ_toHaveRegularReseau=false;this.nbJ=3;this.origin=new e.XYZ(0,0,0);this.end=new e.XYZ(1,1,0);this.kComponentTranslation=0;this.nbVerticalDecays=0;this.nbHorizontalDecays=0;this.squareMailleInsteadOfTriangle=true}t.prototype.go=function(){this.checkArgs();var t=(this.end.x-this.origin.x)/(this.nbI-1);var i;if(this.set_nbJ_toHaveRegularReseau){if(this.squareMailleInsteadOfTriangle)i=t;else i=t*Math.sqrt(3)/2;this.nbJ=Math.floor((this.end.y-this.origin.y)/i+1)}else{i=(this.end.y-this.origin.y)/(this.nbJ-1)}var r=this.end.x-this.origin.x;var s=this.end.y-this.origin.y;var n=this.computeDecayVector(t,r,i,s,this.nbVerticalDecays,this.nbHorizontalDecays);var a=this.computeDecayVector(i,s,t,r,this.nbHorizontalDecays,this.nbVerticalDecays);var o=new e.XYZ(a.y,a.x,0);n.z+=this.kComponentTranslation;o.z+=this.kComponentTranslation;return{Vi:n,Vj:o,nbI:this.nbI,nbJ:this.nbJ}};t.prototype.checkArgs=function(){var t=this.end.x-this.origin.x;var i=this.end.y-this.origin.y;if(Math.abs(t)<e.geo.epsilon||Math.abs(i)<e.geo.epsilon)throw"origin and end are almost in the same line";if(this.nbI<2)throw"this.nbI must be >=2";if(this.nbJ<2)throw"this.nbJ must be >=2"};t.prototype.computeDecayVector=function(t,i,r,s,n,a){var o=new e.XYZ(0,0,0);o.x=t*i*s/(i*s-t*r*a*n);o.y=r*n/i*o.x;return o};return t}();t.BasisForRegularReseau=a;var o=new e.XYZ(0,0,0);function h(e,t,i,r){{o.copyFromFloats(e.param.x,e.param.y,e.param.z).add(t);var s=r.getValue(o);o.copyFromFloats(e.param.x,e.param.y,e.param.z).add(i);var n=r.getValue(o);if(s!=null&&n!=null)e.setTwoOppositeLinks(s,n);else if(s==null&&n!=null)e.setOneLink(n);else if(s!=null&&n==null)e.setOneLink(s)}}var l=new e.XYZ(0,0,0);function u(e,t,i,r,s){var n=e;if(n==null)return;var a=s.getValue(l.copyFrom(e.param).add(i));if(a==null)return;var o=s.getValue(l.copyFrom(e.param).add(i).add(r));if(o==null)return;var h=s.getValue(l.copyFrom(e.param).add(r));if(h==null)return;t.addASquare(n,a,o,h)}var c=function(){function t(t){this.nbI=3;this.nbJ=3;this.fixedK=0;this.Vi=new e.XYZ(1,0,0);this.Vj=new e.XYZ(0,1,0);this.Vk=new e.XYZ(0,0,0);this.origine=new e.XYZ(0,0,0);this.makeLinks=true;this.makeTriangleOrSquare=true;this.squareVersusTriangleMaille=true;this.oneMoreVertexForOddLine=false;this.holeParameters=new e.HashMap;this.markCorner=true;this.markBorder=true;this.markCenter=true;this.putAVertexOnlyAtXYZCheckingThisCondition=null;this._xyz=new e.XYZ(0,0,0);this._iDirection=new e.XYZ(0,0,0);this._jDirection=new e.XYZ(0,0,0);this._kDirection=new e.XYZ(0,0,0);this.paramToVertex=new e.HashMap(true);this.mamesh=new e.Mamesh;if(t!=null){var i=t.go();this.Vi.copyFrom(i.Vi);this.Vj.copyFrom(i.Vj);this.nbI=i.nbI;this.nbJ=i.nbJ;this.origine.copyFrom(t.origin);this.squareVersusTriangleMaille=t.squareMailleInsteadOfTriangle}}t.prototype.checkArgs=function(){if(!this.makeTriangleOrSquare&&!this.makeLinks)e.logger.c("few interest if you do not add neither square nor links");var t=new e.XYZ(0,0,0);e.geo.cross(this.Vi,this.Vj,t);if(t.x==Number.NaN||t.y==Number.NaN||t.z==Number.NaN)throw"a problem with Vi of Vj";if(t.length()<e.geo.epsilon)throw"origin and end are almost in the same line"};t.prototype.getVertex=function(e,t){this._xyz.x=e;this._xyz.y=t;this._xyz.z=this.fixedK;return this.paramToVertex.getValue(this._xyz)};t.prototype.go=function(){this.checkArgs();for(var t=0;t<this.nbI;t++){for(var i=0;i<this.nbJ;i++){var r=new e.XYZ(t,i,this.fixedK);if(this.holeParameters==null||!this.holeParameters.getValue(r)){var s=!this.squareVersusTriangleMaille&&i%2==0?.5:0;this._iDirection.copyFrom(this.Vi).scale(t+s);this._jDirection.copyFrom(this.Vj).scale(i);this._kDirection.copyFrom(this.Vk).scale(this.fixedK);var n=new e.XYZ(0,0,0).add(this._iDirection).add(this._jDirection).add(this._kDirection).add(this.origine);if(this.putAVertexOnlyAtXYZCheckingThisCondition==null||this.putAVertexOnlyAtXYZCheckingThisCondition(n)){var a=this.mamesh.newVertex(n,0,r);this.paramToVertex.putValue(r,a)}}}}if(this.oneMoreVertexForOddLine){var t=this.nbI;for(var i=0;i<this.nbJ;i++){if(i%2==1){var r=new e.XYZ(t,i,this.fixedK);if(this.holeParameters==null||!this.holeParameters.getValue(r)){var s=!this.squareVersusTriangleMaille&&i%2==0?.5:0;this._iDirection.copyFrom(this.Vi).scale(t+s);this._jDirection.copyFrom(this.Vj).scale(i);this._kDirection.copyFrom(this.Vk).scale(this.fixedK);var n=new e.XYZ(0,0,0).add(this._iDirection).add(this._jDirection).add(this._kDirection).add(this.origine);if(this.putAVertexOnlyAtXYZCheckingThisCondition==null||this.putAVertexOnlyAtXYZCheckingThisCondition(n)){var a=this.mamesh.newVertex(n,0,r);this.paramToVertex.putValue(r,a)}}}}}if(this.mamesh.vertices.length==0)console.log("you have created a IN_mamesh with no vertex. Perhaps because of {@link Regular.putAVertexOnlyAtXYZCheckingThisCondition }");if(this.makeLinks){if(!this.squareVersusTriangleMaille)this.linksCreationForTriangle();else this.linksCreationForSquare()}if(this.makeTriangleOrSquare){if(!this.squareVersusTriangleMaille)this.triangleCreation();else this.squareCreation()}if(this.markBorder){if(this.squareVersusTriangleMaille){for(var o=0,h=this.mamesh.vertices;o<h.length;o++){var l=h[o];if(l.links.length!=4)l.markers.push(e.Vertex.Markers.border)}}else{for(var u=0,c=this.mamesh.vertices;u<c.length;u++){var l=c[u];if(l.links.length!=6)l.markers.push(e.Vertex.Markers.border)}}}if(this.markCorner){var m=this.oneMoreVertexForOddLine&&this.nbJ%2==0?1:0;var a=void 0;a=this.getVertex(0,0);if(a!=null)a.markers.push(e.Vertex.Markers.corner);a=this.getVertex(this.nbI-1+m,this.nbJ-1);if(a!=null)a.markers.push(e.Vertex.Markers.corner);a=this.getVertex(0,this.nbJ-1);if(a!=null)a.markers.push(e.Vertex.Markers.corner);a=this.getVertex(this.nbI-1,0);if(a!=null)a.markers.push(e.Vertex.Markers.corner)}if(this.markCenter){var p=this.nbI/2;var f=[];if(Math.floor(p)!=p){f.push(Math.floor(p))}else f.push(Math.floor(p),Math.floor(p)-1);var d=this.nbJ/2;var v=[];if(Math.floor(d)!=d){v.push(Math.floor(d))}else v.push(Math.floor(d),Math.floor(d)-1);for(var g=0,y=f;g<y.length;g++){var t=y[g];for(var b=0,w=v;b<w.length;b++){var i=w[b];var a=this.getVertex(t,i);if(a!=null)a.markers.push(e.Vertex.Markers.center)}}}return this.mamesh};t.prototype.linksCreationForSquare=function(){var t=this;this.mamesh.vertices.forEach(function(i){h(i,e.XYZ.temp0(1,0,0),e.XYZ.temp1(-1,0,0),t.paramToVertex);h(i,e.XYZ.temp0(0,1,0),e.XYZ.temp1(0,-1,0),t.paramToVertex)})};t.prototype.squareCreation=function(){var t=new e.XYZ(1,0,0);var i=new e.XYZ(0,1,0);for(var r=0,s=this.mamesh.vertices;r<s.length;r++){var n=s[r];u(n,this.mamesh,t,i,this.paramToVertex)}};t.prototype.linksCreationForTriangle=function(){var t=this;this.mamesh.vertices.forEach(function(i){h(i,e.XYZ.temp0(1,0,0),e.XYZ.temp1(-1,0,0),t.paramToVertex);if(i.param.y%2==0){h(i,e.XYZ.temp0(1,1,0),e.XYZ.temp1(0,-1,0),t.paramToVertex);h(i,e.XYZ.temp0(0,1,0),e.XYZ.temp1(1,-1,0),t.paramToVertex)}else{h(i,e.XYZ.temp0(0,1,0),e.XYZ.temp1(-1,-1,0),t.paramToVertex);h(i,e.XYZ.temp0(-1,1,0),e.XYZ.temp1(0,-1,0),t.paramToVertex)}})};t.prototype.triangleCreation=function(){for(var e=0,t=this.mamesh.vertices;e<t.length;e++){var i=t[e];var r=i.param.x;var s=i.param.y;if(s%2==0){var n=i;var a=this.getVertex(r+1,s+1);if(a==null)continue;var o=this.getVertex(r,s+1);if(o!=null)this.mamesh.addATriangle(n,a,o);var h=this.getVertex(r+1,s);if(h!=null)this.mamesh.addATriangle(n,h,a)}else{var n=i;var a=this.getVertex(r,s+1);if(a==null)continue;var o=this.getVertex(r+1,s);if(o!=null)this.mamesh.addATriangle(n,o,a);var h=this.getVertex(r+1,s+1);if(h!=null)this.mamesh.addATriangle(a,o,h)}}};return t}();t.Regular=c;var m=function(){function t(t){if(t===void 0){t=5}this.size=t;this.origin=new e.XYZ(0,0,0);this.end=new e.XYZ(1,0,0)}t.prototype.go=function(){var t=new e.Mamesh;for(var i=0;i<this.size;i++){var r=new e.Vertex;r.position=this.iToXYX(i);t.vertices.push(r)}for(var i=1;i<this.size-1;i++){t.vertices[i].setTwoOppositeLinks(t.vertices[i-1],t.vertices[i+1])}t.vertices[0].setOneLink(t.vertices[1]);t.vertices[this.size-1].setOneLink(t.vertices[this.size-2]);return t};t.prototype.iToXYX=function(t){var i=t/(this.size-1);return e.XYZ.newFrom(this.end).substract(this.origin).scale(i).add(this.origin)};return t}();t.Regular1D=m;var p=function(){function t(){this.nbI=3;this.nbJ=3;this.nbK=3;this.Vi=new e.XYZ(1,0,0);this.Vj=new e.XYZ(0,1,0);this.Vk=new e.XYZ(0,0,1);this.origine=new e.XYZ(0,0,0);this.decayOddStrates=false;this.makeLinks=true;this.makeTriangleOrSquare=true;this.strateHaveSquareMailleVersusTriangleMaille=true;this.oneMoreVertexForOddLine=false;this.interStrateMailleAreSquareVersusTriangle=true;this.createJKSquares=true;this.createIKSquaresOrTriangles=true;this.putAVertexOnlyAtXYZCheckingThisCondition=null;this.paramToVertex=new e.HashMap}t.prototype.go=function(){var t=this;this.mamesh=new e.Mamesh;var i=new e.XYZ(0,0,0);if(this.decayOddStrates)i.add(this.Vi).scale(.5);for(var r=0;r<this.nbK;r++){var s=new c;s.makeTriangleOrSquare=this.makeTriangleOrSquare;s.makeLinks=true;s.oneMoreVertexForOddLine=this.oneMoreVertexForOddLine;s.squareVersusTriangleMaille=this.strateHaveSquareMailleVersusTriangleMaille;s.nbI=this.nbI;s.nbJ=this.nbJ;s.fixedK=r;s.Vi=this.Vi;s.Vj=this.Vj;s.Vk.copyFrom(this.Vk);s.origine=e.XYZ.newFrom(this.origine);if(r%2==1)s.origine.substract(i);s.putAVertexOnlyAtXYZCheckingThisCondition=this.putAVertexOnlyAtXYZCheckingThisCondition;var n=s.go();for(var a=0,o=s.paramToVertex.allEntries();a<o.length;a++){var h=o[a];this.mamesh.vertices.push(h.value);this.paramToVertex.putValue(h.key,h.value)}for(var l=0,m=n.smallestSquares;l<m.length;l++){var p=m[l];this.mamesh.smallestSquares.push(p)}for(var f=0,d=n.smallestTriangles;f<d.length;f++){var p=d[f];this.mamesh.smallestTriangles.push(p)}}if(this.interStrateMailleAreSquareVersusTriangle){this.linksCreationForSquareMaille();if(this.createJKSquares){var v=new e.XYZ(0,1,0);var g=new e.XYZ(0,0,1);this.mamesh.vertices.forEach(function(e){u(e,t.mamesh,v,g,t.paramToVertex)})}if(this.createIKSquaresOrTriangles){var y=new e.XYZ(1,0,0);var b=new e.XYZ(0,0,1);this.mamesh.vertices.forEach(function(e){u(e,t.mamesh,y,b,t.paramToVertex)})}}else{this.linksCreationForTriangleMaille();if(this.createJKSquares){var w=new e.XYZ(0,1,0);var M=new e.XYZ(0,0,1);this.mamesh.vertices.forEach(function(e){u(e,t.mamesh,w,M,t.paramToVertex)})}if(this.createIKSquaresOrTriangles){this.triangleCreation()}}return this.mamesh};t.prototype.linksCreationForSquareMaille=function(){var t=this;var i=new e.XYZ(0,0,1);var r=new e.XYZ(0,0,-1);this.mamesh.vertices.forEach(function(e){h(e,i,r,t.paramToVertex)})};t.prototype.linksCreationForTriangleMaille=function(){var t=this;this.mamesh.vertices.forEach(function(i){if(i.param.z%2==0){h(i,e.XYZ.temp0(1,0,1),e.XYZ.temp1(0,0,-1),t.paramToVertex);h(i,e.XYZ.temp0(0,0,1),e.XYZ.temp1(1,0,-1),t.paramToVertex)}else{h(i,e.XYZ.temp0(0,0,1),e.XYZ.temp1(-1,0,-1),t.paramToVertex);h(i,e.XYZ.temp0(-1,0,1),e.XYZ.temp1(0,0,-1),t.paramToVertex)}})};t.prototype.getVertex=function(t,i,r){return this.paramToVertex.getValue(new e.XYZ(t,r,i))};t.prototype.triangleCreation=function(){for(var e=0,t=this.mamesh.vertices;e<t.length;e++){var i=t[e];var r=i.param.x;var s=i.param.z;var n=i.param.y;if(s%2==0){var a=i;var o=this.getVertex(r+1,s+1,n);if(o==null)continue;var h=this.getVertex(r,s+1,n);if(h!=null)this.mamesh.addATriangle(a,o,h);var l=this.getVertex(r+1,s,n);if(l!=null)this.mamesh.addATriangle(a,l,o)}else{var a=i;var o=this.getVertex(r,s+1,n);if(o==null)continue;var h=this.getVertex(r+1,s,n);if(h!=null)this.mamesh.addATriangle(a,h,o);var l=this.getVertex(r+1,s+1,n);if(l!=null)this.mamesh.addATriangle(o,h,l)}}};return t}();t.Regular3D=p})(t=e.reseau||(e.reseau={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(e){this.propBeginToRound=0;this.propEndToRound=1;this.integerBeginToRound=null;this.integerEndToRound=null;this.exponentOfRoundingFunction=1;this.referenceRadiusIsMinVersusMaxVersusMean=2;this.preventStratesCrossings=true;this.mamesh=e}t.prototype.goChanging=function(){if(isNaN(this.exponentOfRoundingFunction))throw"must be a number";if(this.propBeginToRound<0||this.propBeginToRound>1)throw"must be in [0,1]";if(this.propEndToRound<0||this.propEndToRound>1)throw"must be in [0,1]";if(this.propBeginToRound>=this.propEndToRound)return;var t=[];for(var i=0,r=this.mamesh.vertices;i<r.length;i++){var s=r[i];if(s.hasMark(e.Vertex.Markers.border))t.push(s)}var n=e.graph.ringify(t);if(this.integerBeginToRound==null)this.integerBeginToRound=Math.floor(n.length*this.propBeginToRound);if(this.integerEndToRound==null)this.integerEndToRound=Math.ceil(n.length*this.propEndToRound);if(this.integerEndToRound<0)this.integerEndToRound=n.length+this.integerEndToRound;if(this.integerBeginToRound>n.length||this.integerBeginToRound<0)throw"problem";if(this.integerEndToRound>n.length||this.integerEndToRound<0)throw"problem";if(this.integerEndToRound<=this.integerBeginToRound)return;var a=new e.XYZ(0,0,0);for(var o=0,h=this.mamesh.vertices;o<h.length;o++){var l=h[o];a.add(l.position)}a.scale(1/this.mamesh.vertices.length);var u=new e.XYZ(0,0,0);var c=null;for(var m=this.integerBeginToRound;m<this.integerEndToRound;m++){var p=-1;var f=Number.POSITIVE_INFINITY;var d=0;for(var v=0,g=n[m];v<g.length;v++){var y=g[v];var b=e.geo.distance(y.position,a);if(b>p)p=b;if(b<f)f=b;d+=b}d/=n[m].length;if(p>e.geo.epsilon){var w=void 0;if(this.referenceRadiusIsMinVersusMaxVersusMean==0)w=f;else if(this.referenceRadiusIsMinVersusMaxVersusMean==1)w=p;else if(this.referenceRadiusIsMinVersusMaxVersusMean==2)w=d;c=w;for(var M=0,x=n[m];M<x.length;M++){var y=x[M];var C=u.copyFrom(y.position).substract(a);var T=C.length();var V=Math.pow(w/T,this.exponentOfRoundingFunction);C.scale(V);y.position.copyFrom(C.add(a))}}}if(this.preventStratesCrossings){if(this.integerBeginToRound>0){var S=-1;for(var k=0,O=n[this.integerBeginToRound];k<O.length;k++){var y=O[k];var b=e.geo.distance(y.position,a);if(b>S)S=b}var A=Number.POSITIVE_INFINITY;for(var P=0,_=n[this.integerBeginToRound-1];P<_.length;P++){var y=_[P];var b=e.geo.distance(y.position,a);if(b<A)A=b}var F=null;if(1.1*S>A)F=1.1*S/A;if(F!=null){for(var N=0;N<this.integerBeginToRound;N++){for(var B=0,L=n[N];B<L.length;B++){var y=L[B];y.position.copyFrom(u.copyFrom(y.position).substract(a).scale(F).add(a))}}}}if(this.integerEndToRound<n.length){var Y=Number.POSITIVE_INFINITY;for(var X=0,I=n[this.integerEndToRound-1];X<I.length;X++){var y=I[X];var b=e.geo.distance(y.position,a);if(b<Y)Y=b}var Z=-1;for(var D=0,z=n[this.integerEndToRound];D<z.length;D++){var y=z[D];var b=e.geo.distance(y.position,a);if(b>Z)Z=b}var F=null;if(1.1*Z>Y)F=Y/(1.1*Z);if(F!=null){for(var N=this.integerEndToRound;N<n.length;N++){for(var E=0,q=n[N];E<q.length;E++){var y=q[E];y.position.copyFrom(u.copyFrom(y.position).substract(a).scale(F).add(a))}}}}}};return t}();t.RoundSomeStrates=i;var r=function(){function t(t,i,r,s){if(r===void 0){r=new e.XYZ(0,0,0)}if(s===void 0){s=new e.XYZ(1,1,1)}this.axisForRotation=new e.XYZ(0,0,1);this.centerForSimilitude=null;this.vertices=t;this.angle=i;this.vectorForTranslation=r;this.sizesForResize=s}t.prototype.goChanging=function(){var t=this;if(this.centerForSimilitude==null){this.centerForSimilitude=new e.XYZ(0,0,0);var i=1/this.vertices.length;var r=[];var s=[];this.vertices.forEach(function(e){s.push(e.position);r.push(i)});e.geo.baryCenter(s,r,this.centerForSimilitude)}var n=new e.MM;e.geo.axisAngleToMatrix(this.axisForRotation,this.angle,n);this.vertices.forEach(function(i){i.position.substract(t.centerForSimilitude);i.position.resizes(t.sizesForResize);e.geo.multiplicationMatrixVector(n,i.position,i.position);i.position.add(t.centerForSimilitude).add(t.vectorForTranslation)})};return t}();t.Similitude=r;function s(t,i,r){var s=e.XYZ.newFrom(t.vertices[0].position);var n=e.XYZ.newFrom(t.vertices[0].position);for(var a=0,o=t.vertices;a<o.length;a++){var h=o[a];if(h.position.x>s.x)s.x=h.position.x;if(h.position.y>s.y)s.y=h.position.y;if(h.position.x<n.x)n.x=h.position.x;if(h.position.y<n.y)n.y=h.position.y}var l=e.XYZ.newFrom(s).substract(n);var u=e.XYZ.newFrom(r).substract(i);var c=new e.XYZ(u.x/l.x,u.y/l.y,0);for(var m=0,p=t.vertices;m<p.length;m++){var h=p[m];h.position.substract(n).resizes(c).add(i)}}t.adjustInASquare=s})(t=e.spacialTransformations||(e.spacialTransformations={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(t){this.referenceDistanceBetweenVertexWithZeroDichoLevel=.1;this.deformationFromCenterVersusFromDirection=true;this.center=new e.XYZ(0,0,0);this.direction=new e.XYZ(0,0,1);this.alpha=1.7;this.beta=.7;this.seed=22345;this.mamesh=t}t.prototype.go=function(){this.simuStable=new e.proba.StableLaw;this.simuStable.alpha=this.alpha;this.simuStable.beta=this.beta;this.simuStable.nbSimu=this.mamesh.vertices.length;var t=new e.proba.Random(this.seed);this.simuStable.basicGenerator=function(){return t.pseudoRand()};var i=this.simuStable.go();var r=true;var s=0;var n=0;var a=new e.XYZ(0,0,0);var o=new e.XYZ(0,0,0);while(r){r=false;for(var h in this.mamesh.cutSegmentsDico){var l=this.mamesh.cutSegmentsDico[h];if(Math.max(l.a.dichoLevel,l.b.dichoLevel)==n){r=true;var u=i[s++]*Math.pow(this.referenceDistanceBetweenVertexWithZeroDichoLevel/Math.pow(2,n),1/this.simuStable.alpha);e.geo.between(l.a.position,l.b.position,1/2,a);if(this.deformationFromCenterVersusFromDirection){a.substract(this.center);a.scale(1+u)}else{o.copyFrom(this.direction).scale(u);a.add(o)}l.middle.position.copyFrom(a)}}n++}};return t}();t.StableRandomFractal=i})(t=e.fractal||(e.fractal={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(e){this.nbActionsPerIteration=1e3;this.q=Number.POSITIVE_INFINITY;this.beta=.01;this.graph=e}t.prototype.checkArgs=function(){if(this.q==null||this.beta==null)throw"q or beta is null";if(this.q<=0)throw"q must be positive"};t.prototype.go=function(){this.checkArgs();if(this.q==Number.POSITIVE_INFINITY)this.possibleValues=[-1,1];else this.possibleValues=[-1,0,1];this.initialisation()};t.prototype.iterateAndGetChangedVertices=function(){var t=new e.HashMap(true);for(var i=0;i<this.nbActionsPerIteration;i++){var r=void 0;var s=void 0;if(this.beta!=Number.POSITIVE_INFINITY){var n=Math.floor(Math.random()*this.graph.length);r=this.graph[n];s=this.newValue()}else{var a=false;while(!a){var n=Math.floor(Math.random()*this.graph.length);r=this.graph[n];s=this.newValue();var o=null;var h=true;for(var l=0,u=r.links;l<u.length;l++){o=u[l];if(o.to.customerObject.value*s==-1){h=false;break}}}}var c=this.energyRatio(r,s);if(c>=1||Math.random()<c){r.customerObject.value=s;t.putValue(r,s)}}return t};t.prototype.newValue=function(){var e=Math.floor(Math.random()*this.possibleValues.length);return this.possibleValues[e]};t.prototype.energyRatio=function(e,t){var i=1;if(this.q!=1&&this.q!=Number.POSITIVE_INFINITY){i=Math.pow(this.q,Math.abs(t)-Math.abs(e.customerObject.value))}if(this.beta!=0&&this.beta!=Number.POSITIVE_INFINITY){var r=t-e.customerObject.value;if(this.beta!=0&&this.beta!=Number.POSITIVE_INFINITY){var s=0;e.links.forEach(function(e){s+=r*e.to.customerObject.value});i*=Math.exp(this.beta*s)}}return i};t.prototype.initialisation=function(){this.graph.forEach(function(e){e.customerObject.value=0})};return t}();t.IsingModel=i})(t=e.metropolis||(e.metropolis={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(e){var t=function(){function e(e){if(e===void 0){e=1234567}this.seed=e}e.prototype.pseudoRand=function(){var e=Math.pow(2,32);this.seed+=this.seed*this.seed|5;return(this.seed>>>32)/e};e.prototype.pseudoRandInt=function(e){var t=Math.floor(e*this.pseudoRand());if(t==e)t--;return t};return e}();e.Random=t;var i=function(){function e(){this.mean=0;this.stdev=1;this.knuthVersusBowMuller=true;this.use_last=false}e.prototype.go=function(){if(this.knuthVersusBowMuller)return this.knuth();else return this.bowMuller()};e.prototype.bowMuller=function(){var e=1-Math.random();var t=1-Math.random();return this.mean+this.stdev*Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)};e.prototype.knuth=function(){var e;if(this.use_last){e=this.y2;this.use_last=false}else{var t,i,r;do{t=2*Math.random()-1;i=2*Math.random()-1;r=t*t+i*i}while(r>=1);r=Math.sqrt(-2*Math.log(r)/r);e=t*r;this.y2=i*r;this.use_last=true}var s=this.mean+this.stdev*e;if(s>0)return s;return-s};return e}();e.Gaussian=i;function r(e,t){var i;var r=false;return function(){var s;if(r){s=i;r=false}else{var n,a,o;do{n=2*Math.random()-1;a=2*Math.random()-1;o=n*n+a*a}while(o>=1);o=Math.sqrt(-2*Math.log(o)/o);s=n*o;i=a*o;r=true}var h=e+t*s;if(h>0)return h;return-h}}e.gaussian=r;var s=function(){function e(){this.nbSimu=1;this.alpha=1.5;this.beta=0;this.sigma=1;this.mu=0;this.basicGenerator=Math.random}e.prototype.checkArgs=function(){if(this.alpha>2||this.alpha<=0)throw"alpha must be in (0,2]";if(this.beta<-1||this.beta>1)throw"beta must be in [-1,1]"};e.prototype.go=function(){this.checkArgs();var e=[];for(var t=0;t<this.nbSimu;t++){var i=this.basicGenerator()*Math.PI-Math.PI/2;var r=-Math.log(this.basicGenerator());if(this.alpha!=1){var s=Math.tan(Math.PI*this.alpha/2);var n=Math.atan(this.beta*s)/this.alpha;var a=1+this.beta^2*s^2^1/2/this.alpha;e[t]=a*Math.sin(this.alpha*(i+n))/Math.pow(Math.cos(i),1/this.alpha)*Math.pow(Math.cos(i-this.alpha*(i+n))/r,(1-this.alpha)/this.alpha);e[t]=this.sigma*e[t]+this.mu}else if(this.alpha==1){e[t]=2/Math.PI*((Math.PI/2+this.beta*i)*Math.tan(i)-this.beta*Math.log(r*Math.cos(i)/(Math.PI/2+this.beta*i)));e[t]=this.sigma*e[t]+2/Math.PI*this.beta*this.sigma*Math.log(this.sigma)+this.mu}}return e};return e}();e.StableLaw=s})(t=e.proba||(e.proba={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){t.sinh=function(e){return(Math.exp(e)-Math.exp(-e))/2};t.tanh=function(e){return(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))};t.sech=function(e){return 2/(Math.exp(e)+Math.exp(-e))};t.sechP=function(e){return-t.tanh(e)*t.sech(e)};t.sechPP=function(e){return-t.tanhP(e)*t.sech(e)-t.tanh(e)*t.sechP(e)};t.tanhP=function(e){var i=t.tanh(e);return 1-i*i};t.tanhPP=function(e){return-2*t.tanh(e)*t.tanhP(e)};t.tractrice=function(i){return new e.XYZ(t.sech(i),i-t.tanh(i),0)};t.tractriceP=function(i){return new e.XYZ(t.sechP(i),1-t.tanhP(i),0)};t.tractricePP=function(i){return new e.XYZ(t.sechPP(i),-t.tanhPP(i),0)};t.rotationYAxis=function(t){var i=new e.MM;var r=Math.cos(t);var s=Math.sin(t);e.geo.numbersToMM(r,0,s,0,0,1,0,0,-s,0,r,0,0,0,0,1,i);return i};t.rotationYAxisP=function(t){var i=new e.MM;var r=Math.cos(t);var s=Math.sin(t);e.geo.numbersToMM(-s,0,r,0,0,0,0,0,-r,0,-s,0,0,0,0,1,i);return i};t.rotationYAxisPP=function(t){var i=new e.MM;var r=Math.cos(t);var s=Math.sin(t);e.geo.numbersToMM(-r,0,-s,0,0,0,0,0,s,0,-r,0,0,0,0,1,i);return i}})(t=e.usualFunction||(e.usualFunction={}));var i;(function(i){var r=function(){function t(){this.orientationCoef=+1;this.unit=1;this.point=new e.XYZ(0,0,0);this._meanLinkLengthAtArrival=null}t.prototype.xyzToUV=function(t,i){if(i===void 0){i=false}if(this.maillage==null)throw"you must give a maillage to use xyzToUV ";var r=new e.UV(0,0);var s=Number.MAX_VALUE;var n=Number.MAX_VALUE;var a=null;for(var o=0,h=this.maillage.vertices;o<h.length;o++){a=h[o];var l=a.position.x;var u=a.position.y;this.point.copyFrom(this.X(l,u));var c=e.geo.distance(this.point,t);if(c<s){s=c;r.u=l;r.v=u}if(a.hasMark(e.Vertex.Markers.border)){var m=e.geo.distance(t,this.point);if(m<n)n=m}}if(i||this._meanLinkLengthAtArrival==null)this._meanLinkLengthAtArrival=this.meanLinkLengthAtArrival();if(s<1.1*this._meanLinkLengthAtArrival)return{uv:r,distToBorder:n,distToNearestArrivalMesh:s};else{return null}};t.prototype.e=function(t,i){return e.geo.dot(this.newN(t,i),this.Xuu(t,i))};t.prototype.f=function(t,i){return e.geo.dot(this.newN(t,i),this.Xuv(t,i))};t.prototype.g=function(t,i){return e.geo.dot(this.newN(t,i),this.Xvv(t,i))};t.prototype.E=function(t,i){return e.geo.dot(this.Xu(t,i),this.Xu(t,i))};t.prototype.F=function(t,i){return e.geo.dot(this.Xu(t,i),this.Xv(t,i))};t.prototype.G=function(t,i){return e.geo.dot(this.Xv(t,i),this.Xv(t,i))};t.prototype.createArrivalMeshFromMaillage=function(){var t=this;var i=new e.mameshModification.MameshDeepCopier(this.maillage);i.copyCutSegmentsDico=false;this.arrivalOpenMesh=i.go();this.arrivalOpenMesh.vertices.forEach(function(e){var i=e.position.x;var r=e.position.y;e.position=t.X(i,r)})};t.prototype.dNinTangentBasis=function(t,i){var r=new e.M22;var s=this.e(t,i);var n=this.f(t,i);var a=this.g(t,i);var o=this.E(t,i);var h=this.F(t,i);var l=this.G(t,i);var u=o*l-h*h;r.m11=(n*h-s*l)/u;r.m12=(a*h-n*l)/u;r.m21=(s*h-n*o)/u;r.m22=(n*h-a*o)/u;return r};t.prototype.dNaction=function(e,t,i){var r=this.dNinTangentBasis(e,t);var s=this.canonicalToTangentBasis(e,t,i);var n=r.multiplyUV(s);return this.tagentToCanonicalBasis(e,t,n)};t.prototype.canonicalToTangentBasis=function(t,i,r){var s=this.Xu(t,i);var n=this.Xv(t,i);var a=new e.M22;a.m11=s.x;a.m21=s.y;a.m21=n.x;a.m22=n.y;var o=a.inverse();cc(o.determinant());var h=new e.UV(r.x,r.y);return o.multiplyUV(h)};t.prototype.tagentToCanonicalBasis=function(e,t,i){var r=this.Xu(e,t);var s=this.Xv(e,t);r.scale(i.u);s.scale(i.v);return r.add(s)};t.prototype.newN=function(t,i){var r=new e.XYZ(0,0,0);e.geo.cross(this.Xu(t,i),this.Xv(t,i),r);r.normalize().scale(this.unit*this.orientationCoef);return r};t.prototype.meanLinkLengthAtArrival=function(){var t=this;var i=0;var r=0;this.maillage.vertices.forEach(function(s){s.links.forEach(function(n){r++;i+=e.geo.distance(t.X(s.position.x,s.position.y),t.X(n.to.position.x,n.to.position.y))})});return i/r};return t}();i.Carte=r;var s=function(){function t(){this.cartes=[]}t.prototype.drawTheWholeSurface=function(e){this.drawOneMesh(this.wholeSurfaceMesh,e)};t.prototype.drawOneCarte=function(e,t){this.drawOneMesh(this.cartes[e].arrivalOpenMesh,t)};t.prototype.drawOneMesh=function(t,i){function r(e,t){var i=true;for(var r=0,s=e;r<s.length;r++){var n=s[r];if(n.param.x%t!=0){i=false;break}}var a=true;for(var o=0,h=e;o<h.length;o++){var n=h[o];if(n.param.y%t!=0){a=false;break}}return i||a}var s=new e.visu3d.LinesViewer(t,i);s.constantRadius=.01;var n=s.go();n.forEach(function(e){return e.isPickable=false});var a=new e.visu3d.SurfaceViewer(t,i);a.alpha=.5;var o=a.go()};t.prototype.findBestCarte=function(e){var t=-1;var i=null;var r=null;this.cartes.forEach(function(s){var n=s.xyzToUV(e);if(n!=null&&n.distToBorder>t){t=n.distToBorder;i=s;r=n.uv}});if(r==null){cc("the point which is not in any cart arrival is:",e.toString());throw"strange, the xyz do not belong to any carte-arrival"}return{uv:r,carte:i}};return t}();i.Surface=s;(function(e){e[e["selle"]=0]="selle";e[e["cylinder"]=1]="cylinder";e[e["torus"]=2]="torus";e[e["pseudoSphere"]=3]="pseudoSphere"})(i.SurfaceName||(i.SurfaceName={}));var n=i.SurfaceName;var a=function(){function a(t){this.vertexToCarte=new e.HashMap;this.carteIndexToMinimalArrivalMesh=[];this.surfaceName=t}a.prototype.go=function(){this.surface=new s;this.surface.cartes=[];if(this.surfaceName==n.torus){var a=function(t,i){var s=new e.reseau.BasisForRegularReseau;s.origin=t;s.end=i;s.nbI=32;s.nbJ=64;var n=new e.reseau.Regular(s).go();var a=new e.reseau.Regular(s).go();var o=.3;var h=.7;var l=new r;l.maillage=n;l.arrivalOpenMesh=a;l.X=function(t,i){return new e.XYZ((o*Math.cos(t)+h)*Math.cos(i),(o*Math.cos(t)+h)*Math.sin(i),o*Math.sin(t))};l.Xu=function(t,i){return new e.XYZ(-o*Math.sin(t)*Math.cos(i),-o*Math.sin(t)*Math.sin(i),o*Math.cos(t))};l.Xv=function(t,i){return new e.XYZ(-(o*Math.cos(t)+h)*Math.sin(i),(o*Math.cos(t)+h)*Math.cos(i),0)};l.Xuu=function(t,i){return new e.XYZ(-o*Math.cos(t)*Math.cos(i),-o*Math.cos(t)*Math.sin(i),-o*Math.sin(t))};l.Xuv=function(t,i){return new e.XYZ(o*Math.sin(t)*Math.sin(i),-o*Math.sin(t)*Math.cos(i),0)};l.Xvv=function(t,i){return new e.XYZ(-(o*Math.cos(t)+h)*Math.cos(i),-(o*Math.cos(t)+h)*Math.sin(i),0)};a.vertices.forEach(function(e){var t=e.position.x;var i=e.position.y;e.position=l.X(t,i)});return l};var o=.1;this.surface.cartes.push(a(new e.XYZ(o,o,0),new e.XYZ(2*Math.PI-o,2*Math.PI-o,0)));this.surface.cartes.push(a(new e.XYZ(-Math.PI+o,-Math.PI+o,0),new e.XYZ(Math.PI-o,Math.PI-o,0)));this.surface.wholeSurfaceMesh=a(new e.XYZ(0,0,0),new e.XYZ(2*Math.PI,2*Math.PI,0)).arrivalOpenMesh}else if(this.surfaceName==n.cylinder){var h=40;var a=function(t,i){var s=new e.reseau.BasisForRegularReseau;s.origin=t;s.end=i;s.nbI=h+1;s.nbJ=h+1;var n=new e.reseau.Regular(s).go();var a=new e.reseau.Regular(s).go();var o=.5;var l=new r;l.maillage=n;l.arrivalOpenMesh=a;l.X=function(t,i){return new e.XYZ(o*Math.cos(t),i,o*Math.sin(t))};l.Xu=function(t,i){return new e.XYZ(-o*Math.sin(t),0,o*Math.cos(t))};l.Xv=function(t,i){return new e.XYZ(0,1,0)};l.Xuu=function(t,i){return new e.XYZ(-o*Math.cos(t),0,-o*Math.sin(t))};l.Xuv=function(t,i){return new e.XYZ(0,0,0)};l.Xvv=function(t,i){return new e.XYZ(0,0,0)};a.vertices.forEach(function(e){var t=e.position.x;var i=e.position.y;e.position=l.X(t,i)});return l};var o=.3;this.surface.cartes.push(a(new e.XYZ(o,-1/2,0),new e.XYZ(2*Math.PI-o,1/2,0)));this.surface.cartes.push(a(new e.XYZ(o-Math.PI,-1/2,0),new e.XYZ(Math.PI-o,1/2,0)));this.surface.wholeSurfaceMesh=a(new e.XYZ(0,-1/2,0),new e.XYZ(2*Math.PI,1/2,0)).arrivalOpenMesh}else if(this.surfaceName==n.pseudoSphere){var a=function(r,s){var n=new e.reseau.BasisForRegularReseau;n.origin=r;n.end=s;n.nbI=32+1;n.nbJ=20+1;var a=new e.reseau.Regular(n).go();var o=new e.reseau.Regular(n).go();var h=new i.RotationCarteMaker(t.tractrice);h.translation=new e.XYZ(0,-1,0);var l=1;h.scaling=new e.XYZ(l,l,l);h.curveP=t.tractriceP;h.curvePP=t.tractricePP;var u=h.go();u.maillage=a;u.arrivalOpenMesh=o;o.vertices.forEach(function(e){var t=e.position.x;var i=e.position.y;e.position=u.X(t,i)});return u};var o=.3;this.surface.cartes.push(a(new e.XYZ(o,.1,0),new e.XYZ(2*Math.PI-o,3.5,0)));this.surface.cartes.push(a(new e.XYZ(-Math.PI+o,.1,0),new e.XYZ(Math.PI-o,3.5,0)));this.surface.wholeSurfaceMesh=a(new e.XYZ(0,.1,0),new e.XYZ(2*Math.PI,3.5,0)).arrivalOpenMesh}else if(this.surfaceName==n.selle){var a=function(t,i){var s=new e.reseau.BasisForRegularReseau;s.origin=t;s.end=i;s.nbI=40+1;s.nbJ=40+1;var n=new e.reseau.Regular(s).go();var a=new e.reseau.Regular(s).go();var o=new r;o.maillage=n;o.arrivalOpenMesh=a;o.X=function(t,i){return new e.XYZ(t,i,i*i-t*t)};o.Xu=function(t,i){return new e.XYZ(1,0,-2*t)};o.Xv=function(t,i){return new e.XYZ(0,1,2*i)};o.Xuu=function(t,i){return new e.XYZ(0,0,-2)};o.Xuv=function(t,i){return new e.XYZ(0,0,0)};o.Xvv=function(t,i){return new e.XYZ(0,0,2)};a.vertices.forEach(function(e){var t=e.position.x;var i=e.position.y;e.position=o.X(t,i)});return o};var l=.7;this.surface.cartes.push(a(new e.XYZ(-l,-l,0),new e.XYZ(l,l,0)));this.surface.wholeSurfaceMesh=a(new e.XYZ(-l,-l,0),new e.XYZ(l,l,0)).arrivalOpenMesh}else throw"not yet";this.makeMinimalMeshesForEachCarte();return this.surface};a.prototype.makeMinimalMeshesForEachCarte=function(){var t=this;var i=function(i){var s=r.surface.cartes[i];var n=[];s.arrivalOpenMesh.vertices.forEach(function(e){var i=t.surface.findBestCarte(e.position);if(i.carte==s){t.vertexToCarte.putValue(e,s);n.push(e)}});var a=new e.grateAndGlue.SubMameshExtractor(s.arrivalOpenMesh,n).go();r.carteIndexToMinimalArrivalMesh[i]=a};var r=this;for(var s=0;s<this.surface.cartes.length;s++){i(s)}};return a}();i.SurfaceMaker=a;var o=function(){function i(t){this.translation=new e.XYZ(0,0,0);this.scaling=new e.XYZ(1,1,1);this.curve=t}i.prototype.go=function(){var i=this;var s=new r;s.X=function(r,s){var n=new e.XYZ(0,0,0);e.geo.multiplicationMatrixVector(t.rotationYAxis(r),i.curve(s),n);n.resizes(i.scaling).add(i.translation);return n};s.Xu=function(r,s){var n=new e.XYZ(0,0,0);e.geo.multiplicationMatrixVector(t.rotationYAxisP(r),i.curve(s),n);n.resizes(i.scaling);return n};s.Xuu=function(r,s){var n=new e.XYZ(0,0,0);e.geo.multiplicationMatrixVector(t.rotationYAxisPP(r),i.curve(s),n);n.resizes(i.scaling);return n};s.Xv=function(r,s){var n=new e.XYZ(0,0,0);e.geo.multiplicationMatrixVector(t.rotationYAxis(r),i.curveP(s),n);n.resizes(i.scaling);return n};s.Xvv=function(r,s){var n=new e.XYZ(0,0,0);e.geo.multiplicationMatrixVector(t.rotationYAxis(r),i.curvePP(s),n);n.resizes(i.scaling);return n};s.Xuv=function(r,s){var n=new e.XYZ(0,0,0);e.geo.multiplicationMatrixVector(t.rotationYAxisP(r),i.curveP(s),n);n.resizes(i.scaling);return n};return s};return i}();i.RotationCarteMaker=o})(i=e.riemann||(e.riemann={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(e){this.makeLinks=true;this.mamesh=e}t.prototype.go=function(){var t=[];var i=[];var r=new e.HashMap;var s=new e.HashMap;for(var n=0,a=this.mamesh.vertices;n<a.length;n++){var o=a[n];var h=0;var l=void 0;var u=[];for(var c=0,m=o.links;c<m.length;c++){var p=m[c];var f=new BABYLON.Vector3(0,0,0);f.x=p.to.param.x-o.param.x;f.y=p.to.param.y-o.param.y;f.z=p.to.param.z-o.param.z;f.normalize();u.push(f)}h=BABYLON.Vector3.Dot(u[0],u[1]);if(h<0)h*=-1;var d=u[0];var v=u[1];for(var g=0;g<u.length;g++){for(var y=g+1;y<u.length;y++){l=BABYLON.Vector3.Dot(u[g],u[y]);if(l<0)l*=-1;if(h>l){h=l;d=u[g];v=u[y]}}}t.push(d);i.push(v);s.putValue(o,-1)}for(var b=0;b<t.length&&b<i.length;b++){var w=BABYLON.Vector3.Cross(t[b],i[b]);w.normalize();r.putValue(this.mamesh.vertices[b],new e.XYZ(w.x,w.y,w.z))}var M=this.mamesh.vertices[0];var x=0;while(x<this.mamesh.vertices.length-1&&r.getValue(M).x==0&&r.getValue(M).y==0&&r.getValue(M).z==0){M=this.mamesh.vertices[x+1];x++}var C=[];C.push(M);var T=[];T.push(C);var V=new e.HashMap;var S=C;while(S.length>0){S=e.graph.getEdge(S,V);T.push(S)}for(var k=1;k<T.length;k++){for(var O=0,A=T[k];O<A.length;O++){var o=A[O];for(var P=0,_=o.links;P<_.length;P++){var p=_[P];for(var F=0,N=T[k-1];F<N.length;F++){var B=N[F];if(p.to==B){if(r.getValue(o).x==0&&r.getValue(o).y==0&&r.getValue(o).z==0){var L=new e.XYZ(r.getValue(B).x,r.getValue(B).y,r.getValue(B).z);r.putValue(o,L)}if(BABYLON.Vector3.Dot(r.getValue(B),r.getValue(o))<0){var Y=new e.XYZ(-r.getValue(o).x,-r.getValue(o).y,-r.getValue(o).z);r.putValue(o,Y)}}}}}}var X=[];var I=new e.StringMap;var Z=[];for(var D=0,z=this.mamesh.vertices;D<z.length;D++){var o=z[D];for(var E=0,q=o.links;E<q.length;E++){var p=q[E];I.putValue(o.hashNumber+","+p.to.hashNumber,false);var R=[o,p.to];Z.push(R)}}for(var G=0,W=Z;G<W.length;G++){var U=W[G];var H=U[0];var $=U[0];var j=U[1];if(I.getValue($.hashNumber+","+j.hashNumber)!=true){var K=[j];var J=true;while(J){var Q=6.4;var ee=$.links[0];for(var te=0,ie=j.links;te<ie.length;te++){var re=ie[te];if(re.to!=$&&I.getValue(j.hashNumber+","+re.to.hashNumber)!=true){var se=new e.XYZ($.param.x-j.param.x,$.param.y-j.param.y,$.param.z-j.param.z);var ne=new e.XYZ(re.to.param.x-j.param.x,re.to.param.y-j.param.y,re.to.param.z-j.param.z);var ae=e.geo.angleBetweenTwoVectorsBetweenMinusPiAndPi(se,ne,r.getValue($));if(ae<0)ae=6.2831853072+ae;if(ae<Q){Q=ae;ee=re}}}K.push(ee.to);I.putValue(j.hashNumber+","+ee.to.hashNumber,true);$=j;j=ee.to;if(j==H){J=false}}X.push(K)}}var oe=[];var he=[];var le=0;var ue=-1;for(var ce=0,me=X;ce<me.length;ce++){var B=me[ce];ue++;if(B.length==3){var pe=e.geo.distance(B[0].param,B[1].param);var fe=e.geo.distance(B[0].param,B[2].param);var de=e.geo.distance(B[1].param,B[2].param);var ve=(pe+fe+de)/2;var ge=Math.sqrt(ve*(ve-pe)*(ve-fe)*(ve-de));oe.push(ge)}else if(B.length==4){var pe=e.geo.distance(B[0].param,B[1].param);var fe=e.geo.distance(B[1].param,B[2].param);var de=e.geo.distance(B[2].param,B[3].param);var ye=e.geo.distance(B[3].param,B[0].param);var be=e.geo.distance(B[0].param,B[2].param);var we=(pe+fe+be)/2;var Me=Math.sqrt(we*(we-pe)*(we-fe)*(we-be));var xe=(de+ye+be)/2;var Ce=Math.sqrt(xe*(xe-de)*(xe-ye)*(xe-be));oe.push(Me+Ce)}else if(B.length>=5){var Te=(new e.Vertex).setPosition(0,0,0);le=1/B.length;var Ve=[B[0].position];var Se=[le];for(var ke=0,Oe=B;ke<Oe.length;ke++){var o=Oe[ke];Ve.push(o.position);Se.push(le)}e.geo.baryCenter(Ve,Se,Te.param);var Ae=(new e.Vertex).setPosition(Te.param.x,Te.param.y,Te.param.z);var Pe=0;for(var _e=0;_e<B.length;_e++){var pe=e.geo.distance(B[_e].param,B[(_e+1)%B.length].param);var fe=e.geo.distance(B[(_e+1)%B.length].param,Ae.param);var de=e.geo.distance(Ae.param,B[_e].param);var Fe=(pe+fe+de)/2;Pe=Pe+Math.sqrt(Fe*(Fe-pe)*(Fe-fe)*(Fe-de))}oe.push(Pe);he[ue]=Ae}}var Ne=-1;var Be=-1;if(oe.length!=1){for(var Le=0;Le<oe.length;Le++){if(oe[Le]>Ne){Ne=oe[Le];Be=Le}}}var Ye=-1;for(var Xe=0,Ie=X;Xe<Ie.length;Xe++){var B=Ie[Xe];Ye++;if(B.length==3&&Ye!=Be){this.mamesh.addATriangle(B[0],B[1],B[2])}else if(B.length==4&&Ye!=Be){this.mamesh.addASquare(B[0],B[1],B[2],B[3])}else if(B.length>=5&&Ye!=Be){var Ae=he[Ye];Ae.markers.push(e.Vertex.Markers.polygonCenter);this.mamesh.vertices.push(Ae);for(var Ze=0;Ze<B.length;Ze++){this.mamesh.addATriangle(B[Ze],B[(Ze+1)%B.length],Ae);B[Ze].setOneLink(Ae);Ae.setOneLink(B[Ze])}}}return this.mamesh};return t}();t.SurfaceConnectionProcess=i})(t=e.surfaceConnection||(e.surfaceConnection={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){t.squareMainSymmetries=[function(t){return new e.XYZ(1-t.x,t.y,t.z)},function(t){return new e.XYZ(t.x,1-t.y,t.z)},function(t){return new e.XYZ(1-t.x,1-t.y,t.z)}];var i;(function(e){e.verticalAxis="symI";e.horizontalAxis="symJ";e.slashAxis="symIJ";e.rotation="rotation"})(i=t.keyWords||(t.keyWords={}));function r(t,r,s){if(s===void 0){s=false}var n=new e.StringMap;n.putValue(i.verticalAxis,function(i){var r=t;if(i.y%2==1&&s)r++;return new e.XYZ(r-1-i.x,i.y,i.z)});n.putValue(i.horizontalAxis,function(t){return new e.XYZ(t.x,r-1-t.y,t.z)});n.putValue(i.slashAxis,function(i){var n=t;if(i.y%2==1&&s)n++;return new e.XYZ(n-1-i.x,r-1-i.y,i.z)});return n}t.cartesian=r;function s(e,t,i){if(i===void 0){i=false}var s=r(e,t,i);var n=[];for(var a=0,o=s.allValues();a<o.length;a++){var h=o[a];n.push(h)}return n}t.cartesianAsArray=s;function n(t){var r=new e.StringMap;var s=function(s){var n=Math.PI*2/t*s;r.putValue(i.rotation+s,function(t){var i=new e.XYZ(0,0,0);i.x=t.x*Math.cos(n)-t.y*Math.sin(n);i.y=t.x*Math.sin(n)+t.y*Math.cos(n);i.z=t.z;return i})};for(var n=1;n<t;n++){s(n)}return r}t.polygonRotations=n;function a(e){var t=n(e);var i=[];for(var r=0,s=t.allValues();r<s.length;r++){var a=s[r];i.push(a)}return i}t.getAllPolygonalRotations=a})(t=e.symmetries||(e.symmetries={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){function i(e){if(e==null||e.length==0)throw"empty list";var t=e[0];var i=0;for(var r=1;r<e.length;r++){if(e[r]>t){t=e[r];i=r}}return i}t.maxIndex=i;function r(e){return e[i(e)]}t.maxValue=r;function s(e){return e[i(e)]}t.maxValueString=s;function n(e){if(e==null||e.length==0)throw"empty list";var t=e[0];var i=0;for(var r=1;r<e.length;r++){if(e[r]<t){t=e[r];i=r}}return i}t.minIndex=n;function a(e){return e[n(e)]}t.minValue=a;function o(e){return e[n(e)]}t.minValueString=o;function h(e,t){if(e==null||e.length==0)throw"empty list";var i=e[0];var r=0;for(var s=1;s<e.length;s++){if(t(e[s],i)<0){i=e[s];r=s}}return r}t.minIndexOb=h;function l(e,t){return e[h(e,t)]}t.minValueOb=l;function u(e){while(e.length>0)e.pop()}t.clearArray=u;function c(e,t){var i=e.indexOf(t);if(i!=-1)e.splice(i,1);else{cc("l'objet n'est pas dans le tableau",t);throw"l'objet précédent n'est pas dans le tableau:"}}t.removeFromArray=c;function m(e,t){var i=[];for(var r=0,s=e;r<s.length;r++){var n=s[r];if(!t(n))i.push(n)}return i}t.arrayMinusElements=m;function p(e,t){var i=[];for(var r=0;r<e.length;r++){if(t.indexOf(r)!=-1)i.push(e[r])}return i}t.arrayKeepingSomeIndices=p;function f(e,t){var i=[];for(var r=0;r<e.length;r++){if(t.indexOf(r)==-1)i.push(e[r])}return i}t.arrayMinusSomeIndices=f;function d(e,t,i){var r=[];for(var s=0;s<e.length;s+=i){if(t.indexOf(s)==-1){for(var n=0;n<i;n++){r.push(e[s+n])}}}return r}t.arrayMinusBlocksIndices=d;function v(t){var i=Number.MAX_VALUE;var r=-1;for(var s=0;s<t.length;s++){if(t[s]<i){i=t[s];r=s}}if(r==-1)e.logger.c("an empty line has no minimum");return r}t.minIndexOfNumericList=v;function g(e){var t=Number.NEGATIVE_INFINITY;var i=-1;for(var r=0;r<e.length;r++){if(e[r]>t){t=e[r];i=r}}return i}t.maxIndexOfNumericList=g;function y(t){if(t.length==0){e.logger.c("an empty line has no minimum");return-1}var i=t[0];var r=0;for(var s=0;s<t.length;s++){if(t[s]<i){i=t[s];r=s}}return r}t.minIndexOfStringList=y;function b(e){var t=v(e);var i=[];for(var r=0;r<e.length;r++){i[r]=e[(r+t)%e.length]}return JSON.stringify(i)}t.indicesUpPermutationToString=b;var w=function(){function e(e,t,i){this.dicoOfExistingBlocks={};this.removeAlsoCircularPermutation=true;this.longList=e;this.blockSize=t;if(i==null){this.listToRemove=e;this.removeOnlyDoublon=true}else{this.listToRemove=i;this.removeOnlyDoublon=false}}e.prototype.go=function(){for(var e=0;e<this.listToRemove.length;e+=this.blockSize){try{var t=[];for(var i=0;i<this.blockSize;i++)t.push(this.listToRemove[e+i].hashString);this.dicoOfExistingBlocks[this.key(t)]=1}catch(e){throw"a block is not in your list"}}var r=[];for(var e=0;e<this.longList.length;e+=this.blockSize){var t=[];for(var i=0;i<this.blockSize;i++)t.push(this.longList[e+i].hashString);if(!this.removeOnlyDoublon){if(this.dicoOfExistingBlocks[this.key(t)]==null){for(var i=0;i<this.blockSize;i++)r.push(this.longList[e+i])}}else{if(this.dicoOfExistingBlocks[this.key(t)]==1){for(var i=0;i<this.blockSize;i++)r.push(this.longList[e+i]);this.dicoOfExistingBlocks[this.key(t)]++}}}return r};e.prototype.key=function(e){var t=[];if(!this.removeAlsoCircularPermutation)t=e;else{t=[];var i=y(e);for(var r=0;r<e.length;r++)t[r]=e[(r+i)%e.length]}var s="";t.forEach(function(e){s+=e+","});return s};return e}();t.ArrayMinusBlocksElements=w})(t=e.tab||(e.tab={}))})(mathis||(mathis={}));var mathis;(function(e){var t;(function(t){var i=function(){function t(t,i,r){this.nbSegments=32;this.meshModel=null;this.meshModels=null;this.useCloneInsteadOfInstances=false;this.checkCollision=false;this.color=e.color.thema.defaultVertexColor;this.constantRadius=null;this.radiusProp=.1;this.vertexToCopiedMeshes=new e.HashMap;if(e.deconnectViewerForTest)return;if(t instanceof e.Mamesh)this.vertices=t.vertices;else this.vertices=t;if(i==null)throw"scene is null";else this.scene=i;this.positionings=r}t.prototype.checkArgs=function(){if(this.vertices==null||this.vertices[0]==null)cc("no vertex to draw")};t.prototype.go=function(){if(e.deconnectViewerForTest)return;this.checkArgs();if(this.meshModel==null&&this.meshModels==null){this.meshModel=BABYLON.Mesh.CreateSphere("",this.nbSegments,2,this.scene);this.meshModels=[this.meshModel]}else{if(this.meshModels==null)this.meshModels=[];if(this.meshModel!=null)this.meshModels.push(this.meshModel);for(var t=0,i=this.meshModels;t<i.length;t++){var r=i[t];r.bakeCurrentTransformIntoVertices()}}for(var s=0,n=this.meshModels;s<n.length;s++){var r=n[s];if(r.material==null){var a=new BABYLON.StandardMaterial("",this.scene);a.diffuseColor=this.color.toBABYLON_Color3();r.material=a}}for(var o=0,h=this.meshModels;o<h.length;o++){var r=h[o];r.scaling=new e.XYZ(0,0,0)}if(this.positionings==null){this.positionings=new e.HashMap;for(var l=0,u=this.vertices;l<u.length;l++){var c=u[l];var m=void 0;if(this.constantRadius==null){var p=Number.MAX_VALUE;if(c.links.length!=0){for(var f=0,d=c.links;f<d.length;f++){var v=d[f];var g=e.geo.distance(c.position,v.to.position);if(g<p)p=g}}else{for(var y=0,b=this.vertices;y<b.length;y++){var w=b[y];if(!w.position.almostEqual(c.position)){var g=e.geo.distance(c.position,w.position);if(g<p)p=g}}}m=p*this.radiusProp}else m=this.constantRadius;var M=new e.Positioning;M.frontDir=new e.XYZ(1,0,0);M.upVector=new e.XYZ(0,1,0);M.scaling=new e.XYZ(m,m,m);this.positionings.putValue(c,M)}}this.buildVertexVisu()};t.prototype.clear=function(){var e=this;this.vertices.forEach(function(t){if(e.vertexToCopiedMeshes.getValue(t)!=null){for(var i=0,r=e.vertexToCopiedMeshes.getValue(t);i<r.length;i++){var s=r[i];s.dispose()}}})};t.prototype.buildVertexVisu=function(e,t){var i=this;if(e===void 0){e=this.vertices}if(t===void 0){t=[]}t.forEach(function(e){if(i.vertexToCopiedMeshes.getValue(e)!=null){for(var t=0,r=i.vertexToCopiedMeshes.getValue(e);t<r.length;t++){var s=r[t];s.dispose()}}i.vertexToCopiedMeshes.removeKey(e)});e.forEach(function(e){var t=[];if(i.useCloneInsteadOfInstances){for(var r=0,s=i.meshModels;r<s.length;r++){var n=s[r];t.push(n.clone(""))}}else{for(var a=0,o=i.meshModels;a<o.length;a++){var n=o[a];t.push(n.createInstance(""))}}for(var h=0,l=t;h<l.length;h++){var n=l[h];n.checkCollisions=i.checkCollision;if(i.parentNode!=null)n.parent=i.parentNode}if(i.vertexToCopiedMeshes.getValue(e)!=null){for(var u=0,c=i.vertexToCopiedMeshes.getValue(e);u<c.length;u++){var n=c[u];n.dispose()}}i.vertexToCopiedMeshes.putValue(e,t);i.updatePositioning(e)})};t.prototype.updatePositionings=function(e){var t=this;if(e===void 0){e=this.vertices}e.forEach(function(e){return t.updatePositioning(e)})};t.prototype.updatePositioning=function(t){var i=e.XYZ.newFrom(t.position);for(var r=0,s=this.vertexToCopiedMeshes.getValue(t);r<s.length;r++){var n=s[r];if(this.positionings.getValue(t)==null)throw"a vertex without associated positioning";if(Math.abs(this.positionings.getValue(t).scaling.x)<e.geo.epsilon){n.visibility=0}else{n.visibility=1;n.rotationQuaternion=this.positionings.getValue(t).quaternion();n.position=i;n.scaling=this.positionings.getValue(t).scaling}}};return t}();t.VerticesViewer=i;var r=function(){function t(t,i){this.parentNode=null;this.sideOrientation=BABYLON.Mesh.DOUBLESIDE;this.normalDuplication=s.duplicateOnlyWhenNormalsAreTooFarr;this.maxAngleBetweenNormals=Math.PI/4;this.color=e.color.thema.defaultSurfaceColor;this.alpha=.4;this.backFaceCulling=true;this.mamesh=t;this.scene=i}t.prototype.checkArgs=function(){if(this.scene==null)throw"the scene must but not null"};t.prototype.go=function(){if(e.deconnectViewerForTest)return;var t=[];var i=[];for(var r=0,s=this.mamesh.vertices;r<s.length;r++){var n=s[r];t.push(n.position.x,n.position.y,n.position.z)}var a=[];for(var o=0;o<this.mamesh.vertices.length;o++)a[this.mamesh.vertices[o].hashNumber]=o;var h=[];for(var l=0;l<this.mamesh.smallestTriangles.length;l+=3){var u=this.mamesh.smallestTriangles[l];var c=this.mamesh.smallestTriangles[l+1];var m=this.mamesh.smallestTriangles[l+2];h.push(a[u.hashNumber],a[c.hashNumber],a[m.hashNumber])}for(var l=0;l<this.mamesh.smallestSquares.length;l+=4){var u=this.mamesh.smallestSquares[l];var c=this.mamesh.smallestSquares[l+1];var m=this.mamesh.smallestSquares[l+2];var p=this.mamesh.smallestSquares[l+3];h.push(a[u.hashNumber],a[c.hashNumber],a[p.hashNumber]);h.push(a[c.hashNumber],a[m.hashNumber],a[p.hashNumber])}var f=this.computeOneNormalPerTriangle(t,h);var d=this.computeVertexNormalFromTrianglesNormal(t,h,f);this._ComputeSides(this.sideOrientation,t,h,d,i);var v=new BABYLON.VertexData;v.indices=h;v.positions=t;v.normals=d;v.uvs=i;var g=new BABYLON.Mesh("",this.scene);v.applyToMesh(g);if(this.parentNode!=null)g.parent=this.parentNode;if(this.material==null){var y=new BABYLON.StandardMaterial("",this.scene);y.diffuseColor=this.color.toBABYLON_Color3();this.material=y;this.material.backFaceCulling=this.backFaceCulling;if(!this.backFaceCulling)e.logger.c("backFaceCulling is desactivate on this mamesh.");this.material.sideOrientation=BABYLON.Mesh.BACKSIDE;y.alpha=this.alpha}g.material=this.material;return g};t.prototype._ComputeSides=function(e,t,i,r,s){var n=i.length;var a=r.length;var o;var h;e=e||BABYLON.Mesh.DEFAULTSIDE;switch(e){case BABYLON.Mesh.FRONTSIDE:break;case BABYLON.Mesh.BACKSIDE:var l;for(o=0;o<n;o+=3){l=i[o];i[o]=i[o+2];i[o+2]=l}for(h=0;h<a;h++){r[h]=-r[h]}break;case BABYLON.Mesh.DOUBLESIDE:var u=t.length;var c=u/3;for(var m=0;m<u;m++){t[u+m]=t[m]}for(o=0;o<n;o+=3){i[o+n]=i[o+2]+c;i[o+1+n]=i[o+1]+c;i[o+2+n]=i[o]+c}for(h=0;h<a;h++){r[a+h]=-r[h]}var p=s.length;for(var f=0;f<p;f++){s[f+p]=s[f]}break}};t.prototype.computeOneNormalPerTriangle=function(t,i){var r=[];var s=0;var n=0;var a=0;var o=0;var h=0;var l=0;var u=0;var c=0;var m=0;var p=0;var f=0;var d=0;var v=0;var g=i.length/3;for(var y=0;y<g;y++){f=i[y*3];d=i[y*3+1];v=i[y*3+2];s=t[f*3]-t[d*3];n=t[f*3+1]-t[d*3+1];a=t[f*3+2]-t[d*3+2];o=t[v*3]-t[d*3];h=t[v*3+1]-t[d*3+1];l=t[v*3+2]-t[d*3+2];u=n*l-a*h;c=a*o-s*l;m=s*h-n*o;p=Math.sqrt(u*u+c*c+m*m);p=p===0?1:p;u/=p;c/=p;m/=p;r[y]=new e.XYZ(u,c,m)}return r};t.prototype.computeVertexNormalFromTrianglesNormal=function(t,i,r){var n=this;var a=[];for(var o=0;o<t.length/3;o++)a[o]=new e.XYZ(0,0,0);if(this.normalDuplication==s.none){for(var o=0;o<i.length;o+=3){var h=Math.floor(o/3);a[i[o]].add(r[h]);a[i[o+1]].add(r[h]);a[i[o+2]].add(r[h])}a.forEach(function(e){e.normalize()})}else if(this.normalDuplication==s.duplicateVertex||this.normalDuplication==s.duplicateOnlyWhenNormalsAreTooFarr){var l=function(r,o,h,l,u,c){if(n.normalDuplication==s.duplicateOnlyWhenNormalsAreTooFarr){if(e.geo.xyzAlmostZero(r)||e.geo.xyzAlmostZero(o)||e.geo.angleBetweenTwoVectorsBetween0andPi(r,o)<n.maxAngleBetweenNormals){r.add(o)}else{var m=t.length/3;t.push(h,l,u);i[c]=m;a.push(o)}}else{var m=t.length/3;t.push(h,l,u);i[c]=m;a.push(o)}};for(var o=0;o<i.length;o+=3){var h=Math.floor(o/3);var u=i[o];l(a[u],r[h],t[3*u],t[3*u+1],t[3*u+2],o);u=i[o+1];l(a[u],r[h],t[3*u],t[3*u+1],t[3*u+2],o+1);u=i[o+2];l(a[u],r[h],t[3*u],t[3*u+1],t[3*u+2],o+2)}}else throw"wtf";var c=[];a.forEach(function(e){c.push(e.x,e.y,e.z)});return c};return t}();t.SurfaceViewer=r;(function(e){e[e["none"]=0]="none";e[e["duplicateOnlyWhenNormalsAreTooFarr"]=1]="duplicateOnlyWhenNormalsAreTooFarr";e[e["duplicateVertex"]=2]="duplicateVertex"})(t.NormalDuplication||(t.NormalDuplication={}));var s=t.NormalDuplication;var n=function(){function t(t,i){this.lateralScalingConstant=null;this.lateralScalingProp=.05;this.tesselation=12;this.material=null;this.color=e.color.thema.defaultLinkColor;this.res=[];this.pairVertexToLateralDirection=null;this.segmentOrientationFunction=null;this.clonesInsteadOfInstances=false;this.checkCollision=true;this.barycenter=null;this.middle=new e.XYZ(0,0,0);this.mamesh=t;this.scene=i}t.prototype.checkArgs=function(){if(this.scene==null)throw"scene is null";if(this.mamesh.vertices.length==0)cc("your IN_mamesh has no vertex")};t.prototype.go=function(){if(e.deconnectViewerForTest)return;this.checkArgs();if(this.meshModel==null){if(this.material==null){this.material=new BABYLON.StandardMaterial("",this.scene);this.material.diffuseColor=this.color.toBABYLON_Color3()}this.meshModel=BABYLON.Mesh.CreateCylinder("",1,1,1,this.tesselation,5,this.scene);this.meshModel.material=this.material}this.meshModel.scaling=new e.XYZ(0,0,0);if(this.lateralScalingConstant==null){var t=0;var i=0;for(var r=0,s=this.mamesh.vertices;r<s.length;r++){var n=s[r];if(n.links.length!=0){var a=Number.MAX_VALUE;for(var o=0,h=n.links;o<h.length;o++){var l=h[o];var u=e.geo.distance(n.position,l.to.position);if(u<a)a=u}t+=a;i++}}t/=i;this.lateralScalingConstant=t*this.lateralScalingProp}var c=new e.StringMap;for(var m=0,p=this.mamesh.vertices;m<p.length;m++){var f=p[m];for(var d=0,v=f.links;d<v.length;d++){var g=v[d];var y=e.tab.indicesUpPermutationToString([f.hashNumber,g.to.hashNumber]);if(c.getValue(y)==null){this.drawOneLink(f,g.to);c.putValue(y,true)}}}return this.res};t.prototype.drawOneLink=function(t,i){if(this.segmentOrientationFunction!=null){if(this.segmentOrientationFunction(t,i)==0)return;if(this.segmentOrientationFunction(t,i)<0){var r=t;t=i;i=r}}var s;if(this.clonesInsteadOfInstances)s=this.meshModel.clone("");else s=this.meshModel.createInstance("");s.checkCollisions=this.checkCollision;var n=new o(t.position,i.position,s);n.lateralScaling=this.lateralScalingConstant;if(this.pairVertexToLateralDirection!=null){n.lateralDirection=this.pairVertexToLateralDirection(t,i)}else{if(this.barycenter==null){this.barycenter=new e.XYZ(0,0,0);for(var a=0,h=this.mamesh.vertices;a<h.length;a++){var l=h[a];this.barycenter.add(l.position)}this.barycenter.scale(1/this.mamesh.vertices.length)}this.middle.copyFrom(t.position).add(i.position).scale(.5);this.middle.substract(this.barycenter);n.lateralDirection.copyFrom(this.middle)}n.goChanging();if(this.parentNode!=null)s.parent=this.parentNode;this.res.push(s)};return t}();t.LinksViewer=n;var a=function(){function t(t,i){this.vertices=null;this.doNotDrawLinesContainingOnlyInvisibleVertices=true;this.color=null;this.lineToColor=null;this.lineToLevel=null;this.levelPropToColorFunc=function(t){return new e.Color(new e.HSV_01(t*.7,1,.8))};this.cap=BABYLON.Mesh.NO_CAP;this.tesselation=10;this.interpolationOption=new e.geometry.InterpolationOption;this.isThin=false;this.constantRadius=null;this.radiusProp=.05;this.radiusFunction=null;this.res=[];if(t instanceof e.Mamesh){var r=t;if(!r.linesWasMade)r.fillLineCatalogue();this.lines=r.lines}else{this.lines=t}this.scene=i}t.prototype.go=function(){this.buildLineToColor();if(e.deconnectViewerForTest)return;if(this.scene==null)throw"scene is null";for(var t=0,i=this.lines;t<i.length;t++){var r=i[t];if(this.lineToColor.getValue(r)!=null)this.drawOneLine(r)}return this.res};t.prototype.clear=function(){for(var e=0,t=this.res;e<t.length;e++){var i=t[e];i.dispose()}};t.prototype.buildLineToColor=function(){if(this.color!=null){this.lineToColor=new e.HashMap;for(var t=0,i=this.lines;t<i.length;t++){var r=i[t];this.lineToColor.putValue(r,this.color)}return}if(this.lineToColor!=null)return;if(this.lineToLevel==null){this.lineToLevel=new e.HashMap;for(var s=0;s<this.lines.length;s++)this.lineToLevel.putValue(this.lines[s],s)}var n=e.tab.maxValue(this.lineToLevel.allValues());var a=e.tab.minValue(this.lineToLevel.allValues());this.lineToColor=new e.HashMap;for(var o=0,h=this.lines;o<h.length;o++){var r=h[o];var l=this.lineToLevel.getValue(r);if(l!=null){var u=(l-a)/(n-a);this.lineToColor.putValue(r,this.levelPropToColorFunc(u))}else this.lineToColor.putValue(r,null)}};t.prototype.drawOneLine=function(e){var t=[];var i=true;e.vertices.forEach(function(e){t.push(e.position);if(!e.isInvisible)i=false});if(i&&this.doNotDrawLinesContainingOnlyInvisibleVertices)return;var r=this.drawOnePath(e,t);this.res.push(r)};t.prototype.drawOnePath=function(t,i){var r=this;var s;var n;if(this.interpolationOption!=null&&this.interpolationOption.interpolationStyle!=e.geometry.InterpolationStyle.none){var a=new e.geometry.LineInterpoler(i);a.options=this.interpolationOption;if(t.isLoop)a.options.loopLine=true;n=a.go()}else{n=i;if(t.isLoop)n.push(i[0])}i=n;var o=this.lineToColor.getValue(t).toBABYLON_Color3();if(this.isThin){var h=BABYLON.Mesh.CreateLines("",i,this.scene);h.color=o;s=h}else{var l=null;if(this.radiusFunction!=null){var u=0;for(var c=0;c<i.length-1;c++){u+=e.geo.distance(i[c],i[c+1])}l=function(e,t){return r.radiusFunction(e,t/u)};s=BABYLON.Mesh.CreateTube("",i,null,this.tesselation,l,this.cap,this.scene,true,BABYLON.Mesh.FRONTSIDE)}else{if(this.constantRadius==null){var m=0;var p=0;for(var f=0,d=this.lines;f<d.length;f++){var v=d[f];for(var c=0;c<v.vertices.length-1;c++){m+=e.geo.distance(v.vertices[c].position,v.vertices[c+1].position);p++}}this.constantRadius=m/p*this.radiusProp}s=BABYLON.Mesh.CreateTube("",i,this.constantRadius,this.tesselation,null,this.cap,this.scene,true,BABYLON.Mesh.FRONTSIDE)}}var g=new BABYLON.StandardMaterial("",this.scene);g.diffuseColor=o;s.material=g;if(this.parentNode!=null)s.parent=this.parentNode;return s};return t}();t.LinesViewer=a;var o=function(){function t(t,i,r){this.lateralScaling=.05;this.lateralDirection=new e.XYZ(0,0,1);this.yAxis=new e.XYZ(0,1,0);this.zAxis=new e.XYZ(0,0,1);this.direction=new e.XYZ(0,0,0);this.nothing=new e.XYZ(0,0,0);this.begin=t;this.end=i;this.modelMesh=r}t.prototype.goChanging=function(){this.direction.copyFrom(this.end).substract(this.begin);var t=this.direction.length();this.direction.normalize();var i=new e.XYZ(0,0,0);i.add(this.begin).add(this.end).scale(.5);this.modelMesh.scaling=new e.XYZ(this.lateralScaling,t,this.lateralScaling);this.modelMesh.position=i;var r=new e.XYZ(0,0,0);var s=new e.XYZ(0,0,0);e.geo.cross(this.direction,this.lateralDirection,this.nothing);if(this.nothing.lengthSquared()<e.geo.epsilon)s.copyFromFloats(Math.random(),Math.random(),Math.random());else s.copyFrom(this.lateralDirection);e.geo.orthonormalizeKeepingFirstDirection(this.direction,s,this.nothing,r);var n=new e.XYZW(0,0,0,0);e.geo.aQuaternionMovingABtoCD(this.yAxis,this.zAxis,this.direction,r,n,true);this.modelMesh.rotationQuaternion=n;return this.modelMesh};return t}();t.ElongateAMeshFromBeginToEnd=o})(t=e.visu3d||(e.visu3d={}))})(mathis||(mathis={}));var cc;var showDevMessages=true;if(showDevMessages){cc=console.log.bind(window.console)}else cc=function(){};var mathis;(function(e){e.geo=new e.Geo;e.logger=new e.Logger;e.deconnectViewerForTest=false})(mathis||(mathis={}));