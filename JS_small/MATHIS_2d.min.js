var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(t,s){function i(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}(),mathis;!function(e){!function(t){var s=function(){function t(){this.parents=new e.HashMap(!0),this.ranks=new e.HashMap}return t.prototype.find=function(e){return this.addElement(e),this.findRec(e)},t.prototype.findRec=function(e){for(;this.parents.getValue(e)!=this.parents.getValue(this.parents.getValue(e));)this.parents.putValue(e,this.findRec(this.parents.getValue(e)));return this.parents.getValue(e)},t.prototype.union=function(e,t){var s=this.find(e),i=this.find(t);if(s.hashString==i.hashString)return!1;if(this.ranks.getValue(s)<this.ranks.getValue(i))this.parents.putValue(s,i);else if(this.ranks.getValue(s)>this.ranks.getValue(i))this.parents.putValue(i,s);else{this.parents.putValue(s,i);var r=this.ranks.getValue(i);this.ranks.putValue(i,r+this.ranks.getValue(s)+1)}return!0},t.prototype.addElement=function(e){null==this.parents.getValue(e)&&(this.parents.putValue(e,e),this.ranks.putValue(e,0))},t.prototype.get_components=function(t){void 0===t&&(t=!0);for(var s=new e.HashMap(!0),i=this.parents.allKeys(),r=0,n=i;r<n.length;r++){h=n[r];this.find(h).hashString==h.hashString&&(t?s.putValue(h,[h]):s.putValue(h,[]))}for(var o=0,a=i;o<a.length;o++){var h=a[o],l=this.find(h);l.hashString!=h.hashString&&s.getValue(l).push(h)}return s},t}();t.UnionFind=s}(e.general_algo||(e.general_algo={}))}(mathis||(mathis={}));var BABYLON;!function(e){var t=function(){function e(e,t,s){this.x=e,this.y=t,this.z=s}return e}();e.Vector3=t;var s=function(){function e(){this.m=[]}return e}();e.Matrix=s;var i=function(){function e(e,t,s,i){this.x=e,this.y=t,this.z=s,this.w=i}return e}();e.Quaternion=i;var r=function(){function e(){}return e}();e.Mesh=r}(BABYLON||(BABYLON={}));var mathis;!function(e){e.PI=Math.PI,e.cos=Math.cos,e.sin=Math.sin,e.exp=Math.exp,e.sqrt=Math.sqrt;var t=function(){function e(e,t){this.u=e,this.v=t}return e}();e.UV=t;var s=function(){function e(){this.m11=0,this.m12=0,this.m21=0,this.m22=0}return e.prototype.determinant=function(){return this.m11*this.m22-this.m21*this.m12},e.prototype.inverse=function(){var t=new e,s=this.determinant();return t.m11=this.m22/s,t.m22=this.m11/s,t.m12=-this.m12/s,t.m21=-this.m21/s,t},e.prototype.multiplyUV=function(e){return new t(this.m11*e.u+this.m12*e.v,this.m21*e.u+this.m22*e.v)},e}();e.M22=s;var i=function(t){function s(e,s,i){return t.call(this,e,s,i)||this}return __extends(s,t),s.resetDefaultNbDecimalForHash=function(){s.nbDecimalForHash=5},Object.defineProperty(s.prototype,"hashString",{get:function(){return e.roundWithGivenPrecision(this.x,s.nbDecimalForHash)+","+e.roundWithGivenPrecision(this.y,s.nbDecimalForHash)+","+e.roundWithGivenPrecision(this.z,s.nbDecimalForHash)},enumerable:!0,configurable:!0}),s.newZero=function(){return new s(0,0,0)},s.newFrom=function(e){return null==e?null:new s(e.x,e.y,e.z)},s.newOnes=function(){return new s(1,1,1)},s.newRandom=function(){return new s(Math.random(),Math.random(),Math.random())},s.temp0=function(e,t,s){return r.copyFromFloats(e,t,s),r},s.temp1=function(e,t,s){return n.copyFromFloats(e,t,s),n},s.prototype.add=function(t){return e.geo.add(this,t,this),this},s.prototype.resizes=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},s.prototype.multiply=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},s.prototype.length=function(){return e.geo.norme(this)},s.prototype.lengthSquared=function(){return e.geo.squareNorme(this)},s.prototype.substract=function(t){return e.geo.substract(this,t,this),this},s.prototype.scale=function(t){return e.geo.scale(this,t,this),this},s.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},s.prototype.copyFromFloats=function(e,t,s){return this.x=e,this.y=t,this.z=s,this},s.prototype.changeBy=function(e,t,s){return this.x=e,this.y=t,this.z=s,this},s.prototype.normalize=function(){var t=e.geo.norme(this);if(t<e.geo.epsilon)throw"be careful, you have normalized a very small vector";return this.scale(1/t)},s.prototype.almostEqual=function(t){return e.geo.xyzAlmostEquality(this,t)},s.prototype.toString=function(e){return void 0===e&&(e=2),"("+this.x.toFixed(e)+","+this.y.toFixed(e)+","+this.z.toFixed(e)+")"},s.lexicalOrder=function(e,t){return e.x!=t.x?e.x-t.x:e.y!=t.y?e.y-t.y:e.z!=t.z?e.z-t.z:0},s.lexicalOrderInverse=function(e,t){return-s.lexicalOrder(e,t)},s.nbDecimalForHash=5,s}(BABYLON.Vector3);e.XYZ=i;var r=new i(0,0,0),n=new i(0,0,0),o=function(t){function s(e,s,i,r){return t.call(this,e,s,i,r)||this}return __extends(s,t),s.prototype.multiply=function(t){return e.geo.quaternionMultiplication(t,this,this),this},s}(BABYLON.Quaternion);e.XYZW=o;var a=function(){function e(){}return e.orientedSegmentTuple=function(e){return e[0].hashNumber+","+e[1].hashNumber},e.orientedSegment=function(e,t){return e.hashNumber+","+t.hashNumber},e.segment=function(e,t){return g.segmentId(e.hashNumber,t.hashNumber)},e.segmentOrd=function(e,t){return e.hashNumber>t.hashNumber&&(s=[t,e],e=s[0],t=s[1]),[e,t];var s},e.quad=function(t,s,i,r){return n=e.quadOrd(t,s,i,r),t=n[0],s=n[1],i=n[2],r=n[3],t.hashNumber+","+s.hashNumber+","+i.hashNumber+","+r.hashNumber;var n},e.quadOrd=function(e,t,s,i){for(;e.hashNumber>t.hashNumber||e.hashNumber>s.hashNumber||e.hashNumber>i.hashNumber;)r=[t,s,i,e],e=r[0],t=r[1],s=r[2],i=r[3];return t.hashNumber<i.hashNumber&&(n=[i,t],t=n[0],i=n[1]),[e,t,s,i];var r,n},e}();e.Hash=a;var h=function(){function t(){this.position=new i(0,0,0),this.frontDir=new i(1,0,0),this.upVector=new i(0,1,0),this.scaling=new i(1,1,1),this.defaultUpDirIfTooSmall=new i(1,1,0),this.defaultFrontDirIfTooSmall=new i(0,0,1)}return t.prototype.copyFrom=function(e){this.position=i.newFrom(e.position),this.upVector=i.newFrom(e.upVector),this.frontDir=i.newFrom(e.frontDir),this.scaling=i.newFrom(e.scaling)},t.prototype.changeFrontDir=function(t){e.geo.orthonormalizeKeepingFirstDirection(t,this.upVector,this.frontDir,this.upVector)},t.prototype.changeUpVector=function(t){e.geo.orthonormalizeKeepingFirstDirection(this.upVector,t,this.upVector,this.frontDir)},t.prototype.setOrientation=function(t,s){this.upVector=new i(0,0,0),this.frontDir=new i(0,0,0),e.geo.orthonormalizeKeepingFirstDirection(t,s,this.frontDir,this.upVector)},t.prototype.quaternion=function(t){if(void 0===t&&(t=!0),null==this.frontDir&&null==this.upVector)throw"you must precise a frontDir or a upVector or both of them";null==this.frontDir?(this.frontDir=new i(0,0,0),e.geo.getOneOrthonormal(this.upVector,this.frontDir)):null==this.upVector&&(this.upVector=new i(0,0,0),e.geo.getOneOrthonormal(this.frontDir,this.upVector)),this.frontDir.length()<e.geo.epsilon&&(this.frontDir=this.defaultFrontDirIfTooSmall,e.logger.c("a tangent was too small, and so replaced by a default one")),this.upVector.length()<e.geo.epsilon&&(this.upVector=this.defaultUpDirIfTooSmall,e.logger.c("a normal was too small, and so replaced by a default one"));var s=new o(0,0,0,1);return e.geo.twoVectorsToQuaternion(this.frontDir,this.upVector,!t,s),s},t.prototype.applyToMeshes=function(e){var t=null;null==this.frontDir&&null==this.upVector||(t=this.quaternion());for(var s=0,r=e;s<r.length;s++){var n=r[s];null!=this.scaling&&(null==n.scaling&&(n.scaling=new i(1,1,1)),n.scaling.x=this.scaling.x,n.scaling.y=this.scaling.y,n.scaling.z=this.scaling.z),null!=t&&(null==n.rotationQuaternion&&(n.rotationQuaternion=new o(0,0,0,1)),n.rotationQuaternion.x=t.x,n.rotationQuaternion.y=t.y,n.rotationQuaternion.z=t.z,n.rotationQuaternion.w=t.w),null!=this.position&&(null==n.position&&(n.position=new i(0,0,0)),n.position.x=this.position.x,n.position.y=this.position.y,n.position.z=this.position.z)}},t.prototype.applyToMesh=function(e){this.applyToMeshes([e])},t.prototype.applyToVertices=function(t){var s=this.quaternion(),i=new l;e.geo.quaternionToMatrix(s,i);for(var r=0,n=t;r<n.length;r++){var o=n[r];o.position.multiply(this.scaling),e.geo.multiplicationVectorMatrix(i,o.position,o.position),o.position.add(this.position)}},t}();e.Positioning=h;var l=function(t){function s(){return t.call(this)||this}return __extends(s,t),s.newIdentity=function(){var e=new s;return e.m[0]=1,e.m[5]=1,e.m[10]=1,e.m[15]=1,e},s.newFrom=function(e){for(var t=new s,i=0;i<16;i++)t.m[i]=e.m[i];return t},s.newRandomMat=function(){for(var e=new s,t=0;t<16;t++)e.m[t]=Math.random();return e},s.newZero=function(){return new s},s.prototype.equal=function(t){return e.geo.matEquality(this,t)},s.prototype.almostEqual=function(t){return e.geo.matAlmostEquality(this,t)},s.prototype.leftMultiply=function(t){return e.geo.multiplyMatMat(t,this,this),this},s.prototype.rightMultiply=function(t){return e.geo.multiplyMatMat(this,t,this),this},s.prototype.inverse=function(){return e.geo.inverse(this,this),this},s.prototype.copyFrom=function(t){return e.geo.copyMat(t,this),this},s.prototype.transpose=function(){return e.geo.transpose(this,this),this},s.prototype.toString=function(){return"\n"+this.m[0]+this.m[1]+this.m[2]+this.m[3]+"\n"+this.m[4]+this.m[5]+this.m[6]+this.m[7]+"\n"+this.m[8]+this.m[9]+this.m[10]+this.m[11]+"\n"+this.m[12]+this.m[13]+this.m[14]+this.m[15]+"\n"},s}(BABYLON.Matrix);e.MM=l;var u=function(){function e(e){if(this.customerOb=null,null==e)throw"a links is construct with a null vertex";this.to=e}return e}();e.Link=u;var m=function(){function t(){this.links=[],this.dichoLevel=0,this.markers=[],this.customerObject={},this._hashCode=t.hashCount++}return Object.defineProperty(t.prototype,"hashNumber",{get:function(){return this._hashCode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hashString",{get:function(){return this._hashCode+""},enumerable:!0,configurable:!0}),t.prototype.setPosition=function(e,t,s,r){return void 0===r&&(r=!0),this.position=new i(e,t,s),r&&(this.param=new i(e,t,s)),this},t.prototype.hasMark=function(e){return-1!=this.markers.indexOf(e)},t.prototype.getOpposites=function(e){var t=this.findLink(e);if(null==t)throw"the vertex is not a neighbor. Probably your neighborhood relation is not symetric. Please, perform the graph analysis, with the help of the function linkModule.checkTheRegularityOfAGRaph";if(null==t.opposites)return null;for(var s=[],i=0,r=t.opposites;i<r.length;i++){var n=r[i];s.push(n.to)}return s},t.prototype.hasBifurcations=function(){for(var e=0,t=this.links;e<t.length;e++){var s=t[e];if(null!=s.opposites&&s.opposites.length>1)return!0}return!1},t.prototype.hasVoisin=function(e){for(var t=0,s=this.links;t<s.length;t++)if(s[t].to==e)return!0;return!1},t.prototype.isBorder=function(){return this.hasMark(t.Markers.border)},t.prototype.findLink=function(e){for(var t=0,s=this.links;t<s.length;t++){var i=s[t];if(i.to==e)return i}return null},t.prototype.setTwoOppositeLinks=function(e,t){var s=this.findLink(e),i=this.findLink(t);return null==s&&(s=new u(e),this.links.push(s)),null==i&&(i=new u(t),this.links.push(i)),null==s.opposites&&(s.opposites=[]),null==i.opposites&&(i.opposites=[]),s.opposites.push(i),i.opposites.push(s),this},t.prototype.setOneLink=function(e){if(e==this)throw"it is forbidden to link to itself";return this.suppressOneLink(e),this.links.push(new u(e)),this},t.separateTwoVoisins=function(e,t){e.suppressOneLink(t),t.suppressOneLink(e)},t.prototype.suppressOneLink=function(t){var s=this.findLink(t);if(null!=s&&(e.tab.removeFromArray(this.links,s),null!=s.opposites))for(var i=0,r=s.opposites;i<r.length;i++){var n=r[i];n.opposites.length>=2?e.tab.removeFromArray(n.opposites,s):n.opposites=null}},t.prototype.changeToLinkWithoutOpposite=function(t){var s=this.findLink(t);if(null!=s){if(null!=s.opposites)for(var i=0,r=s.opposites;i<r.length;i++){var n=r[i];n.opposites.length>=2?e.tab.removeFromArray(n.opposites,s):n.opposites=null}s.opposites=null}},t.prototype.toString=function(e){return this.hashNumber-e+""},t.prototype.toStringComplete=function(e){for(var s=this.hashNumber-e+"|links:",i=0,r=this.links;i<r.length;i++){var n=r[i],o="";if(null!=n.opposites){o+=",";for(var a=0,h=n.opposites;a<h.length;a++)o+=h[a].to.hashNumber-e+","}s+="("+(n.to.hashNumber-e)+o+")"}null!=this.position&&(s+="|pos:"+this.position.toString(1)+","),s+="|mark:";for(var l=0,u=this.markers;l<u.length;l++){var m=u[l];s+=t.Markers[m]+","}return s},t.hashCount=0,t}();e.Vertex=m,function(e){!function(e){e[e.honeyComb=0]="honeyComb",e[e.corner=1]="corner",e[e.center=2]="center",e[e.border=3]="border",e[e.polygonCenter=4]="polygonCenter",e[e.selectedForLineDrawing=5]="selectedForLineDrawing"}(e.Markers||(e.Markers={}))}(m=e.Vertex||(e.Vertex={}));var c=function(){function t(){this.vertices=[],this.smallestTriangles=[],this.smallestSquares=[],this.hexahedrons=[],this.cutSegmentsDico={}}return Object.defineProperty(t.prototype,"polygons",{get:function(){for(var e=[],t=0;t<this.smallestSquares.length;t+=4)e.push([this.smallestSquares[t],this.smallestSquares[t+1],this.smallestSquares[t+2],this.smallestSquares[t+3]]);for(t=0;t<this.smallestTriangles.length;t+=3)e.push([this.smallestTriangles[t],this.smallestTriangles[t+1],this.smallestTriangles[t+2]]);return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linesWasMade",{get:function(){return null!=this.lines},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"segments",{get:function(){for(var e=[],t=0,s=this.vertices;t<s.length;t++)for(var i=s[t],r=0,n=i.links;r<n.length;r++){var o=n[r];i.hashNumber<o.to.hashNumber&&e.push([i,o.to])}return e},enumerable:!0,configurable:!0}),t.prototype.addATriangle=function(e,t,s,i){if(void 0===i&&(i=!1),null!=e&&null!=t&&null!=s)this.smallestTriangles.push(e,t,s);else if(i)throw"you try to add a null vertex in a triangle";return this},t.prototype.addASquare=function(e,t,s,i){return this.smallestSquares.push(e,t,s,i),this},t.prototype.addHexahedron=function(e){return this.hexahedrons.concat(e),this},t.prototype.getVertex=function(e){var t=this.findVertexFromParam(e);return null==t&&(t=this.newVertex(e)),t},t.prototype.newVertex=function(e,t,s){void 0===t&&(t=0);var i=new m;return i.position=e,i.param=s||e,i.dichoLevel=t,this.addVertex(i),i},t.prototype.findVertexFromParam=function(e){for(var t=0,s=this.vertices;t<s.length;t++){var i=s[t];if(i.param.hashString==e.hashString)return i}return null},t.prototype.addVertex=function(e){this.vertices.push(e)},t.prototype.hasVertex=function(e){for(var t=0,s=this.vertices;t<s.length;t++)if(s[t].hashNumber==e.hashNumber)return!0;return!1},t.prototype.getStraightLines=function(){for(var e=[],t=0,s=this.lines;t<s.length;t++){var i=s[t];i.isLoop||e.push(i)}return e},t.prototype.getLoopLines=function(){for(var e=[],t=0,s=this.lines;t<s.length;t++){var i=s[t];i.isLoop&&e.push(i)}return e},t.prototype.getStraightLinesAsVertices=function(){for(var e=[],t=0,s=this.lines;t<s.length;t++){var i=s[t];i.isLoop||e.push(i.vertices)}return e},t.prototype.getLoopLinesAsVertices=function(){for(var e=[],t=0,s=this.lines;t<s.length;t++){var i=s[t];i.isLoop&&e.push(i.vertices)}return e},t.prototype.toString=function(e){void 0===e&&(e=!0);var t=0;if(e){t=Number.MAX_VALUE;for(var s=0,i=this.vertices;s<i.length;s++)(a=i[s]).hashNumber<t&&(t=a.hashNumber)}var r="\n";null!=this.name&&(r+=this.name+"\n");for(var n=0,o=this.vertices;n<o.length;n++){var a=o[n];r+=a.toStringComplete(t)+"\n"}r+="tri:";for(h=0;h<this.smallestTriangles.length;h+=3)r+="["+(this.smallestTriangles[h].hashNumber-t)+","+(this.smallestTriangles[h+1].hashNumber-t)+","+(this.smallestTriangles[h+2].hashNumber-t)+"]";r+="\nsqua:";for(var h=0;h<this.smallestSquares.length;h+=4)r+="["+(this.smallestSquares[h].hashNumber-t)+","+(this.smallestSquares[h+1].hashNumber-t)+","+(this.smallestSquares[h+2].hashNumber-t)+","+(this.smallestSquares[h+3].hashNumber-t)+"]";if(this.linesWasMade){r+="\nstrai:";for(var l=0,u=this.getStraightLines();l<u.length;l++){r+="[";for(var m=0,c=(d=u[l]).vertices;m<c.length;m++)r+=(y=c[m]).hashNumber-t+",";r+="]"}r+="\nloop:";for(var p=0,g=this.getLoopLines();p<g.length;p++){var d=g[p];r+="[";for(var f=0,v=d.vertices;f<v.length;f++){var y=v[f];r+=y.hashNumber-t+","}r+="]"}}r+="\ncutSegments";for(var b in this.cutSegmentsDico){var x=this.cutSegmentsDico[b];r+="{"+(x.a.hashNumber-t)+","+(x.middle.hashNumber-t)+","+(x.b.hashNumber-t)+"}"}return r},t.prototype.fillLineCatalogue=function(t){void 0===t&&(t=this.vertices),this.lines=e.lineModule.makeLineCatalogue2(t,!0)},t.prototype.addSimpleLinksAroundPolygons=function(){new e.linkModule.SimpleLinkFromPolygonCreator(this).goChanging()},t.prototype.addOppositeLinksAroundPolygons=function(){new e.linkModule.SimpleLinkFromPolygonCreator(this).goChanging(),new e.linkModule.OppositeLinkAssocierByAngles(this.vertices).goChanging()},t.prototype.isolateMameshVerticesFromExteriorVertices=function(){for(var e=[],t=0,s=this.vertices;t<s.length;t++)for(var i=s[t],r=0,n=i.links;r<n.length;r++){var o=n[r];this.hasVertex(o.to)||e.push({vertex:i,link:o})}for(var a=0,h=e;a<h.length;a++){var l=h[a];m.separateTwoVoisins(l.link.to,l.vertex)}},t.prototype.getOrCreateSegment=function(e,t,s){var i=this.cutSegmentsDico[g.segmentId(e.hashNumber,t.hashNumber)];null==i&&(i=new g(e,t),this.cutSegmentsDico[g.segmentId(e.hashNumber,t.hashNumber)]=i),s[g.segmentId(e.hashNumber,t.hashNumber)]=i},t.prototype.maxLinkLength=function(){var t=-1;if(this.vertices.forEach(function(s){s.links.forEach(function(i){var r=e.geo.distance(s.position,i.to.position);r>t&&(t=r)})}),-1==t)throw"your IN_mamesh seems empty";return t},t.prototype.clearLinksAndLines=function(){this.vertices.forEach(function(t){e.tab.clearArray(t.links)}),this.lines=null},t.prototype.clearOppositeInLinks=function(){this.vertices.forEach(function(e){e.links.forEach(function(e){e.opposites=null})})},t.prototype.allLinesAsASortedString=function(t){void 0===t&&(t=!0);var s,i,r="";if(t){i=Number.MAX_VALUE;for(var n=0,o=this.vertices;n<o.length;n++){var a=o[n];a.hashNumber<i&&(i=a.hashNumber)}}if(this.linesWasMade){var h=this.getStraightLines(),l=this.getLoopLines();this.linesWasMade&&h.length>0&&(s=[],h.forEach(function(e){var t=[];e.vertices.forEach(function(e){t.push(e.hashNumber-i)}),s.push(JSON.stringify(t))}),s.sort(),r="straightLines:"+JSON.stringify(s)),l.length>0&&(s=[],l.forEach(function(t){var r=[];t.vertices.forEach(function(e){r.push(e.hashNumber-i)});for(var n=e.tab.minIndexOfNumericList(r),o=[],a=0;a<r.length;a++)o[a]=r[(a+n)%r.length];s.push(JSON.stringify(o))}),s.sort(),r+="|loopLines:"+JSON.stringify(s))}return r},t.prototype.allSquareAndTrianglesAsSortedString=function(e){void 0===e&&(e=!0);var t=0;if(e){t=Number.MAX_VALUE;for(var s=0,i=this.vertices;s<i.length;s++){var r=i[s];r.hashNumber<t&&(t=r.hashNumber)}}return"square:"+this.allSquaresOrTrianglesAsASortedString(this.smallestSquares,4,t)+("triangle:"+this.allSquaresOrTrianglesAsASortedString(this.smallestTriangles,3,t))},t.prototype.allSquaresOrTrianglesAsASortedString=function(t,s,i){for(var r,n="",o=[],a=0;a<t.length;a+=s){for(var h=[],l=0;l<s;l++)h.push(t[a+l]);o.push(h)}return r=[],o.forEach(function(t){var s=[];t.forEach(function(e){s.push(e.hashNumber-i)});for(var n=e.tab.minIndexOfNumericList(s),o=[],a=0;a<s.length;a++)o[a]=s[(a+n)%s.length];r.push(JSON.stringify(o))}),r.sort(),n+=JSON.stringify(r)},t.prototype.checkPolygonAsLinkedSides=function(e){for(var t=0;t<e.length;t++)if(!e[t].hasVoisin(e[(t+1)%e.length]))return!1;return!0},t}();e.Mamesh=c;var p=function(){function t(e,t){this.vertices=e,this.isLoop=t}return t.prototype.getVertex=function(e,t){return void 0===t&&(t=!0),this.isLoop&&t?this.vertices[e%this.vertices.length]:this.vertices[e]},t.prototype.hashForDirected=function(){var t=[];if(this.isLoop)for(var s=e.tab.minIndexOb(this.vertices,function(e,t){return e.hashNumber-t.hashNumber}),i=0;i<this.vertices.length;i++)t.push(this.vertices[(i+s)%this.vertices.length].hashNumber);else for(var r=0,n=this.vertices;r<n.length;r++){var o=n[r];t.push(o.hashNumber)}return JSON.stringify(t)},t.prototype.inverted=function(){for(var e=[],s=0;s<this.vertices.length;s++)e.push(this.vertices[this.vertices.length-1-s]);return new t(e,this.isLoop)},t.prototype.positionList=function(){for(var e=[],t=0,s=this.vertices;t<s.length;t++){var i=s[t];e.push(i.position)}return e},Object.defineProperty(t.prototype,"hashString",{get:function(){var e=this.hashForDirected(),t=this.inverted().hashForDirected();return e<t?e:t},enumerable:!0,configurable:!0}),t.prototype.positionnalHashForDirected=function(t){void 0===t&&(t=1);var s=[];if(i.nbDecimalForHash=t,this.isLoop)for(var r=this.positionList(),n=e.tab.minIndexOb(r,i.lexicalOrder),o=0;o<r.length;o++)s.push(r[(o+n)%r.length].hashString);else for(var a=0,h=this.vertices;a<h.length;a++){var l=h[a];s.push(l.position.hashString)}return i.resetDefaultNbDecimalForHash(),JSON.stringify(s)},t.prototype.positionnalHash=function(e){void 0===e&&(e=1);var t=this.positionnalHashForDirected(e),s=this.inverted().positionnalHashForDirected(e);return t<s?t:s},t.prototype.hashStringUpToSymmetries=function(s,i){for(var r=[this.positionnalHash()],n=0,o=s;n<o.length;n++){for(var a=o[n],h=[],l=0,u=this.vertices;l<u.length;l++){var c=u[l],p=new m;p.position=a(i?c.position:c.param),h.push(p)}var g=new t(h,this.isLoop);r.push(g.positionnalHash())}return e.tab.minValueString(r)},t.prototype.allSegments=function(){for(var e=[],t=this.isLoop?1:0,s=0;s<this.vertices.length-1+t;s++)e.push(new g(this.vertices[s],this.vertices[(s+1)%this.vertices.length]));return e},t}();e.Line=p;var g=function(){function e(e,t){this.a=e.hashNumber<t.hashNumber?e:t,this.b=e.hashNumber<t.hashNumber?t:e}return e.segmentId=function(e,t){return e<t?e+","+t:t+","+e},Object.defineProperty(e.prototype,"hashString",{get:function(){return e.segmentId(this.a.hashNumber,this.b.hashNumber)},enumerable:!0,configurable:!0}),e.prototype.equals=function(e){return this.a==e.a&&this.b==e.b},e.prototype.getOther=function(e){return e==this.a?this.b:this.a},e.prototype.getFirst=function(){return this.a},e.prototype.getSecond=function(){return this.b},e.prototype.has=function(e){return e==this.a||e==this.b},e}();e.Segment=g;var d=function(){function e(){}return e}();e.ClickEvent=d}(mathis||(mathis={}));var mathis;!function(e){!function(t){function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t}function i(e,t,s,i){return i.x=e,i.y=t,i.z=s,i}function r(e,t){for(var s=0;s<16;s++)t.m[s]=e.m[s];return t}function n(e,t){for(var s=0;s<16;s++)if(e.m[s]!=t.m[s])return!1;return!0}function o(e,t){for(var s=0;s<16;s++)if(!c(e.m[s],t.m[s]))return!1;return!0}function a(e,t){return e.x==t.x&&e.y==t.y&&e.z==t.z}function h(e,s){return Math.abs(e.x-s.x)<t.epsitlonForAlmostEquality&&Math.abs(e.y-s.y)<t.epsitlonForAlmostEquality&&Math.abs(e.z-s.z)<t.epsitlonForAlmostEquality}function l(e,s){return Math.abs(e.x-s.x)<t.epsitlonForAlmostEquality&&Math.abs(e.y-s.y)<t.epsitlonForAlmostEquality&&Math.abs(e.z-s.z)<t.epsitlonForAlmostEquality&&Math.abs(e.w-s.w)<t.epsitlonForAlmostEquality}function u(e,t){return l(e,t)||c(e.x,-t.x)&&c(e.y,-t.y)&&c(e.z,-t.z)&&c(e.w,-t.w)}function m(e){return Math.abs(e.x)<t.epsilon&&Math.abs(e.y)<t.epsilon&&Math.abs(e.z)<t.epsilon}function c(e,s){return Math.abs(s-e)<t.epsitlonForAlmostEquality}function p(e){var t=e.m[10]*e.m[15]-e.m[11]*e.m[14],s=e.m[9]*e.m[15]-e.m[11]*e.m[13],i=e.m[9]*e.m[14]-e.m[10]*e.m[13],r=e.m[8]*e.m[15]-e.m[11]*e.m[12],n=e.m[8]*e.m[14]-e.m[10]*e.m[12],o=e.m[8]*e.m[13]-e.m[9]*e.m[12];return e.m[0]*(e.m[5]*t-e.m[6]*s+e.m[7]*i)-e.m[1]*(e.m[4]*t-e.m[6]*r+e.m[7]*n)+e.m[2]*(e.m[4]*s-e.m[5]*r+e.m[7]*o)-e.m[3]*(e.m[4]*i-e.m[5]*n+e.m[6]*o)}function g(e,s){if(Math.abs(p(e))<t.epsilon)throw" you try to inverse a singular matrix";var i=e.m[0],r=e.m[1],n=e.m[2],o=e.m[3],a=e.m[4],h=e.m[5],l=e.m[6],u=e.m[7],m=e.m[8],c=e.m[9],g=e.m[10],d=e.m[11],f=e.m[12],v=e.m[13],y=e.m[14],b=e.m[15],x=g*b-d*y,w=c*b-d*v,T=c*y-g*v,V=m*b-d*f,M=m*y-g*f,S=m*v-c*f,k=h*x-l*w+u*T,O=-(a*x-l*V+u*M),A=a*w-h*V+u*S,L=-(a*T-h*M+l*S),C=1/(i*k+r*O+n*A+o*L),N=l*b-u*y,F=h*b-u*v,_=h*y-l*v,q=a*b-u*f,z=a*y-l*f,X=a*v-h*f,P=l*d-u*g,B=h*d-u*c,I=h*g-l*c,Y=a*d-u*m,U=a*g-l*m,Z=a*c-h*m;s.m[0]=k*C,s.m[4]=O*C,s.m[8]=A*C,s.m[12]=L*C,s.m[1]=-(r*x-n*w+o*T)*C,s.m[5]=(i*x-n*V+o*M)*C,s.m[9]=-(i*w-r*V+o*S)*C,s.m[13]=(i*T-r*M+n*S)*C,s.m[2]=(r*N-n*F+o*_)*C,s.m[6]=-(i*N-n*q+o*z)*C,s.m[10]=(i*F-r*q+o*X)*C,s.m[14]=-(i*_-r*z+n*X)*C,s.m[3]=-(r*P-n*B+o*I)*C,s.m[7]=(i*P-n*Y+o*U)*C,s.m[11]=-(i*B-r*Y+o*Z)*C,s.m[15]=(i*I-r*U+n*Z)*C}function d(e,t){ge.m[0]=e.m[0],ge.m[1]=e.m[4],ge.m[2]=e.m[8],ge.m[3]=e.m[12],ge.m[4]=e.m[1],ge.m[5]=e.m[5],ge.m[6]=e.m[9],ge.m[7]=e.m[13],ge.m[8]=e.m[2],ge.m[9]=e.m[6],ge.m[10]=e.m[10],ge.m[11]=e.m[14],ge.m[12]=e.m[3],ge.m[13]=e.m[7],ge.m[14]=e.m[11],ge.m[15]=e.m[15],r(ge,t)}function f(e,t,s){var i=e.m[0],r=e.m[1],n=e.m[2],o=e.m[3],a=e.m[4],h=e.m[5],l=e.m[6],u=e.m[7],m=e.m[8],c=e.m[9],p=e.m[10],g=e.m[11],d=e.m[12],f=e.m[13],v=e.m[14],y=e.m[15],b=t.m[0],x=t.m[1],w=t.m[2],T=t.m[3],V=t.m[4],M=t.m[5],S=t.m[6],k=t.m[7],O=t.m[8],A=t.m[9],L=t.m[10],C=t.m[11],N=t.m[12],F=t.m[13],_=t.m[14],q=t.m[15];s.m[0]=i*b+r*V+n*O+o*N,s.m[1]=i*x+r*M+n*A+o*F,s.m[2]=i*w+r*S+n*L+o*_,s.m[3]=i*T+r*k+n*C+o*q,s.m[4]=a*b+h*V+l*O+u*N,s.m[5]=a*x+h*M+l*A+u*F,s.m[6]=a*w+h*S+l*L+u*_,s.m[7]=a*T+h*k+l*C+u*q,s.m[8]=m*b+c*V+p*O+g*N,s.m[9]=m*x+c*M+p*A+g*F,s.m[10]=m*w+c*S+p*L+g*_,s.m[11]=m*T+c*k+p*C+g*q,s.m[12]=d*b+f*V+v*O+y*N,s.m[13]=d*x+f*M+v*A+y*F,s.m[14]=d*w+f*S+v*L+y*_,s.m[15]=d*T+f*k+v*C+y*q}function v(e,t,i){if(de.x=0,de.y=0,de.z=0,null==t){t=[];for(var r=0;r<e.length;r++)t.push(1/e.length)}for(var n=0;n<e.length;n++)s(e[n],fe),R(fe,t[n],fe),H(de,fe,de);s(de,i)}function y(e,t,s,i){i.x=e.x*(1-s)+t.x*s,i.y=e.y*(1-s)+t.y*s,i.z=e.z*(1-s)+t.z*s}function b(e,t,s,i){i.u=e.u*(1-s)+t.u*s,i.v=e.v*(1-s)+t.v*s}function x(e,t,i,r,n,o,a){s(e,ye),null!=r?(f(r,n,ve),f(ve,o,ve)):f(n,o,ve),g(ve,ve),ye.x=ye.x/t*2-1,ye.y=-(ye.y/i*2-1),V(ve,ye,a);var h=e.x*ve.m[3]+e.y*ve.m[7]+e.z*ve.m[11]+ve.m[15];w(h,1)&&R(a,1/h,a)}function w(e,t){var s=e-t;return-1.401298e-45<=s&&s<=1.401298e-45}function T(e,t,i){var r=Math.sin(-t),n=Math.cos(-t),o=1-n;s(e,be),ee(be,be),i.m[0]=be.x*be.x*o+n,i.m[1]=be.x*be.y*o-be.z*r,i.m[2]=be.x*be.z*o+be.y*r,i.m[3]=0,i.m[4]=be.y*be.x*o+be.z*r,i.m[5]=be.y*be.y*o+n,i.m[6]=be.y*be.z*o-be.x*r,i.m[7]=0,i.m[8]=be.z*be.x*o-be.y*r,i.m[9]=be.z*be.y*o+be.x*r,i.m[10]=be.z*be.z*o+n,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0,i.m[15]=1}function V(e,t,s){var i=t.x*e.m[0]+t.y*e.m[4]+t.z*e.m[8]+e.m[12],r=t.x*e.m[1]+t.y*e.m[5]+t.z*e.m[9]+e.m[13],n=t.x*e.m[2]+t.y*e.m[6]+t.z*e.m[10]+e.m[14],o=t.x*e.m[3]+t.y*e.m[7]+t.z*e.m[11]+e.m[15];s.x=i/o,s.y=r/o,s.z=n/o}function M(e,t,s){var i=Math.sin(t/2);s.w=Math.cos(t/2),s.x=e.x*i,s.y=e.y*i,s.z=e.z*i}function S(e,t){var s,i,r,n,o,a,h,l,u;s=e.m[0],n=e.m[1],h=e.m[2],i=e.m[4],o=e.m[5],l=e.m[6],r=e.m[8],a=e.m[9];var m,c,p,g,d=s+o+(u=e.m[10]);if(d>0)g=.25*(f=2*Math.sqrt(d+1)),m=(l-a)/f,c=(r-h)/f,p=(n-i)/f;else if(s>o&&s>u)g=(l-a)/(f=2*Math.sqrt(1+s-o-u)),m=.25*f,c=(i+n)/f,p=(r+h)/f;else if(o>u)g=(r-h)/(f=2*Math.sqrt(1+o-s-u)),m=(i+n)/f,c=.25*f,p=(a+l)/f;else{var f=2*Math.sqrt(1+u-s-o);g=(n-i)/f,m=(r+h)/f,c=(a+l)/f,p=.25*f}t.x=m,t.y=c,t.z=p,t.w=g}function k(e,t,s,i){s?Q(e,t,xe,we):Q(t,e,we,xe),J(xe,we,Te),P(xe,we,Te,Ve),S(Ve,i)}function O(e,t){ee(e,Me),$(e,Se),J(Me,Se,ke),P(Me,Se,ke,Oe),d(Oe,Ae),Le.m[0]=1,Le.m[15]=1,f(Ae,Le,t),f(t,Oe,t)}function A(e,t,s){Q(e,t,Me,Se),J(Me,Se,ke),P(Me,Se,ke,Oe),d(Oe,Ae),Le.m[0]=1,Le.m[5]=1,Le.m[15]=1,f(Ae,Le,s),f(s,Oe,s)}function L(e,t){var s=e.x*e.x,i=e.y*e.y,r=e.z*e.z,n=e.x*e.y,o=e.z*e.w,a=e.z*e.x,h=e.y*e.w,l=e.y*e.z,u=e.x*e.w;t.m[0]=1-2*(i+r),t.m[1]=2*(n+o),t.m[2]=2*(a-h),t.m[3]=0,t.m[4]=2*(n-o),t.m[5]=1-2*(r+s),t.m[6]=2*(l+u),t.m[7]=0,t.m[8]=2*(a+h),t.m[9]=2*(l-u),t.m[10]=1-2*(i+s),t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t.m[15]=1}function C(e,t,s){var i=e.x*t.w+e.y*t.z-e.z*t.y+e.w*t.x,r=-e.x*t.z+e.y*t.w+e.z*t.x+e.w*t.y,n=e.x*t.y-e.y*t.x+e.z*t.w+e.w*t.z,o=-e.x*t.x-e.y*t.y-e.z*t.z+e.w*t.w;s.x=i,s.y=r,s.z=n,s.w=o}function N(e,t,s,i,r,n){void 0===n&&(n=!1),n?(qe.copyFrom(e),ze.copyFrom(t),Xe.copyFrom(s),Pe.copyFrom(i)):(Q(e,t,qe,ze),Q(s,i,Xe,Pe)),J(qe,ze,Fe),P(qe,ze,Fe,Ce),J(Xe,Pe,_e),P(Xe,Pe,_e,Ne),d(Ce,Ce),f(Ce,Ne,r)}function F(t,s,i,r,n,o,a){var h=new e.MM,l=new e.MM;P(t,s,i,h),P(r,n,o,l),g(h,h),f(h,l,a)}function _(t,s,i,r,n,o,a,h,l){F(e.XYZ.newFrom(s).substract(t),e.XYZ.newFrom(i).substract(t),e.XYZ.newFrom(r).substract(t),e.XYZ.newFrom(o).substract(n),e.XYZ.newFrom(a).substract(n),e.XYZ.newFrom(h).substract(n),l);var u=new e.XYZ(0,0,0);V(l,t,u),u.scale(-1).add(n),l.m[12]=u.x,l.m[13]=u.y,l.m[14]=u.z}function q(t,s,i,r,n,o,a){var h=new e.XYZ(0,0,0),l=new e.XYZ(0,0,0);J(s,i,h),J(n,o,l),h.add(t),l.add(r),_(t,s,i,h,r,n,o,l,a)}function z(e,t,s,i,r,n){void 0===n&&(n=!1),N(e,t,s,i,Be,n),S(Be,r)}function X(e,t,s,i){var r,n,o=s,a=e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w,h=!1;if(a<0&&(h=!0,a=-a),a>.999999)n=1-o,r=h?-o:o;else{var l=Math.acos(a),u=1/Math.sin(l);n=Math.sin((1-o)*l)*u,r=h?-Math.sin(o*l)*u:Math.sin(o*l)*u}i.x=n*e.x+r*t.x,i.y=n*e.y+r*t.y,i.z=n*e.z+r*t.z,i.w=n*e.w+r*t.w}function P(e,t,s,i){i.m[0]=e.x,i.m[1]=e.y,i.m[2]=e.z,i.m[3]=0,i.m[4]=t.x,i.m[5]=t.y,i.m[6]=t.z,i.m[7]=0,i.m[8]=s.x,i.m[9]=s.y,i.m[10]=s.z,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0,i.m[15]=1}function B(e,t){if(m(e)||m(t))throw"be aware: you compute angle between two vectors, one of them being almost zero";ee(e,Ie),ee(t,Ye);var s=W(Ie,Ye);return s>1?0:s<-1?Math.PI:Math.acos(s)}function I(e,t,s,i){void 0===s&&(s=!0),void 0===i&&(i=.001);var r=B(e,t);return r<i||!!(s&&Math.PI-r<i)}function Y(e,t,s){var i=B(e,t);return J(e,t,Ue),(W(s,Ue)<0?-1:1)*i}function U(e,t,s){var i=Y(e,t,s);return i>=0?i:2*Math.PI+i}function Z(e,t,s,i,r,n,o,a){var h=s-e,l=i-t,u=r-o,m=n-a,c=o-e,p=a-t,g=-h*m+l*u;if(Math.abs(g)<1e-4)return null;var d=(-c*m+p*u)/g;return{x:d*h+e,y:d*l+t}}function E(e,t,s,r,n,o,a){J(e,t,We),J(s,r,Ge),P(e,t,We,Re),P(s,r,Ge,He),S(Re,Ze),S(He,Ee),X(Ze,Ee,n,De),L(De,je),i(je.m[0],je.m[1],je.m[2],o),i(je.m[4],je.m[5],je.m[7],a)}function D(e,t,s,i){i.x=e.x*(1-s)+t.x*s,i.y=e.y*(1-s)+t.y*s,i.z=e.z*(1-s)+t.z*s}function R(e,t,s){s.x=e.x*t,s.y=e.y*t,s.z=e.z*t}function H(e,t,s){s.x=e.x+t.x,s.y=e.y+t.y,s.z=e.z+t.z}function j(e,t,s){s.x=e.x-t.x,s.y=e.y-t.y,s.z=e.z-t.z}function W(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}function G(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)}function K(e){return e.x*e.x+e.y*e.y+e.z*e.z}function J(e,t,i){Ke.x=e.y*t.z-e.z*t.y,Ke.y=e.z*t.x-e.x*t.z,Ke.z=e.x*t.y-e.y*t.x,s(Ke,i)}function Q(r,n,o,a){if(ee(r,$e),s(r,Je),R(Je,W(r,n),Je),j(n,Je,et),K(et)<t.epsilon*t.epsilon)return i(Math.random(),Math.random(),Math.random(),Qe),e.logger.c("beware: you try to orthonormalize two co-linear vectors"),Q(r,Qe,o,a);ee(et,et),s($e,o),s(et,a)}function $(e,t){Math.abs(e.x)+Math.abs(e.y)>1e-4?t.copyFromFloats(-e.y,e.x,0):t.copyFromFloats(0,-e.z,e.y),ee(t,t)}function ee(e,s){var i=t.norme(e);if(i<t.epsilon)throw"one can not normalize a the almost zero vector:"+e;R(e,1/i,s)}function te(e,t,i,r,n,o){s(e,tt),j(tt,r,tt);var a=K(t),h=2*W(t,tt),l=h*h-4*a*(K(tt)-i*i);if(l<0)return!1;var u=(-h+Math.sqrt(l))/2/a,m=(-h-Math.sqrt(l))/2/a;return s(t,st),R(st,u,st),H(st,e,st),s(st,n),s(t,st),R(st,m,st),H(st,e,st),s(st,o),!0}function se(e,t){return s(e,it),j(it,t,it),G(it)}function ie(e,t){return s(e,it),j(it,t,it),K(it)}function re(e,t,i,r){var n=se(e,i),o=se(t,i);return n<o?s(e,r):s(t,r),n<o?n:o}function ne(e,t,s,i){j(t,e,ot),ee(ot,ot),J(s,ot,rt),m(rt)?rt.x=1:rt.normalize(),J(ot,rt,nt),nt.normalize();var r=-W(rt,e),n=-W(nt,e),o=-W(ot,e);he(rt.x,nt.x,ot.x,0,rt.y,nt.y,ot.y,0,rt.z,nt.z,ot.z,0,r,n,o,1,i)}function oe(e,t,s,i,r,n,o){o.m[0]=2/(t-e),o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=2/(i-s),o.m[4]=o.m[6]=o.m[7]=0,o.m[10]=-1/(r-n),o.m[8]=o.m[9]=o.m[11]=0,o.m[12]=(e+t)/(e-t),o.m[13]=(i+s)/(s-i),o.m[14]=r/(r-n),o.m[15]=1}function ae(e,t,s,i,r){var n=1/Math.tan(.5*e);r.m[0]=n/t,r.m[1]=r.m[2]=r.m[3]=0,r.m[5]=n,r.m[4]=r.m[6]=r.m[7]=0,r.m[8]=r.m[9]=0,r.m[10]=-i/(s-i),r.m[11]=1,r.m[12]=r.m[13]=r.m[15]=0,r.m[14]=s*i/(s-i)}function he(e,t,s,i,r,n,o,a,h,l,u,m,c,p,g,d,f){f.m[0]=e,f.m[1]=t,f.m[2]=s,f.m[3]=i,f.m[4]=r,f.m[5]=n,f.m[6]=o,f.m[7]=a,f.m[8]=h,f.m[9]=l,f.m[10]=u,f.m[11]=m,f.m[12]=c,f.m[13]=p,f.m[14]=g,f.m[15]=d}function le(t,s,i,r,n){var o=n*n,a=n*o,h=2*a-3*o+1,l=-2*a+3*o,u=a-2*o+n,m=a-o,c=t.x*h+i.x*l+s.x*u+r.x*m,p=t.y*h+i.y*l+s.y*u+r.y*m,g=t.z*h+i.z*l+s.z*u+r.z*m;return new e.XYZ(c,p,g)}function ue(t,s,i,r,n,o){e.tab.clearArray(o);for(var a=1/n,h=0;h<n;h++)o.push(le(t,s,i,r,h*a))}function me(t,s,i,r,n){e.tab.clearArray(n),r=r>2?r:3;for(var o=function(e,t,s,i){return(1-e)*(1-e)*t+2*e*(1-e)*s+e*e*i},a=0;a<r;a++)n.push(new e.XYZ(o(a/r,t.x,s.x,i.x),o(a/r,t.y,s.y,i.y),o(a/r,t.z,s.z,i.z)))}function ce(t,s,i,r,n,o){e.tab.clearArray(o),n=n>3?n:4;for(var a=function(e,t,s,i,r){return(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*s+3*e*e*(1-e)*i+e*e*e*r},h=0;h<n;h++)o.push(new e.XYZ(a(h/n,t.x,s.x,i.x,r.x),a(h/n,t.y,s.y,i.y,r.y),a(h/n,t.z,s.z,i.z,r.z)))}function pe(t,s,i,r){var n=e.XYZ.newFrom(s).substract(t),o=e.XYZ.newFrom(r).substract(i);if(0==n.x&&0!=o.x)throw"impossible affine transform from a rectangle to a pavé";if(0==n.y&&0!=o.y)throw"impossible affine transform from a rectangle to a pavé";if(0==n.z&&0!=o.z)throw"impossible affine transform from a rectangle to a pavé";var a=0;if(0==n.x&&a++,0==n.y&&a++,0==n.z&&a++,a>=2)throw"intrance pavé is too degenerated";var h=new e.XYZ(0==n.x?1:1/n.x,0==n.y?1:1/n.y,0==n.z?1:1/n.z);return function(e,s){s.copyFrom(e).substract(t).multiply(h).multiply(o).add(i)}}t.copyXYZ=s,t.copyXyzFromFloat=i,t.copyMat=r,t.matEquality=n,t.matAlmostEquality=o,t.xyzEquality=a,t.epsilon=1e-8,t.epsilonSquare=t.epsilon*t.epsilon,t.epsitlonForAlmostEquality=1e-6,t.xyzAlmostEquality=h,t.xyzwAlmostEquality=l,t.almostLogicalEqual=u,t.xyzAlmostZero=m,t.almostEquality=c,t.determinant=p,t.inverse=g;var ge=new e.MM;t.transpose=d,t.multiplyMatMat=f;var de=new e.XYZ(0,0,0),fe=new e.XYZ(0,0,0);t.baryCenter=v,t.between=y,t.betweenUV=b;var ve=new e.MM,ye=new e.XYZ(0,0,0);t.unproject=x;var be=new e.XYZ(0,0,0);t.axisAngleToMatrix=T,t.multiplicationVectorMatrix=V,t.axisAngleToQuaternion=M,t.matrixToQuaternion=S;var xe=new e.XYZ(0,0,0),we=new e.XYZ(0,0,0),Te=new e.XYZ(0,0,0),Ve=new e.MM;t.twoVectorsToQuaternion=k;var Me=new e.XYZ(0,0,0),Se=new e.XYZ(0,0,0),ke=new e.XYZ(0,0,0),Oe=new e.MM,Ae=new e.MM,Le=new e.MM;t.orthogonalProjectionOnLine=O,t.orthogonalProjectionOnPlane=A,t.quaternionToMatrix=L,t.quaternionMultiplication=C;var Ce=new e.MM,Ne=new e.MM,Fe=new e.XYZ(0,0,0),_e=new e.XYZ(0,0,0),qe=new e.XYZ(0,0,0),ze=new e.XYZ(0,0,0),Xe=new e.XYZ(0,0,0),Pe=new e.XYZ(0,0,0);t.anOrthogonalMatrixMovingABtoCD=N,t.linearTransformation_3vec=F,t.affineTransformation_4vec=_,t.affineTransformation_3vec=q;var Be=new e.MM;t.aQuaternionMovingABtoCD=z,t.slerp=X,t.matrixFromLines=P;var Ie=new e.XYZ(0,0,0),Ye=new e.XYZ(0,0,0);t.angleBetweenTwoVectorsBetween0andPi=B,t.almostParallel=I;var Ue=new e.XYZ(0,0,0);t.angleBetweenTwoVectorsBetweenMinusPiAndPi=Y,t.angleBetweenTwoVectorsBetween0And2Pi=U,t.segmentsIntersection=Z;var Ze=new e.XYZW(0,0,0,0),Ee=new e.XYZW(0,0,0,0),De=new e.XYZW(0,0,0,0),Re=new e.MM,He=new e.MM,je=new e.MM,We=new e.XYZ(0,0,0),Ge=new e.XYZ(0,0,0);t.slerpTwoOrthogonalVectors=E,t.interpolateTwoVectors=D,t.scale=R,t.add=H,t.substract=j,t.dot=W,t.norme=G,t.squareNorme=K;var Ke=new e.XYZ(0,0,0);t.cross=J;var Je=new e.XYZ(0,0,0),Qe=new e.XYZ(0,0,0),$e=new e.XYZ(0,0,0),et=new e.XYZ(0,0,0);t.orthonormalizeKeepingFirstDirection=Q,t.getOneOrthonormal=$,t.normalize=ee;var tt=new e.XYZ(0,0,0),st=new e.XYZ(0,0,0);t.intersectionBetweenRayAndSphereFromRef=te;var it=new e.XYZ(0,0,0);t.distance=se,t.squaredDistance=ie,t.closerOf=re;var rt=e.XYZ.newZero(),nt=e.XYZ.newZero(),ot=e.XYZ.newZero();t.LookAtLH=ne,t.OrthoOffCenterLH=oe,t.PerspectiveFovLH=ae,t.numbersToMM=he,t.hermiteSpline=ue,t.quadraticBezier=me,t.cubicBezier=ce,t.affineTransformGenerator=pe}(e.geo||(e.geo={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){var s=function(){function t(t,s,i){this.nbDistinctPoint=1e3,this.maxDistToBeClose=null,this.deformationFunction=function(e){return e},this.mins=new e.XYZ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.maxs=new e.XYZ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this.nbDistinctPoint=i,this.recepteurList=t,null==s||t==s?(this.sourceList=t,this.sourceEqualRecepter=!0):(this.sourceList=s,this.sourceEqualRecepter=!1)}return t.prototype.go=function(){this.buildScaler();for(var t=new e.XYZ(Math.max(1,this.maxs.x-this.mins.x),Math.max(1,this.maxs.y-this.mins.y),Math.max(1,this.maxs.z-this.mins.z)),s={},i=0;i<this.recepteurList.length;i++){var r=this.deformationFunction(this.recepteurList[i]),n=(a=Math.round((r.x-this.mins.x)/t.x*this.nbDistinctPoint))+","+(h=Math.round((r.y-this.mins.y)/t.y*this.nbDistinctPoint))+","+(l=Math.round((r.z-this.mins.z)/t.z*this.nbDistinctPoint));null==s[n]?s[n]=i:this.sourceEqualRecepter||e.logger.c("strange: the recepterList has several XYZ very close. This is, in general, only possible, when recepter equal source")}for(var o={},i=0;i<this.sourceList.length;i++){var r=this.deformationFunction(this.sourceList[i]),a=Math.round((r.x-this.mins.x)/t.x*this.nbDistinctPoint),h=Math.round((r.y-this.mins.y)/t.y*this.nbDistinctPoint),l=Math.round((r.z-this.mins.z)/t.z*this.nbDistinctPoint),u=s[a+","+h+","+l];null!=u&&(this.sourceEqualRecepter?u!=i&&(o[i]=u):o[i]=u)}return o},t.prototype.buildScaler=function(){var t=this;this.recepteurList.forEach(function(e){var s=t.deformationFunction(e);s.x<t.mins.x&&(t.mins.x=s.x),s.y<t.mins.y&&(t.mins.y=s.y),s.z<t.mins.z&&(t.mins.z=s.z),s.x>t.maxs.x&&(t.maxs.x=s.x),s.y>t.maxs.y&&(t.maxs.y=s.y),s.z>t.maxs.z&&(t.maxs.z=s.z)}),this.sourceEqualRecepter||this.sourceList.forEach(function(e){var s=t.deformationFunction(e);s.x<t.mins.x&&(t.mins.x=s.x),s.y<t.mins.y&&(t.mins.y=s.y),s.z<t.mins.z&&(t.mins.z=s.z),s.x>t.maxs.x&&(t.maxs.x=s.x),s.y>t.maxs.y&&(t.maxs.y=s.y),s.z>t.maxs.z&&(t.maxs.z=s.z)}),null!=this.maxDistToBeClose&&(this.nbDistinctPoint=e.geo.distance(this.maxs,this.mins)/this.maxDistToBeClose)},t}();t.CloseXYZfinder=s;var i=function(){function t(e){this.options=new n,this.hermite=new Array,this.points=e}return t.prototype.checkArgs=function(){if(null==this.points||this.points.length<2)throw"too few points"},t.prototype.go=function(){var t=this,s=new Array;if(2==this.points.length){s=[];for(c=0;c<this.options.nbSubdivisions+1;c++){var i=new e.XYZ(0,0,0);e.geo.between(this.points[0],this.points[1],c/this.options.nbSubdivisions,i),s.push(i)}this.options.loopLine&&s.push(e.XYZ.newFrom(this.points[0]))}else if(this.options.interpolationStyle==r.none)s=[],this.points.forEach(function(t){return s.push(e.XYZ.newFrom(t))}),this.options.loopLine&&s.push(e.XYZ.newFrom(this.points[0]));else if(this.options.interpolationStyle==r.hermite){var n=e.XYZ.newZero(),o=e.XYZ.newZero(),a=function(i,r,a,h){e.geo.substract(r,i,n),e.geo.substract(h,a,o),n.scale(t.options.ratioTan),o.scale(t.options.ratioTan),e.geo.hermiteSpline(r,n,a,o,t.options.nbSubdivisions,t.hermite),t.hermite.forEach(function(e){s.push(e)})},h=this.points.length-1;this.options.loopLine?a(this.points[h],this.points[0],this.points[1],this.points[2]):a(this.points[0],this.points[0],this.points[1],this.points[2]);for(c=1;c<this.points.length-2;c++)a(this.points[c-1],this.points[c],this.points[c+1],this.points[c+2]);this.options.loopLine?(a(this.points[h-2],this.points[h-1],this.points[h],this.points[0]),a(this.points[h-1],this.points[h],this.points[0],this.points[1]),s.push(this.points[0])):(a(this.points[h-2],this.points[h-1],this.points[h],this.points[h]),s.push(this.points[h]))}else{if(this.options.interpolationStyle!=r.octavioStyle)throw"line interporler style unknown";if(2==this.points.length)return[e.XYZ.newFrom(this.points[0]),e.XYZ.newFrom(this.points[1])];var h=this.points.length-1,l=e.XYZ.newZero(),u=e.XYZ.newZero(),a=function(i,r,n){e.geo.between(i,r,.5,l),e.geo.between(r,n,.5,u),e.geo.quadraticBezier(l,r,u,t.options.nbSubdivisions,t.hermite),t.hermite.forEach(function(e){s.push(e)})};if(this.options.loopLine)a(this.points[h],this.points[0],this.points[1]);else{var m=e.XYZ.newFrom(this.points[0]);s.push(m)}for(var c=1;c<this.points.length-1;c++)a(this.points[c-1],this.points[c],this.points[c+1]);if(this.options.loopLine){a(this.points[h-1],this.points[h],this.points[0]);var p=e.XYZ.newZero();e.geo.between(this.points[h],this.points[0],.5,p),s.push(p)}else{var g=e.XYZ.newFrom(this.points[h]);s.push(g)}}return s},t}();t.LineInterpoler=i;var r;!function(e){e[e.hermite=0]="hermite",e[e.octavioStyle=1]="octavioStyle",e[e.none=2]="none"}(r=t.InterpolationStyle||(t.InterpolationStyle={}));var n=function(){function e(){this.loopLine=!1,this.interpolationStyle=r.octavioStyle,this.nbSubdivisions=10,this.ratioTan=.5}return e}();t.InterpolationOption=n}(e.geometry||(e.geometry={}))}(mathis||(mathis={}));var mathis;!function(e){!function(){function e(e,t){this.a=e<t?e:t,this.b=e<t?t:e}}();!function(t){function s(t,s){for(var r=[],n=[],o=t,a=new e.HashMap,h=0,l=t;h<l.length;h++){c=l[h];r.push(c),a.putValue(c,!0)}for(;o.length>0;){n=i(o),o=[];for(var u=0,m=n;u<m.length;u++){var c=m[u];a.getValue(c)||((null==s||s.getValue(c))&&(o.push(c),r.push(c)),a.putValue(c,!0))}}return r}function i(t,s){null==s&&(s=new e.HashMap);for(var i=[],r=0,n=t;r<n.length;r++){var o=n[r];s.putValue(o,!0)}for(var a=0,h=t;a<h.length;a++)for(var l=0,u=(o=h[a]).links;l<u.length;l++){var m=u[l];s.getValue(m.to)||i.push(m.to),s.putValue(m.to,!0)}return i}function r(t,s,r){void 0===r&&(r=!1),null==s&&(s=new e.HashMap);for(var n=i(t,s),o=new e.HashMap,a=0,h=n;a<h.length;a++){var l=h[a];o.putValue(l,!0)}for(var u=0,m=i(n.concat(t));u<m.length;u++)if((l=m[u]).links.length<=4){for(var c=0,p=0,g=l.links;p<g.length;p++){var d=g[p];null!=o.getValue(d.to)&&c++}r&&2==c?(n.push(l),s.putValue(l,!0)):c>=2&&(n.push(l),s.putValue(l,!0))}return n}function n(t){var s=new e.HashMap;if(null==t||0==t.length)throw"problème d argument";var r=[];r.push(t);for(var n=i(t,s);n.length>0;)r.push(n),n=i(n,s);return r}function o(e){if(null==e||0==e.length)throw"problème d argument";var t=[];t.push(e);for(var s=e,i=r(s);i.length>0;)t.push(i),i=r(s=s.concat(i));return t}t.getGroup=s;var a=function(){function t(t){this.OUT_distances_dico=new e.HashMap,this.centralCells=t}return t.prototype.OUT_distance=function(e){return this.OUT_distances_dico.getValue(e)},t.prototype.OUT_allGeodesics=function(t,s){void 0===s&&(s=!1);for(var r=[],n=[t],o=new e.HashMap,a=this.OUT_distances_dico.getValue(t);n.length>0;){r.push(n),a--;for(var h=[],l=0,u=n=i(n,o);l<u.length;l++){var m=u[l];if(this.OUT_distances_dico.getValue(m)==a&&(h.push(m),s))break}n=h}return r},t.prototype.go=function(){var t=new e.HashMap;if(null==this.centralCells||0==this.centralCells.length)throw"problème d argument";this.OUT_stratesAround=[],this.OUT_stratesAround.push(this.centralCells);for(var s=i(this.centralCells,t);s.length>0;)this.OUT_stratesAround.push(s),s=i(s,t);for(var r=0;r<this.OUT_stratesAround.length;r++)for(var n=0,o=this.OUT_stratesAround[r];n<o.length;n++){var a=o[n];this.OUT_distances_dico.putValue(a,r)}},t}();t.DistancesFromAGroup=a;var h=function(){function e(e){this.vertices=e,this.nbTimeOfNonEvolutionToStop=2,this.lookNonEvolutionWithDistanceVersusWithGroups=!0,this.consecutiveExtremetDistances=[],this.OUT_nbIteration=0,this.OUT_twoChosenExtremeVertices=[]}return e.prototype.go=function(){for(var e,t=[this.vertices[0]],s=0,i=[];this.evolution();){this.OUT_nbIteration++,(e=new a(t)).go(),s=e.OUT_stratesAround.length;var r=e.OUT_stratesAround[s-1][0];t=[r],this.consecutiveExtremetDistances.push(s),i.push(r)}return this.OUT_twoChosenExtremeVertices=[i[this.OUT_nbIteration-1],i[this.OUT_nbIteration-2]],this.OUT_geodesicsBetweenChosenExtremeVertices=e.OUT_allGeodesics(i[this.OUT_nbIteration-1]),this.OUT_oneGeodesicBetweenChosenExtremeVertices=e.OUT_allGeodesics(i[this.OUT_nbIteration-1],!0),s-1},e.prototype.evolution=function(){if(this.lookNonEvolutionWithDistanceVersusWithGroups){var e=this.consecutiveExtremetDistances.length;if(e<this.nbTimeOfNonEvolutionToStop)return!0;for(var t=this.consecutiveExtremetDistances[e-1],s=1;s<this.nbTimeOfNonEvolutionToStop;s++)if(this.consecutiveExtremetDistances[e-1-s]!=t)return!0;return!1}throw"TODO"},e}();t.HeuristicDiameter=h;var l=function(){function t(t){this.OUT_allExtremeVertex=[],this.allCounters=new e.HashMap,this.allToTransmit=new e.HashMap,this.OUT_diameter=null,this.allVertices=t}return t.prototype.OUT_distance=function(e,t){return this.allCounters.getValue(e).getValue(t)},t.prototype.OUT_allGeodesics=function(t,s,r){void 0===r&&(r=!1);for(var n=[],o=[t],a=new e.HashMap,h=this.allCounters.getValue(t).getValue(s);o.length>0;){n.push(o),h--;for(var l=[],u=0,m=o=i(o,a);u<m.length;u++){var c=m[u];if(this.allCounters.getValue(c).getValue(s)==h&&(l.push(c),r))break}o=l}return n},t.prototype.go=function(){for(var t=0,s=this.allVertices;t<s.length;t++){var i=s[t],r=new e.HashMap(!0);r.putValue(i,0),this.allCounters.putValue(i,r),(u=new e.HashMap(!0)).putValue(i,0),this.allToTransmit.putValue(i,u)}for(var n=!0;n;){n=!1,this.allFreshlyReceived=new e.HashMap;for(var o=0,a=this.allVertices;o<a.length;o++){i=a[o];this.allFreshlyReceived.putValue(i,new e.HashMap(!0))}for(var h=0,l=this.allVertices;h<l.length;h++)for(var i=l[h],u=this.allToTransmit.getValue(i),m=0,c=i.links;m<c.length;m++)for(var p=c[m],g=this.allCounters.getValue(p.to),d=0,f=u.allKeys();d<f.length;d++){var v=f[d];null==g.getValue(v)&&(n=!0,g.putValue(v,u.getValue(v)+1),this.allFreshlyReceived.getValue(p.to).putValue(v,u.getValue(v)+1))}this.allToTransmit=this.allFreshlyReceived,this.OUT_diameter=0;for(var y=0,b=this.allVertices;y<b.length;y++)for(var i=b[y],x=0,w=this.allCounters.getValue(i).allEntries();x<w.length;x++){var T=w[x];T.value>this.OUT_diameter&&(this.OUT_diameter=T.value,this.OUT_aMaxCouple=[i,T.key],this.OUT_allExtremeVertex=[i]),T.value==this.OUT_diameter&&this.OUT_allExtremeVertex.push(i)}}},t}();t.DistancesBetweenAllVertices=l,t.getEdge=i,t.getEdgeConsideringAlsoDiagonalVoisin=r,t.ringify=n,t.ringifyConsideringAlsoDiagonalVoisin=o}(e.graph||(e.graph={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){var s=function(){function t(){this.IN_graphFamily=[],this.seedsList=null,this.seedComputedFromBarycentersVersusFromAllPossibleCells=!0,this.barycenterDecay=new e.XYZ(2.34e-8,6.77e-10,9.87e-10),this.proximityCoefToGrate=[.7],this.proportionOfSeeds=[.1],this.asymmetriesForSeeds=null}return t.prototype.checkArgs=function(){if(null==this.IN_graphFamily||this.IN_graphFamily.length<2)throw"SUB_grater works from 2 graphs"},t.prototype.suppressTooCloseVertex=function(e){for(var t=[],s=0;s<e.length;s++){var i=this.proximityCoefToGrate[s%this.proximityCoefToGrate.length];t[s]=[];for(var r=0,n=e[s];r<n.length;r++){for(var o=n[r],a=!0,h=0;h<e.length&&(s==h||(a=!this.proximityMeasurer.isCloseToMe(o,e[h],i)));h++);a&&t[s].push(o)}}return t},t.prototype.findSeeds=function(){var t=[];if(this.seedComputedFromBarycentersVersusFromAllPossibleCells){for(i=0;i<this.IN_graphFamily.length;i++)t[i]=[];for(var s=[],i=0;i<this.IN_graphFamily.length;i++){s[i]=new e.XYZ(0,0,0);for(var r=0,n=this.IN_graphFamily[i];r<n.length;r++){g=n[r];s[i].add(g.position)}s[i].scale(1/this.IN_graphFamily[i].length),s[i].add(this.barycenterDecay)}for(var o=function(e,t){return t.distance-e.distance},a=0;a<this.IN_graphFamily.length;a++){for(var h=new e.XYZ(0,0,0),l=0;l<this.IN_graphFamily.length;l++)l!=a&&h.add(s[l]);h.scale(1/(this.IN_graphFamily.length-1));for(var u=[],m=new e.XYZ(0,0,0),c=0,p=this.IN_graphFamily[a];c<p.length;c++){var g=p[c];m.copyFrom(g.position).substract(h);var d=e.geo.distance(g.position,h);if(null!=this.asymmetriesForSeeds&&null!=this.asymmetriesForSeeds[a%this.asymmetriesForSeeds.length]){var f=this.asymmetriesForSeeds[a%this.asymmetriesForSeeds.length],v=e.geo.angleBetweenTwoVectorsBetween0andPi(m,f.direction),y=Math.PI;if(null!=f.modulo){if(y=f.modulo,isNaN(y)||y<0||y>Math.PI)throw"modulo must be a number between 0 and PI, but is:"+y;v=e.modulo(v,y)}var b=1-v/y;d=d*(1-f.influence)+b*f.influence}u.push({vertex:g,distance:d})}u.sort(o),t[a]=[];var x=void 0;x=this.proportionOfSeeds[a%this.proportionOfSeeds.length]>0?u[0].distance*(1-this.proportionOfSeeds[a%this.proportionOfSeeds.length]):.99*u[0].distance;for(var w=Number.MAX_VALUE,i=0;w>=x&&i<u.length-1;)t[a].push(u[i].vertex),w=u[++i].distance}}else t=this.suppressTooCloseVertex(this.IN_graphFamily);t=this.suppressTooCloseVertex(t);for(i=0;i<this.IN_graphFamily.length;i++)if(0==t[i].length)throw"an empty seeds, possible cause: 1/  two graphes are identical 2/ one of your graph is nearly includes into an other and you do not use the barycenter technique";return t},t.prototype.go=function(){this.checkArgs(),null==this.proximityMeasurer&&(this.proximityMeasurer=new i),null==this.seedsList&&(this.seedsList=this.findSeeds(),this.OUT_allSeeds=this.seedsList);for(var t=!0,s=[],r=0;r<this.IN_graphFamily.length;r++)s[r]=[].concat(this.seedsList[r]);for(var n=new e.HashMap;t;){t=!1;for(r=0;r<this.IN_graphFamily.length;r++)for(var o=this.proximityCoefToGrate[r%this.proximityCoefToGrate.length],a=0,h=e.graph.getEdge(s[r],n);a<h.length;a++){for(var l=h[a],u=!1,m=0;m<this.IN_graphFamily.length;m++)if(r!=m&&this.proximityMeasurer.isCloseToMe(l,s[m],o)){u=!0;break}u||(s[r].push(l),t=!0)}}return s},t}();t.GraphGrater=s;var i=function(){function t(){this.vertexToLinkLength=new e.HashMap}return t.prototype.meanLinksDist=function(t){var s=this.vertexToLinkLength.getValue(t);if(null!=s)return s;for(var i=0,r=0,n=t.links;r<n.length;r++){var o=n[r];i+=e.geo.distance(t.position,o.to.position)}return i/=t.links.length,this.vertexToLinkLength.putValue(t,i),i},t.prototype.isCloseToMe=function(e,t,s){for(var i=0,r=t;i<r.length;i++){var n=r[i];if(this.areClose(e,n,s))return!0}return!1},t.prototype.areClose=function(t,s,i){return e.geo.distance(t.position,s.position)<(this.meanLinksDist(t)+this.meanLinksDist(s))/2*i},t.prototype.areFar=function(t,s,i){return e.geo.distance(t.position,s.position)>(this.meanLinksDist(t)+this.meanLinksDist(s))/2*i},t}();t.ProximityMeasurer=i;var r=function(){function t(e,t){this.verticesToKeepMustBeInMamesh=!0,this.constructCutSegment=!0,this.takeCareOfPolygons=!0,this.addBorderPolygonInsteadOfSuppress=!1,this.OUT_BorderPolygon=[],this.OUT_BorderVerticesInside=[],this.OUTBorderVerticesOutside=[],this.mamesh=e,this.verticesToKeep=t}return t.prototype.go=function(){var t=this,s=new e.Mamesh;this.verticesToKeep.forEach(function(e){if(t.mamesh.hasVertex(e))s.addVertex(e);else if(t.verticesToKeepMustBeInMamesh)throw'a vertex in the list to keep is not in the original mesh. If you want to allow this, please turn the boolean "verticesToKeepMustBeInMamesh" to false'});for(f=0;f<this.mamesh.smallestSquares.length;f+=4){i=0;s.hasVertex(this.mamesh.smallestSquares[f])&&i++,s.hasVertex(this.mamesh.smallestSquares[f+1])&&i++,s.hasVertex(this.mamesh.smallestSquares[f+2])&&i++,s.hasVertex(this.mamesh.smallestSquares[f+3])&&i++,i>0&&i<4?this.OUT_BorderPolygon.push([this.mamesh.smallestSquares[f],this.mamesh.smallestSquares[f+1],this.mamesh.smallestSquares[f+2],this.mamesh.smallestSquares[f+3]]):4==i&&s.smallestSquares.push(this.mamesh.smallestSquares[f],this.mamesh.smallestSquares[f+1],this.mamesh.smallestSquares[f+2],this.mamesh.smallestSquares[f+3])}for(f=0;f<this.mamesh.smallestTriangles.length;f+=3){var i=0;s.hasVertex(this.mamesh.smallestTriangles[f])&&i++,s.hasVertex(this.mamesh.smallestTriangles[f+1])&&i++,s.hasVertex(this.mamesh.smallestTriangles[f+2])&&i++,i>0&&i<3?this.OUT_BorderPolygon.push([this.mamesh.smallestTriangles[f],this.mamesh.smallestTriangles[f+1],this.mamesh.smallestTriangles[f+2]]):3==i&&s.smallestTriangles.push(this.mamesh.smallestTriangles[f],this.mamesh.smallestTriangles[f+1],this.mamesh.smallestTriangles[f+2])}for(var r=0,n=this.OUT_BorderPolygon;r<n.length;r++)for(var o=0,a=m=n[r];o<a.length;o++){var h=a[o];s.hasVertex(h)?-1==this.OUT_BorderVerticesInside.indexOf(h)&&this.OUT_BorderVerticesInside.push(h):-1==this.OUTBorderVerticesOutside.indexOf(h)&&this.OUTBorderVerticesOutside.push(h)}if(this.takeCareOfPolygons)if(this.addBorderPolygonInsteadOfSuppress){for(var l=0,u=this.OUT_BorderPolygon;l<u.length;l++){var m=u[l];3==m.length?s.smallestTriangles.push(m[0],m[1],m[2]):4==m.length&&s.smallestSquares.push(m[0],m[1],m[2],m[3])}for(var c=0,p=this.OUTBorderVerticesOutside;c<p.length;c++){v=p[c];s.addVertex(v)}}else{for(var g=[],d=[],f=0;f<this.OUT_BorderVerticesInside.length;f++){for(var v=this.OUT_BorderVerticesInside[f],y=!1,b=0,x=s.smallestSquares;b<x.length;b++)if((h=x[b]).hashNumber==v.hashNumber){y=!0;break}if(!y)for(var w=0,T=s.smallestTriangles;w<T.length;w++)if((h=T[w]).hashNumber==v.hashNumber){y=!0;break}y||(d.push(s.vertices.indexOf(v)),g.push(f))}this.OUT_BorderVerticesInside=e.tab.arrayMinusSomeIndices(this.OUT_BorderVerticesInside,g),s.vertices=e.tab.arrayMinusSomeIndices(s.vertices,d)}if(this.constructCutSegment)for(var V in this.mamesh.cutSegmentsDico){var M=this.mamesh.cutSegmentsDico[V];s.hasVertex(M.a)&&(s.hasVertex(M.b)&&s.hasVertex(M.middle)&&(s.cutSegmentsDico[V]=M))}return s},t}();t.SubMameshExtractor=r;var n=function(){function s(e,t){this.markBorder=!0,this.suppressFromBorderVersusCorner=!0,this.mamesh=e,this.nb=t}return s.prototype.go=function(){var s=[];if(this.suppressFromBorderVersusCorner)for(var i=0,r=this.mamesh.vertices;i<r.length;i++)(a=r[i]).hasMark(e.Vertex.Markers.border)&&s.push(a);else for(var n=0,o=this.mamesh.vertices;n<o.length;n++){var a=o[n];a.hasMark(e.Vertex.Markers.corner)&&s.push(a)}var h=e.graph.ringify(s),l=new e.HashMap;if(this.nb<0&&(this.nb=h.length+this.nb-1),this.nb>=h.length-1)throw"you want to suppress too much strates";for(var u=0;u<this.nb;u++)for(var m=0,c=h[u];m<c.length;m++){f=c[m];l.putValue(f,!0)}for(var p=[],g=0,d=this.mamesh.vertices;g<d.length;g++){var f=d[g];null==l.getValue(f)&&p.push(f)}if(this.markBorder)for(var v=0,y=h[this.nb];v<y.length;v++)(f=y[v]).markers.push(e.Vertex.Markers.border);return new t.SubMameshExtractor(this.mamesh,p).go()},s}();t.ExtractCentralPart=n;!function(){function t(e,t){this.receiver=e,this.source=t}t.prototype.checkArgs=function(){if(this.receiver.length%4!=0)throw"receiver is not a list representing squares";if(this.source.length%4!=0)throw"source is not a list representing squares"},t.prototype.go=function(){this.checkArgs();for(var t=new e.HashMap(!0),s=this.squareToBaryCenter(this.source),i=this.squareToBaryCenter(this.receiver),r=0;r<s.length;r++){for(var n=Number.MAX_VALUE,o=-1,a=0;a<i.length;a++){var h=e.geo.distance(s[r],i[a]);h<n&&(n=h,o=a)}for(var l=[this.receiver[4*o],this.receiver[4*o+1],this.receiver[4*o+2],this.receiver[4*o+3]],u=[this.source[4*r],this.source[4*r+1],this.source[4*r+2],this.source[4*r+3]],m=this.getBestPermutationOfReceiver(l,u),c=0;c<4;c++)t.putValue(u[c],m[c])}return t},t.prototype.getBestPermutationOfReceiver=function(t,s){for(var i=Number.MAX_VALUE,r=-1,n=0;n<4;n++){for(var o=[t[n],t[(n+1)%4],t[(n+2)%4],t[(n+3)%4]],a=0,h=0;h<4;h++)a+=e.geo.distance(s[h].position,o[h].position);a<i&&(i=a,r=n)}var l=r;return[t[l],t[(l+1)%4],t[(l+2)%4],t[(l+3)%4]]},t.prototype.squareToBaryCenter=function(t){for(var s=[],i=0;i<t.length;i+=4){var r=[t[i].position,t[i+1].position,t[i+2].position,t[i+3].position],n=new e.XYZ(0,0,0);e.geo.baryCenter(r,[.25,.25,.25,.25],n),s.push(n)}return s}}();var o=function(){function t(e,t){this.toleranceToBeOneOfTheClosest=.5,this.proximityCoef=.7,this.acceptOnlyDisjointReceiverAndSource=!0,this.receiver=e,this.source=t}return t.prototype.checkArgs=function(){if(this.acceptOnlyDisjointReceiverAndSource){for(var t=new e.HashMap,s=0,i=this.source;s<i.length;s++){o=i[s];t.putValue(o,!0)}for(var r=0,n=this.receiver;r<n.length;r++){var o=n[r];if(null!=t.getValue(o))throw"source and receiver must be disjoint"}}},t.prototype.go=function(){this.checkArgs(),null==this.proximityMeasurer&&(this.proximityMeasurer=new i),this.checkArgs();for(var t=new e.HashMap(!0),s=0,r=this.source;s<r.length;s++){for(var n=r[s],o=Number.POSITIVE_INFINITY,a=new e.HashMap(!0),h=null,l=0,u=this.receiver;l<u.length;l++){var m=u[l],c=e.geo.distance(n.position,m.position);this.proximityMeasurer.areClose(n,m,this.proximityCoef)&&(a.putValue(m,c),c<o&&(o=c,h=m))}if(null!=h){var p=[];p.push(h);for(var g=0,d=a.allKeys();g<d.length;g++)(m=d[g])!=h&&a.getValue(m)<=o*(1+this.toleranceToBeOneOfTheClosest)&&p.push(m);t.putValue(n,p)}}return t},t}();t.FindSickingMapFromVertices=o;var a=function(){function i(){this.IN_mameshes=[],this.SUB_grater=new s,this.justGrateDoNotStick=!1,this.addMissingPolygons=!0,this.proximityCoefToStick=[2],this.toleranceToBeOneOfTheClosest=.5,this.OUTBorderVerticesToStick=[],this.OUTGratedMameshes=[],this.takeCareOfPolygons=!0,this.suppressLinksAngularlyTooClose=!0,this.SUB_linkCleanerByAngle=new e.linkModule.LinksSorterAndCleanerByAngles(null,null),this.SUB_PolygonCreatorFromLinks=new e.polygonFinder.PolygonFinderFromLinks(null),this.OUT_stickingMap=new e.HashMap(!0),this.SUB_linkCleanerByAngle.suppressLinksAngularParam=2*Math.PI*.1}return i.prototype.checkArgs=function(){},i.prototype.goChanging=function(){this.checkArgs();for(var s=0,i=this.IN_mameshes;s<i.length;s++)for(var r=0,n=i[s].vertices;r<n.length;r++)for(var a=0,h=(C=n[r]).links;a<h.length;a++)h[a].opposites=null;var l=[];this.IN_mameshes.forEach(function(e){return l.push(e.vertices)}),this.SUB_grater.IN_graphFamily=l;for(var u=this.SUB_grater.go(),m=0;m<this.IN_mameshes.length;m++){var c=new t.SubMameshExtractor(this.IN_mameshes[m],u[m]);c.takeCareOfPolygons=this.takeCareOfPolygons,c.addBorderPolygonInsteadOfSuppress=!1,this.OUTGratedMameshes[m]=c.go(),this.OUTBorderVerticesToStick[m]=[];for(var p=0,d=c.OUT_BorderVerticesInside;p<d.length;p++)for(var f=d[p],v=0,y=f.links;v<y.length;v++){var b=y[v];if(this.IN_mameshes[m].hasVertex(b.to)&&!this.OUTGratedMameshes[m].hasVertex(b.to)){this.OUTBorderVerticesToStick[m].push(f);break}}this.OUTGratedMameshes[m].isolateMameshVerticesFromExteriorVertices();for(var x=0,w=this.OUTGratedMameshes[m].vertices;x<w.length;x++){var T=w[x];T.hasMark(e.Vertex.Markers.border)&&-1==this.OUTBorderVerticesToStick[m].indexOf(T)&&this.OUTBorderVerticesToStick[m].push(T)}}for(var V=this.OUTGratedMameshes[0],M=1;M<this.IN_mameshes.length;M++){var S=new o(V.vertices,this.OUTBorderVerticesToStick[M]);S.toleranceToBeOneOfTheClosest=this.toleranceToBeOneOfTheClosest,S.proximityCoef=this.proximityCoefToStick[M%this.proximityCoefToStick.length];var k=S.go();this.OUT_stickingMap.extend(k);var O=new g(V,this.OUTGratedMameshes[M],k);O.zIndex1=M,O.cleanOppositeLinksAtBegin=!1,O.createNewLinks=!this.justGrateDoNotStick,O.goChanging()}V.isolateMameshVerticesFromExteriorVertices();for(var A=0,L=V.vertices;A<L.length;A++){var C=L[A];if(0==C.links.length)throw" grating process produce a vertex with no links"}return this.suppressLinksAngularlyTooClose&&(this.SUB_linkCleanerByAngle.mamesh=V,this.SUB_linkCleanerByAngle.goChanging()),this.addMissingPolygons&&!this.justGrateDoNotStick&&(this.SUB_PolygonCreatorFromLinks.mamesh=V,this.SUB_PolygonCreatorFromLinks.go()),V},i}();t.ConcurrentMameshesGraterAndSticker=a;var h=function(){function t(t){this.vertices=t,this.nbBoxes=new e.XYZ(20,20,20),this.doubleCheck=!0,this.addRepresentativeInRes=!0}return t.prototype.go=function(){var t=new l(this.vertices);t.nbBoxes=this.nbBoxes;var s=t.go(new e.XYZ(-.1,-.1,-.1));this.OUT_boxSize=t.OUT_boxSize;for(var i=new e.general_algo.UnionFind,r=0,n=s;r<n.length;r++)for(var o=n[r],a=1;a<o.length;a++)i.union(o[0],o[a]);if(this.doubleCheck)for(var h=0,u=t.go(new e.XYZ(.5,.5,.5));h<u.length;h++)for(var o=u[h],a=1;a<o.length;a++)i.union(o[0],o[a]);return i.get_components(this.addRepresentativeInRes)},t}();t.VeryCloseVerticesFinder=h;var l=function(){function t(t){this.vertices=t,this.nbBoxes=new e.XYZ(20,20,20),this.preGoDone=!1,this.mins=new e.XYZ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.maxs=new e.XYZ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}return t.prototype.preGo=function(){this.preGoDone=!0,this.buildScaler();var t=new e.XYZ(Math.max(1,this.maxs.x-this.mins.x),Math.max(1,this.maxs.y-this.mins.y),Math.max(1,this.maxs.z-this.mins.z));this.OUT_boxSize=e.XYZ.newFrom(t),this.OUT_boxSize.x/=this.nbBoxes.x,this.OUT_boxSize.y/=this.nbBoxes.y,this.OUT_boxSize.z/=this.nbBoxes.z},t.prototype.go=function(t){void 0===t&&(t=new e.XYZ(0,0,0)),this.preGoDone||this.preGo();for(var s=e.XYZ.newFrom(t).multiply(this.OUT_boxSize),i=new e.HashMap(!0),r=0,n=this.vertices;r<n.length;r++){var o=n[r],a=o.position,h=new e.XYZ(0,0,0);h.x=this.floatToIndex(a.x+s.x,this.mins.x,this.maxs.x,this.nbBoxes.x),h.y=this.floatToIndex(a.y+s.y,this.mins.y,this.maxs.y,this.nbBoxes.y),h.z=this.floatToIndex(a.z+s.z,this.mins.z,this.maxs.x,this.nbBoxes.z),null==i.getValue(h)?i.putValue(h,[o]):i.getValue(h).push(o)}return i.allValues()},t.prototype.floatToIndex=function(e,t,s,i){return e>=s?i-1:e<=t?0:s-t==0?0:Math.floor((e-t)/(s-t)*i)},t.prototype.buildScaler=function(){for(var e=0,t=this.vertices;e<t.length;e++){var s=t[e].position;s.x<this.mins.x&&(this.mins.x=s.x),s.y<this.mins.y&&(this.mins.y=s.y),s.z<this.mins.z&&(this.mins.z=s.z),s.x>this.maxs.x&&(this.maxs.x=s.x),s.y>this.maxs.y&&(this.maxs.y=s.y),s.z>this.maxs.z&&(this.maxs.z=s.z)}},t}();t.DisjointPackMaker=l;var u=function(){function t(t){this.vertices=t,this.nbBoxes=new e.XYZ(20,20,20),this.maxDistToBeClose=null,this.mins=new e.XYZ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.maxs=new e.XYZ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}return t.prototype.floatToIndex=function(e,t,s,i){return e>=s?i-1:s-t==0?0:Math.floor((e-t)/(s-t)*i)},t.prototype.go=function(){this.buildScaler();var t=new e.XYZ(Math.max(1,this.maxs.x-this.mins.x),Math.max(1,this.maxs.y-this.mins.y),Math.max(1,this.maxs.z-this.mins.z)),s=new e.HashMap(!0);this.OUT_boxSize=e.XYZ.newFrom(t),this.OUT_boxSize.x/=this.nbBoxes.x,this.OUT_boxSize.y/=this.nbBoxes.y,this.OUT_boxSize.z/=this.nbBoxes.z;for(var i=0,r=this.vertices;i<r.length;i++){var n=r[i],o=n.position;(c=new e.XYZ(0,0,0)).x=this.floatToIndex(o.x,this.mins.x,this.maxs.x,this.nbBoxes.x),c.y=this.floatToIndex(o.y,this.mins.y,this.maxs.y,this.nbBoxes.y),c.z=this.floatToIndex(o.z,this.mins.z,this.maxs.x,this.nbBoxes.z),null==s.getValue(c)?s.putValue(c,[n]):s.getValue(c).push(n)}for(var a=[],h=0,l=s.allEntries();h<l.length;h++){var u=l[h];if(u.value.length>1){for(var m=[],c=u.key,p=0,g=[-1,0,1];p<g.length;p++)for(var d=g[p],f=0,v=[-1,0,1];f<v.length;f++)for(var y=v[f],b=0,x=[-1,0,1];b<x.length;b++){var w=x[b],T=e.XYZ.newFrom(c).add(new e.XYZ(d,y,w));null!=s.getValue(T)&&(m=m.concat(s.getValue(T)))}a.push(m)}}return a},t.prototype.buildScaler=function(){for(var e=0,t=this.vertices;e<t.length;e++){var s=t[e].position;s.x<this.mins.x&&(this.mins.x=s.x),s.y<this.mins.y&&(this.mins.y=s.y),s.z<this.mins.z&&(this.mins.z=s.z),s.x>this.maxs.x&&(this.maxs.x=s.x),s.y>this.maxs.y&&(this.maxs.y=s.y),s.z>this.maxs.z&&(this.maxs.z=s.z)}},t}();t.BoxesMaker=u;var m=function(){function t(t,s){this.nbDistinctPoint=1e3,this.maxDistToBeClose=null,this.throwExceptionIfReceiverHaveCloseVertices=!1,this.receiverAndSourceMustBeDisjoint=!1,this.deformationFunction=function(e){return e},this.mins=new e.XYZ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.maxs=new e.XYZ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this.receivers=t,this.sources=s}return t.prototype.go=function(){this.buildScaler();for(var t=new e.XYZ(Math.max(1,this.maxs.x-this.mins.x),Math.max(1,this.maxs.y-this.mins.y),Math.max(1,this.maxs.z-this.mins.z)),s=new e.StringMap,i=0,r=this.receivers;i<r.length;i++){var n=r[i],o=this.deformationFunction(n.position),a=(c=Math.round((o.x-this.mins.x)/t.x*this.nbDistinctPoint))+","+(p=Math.round((o.y-this.mins.y)/t.y*this.nbDistinctPoint))+","+(g=Math.round((o.z-this.mins.z)/t.z*this.nbDistinctPoint));if(null==s.getValue(a))s.putValue(a,n);else if(this.throwExceptionIfReceiverHaveCloseVertices)throw"the receiver list has several XYZ very close, and you have forbidden that"}for(var h=new e.HashMap(!0),l=0,u=this.sources;l<u.length;l++){var m=u[l],o=this.deformationFunction(m.position),c=Math.round((o.x-this.mins.x)/t.x*this.nbDistinctPoint),p=Math.round((o.y-this.mins.y)/t.y*this.nbDistinctPoint),g=Math.round((o.z-this.mins.z)/t.z*this.nbDistinctPoint),d=s.getValue(c+","+p+","+g);if(null!=d)if(d!=m){var f=h.getValue(d);null==f?h.putValue(m,[d]):e.geo.distance(d.position,m.position)<e.geo.distance(d.position,f[0].position)?h.putValue(m,[d].concat(f)):f.push(d)}else if(this.receiverAndSourceMustBeDisjoint)throw"receiver-list and source-list are not disjoint, and you have forbidden that"}return h},t.prototype.buildScaler=function(){var t=this;this.receivers.forEach(function(e){var s=t.deformationFunction(e.position);s.x<t.mins.x&&(t.mins.x=s.x),s.y<t.mins.y&&(t.mins.y=s.y),s.z<t.mins.z&&(t.mins.z=s.z),s.x>t.maxs.x&&(t.maxs.x=s.x),s.y>t.maxs.y&&(t.maxs.y=s.y),s.z>t.maxs.z&&(t.maxs.z=s.z)}),this.sources.forEach(function(e){var s=t.deformationFunction(e.position);s.x<t.mins.x&&(t.mins.x=s.x),s.y<t.mins.y&&(t.mins.y=s.y),s.z<t.mins.z&&(t.mins.z=s.z),s.x>t.maxs.x&&(t.maxs.x=s.x),s.y>t.maxs.y&&(t.maxs.y=s.y),s.z>t.maxs.z&&(t.maxs.z=s.z)}),null!=this.maxDistToBeClose&&(this.nbDistinctPoint=e.geo.distance(this.maxs,this.mins)/this.maxDistToBeClose)},t}();t.FindCloseVerticesFast=m;var c=function(){function t(e){this.mameshes=e,this.cleanDoubleSquareAndTriangles=!0,this.cleanLinksCrossingSegmentMiddle=!0,this.suppressSomeTriangleAndSquareSuperposition=!1,this.mergeLink=!0,this.mergeTrianglesAndSquares=!0,this.mergeSegmentsMiddle=!0,this.OUT_mergedVertices=[]}return t.prototype.goChanging=function(){for(var t=[],s=0,i=this.mameshes;s<i.length;s++){var r=i[s];t=t.concat(r.vertices)}this.mapFromReceiver=new h(t).go(),this.mapFromSource=new e.HashMap;for(var n=0,o=this.mapFromReceiver.allEntries();n<o.length;n++)for(var a=o[n],l=0,u=a.value;l<u.length;l++){g=u[l];this.mapFromSource.putValue(g,a.key)}for(var m=new e.Mamesh,c=0,p=t;c<p.length;c++){var g=p[c];null==this.mapFromSource.getValue(g)&&m.vertices.push(g)}return this.mergeLink&&this.letsMergeLinks(m,t),m},t.prototype.letsMergeLinks=function(t,s){for(var i=new e.HashMap(!0),r=0,n=this.mapFromReceiver.allKeys();r<n.length;r++){var o=n[r];i.putValue(o,!0)}for(var a=0,h=s;a<h.length;a++)for(var l=0,u=(x=h[a]).links;l<u.length;l++){var m=u[l],c=this.mapFromSource.getValue(m.to);null!=c&&(m.to=c,i.putValue(x,!0))}for(var p=0,g=this.mapFromSource.allKeys();p<g.length;p++)for(var d=g[p],f=0,v=d.links;f<v.length;f++){m=v[f];this.mapFromSource.getValue(d).links.push(m)}for(var y=0,b=i.allKeys();y<b.length;y++){for(var x=b[y],w=new e.HashMap,T=[],V=0,M=x.links;V<M.length;V++){m=M[V];null==w.getValue(m.to)&&(w.putValue(m.to,!0),T.push(m))}x.links=T}},t.prototype.letsMergeTriangleQuadFaces=function(){},t.prototype.changeOneSquare=function(e){if(e[0]==e[2]||e[1]==e[3])return null;for(var t=null,s=0,i=0;i<4;i++)e[i]==e[(i+1)%4]&&(s++,t=i);return 0==s?e:s>1?null:0==t?[e[1],e[2],e[3]]:1==t?[e[2],e[3],e[0]]:2==t?[e[3],e[0],e[1]]:3==t?[e[0],e[1],e[2]]:void 0},t}();t.MergerNew=c;var p=function(){function t(t,s,i){this.sourceEqualRecepter=!1,this.cleanDoubleSquareAndTriangles=!0,this.cleanLinksCrossingSegmentMiddle=!0,this.suppressSomeTriangleAndSquareSuperposition=!1,this.mergeLink=!0,this.mergeTrianglesAndSquares=!0,this.mergeSegmentsMiddle=!0,this.destroySource=!0,this.OUT_mergedVertices=[],this.receiverMamesh=t,null==s||t==s?(this.sourceMamesh=t,this.sourceEqualRecepter=!0):(this.sourceMamesh=s,this.sourceEqualRecepter=!1),null==i&&(i=new m(this.receiverMamesh.vertices,this.sourceMamesh.vertices).go()),this.merginMap=new e.HashMap(!0);for(var r=0,n=i.allEntries();r<n.length;r++){var o=n[r];this.merginMap.putValue(o.key,o.value[0])}}return t.prototype.checkArgs=function(){var e=this;if(!this.merginMap.memorizeKeys)throw"the merging map must memorize the keys";this.merginMap.allValues().forEach(function(t){if(null!=e.merginMap.getValue(t))throw"a vertex cannot be the destination and the source of a merging"})},t.prototype.goChanging=function(){this.checkArgs(),this.mergeLink?this.mergeVerticesAndLinks():this.mergeOnlyVertices(),this.mergeTrianglesAndSquares&&this.letsMergeTrianglesAndSquares(),this.mergeSegmentsMiddle&&this.mergeCutSegment(),this.receiverMamesh.lines=null,this.destroySource&&!this.sourceEqualRecepter&&(this.sourceMamesh.vertices=null)},t.prototype.mergeOnlyVertices=function(){var t=this;this.sourceEqualRecepter||(this.receiverMamesh.vertices=this.receiverMamesh.vertices.concat(this.sourceMamesh.vertices)),this.receiverMamesh.clearLinksAndLines(),this.merginMap.allKeys().forEach(function(s){e.tab.removeFromArray(t.receiverMamesh.vertices,s)})},t.prototype.mergeVerticesAndLinks=function(){var t=this;this.sourceEqualRecepter||(this.receiverMamesh.vertices=this.receiverMamesh.vertices.concat(this.sourceMamesh.vertices)),this.receiverMamesh.clearOppositeInLinks(),this.OUT_mergedVertices=this.merginMap.allKeys(),this.OUT_mergedVertices.forEach(function(e){var s=t.merginMap.getValue(e),i=[];e.links.forEach(function(s){null==t.merginMap.getValue(s.to)&&t.merginMap.getValue(e)!=s.to&&i.push(s)}),s.links=s.links.concat(i),0==s.param.x&&(e.param.x=0),0==e.param.y&&(s.param.y=0)});var s=[];this.receiverMamesh.vertices.forEach(function(e){-1==t.merginMap.allKeys().indexOf(e)&&s.push(e)}),this.receiverMamesh.vertices=s,this.receiverMamesh.vertices.forEach(function(s){var i=null;s.links.forEach(function(e){null!=t.merginMap.getValue(e.to)&&(t.merginMap.getValue(e.to)!=s?e.to=t.merginMap.getValue(e.to):(null==i&&(i=[]),i.push(e)))}),null!=i&&i.forEach(function(t){e.tab.removeFromArray(s.links,t)})})},t.prototype.mergeCutSegment=function(){var t=this;if(!this.sourceEqualRecepter)for(var s in this.sourceMamesh.cutSegmentsDico)this.receiverMamesh.cutSegmentsDico[s]=this.sourceMamesh.cutSegmentsDico[s];for(var s in this.receiverMamesh.cutSegmentsDico){var i=this.receiverMamesh.cutSegmentsDico[s];if(i.a.hashNumber!=i.middle.hashNumber&&i.b.hashNumber!=i.middle.hashNumber&&i.a.hashNumber!=i.b.hashNumber){var r=!1;null!=this.merginMap.getValue(i.a)&&(i.a=this.merginMap.getValue(i.a),r=!0),null!=this.merginMap.getValue(i.b)&&(i.b=this.merginMap.getValue(i.b),r=!0),null!=this.merginMap.getValue(i.middle)&&(i.middle=this.merginMap.getValue(i.middle),r=!0),r&&(delete this.receiverMamesh.cutSegmentsDico[s],this.receiverMamesh.cutSegmentsDico[e.Segment.segmentId(i.a.hashNumber,i.b.hashNumber)]=i)}else delete this.receiverMamesh.cutSegmentsDico[s]}this.cleanLinksCrossingSegmentMiddle&&this.receiverMamesh.vertices.forEach(function(s){for(var i=[],r=0;r<s.links.length;r++){var n=s.links[r];null!=t.receiverMamesh.cutSegmentsDico[e.Segment.segmentId(s.hashNumber,n.to.hashNumber)]&&i.push(r)}s.links=e.tab.arrayMinusBlocksIndices(s.links,i,1)})},t.prototype.letsMergeTrianglesAndSquares=function(){this.sourceEqualRecepter||(this.receiverMamesh.smallestSquares=this.receiverMamesh.smallestSquares.concat(this.sourceMamesh.smallestSquares),this.receiverMamesh.smallestTriangles=this.receiverMamesh.smallestTriangles.concat(this.sourceMamesh.smallestTriangles));for(s=0;s<this.receiverMamesh.smallestTriangles.length;s++){i=this.receiverMamesh.smallestTriangles[s];null!=this.merginMap.getValue(i)&&(this.receiverMamesh.smallestTriangles[s]=this.merginMap.getValue(i))}for(var t=[],s=0;s<this.receiverMamesh.smallestTriangles.length;s+=3)this.receiverMamesh.smallestTriangles[s]!=this.receiverMamesh.smallestTriangles[s+1]&&this.receiverMamesh.smallestTriangles[s+1]!=this.receiverMamesh.smallestTriangles[s+2]&&this.receiverMamesh.smallestTriangles[s+2]!=this.receiverMamesh.smallestTriangles[s]||t.push(s);this.receiverMamesh.smallestTriangles=e.tab.arrayMinusBlocksIndices(this.receiverMamesh.smallestTriangles,t,3),this.receiverMamesh.smallestTriangles=new e.tab.ArrayMinusBlocksElements(this.receiverMamesh.smallestTriangles,3).go();for(s=0;s<this.receiverMamesh.smallestSquares.length;s++){var i=this.receiverMamesh.smallestSquares[s];null!=this.merginMap.getValue(i)&&(this.receiverMamesh.smallestSquares[s]=this.merginMap.getValue(i))}for(var r=[],s=0;s<this.receiverMamesh.smallestSquares.length;s+=4){var n=this.changeOneSquare([this.receiverMamesh.smallestSquares[s],this.receiverMamesh.smallestSquares[s+1],this.receiverMamesh.smallestSquares[s+2],this.receiverMamesh.smallestSquares[s+3]]);null==n?r.push(s):3==n.length&&(this.receiverMamesh.smallestTriangles.push(n[0],n[1],n[2]),r.push(s))}if(this.receiverMamesh.smallestSquares=e.tab.arrayMinusBlocksIndices(this.receiverMamesh.smallestSquares,r,4),this.cleanDoubleSquareAndTriangles&&(this.receiverMamesh.smallestSquares=new e.tab.ArrayMinusBlocksElements(this.receiverMamesh.smallestSquares,4).go()),this.suppressSomeTriangleAndSquareSuperposition){for(var o=new e.StringMap,s=0;s<this.receiverMamesh.smallestSquares.length;s+=4)o.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[s].hashNumber,this.receiverMamesh.smallestSquares[s+1].hashNumber,this.receiverMamesh.smallestSquares[s+2].hashNumber]),!0),o.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[s+2].hashNumber,this.receiverMamesh.smallestSquares[s+3].hashNumber,this.receiverMamesh.smallestSquares[s].hashNumber]),!0),o.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[s].hashNumber,this.receiverMamesh.smallestSquares[s+1].hashNumber,this.receiverMamesh.smallestSquares[s+3].hashNumber]),!0),o.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[s+1].hashNumber,this.receiverMamesh.smallestSquares[s+2].hashNumber,this.receiverMamesh.smallestSquares[s+3].hashNumber]),!0);for(var a=[],s=0;s<this.receiverMamesh.smallestTriangles.length;s+=3){var h=e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestTriangles[s].hashNumber,this.receiverMamesh.smallestTriangles[s+1].hashNumber,this.receiverMamesh.smallestTriangles[s+2].hashNumber]);o.getValue(h)&&a.push(s,s+1,s+2)}this.receiverMamesh.smallestTriangles=e.tab.arrayMinusBlocksIndices(this.receiverMamesh.smallestTriangles,a,3);for(var l=new e.StringMap,s=0;s<this.receiverMamesh.smallestSquares.length;s+=4)l.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[s].hashNumber,this.receiverMamesh.smallestSquares[s+2].hashNumber]),!0),l.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[s+1].hashNumber,this.receiverMamesh.smallestSquares[s+3].hashNumber]),!0);for(var u=[],m=[],s=0;s<this.receiverMamesh.smallestSquares.length;s+=4)for(var c=0;c<4;c++){var p=[this.receiverMamesh.smallestSquares[s+c].hashNumber,this.receiverMamesh.smallestSquares[s+(c+1)%4].hashNumber],g=[this.receiverMamesh.smallestSquares[s+(c+1)%4].hashNumber,this.receiverMamesh.smallestSquares[s+(c+2)%4].hashNumber];l.getValue(e.tab.indicesUpPermutationToString(p))&&l.getValue(e.tab.indicesUpPermutationToString(g))&&(u.push(s,s+1,s+2,s+3),m.push(this.receiverMamesh.smallestSquares[s+(c+2)%4],this.receiverMamesh.smallestSquares[s+(c+3)%4],this.receiverMamesh.smallestSquares[s+c%4]))}m.length>0&&(this.receiverMamesh.smallestSquares=e.tab.arrayMinusBlocksIndices(this.receiverMamesh.smallestSquares,u,4),this.receiverMamesh.smallestTriangles=this.receiverMamesh.smallestTriangles.concat(m))}},t.prototype.changeOneSquare=function(e){if(e[0]==e[2]||e[1]==e[3])return null;for(var t=null,s=0,i=0;i<4;i++)e[i]==e[(i+1)%4]&&(s++,t=i);return 0==s?e:s>1?null:0==t?[e[1],e[2],e[3]]:1==t?[e[2],e[3],e[0]]:2==t?[e[3],e[0],e[1]]:3==t?[e[0],e[1],e[2]]:void 0},t}();t.Merger=p;var g=function(){function t(t,s,i){this.createNewLinks=!0,this.cleanOppositeLinksAtBegin=!0,this.twoMameshes=!0,this.zIndex1=Math.random(),this.SUB_polygonFinder=new e.polygonFinder.PolygonFinderFromLinks(null),t!=s&&null!=s||(this.twoMameshes=!1),this.mamesh0=t,this.twoMameshes?this.mamesh1=s:this.mamesh1=null,this.stickingMap=i}return t.prototype.checkArgs=function(){if(!this.stickingMap.memorizeKeys)throw"the sticking map must memorize the keys";for(var e=0,t=this.stickingMap.allValues();e<t.length;e++)for(var s=0,i=t[e];s<i.length;s++){var r=i[s];if(null!=this.stickingMap.getValue(r))throw"a vertex cannot be the destination and the source of a sticking"}},t.prototype.goChanging=function(){if(0!=this.stickingMap.allKeys().length){if(this.checkArgs(),this.cleanOppositeLinksAtBegin&&(this.mamesh0.clearOppositeInLinks(),this.twoMameshes&&this.mamesh1.clearOppositeInLinks()),this.twoMameshes){for(var e=0,t=this.mamesh1.vertices;e<t.length;e++){var s=t[e];s.param.z=this.zIndex1,this.mamesh0.addVertex(s)}this.mamesh0.smallestSquares=this.mamesh0.smallestSquares.concat(this.mamesh1.smallestSquares),this.mamesh0.smallestTriangles=this.mamesh0.smallestTriangles.concat(this.mamesh1.smallestTriangles)}if(this.mamesh0.cutSegmentsDico={},this.mamesh0.vertexToPositioning=null,this.mamesh0.lines=null,this.createNewLinks)for(var i=0,r=this.stickingMap.allKeys();i<r.length;i++)for(var n=r[i],o=0,a=this.stickingMap.getValue(n);o<a.length;o++){var h=a[o];n.setOneLink(h),h.setOneLink(n)}}},t}();t.Sticker=g}(e.grateAndGlue||(e.grateAndGlue={}))}(mathis||(mathis={}));var mathis;!function(e){function t(e){var t=[];for(var s in e)if(e.hasOwnProperty(s)){var i=parseInt(s);isNaN(i)||t.push(i)}return t}function s(e){var t=[];for(var s in e)e.hasOwnProperty(s)&&isNaN(parseInt(s))&&t.push(s);return t}function i(e,t){return e*=Math.pow(10,t),e=Math.round(e),e/=Math.pow(10,t)}function r(e,t){t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(s){"constructor"!==s&&(e.prototype[s]=t.prototype[s])})})}function n(e,t){var s;document.getElementById&&(s=document.getElementById(e))&&s.style&&(s.style.cursor=t)}function o(e,t,s){if(void 0===s&&(s=!1),t<0)throw"second arg must be positif";var i=0;return i=e>=0?e%t:t- -e%t,s&&i>t/2&&(i-=t),Math.abs(i-t)<10*Number.MIN_VALUE&&(i=0),i}function a(e){for(var t,s,i=e.length;i>0;)s=Math.floor(Math.random()*i),t=e[--i],e[i]=e[s],e[s]=t;return e}e.allIntegerValueOfEnume=t,e.allStringValueOfEnume=s;!function(e){function t(t,i){if(void 0===i&&(i=1),null!=s[t]?s[t]++:s[t]=1,s[t]<=i)if(e.showTrace){var r=new Error;console.log("WARNING",t,"...........................................",r)}else console.log("WARNING",t)}e.showTrace=!1;var s=[];e.c=t}(e.logger||(e.logger={})),e.roundWithGivenPrecision=i,e.applyMixins=r,e.setCursorByID=n;var h=function(){function e(){this.millisDuration=0,this.nbTested=0,this.nbOK=0,this.millisDep=performance.now()}return e.prototype.computeTime=function(){this.millisDuration=performance.now()-this.millisDep},e.prototype.add=function(e){e.computeTime(),this.nbTested+=e.nbTested,this.nbOK+=e.nbOK,this.millisDuration+=e.millisDuration},e.prototype.assertTrue=function(e){if(this.nbTested++,e)this.nbOK++;else{var t=new Error;console.log(t.stack)}},e.prototype.toString=function(){return"nbTest:"+this.nbTested+", nbOK:"+this.nbOK+", millisDuration:"+this.millisDuration.toFixed(2)},e}();e.Bilan=h,e.modulo=o,e.shuffle=a;var l=function(){function e(e,t){this.key=e,this.value=t}return e}();e.Entry=l;var u=function(){function e(e){void 0===e&&(e=!1),this.values={},this.keys={},this.memorizeKeys=e}return e.prototype.putValue=function(e,t,s){if(void 0===s&&(s=!0),null==e){if(s)throw"key must be non null";return null}this.values[e.hashString]=t,this.memorizeKeys&&(this.keys[e.hashString]=e)},e.prototype.removeKey=function(e){delete this.values[e.hashString],this.memorizeKeys&&delete this.keys[e.hashString]},e.prototype.getValue=function(e,t){if(void 0===t&&(t=!0),null==e){if(t)throw"key must be non null";return null}return this.values[e.hashString]},e.prototype.allValues=function(){var e=new Array;for(var t in this.values)e.push(this.values[t]);return e},e.prototype.oneValue=function(){for(var e in this.values)return this.values[e];return null},e.prototype.allKeys=function(){if(!this.memorizeKeys)throw"this hashMap has not memorized keys. Please, put args=true in the constructor";var e=new Array;for(var t in this.keys)e.push(this.keys[t]);return e},e.prototype.allEntries=function(){if(!this.memorizeKeys)throw"this hashMap has not memorized keys. Please, put args=true in the constructor";var e=[];for(var t in this.keys)e.push(new l(this.keys[t],this.values[t]));return e},e.prototype.aRandomValue=function(){var e=Object.keys(this.values);return this.values[e[Math.floor(e.length*Math.random())]]},e.prototype.extend=function(e){if(!e.memorizeKeys)throw"cannot extend this  with a HashMap which do not memorize keys";for(var t=0,s=e.allEntries();t<s.length;t++){var i=s[t];this.putValue(i.key,i.value)}},e.prototype.size=function(){var e=0;for(var t in this.values)e++;return e},e.prototype.printMe=function(e){var t="[";for(var s in this.values)t+=s+">"+e(this.values[s])+",";return t+="]"},e}();e.HashMap=u;var m=function(){function e(){this.values={}}return e.prototype.putValue=function(e,t,s){if(void 0===s&&(s=!0),null==e){if(s)throw"key must be non null";return null}this.values[e]=t},e.prototype.removeKey=function(e){delete this.values[e]},e.prototype.getValue=function(e,t){if(void 0===t&&(t=!0),null==e){if(t)throw"key must be non null";return null}return this.values[e]},e.prototype.allValues=function(){var e=new Array;for(var t in this.values)e.push(this.values[t]);return e},e.prototype.oneValue=function(){for(var e in this.values)return this.values[e];return null},e.prototype.allKeys=function(){return Object.keys(this.values)},e.prototype.aRandomValue=function(){var e=Object.keys(this.values);return this.values[e[Math.floor(e.length*Math.random())]]},e.prototype.size=function(){var e=0;for(var t in this.values)e++;return e},e.prototype.__serialize=function(){return this.values},e.prototype.__load=function(e){this.values=e},e}();e.StringMap=m}(mathis||(mathis={}));var mathis;!function(e){!function(t){function s(t,s){function i(t,o,a,h){var l=o[o.length-1],u=o[o.length-2];r.putValue(new e.Segment(u,l),!0);var m=l.getOpposites(u);if(null==m)t&&e.logger.c("strange : probably, the function makeLineCatalogue2 have as args a non complete graph (call getGroup before)"),n.push(new e.Line(o,!1));else{if(0==m.length)throw"convention: is no opposite, the array opposite must be null, and not empty";if(1==a.getValue(new e.Segment(u,l)))n.push(new e.Line(o,!1));else{a.putValue(new e.Segment(u,l),!0);var c=m.length;s||(c=1);for(var p=0;p<c;p++){var g=m[p];if(g==o[0])n.push(new e.Line(o,!0)),r.putValue(new e.Segment(l,o[0]),!0);else if(p<c-1){for(var d=new e.HashMap,f=0;f<o.length-1;f++)d.putValue(new e.Segment(o[f],o[f+1]),!0);i(t,o.concat([g]),d,!0)}else o.push(g),i(t,o,a,h)}}}}var r=new e.HashMap,n=[];if(t.forEach(function(t){t.links.forEach(function(n){null==n.opposites&&(s||null==r.getValue(new e.Segment(t,n.to)))&&i(!1,[t,n.to],new e.HashMap,!1)})}),s){for(var o=new e.HashMap,a=[],h=0,l=n;h<l.length;h++){var u=l[h];null==o.getValue(u)&&a.push(u),o.putValue(u,!0)}n=a}return t.forEach(function(t){t.links.forEach(function(s){null==r.getValue(new e.Segment(t,s.to))&&i(!0,[t,s.to],new e.HashMap,!1)})}),n}var i=function(){function t(e){this.startingVertices=null,this.startingSegments=null,this.restrictLinesToTheseVertices=null,this.lookAtBifurcation=!0,this.mamesh=e}return t.prototype.go=function(){if(null==this.mamesh)throw" a null mamesh";if(null==this.mamesh.vertices||0==this.mamesh.vertices.length)throw"no vertices in this mamesh";this.mamesh.linesWasMade&&e.logger.c("lines already exist for this mamesh");var t=s(this.mamesh.vertices,this.lookAtBifurcation),i=[];if(null!=this.startingVertices){for(var n=new e.HashMap,o=0,a=this.startingVertices;o<a.length;o++){var h=a[o];n.putValue(h,!0)}for(var l=0,u=t;l<u.length;l++)for(var m=0,c=(T=u[l]).vertices;m<c.length;m++){var p=c[m];if(null!=n.getValue(p)){i.push(T);break}}}if(null!=this.startingSegments){for(var g=new e.StringMap,d=0,f=this.startingSegments;d<f.length;d++){var v=f[d],y=v[0],b=v[1];g.putValue(e.Hash.segment(y,b),!0)}for(var x=0,w=t;x<w.length;x++){var T=w[x],V=0;T.isLoop&&(V=1);for(var M=0;M<T.vertices.length+V;M++)if(1==g.getValue(e.Hash.segment(T.vertices[M],T.vertices[(M+1)%T.vertices.length]))){i.push(T);break}}}return null==this.startingVertices&&null==this.startingSegments&&(i=t),null!=this.restrictLinesToTheseVertices&&(i=new r(i,this.restrictLinesToTheseVertices).go()),i},t}();t.LineComputer=i;var r=function(){function t(e,t){this.lines=e,this.vertices=t}return t.prototype.go=function(){var t=this;this.allPresentVertices=new e.HashMap;for(var s=0,i=this.vertices;s<i.length;s++){var r=i[s];this.allPresentVertices.putValue(r,!0)}var n=[];return this.lines.forEach(function(s){if(!s.isLoop)for(var i=0,r=t.cutOneLine(s.vertices);i<r.length;i++){var o=r[i];n.push(new e.Line(o,!1))}}),this.lines.forEach(function(s){if(s.isLoop){for(var i=s.vertices,r=-1,o=0;o<i.length;o++)if(null==t.allPresentVertices.getValue(i[o])){r=o;break}if(-1==r)n.push(s);else{for(var a=[],h=0;h<i.length;h++)a.push(i[(h+r)%i.length]);for(var l=0,u=t.cutOneLine(a);l<u.length;l++){var m=u[l];n.push(new e.Line(m,!1))}}}}),n},t.prototype.cutOneLine=function(e){var t=[];t[0]=[];for(var s=-1,i=!0,r=0;r<e.length;r++)1==this.allPresentVertices.getValue(e[r])?i?(t[++s]=[],t[s].push(e[r]),i=!1):t[s].push(e[r]):i=!0;var n=[];return t.forEach(function(e){e.length>=2&&n.push(e)}),n},t}();t.LinesCuter=r,t.makeLineCatalogue2=s;var n=function(e){function t(){return e.call(this,!0)||this}return __extends(t,e),t}(e.HashMap),o=function(){function t(e){this.packSymmetricLines=!0,this.forSymmetriesUsePositionVersusParam=!0,this.useConsecutiveIntegerForPackNumber=!0,this.symmetries=null,this.OUT_nbFoundSymmetricLines=0,this.OUT_lineIndexToColorIndex=[],this.mamesh=e}return t.prototype.go=function(){if(!this.mamesh.linesWasMade)throw"no line for this IN_mamesh";for(var t=[],s=0,i=new e.HashMap,r=0,o=this.mamesh.lines;r<o.length;r++){for(var a=[],h=[],l=0,u=(M=o[r]).allSegments();l<u.length;l++){g=u[l];null!=i.getValue(g)?a.push(g):h.push(g)}if(0==a.length){var m=new n;m.index=s++;for(var c=0,p=M.allSegments();c<p.length;c++){var g=p[c];m.putValue(g,!0),i.putValue(g,m)}}else{for(var d=i.getValue(a[0]),f=1;f<a.length;f++)this.segmentAndHisPackJoinNewPack(a[f],d,i);for(var v=0,y=h;v<y.length;v++){var b=y[v];d.putValue(b,!0),i.putValue(b,d)}}}if(null!=this.symmetries){e.XYZ.nbDecimalForHash=1;for(var x=new e.StringMap,f=0;f<this.mamesh.lines.length;f++){var w=(M=this.mamesh.lines[f]).hashStringUpToSymmetries(this.symmetries,this.forSymmetriesUsePositionVersusParam),T=x.getValue(w);if(null==T)x.putValue(w,i.getValue(new e.Segment(M.vertices[0],M.vertices[1])));else{this.OUT_nbFoundSymmetricLines++;var V=i.getValue(new e.Segment(M.vertices[0],M.vertices[1]));V.size()==T.size()&&(V.index=T.index)}}e.XYZ.nbDecimalForHash=5}for(f=0;f<this.mamesh.lines.length;f++){var M=this.mamesh.lines[f];t[f]=i.getValue(new e.Segment(M.vertices[0],M.vertices[1])).index}if(this.useConsecutiveIntegerForPackNumber&&this.packSymmetricLines){for(var S=[],k=t[e.tab.maxIndexOfNumericList(t)],O=0,A=0;A<=k;A++){for(var L=!1,C=0;C<t.length;C++)t[C]==A&&(S[C]=A-O,L=!0);L||O++}t=S}for(var N=new e.HashMap,f=0;f<this.mamesh.lines.length;f++)N.putValue(this.mamesh.lines[f],t[f]),this.OUT_lineIndexToColorIndex[f]=t[f];return N},t.prototype.segmentAndHisPackJoinNewPack=function(e,t,s){for(var i=0,r=s.getValue(e).allKeys();i<r.length;i++){var n=r[i];t.putValue(n,!0),s.putValue(n,t)}s.putValue(e,t)},t}();t.CreateAColorIndexRespectingBifurcationsAndSymmetries=o}(e.lineModule||(e.lineModule={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){var s=function(){function t(e){this.clearPOldLinkBefore=!0,this.mamesh=e}return t.prototype.goChanging=function(){this.clearPOldLinkBefore&&this.mamesh.clearLinksAndLines();for(var t=new e.StringMap,s=0,i=this.mamesh.polygons;s<i.length;s++)for(var r=i[s],n=0;n<r.length;n++){var o=e.Segment.segmentId(r[n].hashNumber,r[(n+1)%r.length].hashNumber);null==t.getValue(o)&&(t.putValue(o,!0),r[n].setOneLink(r[(n+1)%r.length]),r[(n+1)%r.length].setOneLink(r[n]))}},t}();t.SimpleLinkFromPolygonCreator=s;var i=function(){function t(e,t){this.normals=t,this.suppressLinksAngularlyTooCloseVersusNot=!0,this.suppressLinksAngularParam=2*Math.PI*.1,this.keepShorterLinksVersusGiveSomePriorityToLinksWithOpposite=!0,this.suppressTriAndQuadWhoseSideIsSuppressed=!0,this.mamesh=e}return t.prototype.goChanging=function(){var t=this;if(null==this.mamesh)throw"mamesh is null";if(null==this.normals)this.vertexToPositioning=new e.mameshAroundComputations.PositioningComputerForMameshVertices(this.mamesh).go();else if(this.normals instanceof e.HashMap)this.vertexToPositioning=this.normals;else if(this.normals instanceof e.XYZ){this.vertexToPositioning=new e.HashMap;var s=new e.Positioning;s.upVector=this.normals;for(var i=0,r=this.mamesh.vertices;i<r.length;i++){var n=r[i];this.vertexToPositioning.putValue(n,s)}}this.mamesh.vertices.forEach(function(s){for(var i=[],r=0;r<s.links.length;r++)if(i[r]=new e.XYZ(0,0,0).copyFrom(s.links[r].to.position).substract(s.position),i[r].length()<e.geo.epsilon)throw"a IN_mamesh with two voisins at the same position";var n=[];n.push({angle:0,i:0});for(var o=t.vertexToPositioning.getValue(s).upVector,r=1;r<s.links.length;r++)n.push({angle:e.geo.angleBetweenTwoVectorsBetweenMinusPiAndPi(i[0],i[r],o),i:r});n.sort(function(e,t){return e.angle-t.angle});for(var a=[],h=0;h<n.length;h++)a.push(s.links[n[h].i]);s.links=a}),this.suppressLinksAngularlyTooCloseVersusNot&&this.letsSuppressLinks()},t.prototype.letsSuppressLinks=function(){for(var t=new e.StringMap,s=0,i=this.mamesh.vertices;s<i.length;s++)for(var r=i[s],n=0,o=!0;o&&r.links.length>=2;){o=!1;for(var a=n;a<n+r.links.length;a++){var h=a%r.links.length,l=(a+1)%r.links.length,u=e.XYZ.newFrom(r.links[h].to.position).substract(r.position),m=e.XYZ.newFrom(r.links[l].to.position).substract(r.position);if(e.geo.angleBetweenTwoVectorsBetween0andPi(u,m)<this.suppressLinksAngularParam){var c=e.geo.distance(r.position,r.links[h].to.position),p=e.geo.distance(r.position,r.links[l].to.position),g=void 0;if(this.keepShorterLinksVersusGiveSomePriorityToLinksWithOpposite)g=c<p?r.links[l]:r.links[h];else{var d=c/(c+p);g=d<.6&&d>.4?null==r.links[l].opposites&&null!=r.links[h].opposites?r.links[l]:r.links[h]:c<p?r.links[l]:r.links[h]}t.putValue(e.Hash.segment(r,g.to),!0),e.Vertex.separateTwoVoisins(r,g.to),o=!0,n=l+1;break}}}if(this.suppressTriAndQuadWhoseSideIsSuppressed){for(var f=[],v=[],h=0;h<this.mamesh.smallestTriangles.length;h+=3){var y=e.Hash.segment(this.mamesh.smallestTriangles[h],this.mamesh.smallestTriangles[h+1]),b=e.Hash.segment(this.mamesh.smallestTriangles[h+1],this.mamesh.smallestTriangles[h+2]),x=e.Hash.segment(this.mamesh.smallestTriangles[h+2],this.mamesh.smallestTriangles[h]);null==t.getValue(y)&&null==t.getValue(b)&&null==t.getValue(x)&&f.push(this.mamesh.smallestTriangles[h],this.mamesh.smallestTriangles[h+1],this.mamesh.smallestTriangles[h+2])}for(h=0;h<this.mamesh.smallestSquares.length;h+=4){var y=e.Hash.segment(this.mamesh.smallestSquares[h],this.mamesh.smallestSquares[h+1]),b=e.Hash.segment(this.mamesh.smallestSquares[h+1],this.mamesh.smallestSquares[h+2]),x=e.Hash.segment(this.mamesh.smallestSquares[h+2],this.mamesh.smallestSquares[h+3]),w=e.Hash.segment(this.mamesh.smallestSquares[h+3],this.mamesh.smallestSquares[h]);null==t.getValue(y)&&null==t.getValue(b)&&null==t.getValue(x)&&null==t.getValue(w)&&v.push(this.mamesh.smallestSquares[h],this.mamesh.smallestSquares[h+1],this.mamesh.smallestSquares[h+2],this.mamesh.smallestSquares[h+3])}this.mamesh.smallestTriangles=f,this.mamesh.smallestSquares=v}},t}();t.LinksSorterAndCleanerByAngles=i;var r=function(){function t(e){this.maxAngleToAssociateLinks=.3*Math.PI,this.clearAllExistingOppositeBefore=!0,this.canCreateBifurcations=!0,this.doNotBranchOnBorder=!1,this.OUT_nbBranching=0,this.vertices=e}return t.prototype.associateOppositeLinks=function(){var t=this;this.vertices.forEach(function(s){for(var i=0,r=0,n=s.links;r<n.length;r++)null==n[r].opposites&&i++;for(var o=[],a=0;a<s.links.length;a++)if(o[a]=new e.XYZ(0,0,0).copyFrom(s.links[a].to.position).substract(s.position),o[a].lengthSquared()<e.geo.epsilonSquare)throw"the IN_mamesh has two voisins at the same position";for(var h=[],l=[],a=0;a<s.links.length;a++){l[a]=Number.POSITIVE_INFINITY;for(var u=a+1;u<s.links.length;u++){var m=Math.abs(e.modulo(e.geo.angleBetweenTwoVectorsBetween0andPi(o[a],o[u])-Math.PI,2*Math.PI,!0));m<t.maxAngleToAssociateLinks&&null==s.links[a].opposites&&null==s.links[u].opposites&&(m<l[a]&&(l[a]=m),h.push({angle:m,i:a,j:u}))}}if(h.sort(function(e,t){return t.angle-e.angle}),!t.canCreateBifurcations||t.doNotBranchOnBorder&&s.hasMark(e.Vertex.Markers.border))for(;h.length>0;){var c=h.pop(),p=s.links[c.i],g=s.links[c.j];p.opposites=[g],g.opposites=[p],h=e.tab.arrayMinusElements(h,function(e){return e.i==c.i||e.j==c.i||e.i==c.j||e.j==c.j})}else for(;h.length>0;){var c=h.pop(),d=h[h.length-1],p=void 0,g=void 0,f=void 0;3==i&&null!=d?c.i==d.i?(p=s.links[c.i],g=s.links[c.j],f=s.links[d.j]):c.i==d.j?(p=s.links[c.i],g=s.links[c.j],f=s.links[d.i]):c.j==d.i?(p=s.links[c.j],g=s.links[c.i],f=s.links[d.j]):c.j==d.j?(p=s.links[c.j],g=s.links[c.i],f=s.links[d.i]):(p=s.links[c.i],g=s.links[c.j]):(p=s.links[c.i],g=s.links[c.j]),null==f?(p.opposites=[g],g.opposites=[p],h=e.tab.arrayMinusElements(h,function(e){return e.i==c.i||e.j==c.i||e.i==c.j||e.j==c.j}),i-=2):(t.OUT_nbBranching++,h.pop(),p.opposites=[g,f],g.opposites=[p],f.opposites=[p],i-=1,h=e.tab.arrayMinusElements(h,function(e){return e.i==c.i||e.j==c.i||e.i==c.j||e.j==c.j||e.i==d.i||e.j==d.i||e.i==d.j||e.j==d.j}))}})},t.prototype.goChanging=function(){this.clearAllExistingOppositeBefore&&this.vertices.forEach(function(e){e.links.forEach(function(e){e.opposites=null})}),null!=this.maxAngleToAssociateLinks&&this.associateOppositeLinks()},t}();t.OppositeLinkAssocierByAngles=r;var n=function(){function t(t){this.interiorTJonction=new e.HashMap,this.borderTJonction=new e.HashMap,this.forcedOpposite=new e.HashMap,this.polygonesAroundEachVertex=new e.HashMap,this.polygones=[],this.markIsolateVertexAsCorner=!0,this.markBorder=!0,this.forceOppositeLinksAtCorners=!1,this.mamesh=t}return t.prototype.goChanging=function(){this.checkArgs(),this.createPolygonesFromSmallestTrianglesAnSquares(),this.detectBorder(),this.createLinksTurningAround(),this.makeLinksFinaly()},t.prototype.checkArgs=function(){if(!(null!=this.mamesh.smallestSquares&&0!=this.mamesh.smallestSquares.length||null!=this.mamesh.smallestTriangles&&0!=this.mamesh.smallestTriangles.length))throw"no triangles nor squares given";this.mamesh.clearLinksAndLines()},t.prototype.createPolygonesFromSmallestTrianglesAnSquares=function(){for(var t=this,s=0;s<this.mamesh.smallestTriangles.length;s+=3)this.polygones.push(new o([this.mamesh.smallestTriangles[s],this.mamesh.smallestTriangles[s+1],this.mamesh.smallestTriangles[s+2]]));for(s=0;s<this.mamesh.smallestSquares.length;s+=4)this.polygones.push(new o([this.mamesh.smallestSquares[s],this.mamesh.smallestSquares[s+1],this.mamesh.smallestSquares[s+2],this.mamesh.smallestSquares[s+3]]));for(var i=0,r=this.polygones;i<r.length;i++)for(var n=r[i],a=n.points.length,s=0;s<a;s++){var h=n.points[s%a],l=n.points[(s+1)%a];this.subdivideSegment(n,h,l,this.mamesh.cutSegmentsDico)}this.mamesh.vertices.forEach(function(e){t.polygonesAroundEachVertex.putValue(e,new Array)}),this.polygones.forEach(function(e){e.points.forEach(function(s){t.polygonesAroundEachVertex.getValue(s).push(e)})}),this.markIsolateVertexAsCorner&&this.mamesh.vertices.forEach(function(s){1==t.polygonesAroundEachVertex.getValue(s).length&&(s.markers.push(e.Vertex.Markers.corner),e.logger.c("new corners was added when we automatically create then links from the triangulatedRect/square"))})},t.prototype.detectBorder=function(){for(var t=this,s=0;s<this.mamesh.vertices.length;s++){for(var i=this.mamesh.vertices[s],r=this.polygonesAroundEachVertex.getValue(i),n=new e.HashMap(!0),o=0,a=r;o<a.length;o++){var h=a[o].theTwoAnglesAdjacentFrom(i),l=h[0],u=h[1];null==n.getValue(l)?n.putValue(l,1):n.putValue(l,n.getValue(l)+1),null==n.getValue(u)?n.putValue(u,1):n.putValue(u,n.getValue(u)+1)}var m=0;if(n.allKeys().forEach(function(s){if(1==n.getValue(s))m++,null==t.borderTJonction.getValue(i)&&(t.borderTJonction.putValue(i,new Array),t.markBorder&&i.markers.push(e.Vertex.Markers.border)),t.borderTJonction.getValue(i).push(s);else if(n.getValue(s)>2)throw" non conform mesh: a link appear strictly more than 2 times as side of polygones turning around a vertex   "}),0!=m&&2!=m)throw"strange mesh (perhaps too holy): the vertex: "+i.toString(0)+" has:"+m+" link with multiplicity 1"}},t.prototype.createLinksTurningAround=function(){for(var t=this,s=function(s,i){var r=t.mamesh.cutSegmentsDico[e.Segment.segmentId(s.hashNumber,i.hashNumber)];null!=r&&(null!=t.interiorTJonction.getValue(r.middle)?console.log("attention, une double interiorTjonction"):t.interiorTJonction.putValue(r.middle,!0),t.forcedOpposite.putValue(r.middle,[s,i]))},i=0,r=this.polygones;i<r.length;i++){var n=r[i],o=n.points.length;if(o>3)if(4==o)s(n.points[0],n.points[2]),s(n.points[1],n.points[3]);else for(var a=0;a<o;a++)s(n.points[a],n.points[(a+2)%o])}this.mamesh.vertices.forEach(function(s){var i=t.polygonesAroundEachVertex.getValue(s);if(null!=t.borderTJonction.getValue(s)&&null!=t.interiorTJonction.getValue(s))throw"a vertex cannot be a interior and border T-jonction";if(null==t.borderTJonction.getValue(s)){var r=i[0];null==r?e.logger.c("some vertex was not around a square/triangulatedRect"):t.createLinksTurningFromOnePolygone(s,r,i,!1)}else{var n=t.findAPolygoneWithOrientedEdge(s,t.borderTJonction.getValue(s)[0],i);null==n&&(n=t.findAPolygoneWithOrientedEdge(s,t.borderTJonction.getValue(s)[1],i)),t.createLinksTurningFromOnePolygone(s,n,i,!0)}})},t.prototype.makeLinksFinaly=function(){var t=this;this.mamesh.vertices.forEach(function(s){if(t.forceOppositeLinksAtCorners||!s.hasMark(e.Vertex.Markers.corner)){var i=s.links.length;if(null!=t.borderTJonction.getValue(s)){var r=s.links[0],n=s.links[i-1];r.opposites=[n],n.opposites=[r]}else{if(i%2==0)for(var o=0;o<i;o++){var r=s.links[o],n=s.links[(o+i/2)%i];r.opposites=[n],n.opposites=[r]}if(null!=t.forcedOpposite.getValue(s)){var a=t.forcedOpposite.getValue(s)[0],h=t.forcedOpposite.getValue(s)[1];s.changeToLinkWithoutOpposite(a),s.changeToLinkWithoutOpposite(h),s.setTwoOppositeLinks(a,h)}}}})},t.prototype.findAPolygoneWithOrientedEdge=function(e,t,s){for(var i=0,r=s;i<r.length;i++)for(var n=r[i],o=n.points.length,a=0;a<o;a++)if(n.points[a%o].hashNumber==e.hashNumber&&n.points[(a+1)%o].hashNumber==t.hashNumber)return n;return null},t.prototype.findAPolygoneWithThisEdge=function(t,s,i){for(var r=0,n=i;r<n.length;r++)for(var o=n[r],a=o.points.length,h=0;h<a;h++)if(e.Segment.segmentId(o.points[h%a].hashNumber,o.points[(h+1)%a].hashNumber)==e.Segment.segmentId(t.hashNumber,s.hashNumber))return o;return null},t.prototype.createLinksTurningFromOnePolygone=function(t,s,i,r){for(var n=s.theOutgoingAnglesAdjacentFrom(t),o=s,a=!0;i.length>0;){if(t.links.push(new e.Link(n)),a)n=o.theIngoingAnglesAdjacentFrom(t);else{var h=o.theTwoAnglesAdjacentFrom(t);n=h[0].hashNumber==n.hashNumber?h[1]:h[0]}e.tab.removeFromArray(i,o),null==(o=this.findAPolygoneWithOrientedEdge(t,n,i))&&(o=this.findAPolygoneWithOrientedEdge(n,t,i),a=!1)}r&&t.links.push(new e.Link(n))},t.prototype.subdivideSegment=function(t,s,i,r){var n=r[e.Segment.segmentId(s.hashNumber,i.hashNumber)];if(null!=n){var o=t.points.indexOf(s),a=t.points.indexOf(i),h=Math.min(o,a);Math.max(o,a)==t.points.length-1&&0==h?t.points.splice(length,0,n.middle):t.points.splice(h+1,0,n.middle),this.subdivideSegment(t,s,n.middle,r),this.subdivideSegment(t,i,n.middle,r)}},t}();t.LinkCreatorSorterAndBorderDetectorByPolygons=n;var o=function(){function e(e){this.points=e}return e.prototype.hasAngle=function(e){for(var t=0,s=this.points;t<s.length;t++)if(s[t].hashNumber==e.hashNumber)return!0;return!1},e.prototype.theOutgoingAnglesAdjacentFrom=function(e){for(var t=this.points.length,s=0;s<t;s++)if(this.points[s]==e)return this.points[(s+1)%t];throw"we do not find the point in this polygone"},e.prototype.theIngoingAnglesAdjacentFrom=function(e){for(var t=this.points.length,s=0;s<t;s++)if(this.points[s]==e)return this.points[(s-1+t)%t];throw"we do not find the point in this polygone"},e.prototype.theTwoAnglesAdjacentFrom=function(e){for(var t=this.points.length,s=0;s<t;s++)if(this.points[s]==e)return[this.points[(s-1+t)%t],this.points[(s+1)%t]];throw"we do not find the point in this polygone"},e.prototype.toString=function(){for(var e="[",t=0,s=this.points;t<s.length;t++)e+=s[t].hashNumber+",";return e+"]"},e}();t.Polygone=o}(e.linkModule||(e.linkModule={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){var s=function(){function t(t){this.attractionOfTangent=new e.XYZ(1,.0123456721,.00078654343),this.computeTangent=!0,this.computeNormal=!0,this.computeSizes=!0,this.sizesProp=new e.XYZ(.3,.3,.3),this.allVerticesHaveSameSizes=!1,this.temp=new e.XYZ(0,0,0),this._side1=new e.XYZ(0,0,0),this._side2=new e.XYZ(0,0,0),this.mamesh=t}return t.prototype.checkArgs=function(){if(0==this.mamesh.smallestSquares.length&&0==this.mamesh.smallestTriangles.length)throw"no triangles nor Square. The normals cannot be computed"},t.prototype.go=function(){var t=this,s=new e.HashMap;if(0==this.mamesh.vertices.length)return void e.logger.c("you try to compute normal, tangent, diameter for an empty mamesh");if(this.mamesh.vertices.forEach(function(t){var i=new e.Positioning;i.position=t.position,i.upVector=new e.XYZ(0,0,0),i.frontDir=new e.XYZ(0,0,0),s.putValue(t,i)}),this.computeTangent&&this.mamesh.vertices.forEach(function(i){var r=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=new e.XYZ(0,0,0),a=new e.XYZ(0,0,0);if(0==i.links.length)throw"a vertex with no links. Impossible to compute a tangent";for(var h=t.attractionOfTangent.length(),l=0;l<i.links.length;l++)if(t.temp.copyFrom(i.links[l].to.position).substract(i.position),t.temp.length()<e.geo.epsilon)e.logger.c("a mamesh has two vertices at almost the same position");else{var u=e.geo.dot(t.temp,t.attractionOfTangent)/t.temp.length()/h;u>r&&(r=u,o.copyFrom(t.temp)),u<n&&(n=u,a.copyFrom(t.temp))}-n>2*r?s.getValue(i).frontDir.copyFrom(a.scale(-1)):s.getValue(i).frontDir.copyFrom(o)}),this.computeNormal){for(var i=[],r=0;r<this.mamesh.smallestTriangles.length/3;r++)this._side1.copyFrom(this.mamesh.smallestTriangles[3*r+1].position).substract(this.mamesh.smallestTriangles[3*r].position),this._side2.copyFrom(this.mamesh.smallestTriangles[3*r+2].position).substract(this.mamesh.smallestTriangles[3*r].position),i[r]=new e.XYZ(0,0,0),e.geo.cross(this._side1,this._side2,i[r]),i[r].normalize();for(var n=[],r=0;r<this.mamesh.smallestSquares.length/4;r++){this._side1.copyFrom(this.mamesh.smallestSquares[4*r+1].position).substract(this.mamesh.smallestSquares[4*r].position),this._side2.copyFrom(this.mamesh.smallestSquares[4*r+3].position).substract(this.mamesh.smallestSquares[4*r].position),n[r]=new e.XYZ(0,0,0),e.geo.cross(this._side1,this._side2,n[r]);try{n[r].normalize()}catch(e){throw"the square"+this.mamesh.smallestSquares[4*r].hashNumber+","+this.mamesh.smallestSquares[4*r+1].hashNumber+","+this.mamesh.smallestSquares[4*r+2].hashNumber+","+this.mamesh.smallestSquares[4*r+3].hashNumber+" is degenerated"}}for(r=0;r<i.length;r++){var o=this.mamesh.smallestTriangles[3*r],a=this.mamesh.smallestTriangles[3*r+1],h=this.mamesh.smallestTriangles[3*r+2];s.getValue(o).upVector.add(i[r]),s.getValue(a).upVector.add(i[r]),s.getValue(h).upVector.add(i[r])}for(r=0;r<n.length;r++){var o=this.mamesh.smallestSquares[4*r],a=this.mamesh.smallestSquares[4*r+1],h=this.mamesh.smallestSquares[4*r+2],l=this.mamesh.smallestSquares[4*r+3];s.getValue(o).upVector.add(n[r]),s.getValue(a).upVector.add(n[r]),s.getValue(h).upVector.add(n[r]),s.getValue(l).upVector.add(n[r])}var u=[];if(this.mamesh.vertices.forEach(function(t){try{s.getValue(t).upVector.normalize()}catch(s){e.logger.c("a too small upVector for a vertex, probably a vertex which is not in any polygone. The upVector will be the mean of other upVector"),u.push(t)}}),u.length>0){for(var m=new e.XYZ(0,0,0),c=0,p=this.mamesh.vertices;c<p.length;c++){var g=p[c];m.add(s.getValue(g).upVector)}try{m.normalize()}catch(e){throw"canot manage to compute upVector for any vertex"}for(var d=0,f=u;d<f.length;d++){var v=f[d];s.getValue(v).upVector.copyFrom(m)}}}if(this.computeSizes)if(this.allVerticesHaveSameSizes){var y=0,b=this.mamesh.vertices[0],x=0;b.links.forEach(function(t){x+=e.geo.distance(b.position,t.to.position)}),y=x/b.links.length,this.mamesh.vertices.forEach(function(e){return s.getValue(e).scaling.copyFrom(t.sizesProp).scale(y)})}else this.mamesh.vertices.forEach(function(i){var r=0;i.links.forEach(function(t){r+=e.geo.distance(i.position,t.to.position)}),s.getValue(i).scaling.copyFrom(t.sizesProp).scale(r/i.links.length)});return s},t}();t.PositioningComputerForMameshVertices=s}(e.mameshAroundComputations||(e.mameshAroundComputations={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){function s(t,s,i,r){if(null==i.middle){var n=new e.XYZ(0,0,0);e.geo.between(i.a.position,i.b.position,.5,n),i.middle=s.newVertex(n,Math.max(i.a.dichoLevel,i.b.dichoLevel)+1,t(i.a.param,i.b.param)),i.a.hasMark(e.Vertex.Markers.border)&&i.b.hasMark(e.Vertex.Markers.border)&&i.middle.markers.push(e.Vertex.Markers.border),null!=r&&(i.orth1=r)}else null!=r&&(i.orth2=r)}var i=function(){function t(t){this.makeLinks=!0,this.trianglesToCut=null,this.nbDicho=1,this.newParamForMiddle=function(t,s){var i=new e.XYZ(0,0,0);return e.geo.between(t,s,.5,i),i},this.mamesh=t}return t.prototype.checkArgs=function(){0==this.mamesh.smallestTriangles.length&&e.logger.c("no triangulatedRect for triangulatedRect dichotomy")},t.prototype.go=function(){this.checkArgs(),this.makeLinks||this.mamesh.clearLinksAndLines();var t;null==this.trianglesToCut?(this.trianglesToCut=this.mamesh.smallestTriangles,t=new Array):t=new e.tab.ArrayMinusBlocksElements(this.mamesh.smallestTriangles,3,this.trianglesToCut).go();for(var i=this.createAndAddSegmentsFromTriangles(this.trianglesToCut),r=0;r<this.trianglesToCut.length;r+=3){var n=this.trianglesToCut[r],o=this.trianglesToCut[r+1],a=this.trianglesToCut[r+2],h=i[e.Segment.segmentId(n.hashNumber,o.hashNumber)],l=i[e.Segment.segmentId(o.hashNumber,a.hashNumber)],u=i[e.Segment.segmentId(a.hashNumber,n.hashNumber)];this.makeLinks?(s(this.newParamForMiddle,this.mamesh,h,a),s(this.newParamForMiddle,this.mamesh,l,n),s(this.newParamForMiddle,this.mamesh,u,o)):(s(this.newParamForMiddle,this.mamesh,h),s(this.newParamForMiddle,this.mamesh,l),s(this.newParamForMiddle,this.mamesh,u));var m=h.middle,c=l.middle,p=u.middle;t.push(n,m,p),t.push(o,c,m),t.push(a,p,c),t.push(m,c,p)}if(this.makeLinks)for(var g in i){var d=i[g],f=i[e.Segment.segmentId(d.a.hashNumber,d.orth1.hashNumber)],v=i[e.Segment.segmentId(d.b.hashNumber,d.orth1.hashNumber)];if(null!=d.orth2){var y=i[e.Segment.segmentId(d.a.hashNumber,d.orth2.hashNumber)],b=i[e.Segment.segmentId(d.b.hashNumber,d.orth2.hashNumber)];d.middle.setTwoOppositeLinks(f.middle,b.middle),d.middle.setTwoOppositeLinks(y.middle,v.middle)}else d.middle.setOneLink(f.middle),d.middle.setOneLink(v.middle);try{var x=function(e,t,s){e.findLink(t).to=s};x(d.a,d.b,d.middle),x(d.b,d.a,d.middle),d.middle.setTwoOppositeLinks(d.a,d.b)}catch(e){throw"a bad segment, probably your triangles are not corrects (e.g. one missing, or one more)"}}this.mamesh.smallestTriangles=t},t.prototype.createAndAddSegmentsFromTriangles=function(e){for(var t={},s=0;s<e.length;s+=3){var i=e[s],r=e[s+1],n=e[s+2];this.mamesh.getOrCreateSegment(i,r,t),this.mamesh.getOrCreateSegment(r,n,t),this.mamesh.getOrCreateSegment(n,i,t)}return t},t}();t.TriangleDichotomer=i;var r=function(){function t(s){this.makeLinks=!0,this.squareToCut=null,this.dichoStyle=t.DichoStyle.fourSquares,this.newParamForMiddle=function(t,s){var i=new e.XYZ(0,0,0);return e.geo.between(t,s,.5,i),i},this.newParamForCenter=function(t,s,i,r){var n=new e.XYZ(0,0,0);return e.geo.baryCenter([t,s,i,r],[.25,.25,.25,.25],n),n},this.mamesh=s}return t.prototype.checkArgs=function(){if(0==this.mamesh.smallestSquares.length)throw"no square for square dichotomy";this.mamesh.clearLinksAndLines()},t.prototype.go=function(){this.checkArgs();var i;null==this.squareToCut?(this.squareToCut=this.mamesh.smallestSquares,i=new Array):i=new e.tab.ArrayMinusBlocksElements(this.mamesh.smallestSquares,4,this.squareToCut).go();for(var r=this.createAndAddSegmentsFromSquare(this.squareToCut),n=0;n<this.squareToCut.length;n+=4){var o=this.squareToCut[n],a=this.squareToCut[n+1],h=this.squareToCut[n+2],l=this.squareToCut[n+3],u=r[e.Segment.segmentId(o.hashNumber,a.hashNumber)],m=r[e.Segment.segmentId(a.hashNumber,h.hashNumber)],c=r[e.Segment.segmentId(h.hashNumber,l.hashNumber)],p=r[e.Segment.segmentId(l.hashNumber,o.hashNumber)];s(this.newParamForMiddle,this.mamesh,u),s(this.newParamForMiddle,this.mamesh,m),s(this.newParamForMiddle,this.mamesh,c),s(this.newParamForMiddle,this.mamesh,p);var g=u.middle,d=m.middle,f=c.middle,v=p.middle;if(this.dichoStyle==t.DichoStyle.fourSquares){var y=new e.XYZ(0,0,0);e.geo.baryCenter([u.a.position,u.b.position,c.a.position,c.b.position],[.25,.25,.25,.25],y);var b=Math.max(u.a.dichoLevel,u.b.dichoLevel,c.a.dichoLevel,c.b.dichoLevel)+1,x=this.mamesh.newVertex(y,b,this.newParamForCenter(u.a.param,u.b.param,c.a.param,c.b.param)),w=new e.Segment(g,f);w.middle=x,this.mamesh.cutSegmentsDico[e.Segment.segmentId(g.hashNumber,f.hashNumber)]=w,i.push(o,g,x,v),i.push(a,d,x,g),i.push(h,f,x,d),i.push(l,v,x,f)}else{if(this.dichoStyle!=t.DichoStyle.fourTriangles)throw"ho ho";i.push(g,d,f,v),this.mamesh.smallestTriangles.push(o,g,v),this.mamesh.smallestTriangles.push(a,d,g),this.mamesh.smallestTriangles.push(h,f,d),this.mamesh.smallestTriangles.push(l,v,f)}}this.mamesh.smallestSquares=i,this.makeLinks&&new e.linkModule.LinkCreatorSorterAndBorderDetectorByPolygons(this.mamesh).goChanging()},t.prototype.createAndAddSegmentsFromSquare=function(e){for(var t={},s=0;s<e.length;s+=4){var i=e[s],r=e[s+1],n=e[s+2],o=e[s+3];this.mamesh.getOrCreateSegment(i,r,t),this.mamesh.getOrCreateSegment(r,n,t),this.mamesh.getOrCreateSegment(n,o,t),this.mamesh.getOrCreateSegment(o,i,t)}return t},t}();t.SquareDichotomer=r;var n=function(){function t(t){this.makeLinks=!0,this.squareToCut=null,this.dichoStyle=r.DichoStyle.fourSquares,this.newParamForMiddle=function(t,s){var i=new e.XYZ(0,0,0);return e.geo.between(t,s,.5,i),i},this.newParamForCenter=function(t,s,i,r){var n=new e.XYZ(0,0,0);return e.geo.baryCenter([t,s,i,r],[.25,.25,.25,.25],n),n},this.mamesh=t}return t.prototype.checkArgs=function(){if(0==this.mamesh.smallestSquares.length)throw"no square for square dichotomy";this.mamesh.clearLinksAndLines()},t.prototype.go=function(){this.checkArgs();var t;null==this.squareToCut?(this.squareToCut=this.mamesh.smallestSquares,t=new Array):t=new e.tab.ArrayMinusBlocksElements(this.mamesh.smallestSquares,4,this.squareToCut).go();for(var i=this.createAndAddSegmentsFromSquare(this.squareToCut),n=0;n<this.squareToCut.length;n+=4){var o=this.squareToCut[n],a=this.squareToCut[n+1],h=this.squareToCut[n+2],l=this.squareToCut[n+3],u=i[e.Segment.segmentId(o.hashNumber,a.hashNumber)],m=i[e.Segment.segmentId(a.hashNumber,h.hashNumber)],c=i[e.Segment.segmentId(h.hashNumber,l.hashNumber)],p=i[e.Segment.segmentId(l.hashNumber,o.hashNumber)];s(this.newParamForMiddle,this.mamesh,u),s(this.newParamForMiddle,this.mamesh,m),s(this.newParamForMiddle,this.mamesh,c),s(this.newParamForMiddle,this.mamesh,p);var g=u.middle,d=m.middle,f=c.middle,v=p.middle;if(this.dichoStyle==r.DichoStyle.fourSquares){var y=new e.XYZ(0,0,0);e.geo.baryCenter([u.a.position,u.b.position,c.a.position,c.b.position],[.25,.25,.25,.25],y);var b=Math.max(u.a.dichoLevel,u.b.dichoLevel,c.a.dichoLevel,c.b.dichoLevel)+1,x=this.mamesh.newVertex(y,b,this.newParamForCenter(u.a.param,u.b.param,c.a.param,c.b.param)),w=new e.Segment(g,f);w.middle=x,this.mamesh.cutSegmentsDico[e.Segment.segmentId(g.hashNumber,f.hashNumber)]=w,t.push(o,g,x,v),t.push(a,d,x,g),t.push(h,f,x,d),t.push(l,v,x,f)}else{if(this.dichoStyle!=r.DichoStyle.fourTriangles)throw"ho ho";t.push(g,d,f,v),this.mamesh.smallestTriangles.push(o,g,v),this.mamesh.smallestTriangles.push(a,d,g),this.mamesh.smallestTriangles.push(h,f,d),this.mamesh.smallestTriangles.push(l,v,f)}}this.mamesh.smallestSquares=t,this.makeLinks&&new e.linkModule.LinkCreatorSorterAndBorderDetectorByPolygons(this.mamesh).goChanging()},t.prototype.createAndAddSegmentsFromSquare=function(e){for(var t={},s=0;s<e.length;s+=4){var i=e[s],r=e[s+1],n=e[s+2],o=e[s+3];this.mamesh.getOrCreateSegment(i,r,t),this.mamesh.getOrCreateSegment(r,n,t),this.mamesh.getOrCreateSegment(n,o,t),this.mamesh.getOrCreateSegment(o,i,t)}return t},t}();t.SimplestSquareDichotomer=n,function(e){!function(e){e[e.fourSquares=0]="fourSquares",e[e.fourTriangles=1]="fourTriangles"}(e.DichoStyle||(e.DichoStyle={}))}(r=t.SquareDichotomer||(t.SquareDichotomer={}));var o=function(){function t(e){this.subdivider=3,this.hexahedronsToCut=null,this.suppressVolumes=null,this.createdPointsPerSegment={},this.createdPointsPerSurface={},this.newHexahedrons=null,this.points=null,this.mamesh=e}return t.prototype.checkArgs=function(){(null==this.hexahedronsToCut&&0==this.mamesh.hexahedrons.length||null!=this.hexahedronsToCut&&0==this.hexahedronsToCut.length)&&e.logger.c("HexahedronSubdivider : No input")},t.prototype.go=function(){this.checkArgs(),null==this.hexahedronsToCut&&(this.hexahedronsToCut=this.mamesh.hexahedrons),this.points=new Array(this.subdivider+1);for(var e=0;e<=this.subdivider;e++){this.points[e]=new Array(this.subdivider+1);for(var t=0;t<=this.subdivider;t++)this.points[e][t]=new Array(this.subdivider+1)}this.subdivideHexahedrons()},t.prototype.subdivideHexahedronInVertices=function(t){var s=this,i=this.subdivider,r=[[0,0,0],[i,0,0],[i,0,i],[0,0,i],[0,i,i],[0,i,0],[i,i,0],[i,i,i]];r.forEach(function(e,i){var r=e[0],n=e[1],o=e[2];s.points[r][n][o]=s.hexahedronsToCut[t+i]});for(var n=0,o=[[0,1],[1,2],[2,3],[3,0],[0,5],[1,6],[2,7],[3,4],[4,5],[5,6],[6,7],[7,4]];n<o.length;n++){var a=o[n],h=a[0],l=a[1],u=e.Hash.segment(this.hexahedronsToCut[t+h],this.hexahedronsToCut[t+l]);this.hexahedronsToCut[t+h].hashNumber>this.hexahedronsToCut[t+l].hashNumber&&(I=[l,h],h=I[0],l=I[1]);for(var m=r[h],c=m[0],p=m[1],g=m[2],d=r[l],f=d[0],v=d[1],y=d[2],b=1;b<i;b++)this.points[c+(f-c)/i*b][p+(v-p)/i*b][g+(y-g)/i*b]=this.createdPointsPerSegment[u][b]}for(var x=0,w=[[0,1,2,3],[4,7,6,5],[0,3,4,5],[1,6,7,2],[2,7,4,3],[0,5,6,1]];x<w.length;x++){for(var T=w[x],h=T[0],l=T[1],V=T[2],M=T[3],u=e.Hash.quad(this.hexahedronsToCut[t+h],this.hexahedronsToCut[t+l],this.hexahedronsToCut[t+V],this.hexahedronsToCut[t+M]);this.hexahedronsToCut[t+h].hashNumber>this.hexahedronsToCut[t+l].hashNumber||this.hexahedronsToCut[t+h].hashNumber>this.hexahedronsToCut[t+V].hashNumber||this.hexahedronsToCut[t+h].hashNumber>this.hexahedronsToCut[t+M].hashNumber;)Y=[l,V,M,h],h=Y[0],l=Y[1],V=Y[2],M=Y[3];this.hexahedronsToCut[t+l].hashNumber>this.hexahedronsToCut[t+M].hashNumber&&(U=[M,l],l=U[0],M=U[1]);for(var S=r[h],c=S[0],p=S[1],g=S[2],k=r[l],f=k[0],v=k[1],y=k[2],O=r[V],A=O[0],L=O[1],C=O[2],b=1;b<i;b++)for(var N=1;N<i;N++)this.points[c+(f-c)/i*b+(A-f)/i*N][p+(v-p)/i*b+(L-v)/i*N][g+(y-g)/i*b+(C-y)/i*N]=this.createdPointsPerSurface[u][b][N]}for(var F=1;F<i;F++)for(var _=1;_<i;_++)for(var q=1;q<i;q++){var z=new e.XYZ(0,0,0),X=F/i,P=_/i,B=q/i;e.geo.baryCenter([this.hexahedronsToCut[t].position,this.hexahedronsToCut[t+1].position,this.hexahedronsToCut[t+2].position,this.hexahedronsToCut[t+3].position,this.hexahedronsToCut[t+4].position,this.hexahedronsToCut[t+5].position,this.hexahedronsToCut[t+6].position,this.hexahedronsToCut[t+7].position],[(1-X)*(1-P)*(1-B),X*(1-P)*(1-B),X*(1-P)*B,(1-X)*(1-P)*B,(1-X)*P*B,(1-X)*P*(1-B),X*P*(1-B),X*P*B],z),this.points[F][_][q]=this.mamesh.newVertex(z)}var I,Y,U},t.prototype.makeNewHexahedronsFromPoints=function(){null==this.suppressVolumes&&(this.suppressVolumes=[]);for(var e=this.subdivider,t=this,s=0;s<e;s++)!function(s){for(var i=0;i<e;i++)!function(i){for(var r=0;r<e;r++)!function(e){if(t.suppressVolumes.some(function(t){return t[0]==s&&t[1]==i&&t[2]==e}))return"continue";t.newHexahedrons.push.apply(t.newHexahedrons,[t.points[s][i][e],t.points[s+1][i][e],t.points[s+1][i][e+1],t.points[s][i][e+1],t.points[s][i+1][e+1],t.points[s][i+1][e],t.points[s+1][i+1][e],t.points[s+1][i+1][e+1]])}(r)}(i)}(s)},t.prototype.makeSurfacesVertices=function(){for(var t=[[0,1,2,3],[4,7,6,5],[0,3,4,5],[1,6,7,2],[2,7,4,3],[0,5,6,1]],s=0;s<this.hexahedronsToCut.length;s+=8)for(var i=0,r=t;i<r.length;i++){var n=r[i],o=n[0],a=n[1],h=n[2],l=n[3];null==this.createdPointsPerSurface[e.Hash.quad(this.hexahedronsToCut[s+o],this.hexahedronsToCut[s+a],this.hexahedronsToCut[s+h],this.hexahedronsToCut[s+l])]&&(this.createdPointsPerSurface[e.Hash.quad(this.hexahedronsToCut[s+o],this.hexahedronsToCut[s+a],this.hexahedronsToCut[s+h],this.hexahedronsToCut[s+l])]=this.subdivideSurface(this.hexahedronsToCut[s+o],this.hexahedronsToCut[s+a],this.hexahedronsToCut[s+h],this.hexahedronsToCut[s+l]))}},t.prototype.makeSegmentsVertices=function(){for(var t=[[0,1],[1,2],[2,3],[3,0],[0,5],[1,6],[2,7],[3,4],[4,5],[5,6],[6,7],[7,4]],s=0;s<this.hexahedronsToCut.length;s+=8)for(var i=0,r=t;i<r.length;i++){var n=r[i],o=n[0],a=n[1];null==this.createdPointsPerSegment[e.Hash.segment(this.hexahedronsToCut[s+o],this.hexahedronsToCut[s+a])]&&(this.createdPointsPerSegment[e.Hash.segment(this.hexahedronsToCut[s+o],this.hexahedronsToCut[s+a])]=this.subdivideSegment(this.hexahedronsToCut[s+o],this.hexahedronsToCut[s+a]))}},t.prototype.subdivideSegment=function(t,s){t=(h=e.Hash.segmentOrd(t,s))[0],s=h[1];for(var i=[],r=this.subdivider,n=1;n<r;n++){var o=new e.XYZ(0,0,0),a=n/r;e.geo.baryCenter([t.position,s.position],[1-a,a],o),i[n]=this.mamesh.newVertex(o)}return i;var h},t.prototype.subdivideSurface=function(t,s,i,r){t=(p=e.Hash.quadOrd(t,s,i,r))[0],s=p[1],i=p[2],r=p[3];for(var n=[],o=this.subdivider,a=1;a<o;a++){n[a]=[];for(var h=1;h<o;h++){var l=new e.XYZ(0,0,0),u=[h/o,a/o],m=u[0],c=u[1];e.geo.baryCenter([t.position,s.position,i.position,r.position],[(1-m)*(1-c),m*(1-c),m*c,(1-m)*c],l),n[a][h]=this.mamesh.newVertex(l)}}return n;var p},t.prototype.subdivideHexahedrons=function(){this.makeSegmentsVertices(),this.makeSurfacesVertices();var e=this.hexahedronsToCut.length/8;this.newHexahedrons=[];for(var t=0;t<e;t++)this.subdivideHexahedronInVertices(8*t),this.makeNewHexahedronsFromPoints()},t}();t.HexahedronSubdivider=o;var a=function(){function t(e){this.hexahedronsToDraw=null,this.newSurfaces=null,this.surfacesSet={},this.mamesh=e}return t.prototype.checkArgs=function(){(null==this.hexahedronsToDraw&&(null==this.mamesh.hexahedrons||0==this.mamesh.hexahedrons.length)||null!=this.hexahedronsToDraw&&0==this.hexahedronsToDraw.length)&&e.logger.c("SurfacesFromHexahedrons : No input")},t.prototype.go=function(){this.checkArgs(),null==this.hexahedronsToDraw&&(this.hexahedronsToDraw=this.mamesh.hexahedrons);var t=[[0,3,2,1],[4,5,6,7],[0,5,4,3],[1,2,7,6],[2,3,4,7],[0,1,6,5]];this.newSurfaces=[];for(var s=0;s<this.hexahedronsToDraw.length;s+=8)for(var i=0,r=t;i<r.length;i++){var n=r[i],o=n[0],a=n[1],h=n[2],l=n[3],u=e.Hash.quad(this.hexahedronsToDraw[s+o],this.hexahedronsToDraw[s+a],this.hexahedronsToDraw[s+h],this.hexahedronsToDraw[s+l]);null==this.surfacesSet[u]?this.surfacesSet[u]=[this.hexahedronsToDraw[s+o],this.hexahedronsToDraw[s+a],this.hexahedronsToDraw[s+h],this.hexahedronsToDraw[s+l]]:delete this.surfacesSet[u]}for(var m in this.surfacesSet)this.newSurfaces.push.apply(this.newSurfaces,this.surfacesSet[m]);for(var c=this.newSurfaces.length,o=0;o<c;o+=5e3)this.mamesh.smallestSquares.push.apply(this.mamesh.smallestSquares,this.newSurfaces.slice(o,o+5e3))},t}();t.SurfacesFromHexahedrons=a;var h=function(){function t(e){this.copyCutSegmentsDico=!0,this.copyLines=!0,this.oldMamesh=e}return t.prototype.go=function(){var t=new e.HashMap,s=new e.Mamesh;if(this.oldMamesh.vertices.forEach(function(i){var r=e.XYZ.newFrom(i.param),n=s.newVertex(i.position,i.dichoLevel,r);t.putValue(i,n),n.importantMarker=i.importantMarker,i.markers.forEach(function(e){return n.markers.push(e)})}),this.oldMamesh.vertices.forEach(function(s){for(var i=t.getValue(s),r=0;r<s.links.length;r++)i.links[r]=new e.Link(t.getValue(s.links[r].to));for(r=0;r<s.links.length;r++){var n=s.links[r],o=i.links[r];if(null!=n.opposites){o.opposites=[];for(var a=0,h=n.opposites;a<h.length;a++){var l=h[a],u=s.links.indexOf(l);o.opposites.push(i.links[u])}}}}),this.oldMamesh.smallestTriangles.forEach(function(e){s.smallestTriangles.push(t.getValue(e))}),this.oldMamesh.smallestSquares.forEach(function(e){s.smallestSquares.push(t.getValue(e))}),this.copyLines&&this.oldMamesh.linesWasMade){var i=this.oldMamesh.getStraightLinesAsVertices(),r=this.oldMamesh.getLoopLinesAsVertices();s.lines=[],i.forEach(function(i){var r=[];i.forEach(function(e){r.push(t.getValue(e))}),s.lines.push(new e.Line(r,!1))}),r.forEach(function(i){var r=[];i.forEach(function(e){r.push(t.getValue(e))}),s.lines.push(new e.Line(r,!0))})}if(this.copyCutSegmentsDico)for(var n in this.oldMamesh.cutSegmentsDico){var o=this.oldMamesh.cutSegmentsDico[n],a=t.getValue(o.a),h=t.getValue(o.b),l=new e.Segment(a,h);l.middle=t.getValue(o.middle),null!=o.orth1&&(l.orth1=t.getValue(o.orth1)),null!=o.orth2&&(l.orth2=t.getValue(o.orth2)),s.cutSegmentsDico[e.Segment.segmentId(a.hashNumber,h.hashNumber)]=l}else this.copyCutSegmentsDico=null;return s},t}();t.MameshDeepCopier=h;var l=function(){function t(t){var s=this;this.percolationProba=.5,this.probaToPercolateFunction=function(e){return 3==e.links.length?0:4==e.links.length?.3*s.percolationProba:5==e.links.length?.6*s.percolationProba:e.links.length>=6?s.percolationProba:void 0},this.SUB_random=new e.proba.Random,this.doNotPercolateOnBorder=!0,this.maxPercolationForAVertexAlreadyPercolate=0,t instanceof e.Mamesh?this.IN_vertices=t.vertices:this.IN_vertices=t}return t.prototype.goChanging=function(){if(null==this.IN_vertices)throw"vertices must be specifiate";for(var t=new e.HashMap,s=0,i=this.IN_vertices;s<i.length;s++){o=i[s];t.putValue(o,o.links.length)}for(var r=0,n=this.IN_vertices;r<n.length;r++){var o=n[r];if((!this.doNotPercolateOnBorder||!o.hasMark(e.Vertex.Markers.border))&&this.SUB_random.pseudoRand()<this.probaToPercolateFunction(o)){var a=this.SUB_random.pseudoRandInt(o.links.length),h=o.links[a].to;h.links.length>=t.getValue(h)-this.maxPercolationForAVertexAlreadyPercolate&&e.Vertex.separateTwoVoisins(o,h)}}},t}();t.PercolationOnLinks=l}(e.mameshModification||(e.mameshModification={}))}(mathis||(mathis={}));var mathis;!function(e){var t=function(){function t(e,t){void 0===t&&(t=[]),this.mamesh=e,this.doNotMoveMe=t,this.nbIteration=10}return t.prototype.goChanging=function(){for(var t=new e.HashMap,s=0,i=this.doNotMoveMe;s<i.length;s++){a=i[s];t.putValue(a,!0)}for(var r=0;r<this.nbIteration;r++)for(var n=0,o=this.mamesh.vertices;n<o.length;n++){var a=o[n];if(null==t.getValue(a)){for(var h=[],l=0,u=a.links;l<u.length;l++){var m=u[l];h.push(m.to.position)}e.geo.baryCenter(h,null,a.position)}}},t}();e.MameshSmoother=t;!function(t){var s=function(){function t(e,t){this.mamesh=e,this.vertexToNormal=t}return t.prototype.goChanging=function(){this.goForQuad(),this.goForTriangle()},t.prototype.goForQuad=function(){for(var t=[],s=0;s<this.mamesh.smallestSquares.length;s+=4){var i=this.mamesh.smallestSquares[s],r=this.mamesh.smallestSquares[s+1],n=this.mamesh.smallestSquares[s+2],o=this.mamesh.smallestSquares[s+3],a=this.vertexToNormal.getValue(i),h=e.XYZ.newFrom(r.position).substract(i.position),l=e.XYZ.newFrom(i.position).substract(o.position);e.geo.angleBetweenTwoVectorsBetweenMinusPiAndPi(l,h,a)<0?t.push(o,n,r,i):t.push(i,r,n,o)}this.mamesh.smallestSquares=t},t.prototype.goForTriangle=function(){for(var t=[],s=0;s<this.mamesh.smallestTriangles.length;s+=3){var i=this.mamesh.smallestTriangles[s],r=this.mamesh.smallestTriangles[s+1],n=this.mamesh.smallestTriangles[s+2],o=this.vertexToNormal.getValue(i),a=e.XYZ.newFrom(r.position).substract(i.position),h=e.XYZ.newFrom(i.position).substract(n.position);e.geo.angleBetweenTwoVectorsBetweenMinusPiAndPi(h,a,o)<0?t.push(n,r,i):t.push(i,r,n)}this.mamesh.smallestTriangles=t},t}();t.PolygonTurner=s;var i=function(){function t(t){this.mamesh=t,this.normalizeNormals=!0,this.neighborhoodSize_forSmoothing=0,this.OUT_vertexWithoutNaturalNormal=[],this.temp0=new e.XYZ(0,0,0),this.temp1=new e.XYZ(0,0,0),this.OUT_vertexToStrate=new e.HashMap(!0)}return t.prototype.go=function(){if(null==this.mamesh)throw"the mamesh is null";for(var t=new e.HashMap(!0),s=0,i=this.mamesh.vertices;s<i.length;s++)0==(a=i[s]).links.length&&t.putValue(a,!0);t.allKeys().length>0&&(e.logger.c("there are:"+t.allKeys().length+" isolated vertices. They are removed from your mamesh"),this.mamesh.vertices=e.tab.arrayMinusElements(this.mamesh.vertices,function(e){return t.getValue(e)}));for(var r=new e.HashMap(!0),n=0,o=this.mamesh.vertices;n<o.length;n++){var a=o[n],h=this.oneNormalComputation(a);null!=h?r.putValue(a,h):this.OUT_vertexWithoutNaturalNormal.push(a)}this.OUT_vertexWithoutNaturalNormal.length>0&&e.logger.c("there is :"+this.OUT_vertexWithoutNaturalNormal.length+" vertices without a natural normal. We will associate to them the normal of one of their neighbor");for(var l=new e.HashMap,u=0,m=this.mamesh.vertices;u<m.length;u++){a=m[u];null!=r.getValue(a)&&l.putValue(a,a)}for(var c=0,p=l.oneValue();null!=p&&c<1e3;)this.aligningNormals(r,p,l),p=l.oneValue(),c++;if(1e3==c)throw"more than 1000 connected component in this mamesh. Strange";var g;if(this.neighborhoodSize_forSmoothing>0){g=new e.HashMap(!0);for(var d=0,f=this.mamesh.vertices;d<f.length;d++){var v=f[d];g.putValue(v,this.smoothingByNeighbors(v,r))}}else g=r;for(var y=[],b=0,x=g.allKeys();b<x.length;b++){a=x[b];null==g.getValue(a)&&y.push(a)}if(y.length>0){e.logger.c("strange: there is:"+y.length+" vertex with null normal associated");for(var w=0,T=y;w<T.length;w++){a=T[w];g.removeKey(a)}}return g},t.prototype.smoothingByNeighbors=function(t,s){for(var i=new e.HashMap,r=[t],n=[],o=0;o<this.neighborhoodSize_forSmoothing;o++)r=e.graph.getEdge(r,i),n=n.concat(r);for(var a=[],h=0,l=n;h<l.length;h++){var u=l[h];a.push(s.getValue(u))}var m=new e.XYZ(0,0,0);return e.geo.baryCenter(a,null,m),m},t.prototype.oneNormalComputation=function(t){if(t.links.length<2)return e.logger.c("cannot compute normal for vertex with nbLinks<2"),null;for(var s=new e.XYZ(0,0,0),i=new e.XYZ(0,0,0),r=0,n=t.links.length,o=0;o<n;o++)for(var a=o+1;a<n;a++){var h=this.temp0.copyFrom(t.links[o].to.position).substract(t.position),l=this.temp1.copyFrom(t.links[a].to.position).substract(t.position);e.geo.cross(h.normalize(),l.normalize(),s);var u=s.length();u>r&&(r=u,i.copyFrom(s))}return r<100*e.geo.epsilon&&r<e.geo.epsilon?(e.logger.c("Cannot compute normal : all in the links are on the same line"),null):(this.normalizeNormals&&i.scale(1/r),i)},t.prototype.oneFastComputation=function(t){if(t.links.length<2)return e.logger.c("cannot compute normal for vertex with nbLinks<2"),null;var s=new e.XYZ(0,0,0),i=this.temp0.copyFrom(t.links[0].to.position).substract(t.position),r=this.temp1.copyFrom(t.links[1].to.position).substract(t.position);e.geo.cross(i.normalize(),r.normalize(),s);var n=s.length();return n<.2&&t.links.length>=3&&(r=this.temp1.copyFrom(t.links[2].to.position).substract(t.position),e.geo.cross(i.normalize(),r.normalize(),s),n=s.length()),n<e.geo.epsilon?(e.logger.c("Cannot compute at least one normal  with the fast technik : try the slow method"),null):(this.normalizeNormals&&s.scale(1/n),s)},t.prototype.aligningNormals=function(t,s,i){i.removeKey(s);for(var r=[],n=new e.HashMap,o=[s],a=0;o.length>0&&a<1e4;)a++,r.push(o),o=e.graph.getEdge(o,n);if(1e4==a)throw"too many strates";this.OUT_vertexToStrate.putValue(s,0);for(var h=1;h<r.length;h++)for(var l=0,u=r[h];l<u.length;l++){var m=u[l];this.OUT_vertexToStrate.putValue(m,h),i.removeKey(m);for(var c=0,p=m.links;c<p.length;c++){var g=p[c];if(this.OUT_vertexToStrate.getValue(g.to)==h-1){var d=t.getValue(g.to),f=t.getValue(m);if(null==f){if(null==d)throw"previousNormal is null";t.putValue(m,e.XYZ.newFrom(d))}else{var v=e.geo.dot(d,f);if(Math.abs(v)<e.geo.epsilon)throw"two neighbor vertices have orthogonal vertex. Your mamesh is too irregular";v<0&&f.scale(-1)}break}}}},t}();t.NormalComputerFromLinks=i;var r=function(){function t(e){this.nbBiggerFacesDeleted=1,this.areaVsPerimeter_toDetectBiggerFaces=!1,this.useBarycenterToCutPolygons=!0,this.mamesh=e}return t.prototype.polygonsDetection=function(t){function i(s,r,n,o){if(++s>1e3)throw"too many recursion when we build a polygon";for(var a=[],h=r[r.length-1],l=r[r.length-2],m=0,c=h.links;m<c.length;m++){var p=c[m];if(p.to!=l){var g=p.to,d=(e.Hash.orientedSegment(h,g),e.XYZ.newFrom(l.position).substract(h.position)),f=e.XYZ.newFrom(p.to.position).substract(h.position),v=e.geo.angleBetweenTwoVectorsBetween0And2Pi(f,d,t.getValue(h))+Math.PI;a.push({vertex:g,angle:v})}}if(a.length>0){a.sort(u);var y=a[0].vertex,b=e.Hash.orientedSegment(h,y);return null!=n.getValue(b)?(r.pop(),r):null==o.getValue(b)?(e.Vertex.separateTwoVoisins(l,h),o.removeKey(e.Hash.orientedSegment(l,h)),r.pop(),r.length>1?i(s,r,n,o):null):(r.push(y),n.putValue(e.Hash.orientedSegment(h,y),!0),i(s,r,n,o))}return e.Vertex.separateTwoVoisins(l,h),o.removeKey(e.Hash.orientedSegment(l,h)),r.pop(),r.length>1?i(s,r,n,o):null}new s(this.mamesh,t).goChanging();for(var r=new e.StringMap,n=0;n<this.mamesh.smallestSquares.length;n+=4){var o=this.mamesh.smallestSquares[n],a=this.mamesh.smallestSquares[n+1],h=this.mamesh.smallestSquares[n+2],l=this.mamesh.smallestSquares[n+3];r.putValue(e.Hash.orientedSegment(o,a),!0),r.putValue(e.Hash.orientedSegment(a,h),!0),r.putValue(e.Hash.orientedSegment(h,l),!0),r.putValue(e.Hash.orientedSegment(l,o),!0)}for(n=0;n<this.mamesh.smallestTriangles.length;n+=3){var o=this.mamesh.smallestTriangles[n],a=this.mamesh.smallestTriangles[n+1],h=this.mamesh.smallestTriangles[n+2];r.putValue(e.Hash.orientedSegment(o,a),!0),r.putValue(e.Hash.orientedSegment(a,h),!0),r.putValue(e.Hash.orientedSegment(h,o),!0)}for(var u=function(e,t){return e.angle-t.angle},m=new e.StringMap,c=0,p=this.mamesh.vertices;c<p.length;c++)for(var g=p[c],d=0,f=g.links;d<f.length;d++){var v=f[d],y=e.Hash.orientedSegment(g,v.to);null==r.getValue(y)&&m.putValue(y,[g,v.to])}for(var b=[],x=m.oneValue(),w=0;null!=x&&w<1e4;){w++;var T=[x[0],x[1]],V=new e.StringMap;V.putValue(e.Hash.orientedSegment(x[0],x[1]),!0);if(null!=(T=i(0,T,V,m))){b.push(T);for(var M=0,S=V.allKeys();M<S.length;M++){var k=S[M];m.removeKey(k)}}x=m.oneValue()}if(1e4==w)throw"we turn too mush on the mamesh";return b},t.prototype.suppressionOfLinksAppearingTwiceInOnePolygon=function(t){for(var s=[],i=[],r=0;r<t.length;r++)for(var n=t[r],o=new e.StringMap,a=!1,h=0;h<n.length;h++){var l=e.Hash.segment(n[h],n[(h+1)%n.length]),u=o.getValue(l);if(null==u)o.putValue(l,1);else{if(1!=u)throw"a segment appears more than two times in the same polygon";o.putValue(l,2),a||s.push(r),a=!0,i.push([n[h],n[(h+1)%n.length]])}}this.floatedLinksSuppression(i,s,t),this.reorderFloatingPolygon(s,t)},t.prototype.floatedLinksSuppression=function(t,s,i){for(var r=0,n=t;r<n.length;r++){var o=n[r];if(e.Vertex.separateTwoVoisins(o[0],o[1]),o[0].links.length<1){for(var a=0,h=s;a<h.length;a++)for(var l=0,u=g=i[p=h[a]];l<u.length;l++)if((v=u[l])==o[0]){e.tab.removeFromArray(g,o[0]);break}e.tab.removeFromArray(this.mamesh.vertices,o[0])}if(o[1].links.length<1){for(var m=0,c=s;m<c.length;m++)for(var p=c[m],g=i[p],d=0,f=g;d<f.length;d++){var v=f[d];if(v==o[1]){e.tab.removeFromArray(g,o[1]);break}}e.tab.removeFromArray(this.mamesh.vertices,o[1])}}},t.prototype.reorderFloatingPolygon=function(e,t){for(var s=0,i=e;s<i.length;s++){for(var r=i[s],n=t[r],o=[],a=n[0],h=n[0],l=void 0,u=!0,m=0,c=h.links;m<c.length;m++){var p=c[m];if(-1!=n.indexOf(p.to)){l=p.to;break}}o.push(h);for(var g=!0;g;){if(l!=a){for(var d=0,f=l.links;d<f.length;d++)if((p=f[d]).to!=h&&-1!=n.indexOf(p.to)){o.push(l),h=l,l=p.to,u=!1;break}}else g=!1;u&&(g=!1)}t[r]=o}},t.prototype.areaAndPerimeterComputation=function(t){for(var s=[],i=[],r=0,n=-1,o=0,a=t;o<a.length;o++){var h=a[o];if(n++,3==h.length){var l=e.geo.distance(h[0].position,h[1].position),u=e.geo.distance(h[0].position,h[2].position),m=e.geo.distance(h[1].position,h[2].position);if(this.areaVsPerimeter_toDetectBiggerFaces){var c=(l+u+m)/2,p=Math.sqrt(c*(c-l)*(c-u)*(c-m));s.push(p)}else{x=l+u+m;s.push(x)}}else if(4==h.length){var l=e.geo.distance(h[0].position,h[1].position),u=e.geo.distance(h[1].position,h[2].position),m=e.geo.distance(h[2].position,h[3].position),g=e.geo.distance(h[3].position,h[0].position),d=e.geo.distance(h[0].position,h[2].position);if(this.areaVsPerimeter_toDetectBiggerFaces){var f=(l+u+d)/2,v=Math.sqrt(f*(f-l)*(f-u)*(f-d)),y=(m+g+d)/2,b=Math.sqrt(y*(y-m)*(y-g)*(y-d));s.push(v+b)}else{var x=l+u+m+g;s.push(x)}}else if(h.length>=5){var w=(new e.Vertex).setPosition(0,0,0);r=1/h.length;for(var T=[],V=[],M=0,S=h;M<S.length;M++){var k=S[M];T.push(k.position),V.push(r)}e.geo.baryCenter(T,V,w.param);var O=(new e.Vertex).setPosition(w.param.x,w.param.y,w.param.z),A=0;if(this.areaVsPerimeter_toDetectBiggerFaces)for(_=0;_<h.length;_++){var L=((l=e.geo.distance(h[_].position,h[(_+1)%h.length].position))+(u=e.geo.distance(h[(_+1)%h.length].position,O.position))+(m=e.geo.distance(O.position,h[_].position)))/2;A+=Math.sqrt(L*(L-l)*(L-u)*(L-m))}else for(_=0;_<h.length;_++)A+=l=e.geo.distance(h[_].position,h[(_+1)%h.length].position);s.push(A),i[n]=O}}for(var C=0;C<this.nbBiggerFacesDeleted;C++){for(var N=-1,F=-1,_=0;_<s.length;_++)s[_]>N&&(N=s[_],F=_);s[F]=-1,t[F]=[]}return i},t.prototype.fillConvexSurface=function(t,s){s.markers.push(e.Vertex.Markers.polygonCenter),this.mamesh.vertices.push(s);for(var i=0;i<t.length;i++)this.mamesh.addATriangle(t[i],t[(i+1)%t.length],s),t[i].setOneLink(s),s.setOneLink(t[i])},t.prototype.fillNoConvexSurface=function(t,s){for(;t.length>=3;){for(var i=new e.HashMap,r=!1,n=0;n<t.length;n+=1){var o=void 0,a=void 0,h=t[n];o=0==n?t[t.length-1]:t[n-1],a=n==t.length-1?t[0]:t[n+1];var l=new e.XYZ(o.position.x-h.position.x,o.position.y-h.position.y,o.position.z-h.position.z),u=new e.XYZ(a.position.x-h.position.x,a.position.y-h.position.y,a.position.z-h.position.z);e.geo.angleBetweenTwoVectorsBetweenMinusPiAndPi(l,u,s.getValue(t[n]))<0?(i.putValue(h,!1),r=!0):i.putValue(h,!0)}for(var m=!0,n=0;n<t.length&&m;n++){var o=void 0,a=void 0,c=void 0,h=t[n];o=0==n?t[t.length-1]:t[n-1],a=n==t.length-1?t[0]:t[n+1],c=n==t.length-2?t[0]:n==t.length-1?t[1]:t[n+2],r?i.getValue(h)||(h.setOneLink(c),c.setOneLink(h),this.mamesh.addATriangle(h,a,c),e.tab.removeFromArray(t,a),m=!1):(o.setOneLink(a),a.setOneLink(o),this.mamesh.addATriangle(o,h,a),e.tab.removeFromArray(t,h),m=!1)}}},t.prototype.go=function(){if(null==this.mamesh)throw"the mamesh is null";this.SUB_NormalComputer=new i(this.mamesh),this.mamesh.vertices=e.tab.arrayMinusElements(this.mamesh.vertices,function(e){return 0==e.links.length}),cc("this.OUT_vertexToNormal",this.OUT_vertexToNormal),this.OUT_vertexToNormal=this.SUB_NormalComputer.go();var t=this.polygonsDetection(this.OUT_vertexToNormal);this.suppressionOfLinksAppearingTwiceInOnePolygon(t);for(var s=this.areaAndPerimeterComputation(t),r=-1,n=0,o=t;n<o.length;n++){var a=o[n];if(r++,3==a.length)this.mamesh.addATriangle(a[0],a[1],a[2]);else if(4==a.length)this.mamesh.addASquare(a[0],a[1],a[2],a[3]);else if(a.length>=5)if(this.useBarycenterToCutPolygons){var h=s[r];this.fillConvexSurface(a,h)}else this.fillNoConvexSurface(a,this.OUT_vertexToNormal)}},t}();t.PolygonFinderFromLinks=r}(e.polygonFinder||(e.polygonFinder={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){function s(e,t,s,i){l.copyFromFloats(e.param.x,e.param.y,e.param.z).add(t);var r=i.getValue(l);l.copyFromFloats(e.param.x,e.param.y,e.param.z).add(s);var n=i.getValue(l);null!=r&&null!=n?e.setTwoOppositeLinks(r,n):null==r&&null!=n?e.setOneLink(n):null!=r&&null==n&&e.setOneLink(r)}function i(e,t,s,i,r){var n=e;if(null!=n){var o=r.getValue(u.copyFrom(e.param).add(s));if(null!=o){var a=r.getValue(u.copyFrom(e.param).add(s).add(i));if(null!=a){var h=r.getValue(u.copyFrom(e.param).add(i));null!=h&&t.addASquare(n,o,a,h)}}}}var r=function(){function t(e){this.makeLinks=!0,this.markCorners=!0,this.addALoopLineAround=!1,this.mamesh=e}return t.prototype.go=function(){var t=this.mamesh.newVertex(new e.XYZ(0,0,0)),s=this.mamesh.newVertex(new e.XYZ(0,1,0)),i=this.mamesh.newVertex(new e.XYZ(1,0,0));this.mamesh.addATriangle(t,s,i),this.markCorners&&(t.markers.push(e.Vertex.Markers.corner),s.markers.push(e.Vertex.Markers.corner),i.markers.push(e.Vertex.Markers.corner)),this.makeLinks&&(this.addALoopLineAround?(t.setTwoOppositeLinks(s,i),s.setTwoOppositeLinks(i,t),i.setTwoOppositeLinks(t,s)):(t.setOneLink(s),t.setOneLink(i),s.setOneLink(t),s.setOneLink(i),i.setOneLink(t),i.setOneLink(s)))},t}();t.SingleTriangle=r;var n=function(){function t(){this.markCorner=!0,this.markBorder=!0,this.origin=new e.XYZ(0,0,0),this.end=new e.XYZ(2,1,0),this.nbU=6}return t.prototype.go=function(){var t=new g;t.nbU=this.nbU+1,t.nbV=this.nbU+1,t.origin=new e.XYZ(0,0,0),t.end=new e.XYZ(2,1,0),t.putAVertexOnlyAtXYZCheckingThisCondition=function(e){return e.y<=e.x+1e-4&&e.y<2-e.x+1e-4},t.maille=p.triangleH;var s=t.go();if(this.origin.almostEqual(new e.XYZ(0,0,0))&&this.end.almostEqual(new e.XYZ(2,1,0))||e.spacialTransformations.adjustInASquare(s,this.origin,this.end),this.markCorner)for(var i=0,r=s.vertices;i<r.length;i++)2==(a=r[i]).links.length&&a.markers.push(e.Vertex.Markers.corner);if(this.markBorder)for(var n=0,o=s.vertices;n<o.length;n++){var a=o[n];a.links.length<=4&&a.markers.push(e.Vertex.Markers.border)}return s},t}();t.TriangulatedTriangle=n;var o=function(){function t(){this.markCorner=!0,this.markBorder=!0,this.origin=new e.XYZ(-1,-1,0),this.end=new e.XYZ(1,1,0),this.nbSubdivisionInSide=6,this.setAllDichoLevelTo0=!0,this.mamesh=new e.Mamesh}return t.prototype.go=function(){for(var t=0;t<3;t++){var s=new e.XYZ(Math.cos(2*Math.PI*t/3-Math.PI/2),Math.sin(2*Math.PI*t/3-Math.PI/2),0),i=e.XYZ.newFrom(s);(m=this.mamesh.newVertex(i,0,s)).markers.push(e.Vertex.Markers.corner)}this.mamesh.addATriangle(this.mamesh.vertices[0],this.mamesh.vertices[1],this.mamesh.vertices[2]);for(var r=Math.floor(Math.log(this.nbSubdivisionInSide)/Math.log(2)),n=0;n<r;n++)(o=new e.mameshModification.TriangleDichotomer(this.mamesh)).makeLinks=!1,o.go();if(Math.pow(2,r)!=this.nbSubdivisionInSide){var o=new e.mameshModification.TriangleDichotomer(this.mamesh);o.makeLinks=!1,o.go()}var a=new e.linkModule.LinkCreatorSorterAndBorderDetectorByPolygons(this.mamesh);if(a.markIsolateVertexAsCorner=!1,a.goChanging(),Math.pow(2,r)!=this.nbSubdivisionInSide){var h=new e.grateAndGlue.ExtractCentralPart(this.mamesh,Math.floor((Math.pow(2,r+1)-this.nbSubdivisionInSide)/3));h.markBorder=this.markBorder,this.mamesh=h.go(),this.mamesh.isolateMameshVerticesFromExteriorVertices()}if(this.markCorner)for(var l=0,u=this.mamesh.vertices;l<u.length;l++){var m=u[l];2==m.links.length&&m.markers.push(e.Vertex.Markers.corner)}if(this.setAllDichoLevelTo0)for(var c=0,p=this.mamesh.vertices;c<p.length;c++)p[c].dichoLevel=0;return e.spacialTransformations.adjustInASquare(this.mamesh,this.origin,this.end),this.mamesh},t}();t.TriangulatedTriangleOld=o;var a=function(){function t(t){this.markCorner=!0,this.markBorder=!0,this.origin=new e.XYZ(-1,-1,0),this.end=new e.XYZ(1,1,0),this.nbSubdivisionInARadius=1,this.setAllDichoLevelTo0=!0,this.mamesh=new e.Mamesh,this.nbSides=t}return t.prototype.go=function(){var t=this.mamesh.newVertex(new e.XYZ(0,0,0),0,new e.XYZ(0,0,0));t.markers.push(e.Vertex.Markers.center);for(n=0;n<this.nbSides;n++){var s=new e.XYZ(Math.cos(2*Math.PI*n/this.nbSides-Math.PI/2),Math.sin(2*Math.PI*n/this.nbSides-Math.PI/2),0),i=e.XYZ.newFrom(s),r=this.mamesh.newVertex(i,0,s);this.markBorder&&r.markers.push(e.Vertex.Markers.border)}for(n=1;n<this.nbSides+1;n++)this.mamesh.addATriangle(this.mamesh.vertices[0],this.mamesh.vertices[n],this.mamesh.vertices[n%this.nbSides+1]);if(this.nbSides%2==0)for(n=1;n<=this.nbSides/2;n++)t.setTwoOppositeLinks(this.mamesh.vertices[n],this.mamesh.vertices[n+this.nbSides/2]);else for(n=1;n<=this.nbSides;n++)t.setOneLink(this.mamesh.vertices[n]);for(var n=1;n<=this.nbSides;n++){var o=this.mamesh.vertices[n],a=n==this.nbSides?this.mamesh.vertices[1]:this.mamesh.vertices[n+1],h=1==n?this.mamesh.vertices[this.nbSides]:this.mamesh.vertices[n-1];o.setOneLink(t),o.setOneLink(a),o.setOneLink(h)}for(var l=Math.log(this.nbSubdivisionInARadius)/Math.log(2),u=0;u<l;u++)(m=new e.mameshModification.TriangleDichotomer(this.mamesh)).makeLinks=!0,m.go();if(l!=Math.floor(l)){var m=new e.mameshModification.TriangleDichotomer(this.mamesh);m.makeLinks=!0,m.go();var c=new e.grateAndGlue.ExtractCentralPart(this.mamesh,-this.nbSubdivisionInARadius);c.markBorder=this.markBorder,this.mamesh=c.go(),this.mamesh.isolateMameshVerticesFromExteriorVertices()}if(this.markCorner)for(var p=0,g=this.mamesh.vertices;p<g.length;p++)3==(r=g[p]).links.length&&r.markers.push(e.Vertex.Markers.corner);if(e.spacialTransformations.adjustInASquare(this.mamesh,this.origin,this.end),this.setAllDichoLevelTo0)for(var d=0,f=this.mamesh.vertices;d<f.length;d++)f[d].dichoLevel=0;return this.mamesh},t}();t.TriangulatedPolygone=a;var h=function(){function t(){this.nbU=3,this.set_nbV_toHaveRegularReseau=!1,this.set_nbU_toHaveRegularReseau=!1,this.nbV=3,this.origin=new e.XYZ(0,0,0),this.end=new e.XYZ(1,1,0),this.kComponentTranslation=0,this.nbVerticalDecays=0,this.nbHorizontalDecays=0,this.squareMailleInsteadOfTriangle=!0}return t.prototype.go=function(){if(this.checkArgs(),this.set_nbV_toHaveRegularReseau&&this.set_nbU_toHaveRegularReseau)throw"you must chose only one of the two options";var t,s;this.set_nbV_toHaveRegularReseau?(t=(this.end.x-this.origin.x)/(this.nbU-1),s=this.squareMailleInsteadOfTriangle?t:t*Math.sqrt(3)/2,this.nbV=Math.floor((this.end.y-this.origin.y)/s+1)):this.set_nbU_toHaveRegularReseau?(s=(this.end.y-this.origin.y)/(this.nbV-1),t=this.squareMailleInsteadOfTriangle?s:s/Math.sqrt(3)*2,this.nbU=Math.floor((this.end.x-this.origin.x)/t+1)):(t=(this.end.x-this.origin.x)/(this.nbU-1),s=(this.end.y-this.origin.y)/(this.nbV-1));var i=this.end.x-this.origin.x,r=this.end.y-this.origin.y,n=this.computeDecayVector(t,i,s,r,this.nbVerticalDecays,this.nbHorizontalDecays),o=this.computeDecayVector(s,r,t,i,this.nbHorizontalDecays,this.nbVerticalDecays),a=new e.XYZ(o.y,o.x,0);return n.z+=this.kComponentTranslation,a.z+=this.kComponentTranslation,{dirU:n,dirV:a,nbU:this.nbU,nbV:this.nbV}},t.prototype.checkArgs=function(){var t=this.end.x-this.origin.x,s=this.end.y-this.origin.y;if(Math.abs(t)<e.geo.epsilon||Math.abs(s)<e.geo.epsilon)throw"origin and end are almost in the same line";if(this.nbU<2)throw"this.nbI must be >=2";if(this.nbV<2)throw"this.nbJ must be >=2"},t.prototype.computeDecayVector=function(t,s,i,r,n,o){var a=new e.XYZ(0,0,0);return a.x=t*s*r/(s*r-t*i*o*n),a.y=i*n/s*a.x,a},t}();t.BasisForRegularReseau=h;var l=new e.XYZ(0,0,0),u=new e.XYZ(0,0,0),m=function(){function t(t){this.nbU=3,this.nbV=3,this.fixedW=0,this.dirU=new e.XYZ(1,0,0),this.dirV=new e.XYZ(0,1,0),this.dirW=new e.XYZ(0,0,0),this.origine=new e.XYZ(0,0,0),this.makeLinks=!0,this.makeTriangleOrSquare=!0,this.squareVersusTriangleMaille=!0,this.oneMoreVertexForOddLine=!1,this.markCorner=!0,this.markBorder=!0,this.markCenter=!0,this.putAVertexOnlyAtXYZCheckingThisCondition=null,this.OUT_paramToVertex=new e.HashMap(!0),this._xyz=new e.XYZ(0,0,0),this._iDirection=new e.XYZ(0,0,0),this._jDirection=new e.XYZ(0,0,0),this._kDirection=new e.XYZ(0,0,0),this.mamesh=new e.Mamesh,this.generator=t}return t.prototype.checkArgs=function(){this.makeTriangleOrSquare||this.makeLinks||e.logger.c("few interest if you do not add neither square nor links");var t=new e.XYZ(0,0,0);if(e.geo.cross(this.dirU,this.dirV,t),t.x==Number.NaN||t.y==Number.NaN||t.z==Number.NaN)throw"a problem with Vi of Vj";if(t.length()<e.geo.epsilon)throw"origin and end are almost in the same line"},t.prototype.getVertex=function(e,t){return this._xyz.x=e,this._xyz.y=t,this._xyz.z=this.fixedW,this.OUT_paramToVertex.getValue(this._xyz)},t.prototype.go=function(){if(null!=this.generator){var t=this.generator.go();this.dirU.copyFrom(t.dirU),this.dirV.copyFrom(t.dirV),this.nbU=t.nbU,this.nbV=t.nbV,this.origine.copyFrom(this.generator.origin),this.squareVersusTriangleMaille=this.generator.squareMailleInsteadOfTriangle}this.checkArgs();for(s=0;s<this.nbU;s++)for(i=0;i<this.nbV;i++){r=new e.XYZ(s,i,this.fixedW);if(null==this.holeParameters||!this.holeParameters(r)){n=this.squareVersusTriangleMaille||i%2!=0?0:.5;this._iDirection.copyFrom(this.dirU).scale(s+n),this._jDirection.copyFrom(this.dirV).scale(i),this._kDirection.copyFrom(this.dirW).scale(this.fixedW);o=new e.XYZ(0,0,0).add(this._iDirection).add(this._jDirection).add(this._kDirection).add(this.origine);if(null==this.putAVertexOnlyAtXYZCheckingThisCondition||this.putAVertexOnlyAtXYZCheckingThisCondition(o)){m=this.mamesh.newVertex(o,0,r);this.OUT_paramToVertex.putValue(r,m)}}}if(this.oneMoreVertexForOddLine)for(var s=this.nbU,i=0;i<this.nbV;i++)if(i%2==1){var r=new e.XYZ(s,i,this.fixedW);if(null==this.holeParameters||!this.holeParameters(r)){var n=this.squareVersusTriangleMaille||i%2!=0?0:.5;this._iDirection.copyFrom(this.dirU).scale(s+n),this._jDirection.copyFrom(this.dirV).scale(i),this._kDirection.copyFrom(this.dirW).scale(this.fixedW);var o=new e.XYZ(0,0,0).add(this._iDirection).add(this._jDirection).add(this._kDirection).add(this.origine);if(null==this.putAVertexOnlyAtXYZCheckingThisCondition||this.putAVertexOnlyAtXYZCheckingThisCondition(o)){m=this.mamesh.newVertex(o,0,r);this.OUT_paramToVertex.putValue(r,m)}}}if(0==this.mamesh.vertices.length&&console.log("you have created a IN_mamesh with no vertex. Perhaps because of {@link Regular.putAVertexOnlyAtXYZCheckingThisCondition }"),this.makeLinks&&(this.squareVersusTriangleMaille?this.linksCreationForSquare():this.linksCreationForTriangle()),this.makeTriangleOrSquare&&(this.squareVersusTriangleMaille?this.squareCreation():this.triangleCreation()),this.markBorder)for(var a=0,h=this.mamesh.vertices;a<h.length;a++){var l=h[a];0!=l.param.x&&0!=l.param.y&&l.param.x!=this.nbU-1&&l.param.y!=this.nbV-1||l.markers.push(e.Vertex.Markers.border)}if(this.markCorner){var u=this.oneMoreVertexForOddLine&&this.nbV%2==0?1:0,m=void 0;null!=(m=this.getVertex(0,0))&&m.markers.push(e.Vertex.Markers.corner),null!=(m=this.getVertex(this.nbU-1+u,this.nbV-1))&&m.markers.push(e.Vertex.Markers.corner),null!=(m=this.getVertex(0,this.nbV-1))&&m.markers.push(e.Vertex.Markers.corner),null!=(m=this.getVertex(this.nbU-1,0))&&m.markers.push(e.Vertex.Markers.corner)}if(this.markCenter){var c=this.nbU/2,p=[];Math.floor(c)!=c?p.push(Math.floor(c)):p.push(Math.floor(c),Math.floor(c)-1);var g=this.nbV/2,d=[];Math.floor(g)!=g?d.push(Math.floor(g)):d.push(Math.floor(g),Math.floor(g)-1);for(var f=0,v=p;f<v.length;f++)for(var s=v[f],y=0,b=d;y<b.length;y++){i=b[y];null!=(m=this.getVertex(s,i))&&m.markers.push(e.Vertex.Markers.center)}}return this.mamesh},t.prototype.linksCreationForSquare=function(){var t=this;this.mamesh.vertices.forEach(function(i){s(i,e.XYZ.temp0(1,0,0),e.XYZ.temp1(-1,0,0),t.OUT_paramToVertex),s(i,e.XYZ.temp0(0,1,0),e.XYZ.temp1(0,-1,0),t.OUT_paramToVertex)})},t.prototype.squareCreation=function(){for(var t=new e.XYZ(1,0,0),s=new e.XYZ(0,1,0),r=0,n=this.mamesh.vertices;r<n.length;r++)i(n[r],this.mamesh,t,s,this.OUT_paramToVertex)},t.prototype.linksCreationForTriangle=function(){var t=this;this.mamesh.vertices.forEach(function(i){s(i,e.XYZ.temp0(1,0,0),e.XYZ.temp1(-1,0,0),t.OUT_paramToVertex),i.param.y%2==0?(s(i,e.XYZ.temp0(1,1,0),e.XYZ.temp1(0,-1,0),t.OUT_paramToVertex),s(i,e.XYZ.temp0(0,1,0),e.XYZ.temp1(1,-1,0),t.OUT_paramToVertex)):(s(i,e.XYZ.temp0(0,1,0),e.XYZ.temp1(-1,-1,0),t.OUT_paramToVertex),s(i,e.XYZ.temp0(-1,1,0),e.XYZ.temp1(0,-1,0),t.OUT_paramToVertex))})},t.prototype.triangleCreation=function(){for(var e=0;e<this.nbU;e++)for(var t=0;t<this.nbV;t++)if(t%2==0){var s=this.getVertex(e,t),i=this.getVertex(e+1,t+1),r=this.getVertex(e,t+1),n=this.getVertex(e+1,t);this.mamesh.addATriangle(s,i,r),this.mamesh.addATriangle(s,n,i)}else{var s=this.getVertex(e,t),i=this.getVertex(e,t+1),r=this.getVertex(e+1,t),n=this.getVertex(e+1,t+1);this.mamesh.addATriangle(s,r,i),this.mamesh.addATriangle(i,r,n)}},t}();t.Regular2d=m;var c;!function(e){e[e.flat=0]="flat",e[e.cylinder=1]="cylinder",e[e.moebius=2]="moebius",e[e.torus=3]="torus",e[e.klein=4]="klein"}(c=t.Topology||(t.Topology={}));var p;!function(e){e[e.quad=0]="quad",e[e.triangleH=1]="triangleH",e[e.triangleV=2]="triangleV"}(p=t.Maille||(t.Maille={}));var g=function(){function t(){this.nbU=3,this.adaptVForRegularReseau=!1,this.nbV=3,this.nbSubInterval_U=1,this.nbSubInterval_V=1,this.origin=new e.XYZ(-.7,-.7,0),this.end=new e.XYZ(.7,.7,0),this.lateral1=null,this.lateral2=null,this.nbVerticalDecays=0,this.nbHorizontalDecays=0,this.makeLinks=!0,this.makeTriangleOrSquare=!0,this.makeLine=!0,this.oneMoreVertexForOddLine=!1,this.markCorner=!0,this.markBorder=!0,this.markCenter=!0,this.putAVertexOnlyAtXYZCheckingThisCondition=null,this.maille=p.quad,this.topology=c.flat,this.flatVersusNaturalShape=!0,this.OUT_paramToVertex=new e.HashMap}return t.prototype.inverseXY=function(e){var t=e.x;e.x=e.y,e.y=t},t.prototype.go=function(){var t=this.maille==p.triangleV,s=new e.XYZ(this.origin.x,this.origin.y,0),i=new e.XYZ(this.end.x,this.end.y,0),r=this.nbU,n=this.nbV,o=this.nbSubInterval_U,a=this.nbSubInterval_V,l=this.nbVerticalDecays,u=this.nbHorizontalDecays;t&&(this.inverseXY(s),this.inverseXY(i),r=this.nbV,n=this.nbU,o=this.nbSubInterval_V,a=this.nbSubInterval_U,l=this.nbHorizontalDecays,u=this.nbVerticalDecays);var c=new h;c.nbU=(r-1)*o+1,this.adaptVForRegularReseau&&(t?c.set_nbU_toHaveRegularReseau=!0:c.set_nbV_toHaveRegularReseau=!0),c.nbV=(n-1)*a+1,c.origin=s,c.end=i,c.nbVerticalDecays=l,c.nbHorizontalDecays=u,c.squareMailleInsteadOfTriangle=!this.triangle;var g=c.go(),d=new m;d.dirU.copyFrom(g.dirU),d.dirV.copyFrom(g.dirV),d.nbU=g.nbU,d.nbV=g.nbV,d.origine.copyFrom(c.origin),d.squareVersusTriangleMaille=!this.triangle,this.OUT_paramToVertex=d.OUT_paramToVertex,d.makeLinks=this.makeLinks,d.makeTriangleOrSquare=this.makeTriangleOrSquare,d.oneMoreVertexForOddLine=this.oneMoreVertexForOddLine,d.holeParameters=this.holeParameters,d.markCorner=this.markCorner,d.markBorder=this.markBorder,d.markCenter=this.markCenter,d.putAVertexOnlyAtXYZCheckingThisCondition=this.putAVertexOnlyAtXYZCheckingThisCondition;var f=d.go();if(t)for(var v=0,y=f.vertices;v<y.length;v++){var b=y[v];this.inverseXY(b.position)}return this.subdivisionsAndLines(f,o,a),f},Object.defineProperty(t.prototype,"triangle",{get:function(){return this.maille==p.triangleV||this.maille==p.triangleH},enumerable:!0,configurable:!0}),t.prototype.subdivisionsAndLines=function(t,s,i){var r=[];if(this.triangle)for(var n=this.nbSubInterval_U,o=0,a=t.vertices;o<a.length;o++){var h=a[o];h.param.x%n==0&&h.param.y%(2*n)==0?(h.dichoLevel=0,r.push(h)):h.param.x%n==Math.ceil(n/2)&&h.param.y%(2*n)==n?(h.dichoLevel=0,r.push(h)):h.dichoLevel=1}else for(var l=0,u=t.vertices;l<u.length;l++){var m=u[l];m.param.x%s==0&&m.param.y%i==0?(m.dichoLevel=0,r.push(m)):m.dichoLevel=1}if(this.makeLine){var c=new e.lineModule.LineComputer(t);c.startingVertices=r,t.lines=c.go()}},t}();t.Regular2dPlus=g;var d=function(){function t(t){void 0===t&&(t=5),this.size=t,this.origin=new e.XYZ(0,0,0),this.end=new e.XYZ(1,0,0)}return t.prototype.go=function(){if(null==this.size||this.size<=0)throw"non valide size:"+this.size;for(var t=new e.Mamesh,s=0;s<this.size;s++){var i=new e.Vertex;i.position=this.iToXYX(s),t.vertices.push(i)}for(s=1;s<this.size-1;s++)t.vertices[s].setTwoOppositeLinks(t.vertices[s-1],t.vertices[s+1]);return t.vertices[0].setOneLink(t.vertices[1]),t.vertices[this.size-1].setOneLink(t.vertices[this.size-2]),t},t.prototype.iToXYX=function(t){var s=t/(this.size-1);return e.XYZ.newFrom(this.end).substract(this.origin).scale(s).add(this.origin)},t}();t.Regular1D=d;var f=function(){function t(){this.nbU=3,this.nbV=3,this.nbW=3,this.dirU=new e.XYZ(1,0,0),this.dirV=new e.XYZ(0,1,0),this.dirW=new e.XYZ(0,0,1),this.origine=new e.XYZ(0,0,0),this.decayOddStrates=!1,this.makeLinks=!0,this.makeTriangleOrSquare=!0,this.strateHaveSquareMailleVersusTriangleMaille=!0,this.oneMoreVertexForOddLine=!1,this.interStrateMailleAreSquareVersusTriangle=!0,this.createJKSquares=!0,this.createIKSquaresOrTriangles=!0,this.putAVertexOnlyAtXYZCheckingThisCondition=null,this.paramToVertex=new e.HashMap}return t.prototype.go=function(){var t=this;this.mamesh=new e.Mamesh;var s=new e.XYZ(0,0,0);this.decayOddStrates&&s.add(this.dirU).scale(.5);for(var r=0;r<this.nbW;r++){var n=new m;n.makeTriangleOrSquare=this.makeTriangleOrSquare,n.makeLinks=!0,n.oneMoreVertexForOddLine=this.oneMoreVertexForOddLine,n.squareVersusTriangleMaille=this.strateHaveSquareMailleVersusTriangleMaille,n.nbU=this.nbU,n.nbV=this.nbV,n.fixedW=r,n.dirU=this.dirU,n.dirV=this.dirV,n.dirW.copyFrom(this.dirW),n.origine=e.XYZ.newFrom(this.origine),r%2==1&&n.origine.substract(s),n.putAVertexOnlyAtXYZCheckingThisCondition=this.putAVertexOnlyAtXYZCheckingThisCondition;for(var o=n.go(),a=0,h=n.OUT_paramToVertex.allEntries();a<h.length;a++){var l=h[a];this.mamesh.vertices.push(l.value),this.paramToVertex.putValue(l.key,l.value)}for(var u=0,c=o.smallestSquares;u<c.length;u++){d=c[u];this.mamesh.smallestSquares.push(d)}for(var p=0,g=o.smallestTriangles;p<g.length;p++){var d=g[p];this.mamesh.smallestTriangles.push(d)}}if(this.interStrateMailleAreSquareVersusTriangle){if(this.linksCreationForSquareMaille(),this.createJKSquares){var f=new e.XYZ(0,1,0),v=new e.XYZ(0,0,1);this.mamesh.vertices.forEach(function(e){i(e,t.mamesh,f,v,t.paramToVertex)})}if(this.createIKSquaresOrTriangles){var y=new e.XYZ(1,0,0),b=new e.XYZ(0,0,1);this.mamesh.vertices.forEach(function(e){i(e,t.mamesh,y,b,t.paramToVertex)})}}else{if(this.linksCreationForTriangleMaille(),this.createJKSquares){var x=new e.XYZ(0,1,0),w=new e.XYZ(0,0,1);this.mamesh.vertices.forEach(function(e){i(e,t.mamesh,x,w,t.paramToVertex)})}this.createIKSquaresOrTriangles&&this.triangleCreation()}return this.mamesh},t.prototype.linksCreationForSquareMaille=function(){var t=this,i=new e.XYZ(0,0,1),r=new e.XYZ(0,0,-1);this.mamesh.vertices.forEach(function(e){s(e,i,r,t.paramToVertex)})},t.prototype.linksCreationForTriangleMaille=function(){var t=this;this.mamesh.vertices.forEach(function(i){i.param.z%2==0?(s(i,e.XYZ.temp0(1,0,1),e.XYZ.temp1(0,0,-1),t.paramToVertex),s(i,e.XYZ.temp0(0,0,1),e.XYZ.temp1(1,0,-1),t.paramToVertex)):(s(i,e.XYZ.temp0(0,0,1),e.XYZ.temp1(-1,0,-1),t.paramToVertex),s(i,e.XYZ.temp0(-1,0,1),e.XYZ.temp1(0,0,-1),t.paramToVertex))})},t.prototype.getVertex=function(t,s,i){return this.paramToVertex.getValue(new e.XYZ(t,i,s))},t.prototype.triangleCreation=function(){for(var e=0,t=this.mamesh.vertices;e<t.length;e++){var s=t[e],i=s.param.x,r=s.param.z,n=s.param.y;if(r%2==0){o=s;if(null==(a=this.getVertex(i+1,r+1,n)))continue;null!=(h=this.getVertex(i,r+1,n))&&this.mamesh.addATriangle(o,a,h),null!=(l=this.getVertex(i+1,r,n))&&this.mamesh.addATriangle(o,l,a)}else{var o=s,a=this.getVertex(i,r+1,n);if(null==a)continue;var h=this.getVertex(i+1,r,n);null!=h&&this.mamesh.addATriangle(o,h,a);var l=this.getVertex(i+1,r+1,n);null!=l&&this.mamesh.addATriangle(a,h,l)}}},t}();t.Regular3D=f}(e.reseau||(e.reseau={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){function s(t,s,i){for(var r=e.XYZ.newFrom(t.vertices[0].position),n=e.XYZ.newFrom(t.vertices[0].position),o=0,a=t.vertices;o<a.length;o++)(p=a[o]).position.x>r.x&&(r.x=p.position.x),p.position.y>r.y&&(r.y=p.position.y),p.position.x<n.x&&(n.x=p.position.x),p.position.y<n.y&&(n.y=p.position.y);for(var h=e.XYZ.newFrom(r).substract(n),l=e.XYZ.newFrom(i).substract(s),u=new e.XYZ(l.x/h.x,l.y/h.y,0),m=0,c=t.vertices;m<c.length;m++){var p=c[m];p.position.substract(n).resizes(u).add(s)}}function i(t){var s;if(t[0]instanceof e.XYZ)s=t;else{s=[];for(var i=0,r=t;i<r.length;i++){var n=r[i];s.push(n.position)}}return s}function r(t,s,r,n,o,a,h,l,u){var m=i(t),c=new e.MM;e.geo.affineTransformation_4vec(s,r,n,o,a,h,l,u,c);for(var p=0,g=m;p<g.length;p++){var d=g[p];e.geo.multiplicationVectorMatrix(c,d,d)}}function n(t,s,r,n,o,a,h){var l=i(t),u=new e.MM;e.geo.affineTransformation_3vec(s,r,n,o,a,h,u);for(var m=0,c=l;m<c.length;m++){var p=c[m];e.geo.multiplicationVectorMatrix(u,p,p)}}function o(t,s,r,o,a,h,l,u,m){for(var c=i(t),p=[],g=0,d=c;g<d.length;g++){b=d[g];p.push(e.XYZ.newFrom(b))}for(var f=[],v=0,y=c;v<y.length;v++){var b=y[v];f.push(e.XYZ.newFrom(b))}n(p,s,r,o,h,l,u),n(f,s,o,a,h,u,m);for(var x=0;x<c.length;x++){var w=e.geo.distance(c[x],r),T=e.geo.distance(c[x],a),V=w+T;e.geo.baryCenter([p[x],f[x]],[T/V,w/V],c[x])}}var a=function(){function t(e){this.propBeginToRound=0,this.propEndToRound=1,this.integerBeginToRound=null,this.integerEndToRound=null,this.exponentOfRoundingFunction=1,this.referenceRadiusIsMinVersusMaxVersusMean=2,this.preventStratesCrossings=!0,this.mamesh=e}return t.prototype.goChanging=function(){if(isNaN(this.exponentOfRoundingFunction))throw"must be a number";if(this.propBeginToRound<0||this.propBeginToRound>1)throw"must be in [0,1]";if(this.propEndToRound<0||this.propEndToRound>1)throw"must be in [0,1]";if(!(this.propBeginToRound>=this.propEndToRound)){for(var t=[],s=0,i=this.mamesh.vertices;s<i.length;s++){var r=i[s];r.hasMark(e.Vertex.Markers.border)&&t.push(r)}var n=e.graph.ringify(t);if(null==this.integerBeginToRound&&(this.integerBeginToRound=Math.floor(n.length*this.propBeginToRound)),null==this.integerEndToRound&&(this.integerEndToRound=Math.ceil(n.length*this.propEndToRound)),this.integerEndToRound<0&&(this.integerEndToRound=n.length+this.integerEndToRound),this.integerBeginToRound>n.length||this.integerBeginToRound<0)throw"problem";if(this.integerEndToRound>n.length||this.integerEndToRound<0)throw"problem";if(!(this.integerEndToRound<=this.integerBeginToRound)){for(var o=new e.XYZ(0,0,0),a=0,h=this.mamesh.vertices;a<h.length;a++){var l=h[a];o.add(l.position)}o.scale(1/this.mamesh.vertices.length);for(var u=new e.XYZ(0,0,0),m=this.integerBeginToRound;m<this.integerEndToRound;m++){for(var c=-1,p=Number.POSITIVE_INFINITY,g=0,d=0,f=n[m];d<f.length;d++){x=f[d];(B=e.geo.distance(x.position,o))>c&&(c=B),B<p&&(p=B),g+=B}if(g/=n[m].length,c>e.geo.epsilon){var v=void 0;0==this.referenceRadiusIsMinVersusMaxVersusMean?v=p:1==this.referenceRadiusIsMinVersusMaxVersusMean?v=c:2==this.referenceRadiusIsMinVersusMaxVersusMean&&(v=g),v;for(var y=0,b=n[m];y<b.length;y++){var x=b[y],w=u.copyFrom(x.position).substract(o),T=w.length(),V=Math.pow(v/T,this.exponentOfRoundingFunction);w.scale(V),x.position.copyFrom(w.add(o))}}}if(this.preventStratesCrossings){if(this.integerBeginToRound>0){for(var M=-1,S=0,k=n[this.integerBeginToRound];S<k.length;S++){x=k[S];(B=e.geo.distance(x.position,o))>M&&(M=B)}for(var O=Number.POSITIVE_INFINITY,A=0,L=n[this.integerBeginToRound-1];A<L.length;A++){x=L[A];(B=e.geo.distance(x.position,o))<O&&(O=B)}I=null;if(1.1*M>O&&(I=1.1*M/O),null!=I)for(Y=0;Y<this.integerBeginToRound;Y++)for(var C=0,N=n[Y];C<N.length;C++)(x=N[C]).position.copyFrom(u.copyFrom(x.position).substract(o).scale(I).add(o))}if(this.integerEndToRound<n.length){for(var F=Number.POSITIVE_INFINITY,_=0,q=n[this.integerEndToRound-1];_<q.length;_++){x=q[_];(B=e.geo.distance(x.position,o))<F&&(F=B)}for(var z=-1,X=0,P=n[this.integerEndToRound];X<P.length;X++){var x=P[X],B=e.geo.distance(x.position,o);B>z&&(z=B)}var I=null;if(1.1*z>F&&(I=F/(1.1*z)),null!=I)for(var Y=this.integerEndToRound;Y<n.length;Y++)for(var U=0,Z=n[Y];U<Z.length;U++)(x=Z[U]).position.copyFrom(u.copyFrom(x.position).substract(o).scale(I).add(o))}}}}},t}();t.RoundSomeStrates=a;var h=function(){function t(t,s,i,r){void 0===i&&(i=new e.XYZ(0,0,0)),void 0===r&&(r=new e.XYZ(1,1,1)),this.axisForRotation=new e.XYZ(0,0,1),this.centerForSimilitude=null,this.vertices=t,this.angle=s,this.vectorForTranslation=i,this.sizesForResize=r}return t.prototype.goChanging=function(){var t=this;if(null==this.centerForSimilitude){this.centerForSimilitude=new e.XYZ(0,0,0);var s=1/this.vertices.length,i=[],r=[];this.vertices.forEach(function(e){r.push(e.position),i.push(s)}),e.geo.baryCenter(r,i,this.centerForSimilitude)}var n=new e.MM;e.geo.axisAngleToMatrix(this.axisForRotation,this.angle,n),this.vertices.forEach(function(s){s.position.substract(t.centerForSimilitude),s.position.resizes(t.sizesForResize),e.geo.multiplicationVectorMatrix(n,s.position,s.position),s.position.add(t.centerForSimilitude).add(t.vectorForTranslation)})},t}();t.Similitude=h,t.adjustInASquare=s,t.affineTransformation_4vec=r,t.affineTransformation_3vec=n,t.quadTransformation_4vec=o}(e.spacialTransformations||(e.spacialTransformations={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){function s(t,s,i){void 0===i&&(i=!1);var r=new e.StringMap;return r.putValue(o.verticalAxis,function(s){var r=t;return s.y%2==1&&i&&r++,new e.XYZ(r-1-s.x,s.y,s.z)}),r.putValue(o.horizontalAxis,function(t){return new e.XYZ(t.x,s-1-t.y,t.z)}),r.putValue(o.slashAxis,function(r){var n=t;return r.y%2==1&&i&&n++,new e.XYZ(n-1-r.x,s-1-r.y,r.z)}),r}function i(e,t,i){void 0===i&&(i=!1);for(var r=[],n=0,o=s(e,t,i).allValues();n<o.length;n++){var a=o[n];r.push(a)}return r}function r(t){for(var s=new e.StringMap,i=1;i<t;i++)!function(i){var r=2*Math.PI/t*i;s.putValue(o.rotation+i,function(t){var s=new e.XYZ(0,0,0);return s.x=t.x*Math.cos(r)-t.y*Math.sin(r),s.y=t.x*Math.sin(r)+t.y*Math.cos(r),s.z=t.z,s})}(i);return s}function n(e){for(var t=[],s=0,i=r(e).allValues();s<i.length;s++){var n=i[s];t.push(n)}return t}t.squareMainSymmetries=[function(t){return new e.XYZ(1-t.x,t.y,t.z)},function(t){return new e.XYZ(t.x,1-t.y,t.z)},function(t){return new e.XYZ(1-t.x,1-t.y,t.z)}];var o;!function(e){e.verticalAxis="symI",e.horizontalAxis="symJ",e.slashAxis="symIJ",e.rotation="rotation"}(o=t.keyWords||(t.keyWords={})),t.cartesian=s,t.cartesianAsArray=i,t.polygonRotations=r,t.getAllPolygonalRotations=n}(e.symmetries||(e.symmetries={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){function s(e){if(null==e||0==e.length)throw"empty list";for(var t=e[0],s=0,i=1;i<e.length;i++)e[i]>t&&(t=e[i],s=i);return s}function i(e){return e[s(e)]}function r(e){return e[s(e)]}function n(e){if(null==e||0==e.length)throw"empty list";for(var t=e[0],s=0,i=1;i<e.length;i++)e[i]<t&&(t=e[i],s=i);return s}function o(e){return e[n(e)]}function a(e){return e[n(e)]}function h(e,t){if(null==e||0==e.length)throw"empty list";for(var s=e[0],i=0,r=1;r<e.length;r++)t(e[r],s)<0&&(s=e[r],i=r);return i}function l(e,t){return e[h(e,t)]}function u(e){for(;e.length>0;)e.pop()}function m(e,t){var s=e.indexOf(t);if(-1==s)throw cc("l'objet n'est pas dans le tableau",t),"l'objet précédent n'est pas dans le tableau:";e.splice(s,1)}function c(e,t){for(var s=[],i=0,r=e;i<r.length;i++){var n=r[i];t(n)||s.push(n)}return s}function p(e,t){for(var s=[],i=0;i<e.length;i++)-1!=t.indexOf(i)&&s.push(e[i]);return s}function g(e,t){for(var s=[],i=0;i<e.length;i++)-1==t.indexOf(i)&&s.push(e[i]);return s}function d(e,t,s){for(var i=[],r=0;r<e.length;r+=s)if(-1==t.indexOf(r))for(var n=0;n<s;n++)i.push(e[r+n]);return i}function f(t){for(var s=Number.MAX_VALUE,i=-1,r=0;r<t.length;r++)t[r]<s&&(s=t[r],i=r);return-1==i&&e.logger.c("an empty line has no minimum"),i}function v(e){for(var t=Number.NEGATIVE_INFINITY,s=-1,i=0;i<e.length;i++)e[i]>t&&(t=e[i],s=i);return s}function y(t){if(0==t.length)return e.logger.c("an empty line has no minimum"),-1;for(var s=t[0],i=0,r=0;r<t.length;r++)t[r]<s&&(s=t[r],i=r);return i}function b(e){for(var t=f(e),s=[],i=0;i<e.length;i++)s[i]=e[(i+t)%e.length];return JSON.stringify(s)}t.maxIndex=s,t.maxValue=i,t.maxValueString=r,t.minIndex=n,t.minValue=o,t.minValueString=a,t.minIndexOb=h,t.minValueOb=l,t.clearArray=u,t.removeFromArray=m,t.arrayMinusElements=c,t.arrayKeepingSomeIndices=p,t.arrayMinusSomeIndices=g,t.arrayMinusBlocksIndices=d,t.minIndexOfNumericList=f,t.maxIndexOfNumericList=v,t.minIndexOfStringList=y,t.indicesUpPermutationToString=b;var x=function(){function e(e,t,s){this.dicoOfExistingBlocks={},this.removeAlsoCircularPermutation=!0,this.longList=e,this.blockSize=t,null==s?(this.listToRemove=e,this.removeOnlyDoublon=!0):(this.listToRemove=s,this.removeOnlyDoublon=!1)}return e.prototype.go=function(){for(i=0;i<this.listToRemove.length;i+=this.blockSize)try{for(var e=[],t=0;t<this.blockSize;t++)e.push(this.listToRemove[i+t].hashString);this.dicoOfExistingBlocks[this.key(e)]=1}catch(e){throw"a block is not in your list"}for(var s=[],i=0;i<this.longList.length;i+=this.blockSize){for(var e=[],t=0;t<this.blockSize;t++)e.push(this.longList[i+t].hashString);if(this.removeOnlyDoublon){if(1==this.dicoOfExistingBlocks[this.key(e)]){for(t=0;t<this.blockSize;t++)s.push(this.longList[i+t]);this.dicoOfExistingBlocks[this.key(e)]++}}else if(null==this.dicoOfExistingBlocks[this.key(e)])for(t=0;t<this.blockSize;t++)s.push(this.longList[i+t])}return s},e.prototype.key=function(e){var t=[];if(this.removeAlsoCircularPermutation){t=[];for(var s=y(e),i=0;i<e.length;i++)t[i]=e[(i+s)%e.length]}else t=e;var r="";return t.forEach(function(e){r+=e+","}),r},e}();t.ArrayMinusBlocksElements=x}(e.tab||(e.tab={}))}(mathis||(mathis={}));var cc,showDevMessages=!0;cc=showDevMessages?console.log.bind(window.console):function(){};var mathis;!function(e){e.deconnectViewerForTest=!1}(mathis||(mathis={}));var mathis;!function(e){!function(e){function t(e,t){var s,i=!1;return function(){var r;if(i)r=s,i=!1;else{var n,o,a;do{a=(n=2*Math.random()-1)*n+(o=2*Math.random()-1)*o}while(a>=1);r=n*(a=Math.sqrt(-2*Math.log(a)/a)),s=o*a,i=!0}var h=e+t*r;return h>0?h:-h}}var s=function(){function e(e){void 0===e&&(e=1234567),this.seed=e}return e.prototype.pseudoRand=function(){var e=Math.pow(2,32);return this.seed+=this.seed*this.seed|5,(this.seed>>>32)/e},e.prototype.pseudoRandInt=function(e){var t=Math.floor(e*this.pseudoRand());return t==e&&t--,t},e}();e.Random=s;var i=function(){function e(){this.mean=0,this.stdev=1,this.knuthVersusBowMuller=!0,this.use_last=!1}return e.prototype.go=function(){return this.knuthVersusBowMuller?this.knuth():this.bowMuller()},e.prototype.bowMuller=function(){var e=1-Math.random(),t=1-Math.random();return this.mean+this.stdev*Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)},e.prototype.knuth=function(){var e;if(this.use_last)e=this.y2,this.use_last=!1;else{var t,s,i;do{i=(t=2*Math.random()-1)*t+(s=2*Math.random()-1)*s}while(i>=1);e=t*(i=Math.sqrt(-2*Math.log(i)/i)),this.y2=s*i,this.use_last=!0}var r=this.mean+this.stdev*e;return r>0?r:-r},e}();e.Gaussian=i,e.gaussian=t;var r=function(){function e(){this.nbSimu=1,this.alpha=1.5,this.beta=0,this.sigma=1,this.mu=0,this.basicGenerator=Math.random}return e.prototype.checkArgs=function(){if(this.alpha>2||this.alpha<=0)throw"alpha must be in (0,2]";if(this.beta<-1||this.beta>1)throw"beta must be in [-1,1]"},e.prototype.go=function(){this.checkArgs();for(var e=[],t=0;t<this.nbSimu;t++){var s=this.basicGenerator()*Math.PI-Math.PI/2,i=-Math.log(this.basicGenerator());if(1!=this.alpha){var r=Math.tan(Math.PI*this.alpha/2),n=Math.atan(this.beta*r)/this.alpha,o=1+this.beta^2*r^2^.5/this.alpha;e[t]=o*Math.sin(this.alpha*(s+n))/Math.pow(Math.cos(s),1/this.alpha)*Math.pow(Math.cos(s-this.alpha*(s+n))/i,(1-this.alpha)/this.alpha),e[t]=this.sigma*e[t]+this.mu}else 1==this.alpha&&(e[t]=2/Math.PI*((Math.PI/2+this.beta*s)*Math.tan(s)-this.beta*Math.log(i*Math.cos(s)/(Math.PI/2+this.beta*s))),e[t]=this.sigma*e[t]+2/Math.PI*this.beta*this.sigma*Math.log(this.sigma)+this.mu)}return e},e}();e.StableLaw=r}(e.proba||(e.proba={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){var s;!function(e){e[e.triangulatedTriangle=0]="triangulatedTriangle",e[e.triangulatedRect=1]="triangulatedRect",e[e.square=2]="square",e[e.polygon3=3]="polygon3",e[e.polygon4=4]="polygon4",e[e.polygon5=5]="polygon5",e[e.polygon6=6]="polygon6",e[e.polygon7=7]="polygon7",e[e.polygon8=8]="polygon8",e[e.polygon9=9]="polygon9",e[e.polygon10=10]="polygon10",e[e.polygon11=11]="polygon11",e[e.polygon12=12]="polygon12"}(s=t.PartShape||(t.PartShape={}));var i;!function(e){e[e.concentric=0]="concentric",e[e.patchwork=1]="patchwork",e[e.polyhedron=2]="polyhedron"}(i=t.PrimaryType||(t.PrimaryType={}));var r;!function(e){e[e.forNonBorder=0]="forNonBorder",e[e.forVertexWithAtLeast5links=1]="forVertexWithAtLeast5links",e[e.none=2]="none"}(r=t.SuppressLinkWithoutOpposite||(t.SuppressLinkWithoutOpposite={}));var n=function(){function t(){this.primaryType=i.concentric,this.shapes=[s.square],this.proportions=[new e.UV(1,1)],this.exponentOfRoundingFunction=[1],this.nbPatches=2,this.individualScales=[new e.UV(1,1)],this.individualRotations=[0],this.individualTranslation=[new e.XYZ(0,0,0)],this.nbI=8,this.nbJ=null,this.percolationProba=[0],this.scalingBeforeOppositeLinkAssociations=null,this.proportionOfSeeds=[.1],this.stratesToSuppressFromCorners=[0],this.asymetriesForSeeds=null,this.suppressLinksWithoutOpposite=r.forVertexWithAtLeast5links,this.doLineBifurcations=!0}return t}();t.ConcentricDescription=n;var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.primaryType=i.patchwork,t.nbPatchesI=2,t.nbPatchesJ=2,t.patchesInQuinconce=!1,t.oddPatchLinesAreTheSameVersusLongerVersusShorter=0,t.alternateShapeAccordingIPlusJVersusCounter=!0,t}return __extends(t,e),t}(n);t.PatchworkDescription=o;var a=function(){function t(){this.desc=new n,this.SUB_gratAndStick=new e.grateAndGlue.ConcurrentMameshesGraterAndSticker,this.SUB_oppositeLinkAssocierByAngles=new e.linkModule.OppositeLinkAssocierByAngles(null),this.SUB_mameshCleaner=new m(null),this.origine=new e.XYZ(0,0,0),this.end=new e.XYZ(1,1,0),this.toleranceToBeOneOfTheClosest=.55,this.forceToGrate=[.1],this.finalize=!0,this.OUT_corner=[]}return t.prototype.go=function(){this.SUB_gratAndStick.SUB_grater.proportionOfSeeds=this.desc.proportionOfSeeds,this.SUB_gratAndStick.SUB_grater.asymmetriesForSeeds=this.desc.asymetriesForSeeds,this.SUB_oppositeLinkAssocierByAngles.canCreateBifurcations=this.desc.doLineBifurcations,null==this.desc.nbJ&&(this.desc.nbJ=this.desc.nbI);for(var t=[],i=this,r=0;r<this.desc.nbPatches;r++)!function(r){var n=r%i.desc.shapes.length,o=i.desc.shapes[n],a=s[o],h=Math.round(i.desc.nbI*i.desc.proportions[r%i.desc.proportions.length].u),l=Math.round(i.desc.nbJ*i.desc.proportions[r%i.desc.proportions.length].v),u=.5*i.desc.individualScales[r%i.desc.individualScales.length].u*i.desc.proportions[r%i.desc.proportions.length].u,m=.5*i.desc.individualScales[r%i.desc.individualScales.length].v*i.desc.proportions[r%i.desc.proportions.length].v,c=void 0;if(-1!=a.indexOf("polygon")){var p=parseInt(a.slice(7,a.length)),g=new e.reseau.TriangulatedPolygone(p);g.origin=new e.XYZ(-u,-m,0),g.end=new e.XYZ(u,m,0),g.nbSubdivisionInARadius=Math.floor((h+l)/4),c=g.go()}else if(o==s.square||o==s.triangulatedRect){var d=new e.reseau.BasisForRegularReseau;d.origin=new e.XYZ(-u,-m,0),d.end=new e.XYZ(u,m,0),d.nbU=h,d.nbV=l,o==s.triangulatedRect&&(d.squareMailleInsteadOfTriangle=!1),d.go();var f=new e.reseau.Regular2d(d);o==s.triangulatedRect&&(f.oneMoreVertexForOddLine=!0),c=f.go()}else{if(o!=s.triangulatedTriangle)throw"partShape non reconnue";var v=new e.reseau.TriangulatedTriangle;v.origin=new e.XYZ(-u,-m,0),v.end=new e.XYZ(u,m,0),v.nbU=(h+l)/2,c=v.go()}if(0==r)for(var y=0,b=c.vertices;y<b.length;y++){var x=b[y];x.hasMark(e.Vertex.Markers.corner)&&i.OUT_corner.push(x)}if(i.desc.propBeginToRound||i.desc.propEndToRound||i.desc.integerBeginToRound||i.desc.integerEndToRound){var w=new e.spacialTransformations.RoundSomeStrates(c);null==i.desc.propBeginToRound?w.propBeginToRound=0:w.propBeginToRound=i.desc.propBeginToRound[r%i.desc.propBeginToRound.length],null==i.desc.propEndToRound?w.propEndToRound=1:w.propEndToRound=i.desc.propEndToRound[r%i.desc.propEndToRound.length],null!=i.desc.integerBeginToRound&&(w.integerBeginToRound=i.desc.integerBeginToRound[r%i.desc.integerBeginToRound.length]),null!=i.desc.integerEndToRound&&(w.integerEndToRound=i.desc.integerEndToRound[r%i.desc.integerEndToRound.length]),w.exponentOfRoundingFunction=i.desc.exponentOfRoundingFunction[r%i.desc.exponentOfRoundingFunction.length],w.referenceRadiusIsMinVersusMaxVersusMean=2,w.preventStratesCrossings=!0,w.goChanging()}var T=i.desc.percolationProba[r*i.desc.percolationProba.length];if(T>0){var V=new e.mameshModification.PercolationOnLinks(c);V.percolationProba=T,V.goChanging()}if(i.desc.stratesToSuppressFromCorners[r%i.desc.stratesToSuppressFromCorners.length]>0){var M=new e.grateAndGlue.ExtractCentralPart(c,i.desc.stratesToSuppressFromCorners[r%i.desc.stratesToSuppressFromCorners.length]);M.suppressFromBorderVersusCorner=!1,(c=M.go()).isolateMameshVerticesFromExteriorVertices()}t.push(c);var S=i.desc.individualTranslation[r%i.desc.individualTranslation.length],k=i.desc.individualRotations[r%i.desc.individualRotations.length],O=new e.MM;e.geo.axisAngleToMatrix(new e.XYZ(0,0,-1),k,O),c.vertices.forEach(function(t){e.geo.multiplicationVectorMatrix(O,t.position,t.position),t.position.add(S)})}(r);var n;return this.desc.nbPatches>1?(this.SUB_gratAndStick.IN_mameshes=t,this.SUB_gratAndStick.toleranceToBeOneOfTheClosest=this.toleranceToBeOneOfTheClosest,this.SUB_gratAndStick.SUB_grater.proportionOfSeeds=this.forceToGrate,n=this.SUB_gratAndStick.goChanging()):(n=t[0],e.spacialTransformations.adjustInASquare(n,new e.XYZ(0,0,0),new e.XYZ(1,1,0)),n.clearOppositeInLinks()),null!=this.desc.scalingBeforeOppositeLinkAssociations&&e.spacialTransformations.adjustInASquare(n,new e.XYZ(0,0,0),new e.XYZ(this.desc.scalingBeforeOppositeLinkAssociations.x,this.desc.scalingBeforeOppositeLinkAssociations.y,0)),this.finalize&&(this.SUB_oppositeLinkAssocierByAngles.vertices=n.vertices,this.SUB_oppositeLinkAssocierByAngles.goChanging(),this.SUB_mameshCleaner.suppressLinksWithoutOpposite=this.desc.suppressLinksWithoutOpposite,this.SUB_mameshCleaner.IN_mamesh=n,this.SUB_mameshCleaner.goChanging()),e.spacialTransformations.adjustInASquare(n,this.origine,this.end),n},t}();t.Concentric=a;var h=function(t){function s(){var e=t.call(this)||this;return e.desc=new o,e.desc.nbPatches=0,e.desc.individualTranslation=[],e}return __extends(s,t),s.prototype.go=function(){this.desc.individualTranslation=[],this.desc.nbPatches=0;for(var s=[],i=0,r=0;r<this.desc.nbPatchesJ;r++){var n=0;if(r%2==1)if(0==this.desc.oddPatchLinesAreTheSameVersusLongerVersusShorter)n=0;else if(1==this.desc.oddPatchLinesAreTheSameVersusLongerVersusShorter)n=1;else{if(2!=this.desc.oddPatchLinesAreTheSameVersusLongerVersusShorter)throw"must be 0 or 1 or 2";n=-1}for(var o=0;o<this.desc.nbPatchesI+n;o++){this.desc.nbPatches++;var a=0;this.desc.patchesInQuinconce&&r%2==1&&(0==this.desc.oddPatchLinesAreTheSameVersusLongerVersusShorter&&(a=-.5),1==this.desc.oddPatchLinesAreTheSameVersusLongerVersusShorter&&(a=-.5),2==this.desc.oddPatchLinesAreTheSameVersusLongerVersusShorter&&(a=.5)),this.desc.individualTranslation.push(new e.XYZ(o+a,r,0)),i++;var h=this.desc.alternateShapeAccordingIPlusJVersusCounter?o+n+r:i;s.push(this.desc.shapes[h%this.desc.shapes.length])}}return this.desc.shapes=s,t.prototype.go.call(this)},s}(a);t.Patchwork=h;var l=function(){function e(){this.primaryType=i.polyhedron,this.facesDescription=[],this.suppressLinksWithoutOpposite=r.forVertexWithAtLeast5links,this.nbU=4,this.canCreateBifurcations=!0}return e}();t.PolyhedronBoardDescription=l;var u=function(){function t(t){this.desc=t,this.SUB_oppositeLinkAssocierByAngles=new e.linkModule.OppositeLinkAssocierByAngles(null),this.SUB_mameshCleaner=new m(null),this.finalize=!0}return t.prototype.go=function(){for(var t=0,i=this.desc.facesDescription;t<i.length;t++){var r=i[t];r.nbI=this.desc.nbU,r.nbJ=this.desc.nbU}var o=new e.polyhedron.Polyhedron(this.desc.polyhedronName).go(),h=null;if(null==o.faces)throw"no faces in this mamesh";cc("mameshStructure.faces.length",o.faces.length);for(var l=!0,u=0,m=o.faces; u<m.length; u++){var c=m[u];if(3==c.length){var p=c[0],g=c[1],d=c[2];(f=new a).finalize=!1,null!=this.desc.facesDescription[3]?f.desc=this.desc.facesDescription[3]:(f.desc=new n,f.desc.nbPatches=1,f.desc.nbI=this.desc.nbU,f.desc.shapes=[s.triangulatedTriangle]);v=f.go();e.spacialTransformations.affineTransformation_3vec(v.vertices,f.OUT_corner[0].position,f.OUT_corner[1].position,f.OUT_corner[2].position,p.position,g.position,d.position),l?(l=!1,h=v):(y=new e.grateAndGlue.Merger(h,v)).goChanging()}else if(4==c.length){var p=c[0],g=c[1],d=c[2];(f=new a).finalize=!1,null!=this.desc.facesDescription[4]?f.desc=this.desc.facesDescription[4]:(f.desc=new n,f.desc.nbPatches=1,f.desc.nbI=this.desc.nbU,f.desc.shapes=[s.square]);v=f.go();e.spacialTransformations.affineTransformation_3vec(v.vertices,new e.XYZ(0,0,0),new e.XYZ(1,0,0),new e.XYZ(1,1,0),p.position,g.position,d.position),l?(l=!1,h=v):(y=new e.grateAndGlue.Merger(h,v)).goChanging()}else if(5==c.length){var p=c[0],g=c[2],d=c[3];(f=new a).finalize=!1,null!=this.desc.facesDescription[5]?f.desc=this.desc.facesDescription[5]:(f.desc=new n,f.desc.nbPatches=1,f.desc.nbI=2*(this.desc.nbU-1),f.desc.shapes=[s.polygon5]);v=f.go();e.spacialTransformations.affineTransformation_3vec(v.vertices,f.OUT_corner[0].position,f.OUT_corner[2].position,f.OUT_corner[3].position,p.position,g.position,d.position),l?(l=!1,h=v):(y=new e.grateAndGlue.Merger(h,v)).goChanging()}else if(6==c.length){var p=c[0],g=c[2],d=c[4];(f=new a).finalize=!1,null!=this.desc.facesDescription[6]?f.desc=this.desc.facesDescription[6]:(f.desc=new n,f.desc.nbPatches=1,f.desc.nbI=2*(this.desc.nbU-1),f.desc.shapes=[s.polygon6]);v=f.go();e.spacialTransformations.affineTransformation_3vec(v.vertices,f.OUT_corner[0].position,f.OUT_corner[2].position,f.OUT_corner[4].position,p.position,g.position,d.position),l?(l=!1,h=v):(y=new e.grateAndGlue.Merger(h,v)).goChanging()}else if(7==c.length){var p=c[0],g=c[2],d=c[4];(f=new a).finalize=!1,null!=this.desc.facesDescription[7]?f.desc=this.desc.facesDescription[7]:(f.desc=new n,f.desc.nbPatches=1,f.desc.nbI=2*(this.desc.nbU-1),f.desc.shapes=[s.polygon7]);v=f.go();e.spacialTransformations.affineTransformation_3vec(v.vertices,f.OUT_corner[0].position,f.OUT_corner[2].position,f.OUT_corner[4].position,p.position,g.position,d.position),l?(l=!1,h=v):(y=new e.grateAndGlue.Merger(h,v)).goChanging()}else if(8==c.length){var p=c[0],g=c[3],d=c[6],f=new a;f.finalize=!1,null!=this.desc.facesDescription[8]?f.desc=this.desc.facesDescription[8]:(f.desc=new n,f.desc.nbPatches=1,f.desc.nbI=2*(this.desc.nbU-1),f.desc.shapes=[s.polygon8]);var v=f.go();if(e.spacialTransformations.affineTransformation_3vec(v.vertices,f.OUT_corner[0].position,f.OUT_corner[3].position,f.OUT_corner[6].position,p.position,g.position,d.position),l)l=!1,h=v;else{var y=new e.grateAndGlue.Merger(h,v);y.goChanging()}}}return this.finalize&&(this.SUB_oppositeLinkAssocierByAngles.vertices=h.vertices,this.SUB_oppositeLinkAssocierByAngles.canCreateBifurcations=this.desc.canCreateBifurcations,this.SUB_oppositeLinkAssocierByAngles.goChanging(),this.SUB_mameshCleaner.suppressLinksWithoutOpposite=this.desc.suppressLinksWithoutOpposite,this.SUB_mameshCleaner.IN_mamesh=h),h},t}();t.PolyhedronBoard=u;var m=function(){function t(e){this.OUT_nbLinkSuppressed=0,this.OUT_nbVerticesSuppressed=0,this.suppressCellWithNoVoisin=!0,this.suppressLinksWithoutOpposite=r.none,this.suppressLinkWithoutOppositeFunction=function(e){return e.links.length>=5},this.IN_mamesh=e}return t.prototype.goChanging=function(){if(this.suppressLinksWithoutOpposite==r.forVertexWithAtLeast5links?this.suppressLinkWithoutOppositeFunction=function(e){return e.links.length>=5}:this.suppressLinksWithoutOpposite==r.forNonBorder?this.suppressLinkWithoutOppositeFunction=function(e){return!e.isBorder()}:this.suppressLinkWithoutOppositeFunction=null,null==this.IN_mamesh)throw"a Mamesh is require as IN_arg";null!=this.suppressLinkWithoutOppositeFunction&&this.suppressLinkWithoutOpposite()},t.prototype.suppressLinkWithoutOpposite=function(){for(var t=!0;t;){t=!1;for(var s=0,i=this.IN_mamesh.vertices;s<i.length;s++){var r=i[s];if(this.suppressLinkWithoutOppositeFunction(r))for(a=0;a<r.links.length;a++){var n=r.links[a];if(null==n.opposites){t=!0,e.Vertex.separateTwoVoisins(r,n.to),this.OUT_nbLinkSuppressed++;break}}}}if(this.suppressCellWithNoVoisin){for(var o=[],a=0;a<this.IN_mamesh.vertices.length;a++)0==this.IN_mamesh.vertices[a].links.length&&(o.push(a),this.OUT_nbVerticesSuppressed++);this.IN_mamesh.vertices=e.tab.arrayMinusSomeIndices(this.IN_mamesh.vertices,o)}},t}();t.MameshCleaner=m}(e.octavioBoard||(e.octavioBoard={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){t.platonic=["tetrahedron","cube","octahedron","dodecahedron","icosahedron"],t.archimedean=["truncated tetrahedron","cuboctahedron","truncated cube","truncated octahedron","rhombicuboctahedron","truncated cuboctahedron","snub cube","icosidodecahedron","truncated dodecahedron","truncated icosahedron","rhombicosidodecahedron","truncated icosidodecahedron","snub dodecahedron"],t.antiprisms=["square antiprism","pentagonal antiprism","hexagonal antiprism","octagonal antiprism","decagonal antiprism"],t.johnson=["square pyramid","pentagonal pyramid","triangular cupola","square cupola","pentagonal cupola","pentagonal rotunda","elongated triangular pyramid","elongated square pyramid","elongated pentagonal pyramid","gyroelongated square pyramid","gyroelongated pentagonal pyramid","triangular bipyramid","pentagonal bipyramid","elongated triangular bipyramid","elongated square bipyramid","elongated pentagonal bipyramid","gyroelongated square bipyramid","elongated triangular cupola","elongated square cupola","elongated pentagonal cupola","elongated pentagonal rotunda","gyroelongated triangular cupola","gyroelongated square cupola","gyroelongated pentagonal cupola","gyroelongated pentagonal rotunda","gyrobifastigium","triangular orthobicupola","square orthobicupola","square gyrobicupola","pentagonal orthobicupola","pentagonal gyrobicupola","pentagonal orthocupolarotunda","pentagonal gyrocupolarotunda","pentagonal orthobirotunda","elongated triangular orthobicupola","elongated triangular gyrobicupola","elongated square gyrobicupola","elongated pentagonal orthobicupola","elongated pentagonal gyrobicupola","elongated pentagonal orthocupolarotunda","elongated pentagonal gyrocupolarotunda","elongated pentagonal orthobirotunda","elongated pentagonal gyrobirotunda","gyroelongated triangular bicupola","gyroelongated square bicupola","gyroelongated pentagonal bicupola","gyroelongated pentagonal cupolarotunda","gyroelongated pentagonal birotunda","augmented triangular prism","biaugmented triangular prism","triaugmented triangular prism","augmented pentagonal prism","biaugmented pentagonal prism","augmented hexagonal prism","parabiaugmented hexagonal prism","metabiaugmented hexagonal prism","triaugmented hexagonal prism","augmented dodecahedron","parabiaugmented dodecahedron","metabiaugmented dodecahedron","triaugmented dodecahedron","metabidiminished icosahedron","tridiminished icosahedron","augmented tridiminished icosahedron","augmented truncated tetrahedron","augmented truncated cube","biaugmented truncated cube","augmented truncated dodecahedron","parabiaugmented truncated dodecahedron","metabiaugmented truncated dodecahedron","triaugmented truncated dodecahedron","gyrate rhombicosidodecahedron","parabigyrate rhombicosidodecahedron","metabigyrate rhombicosidodecahedron","trigyrate rhombicosidodecahedron","diminished rhombicosidodecahedron","paragyrate diminished rhombicosidodecahedron","metagyrate diminished rhombicosidodecahedron","bigyrate diminished rhombicosidodecahedron","parabidiminished rhombicosidodecahedron","metabidiminished rhombicosidodecahedron","gyrate bidiminished rhombicosidodecahedron","tridiminished rhombicosidodecahedron","snub disphenoid","snub square antiprism","sphenocorona","augmented sphenocorona","sphenomegacorona","hebesphenomegacorona","disphenocingulum","bilunabirotunda","triangular hebesphenorotunda"],t.prisms=["triangular prism","pentagonal prism","hexagonal prism","octagonal prism","decagonal prism"];var s=function(){function t(e){this.makeLinks=!0,this.type=e.toLowerCase()}return t.prototype.dataToMamesh=function(t){for(var s=new e.Mamesh,i=0,r=t.vertices;i<r.length;i++){var n=r[i];s.newVertex(new e.XYZ(n[0],n[1],n[2]))}for(var o=Number.MIN_VALUE,a=0,h=s.vertices;a<h.length;a++){var l=(c=h[a]).position.length();l>o&&(o=l)}for(var u=0,m=s.vertices;u<m.length;u++){var c=m[u];c.position.scale(1/o)}var p=0;s.faces=[];for(var g=0,d=t.faces;g<d.length;g++){var f=d[g];if(3==f.length)s.addATriangle(s.vertices[f[0]],s.vertices[f[1]],s.vertices[f[2]]),s.faces.push([s.vertices[f[0]],s.vertices[f[1]],s.vertices[f[2]]]);else if(4==f.length)s.addASquare(s.vertices[f[0]],s.vertices[f[1]],s.vertices[f[2]],s.vertices[f[3]]),s.faces.push([s.vertices[f[0]],s.vertices[f[1]],s.vertices[f[2]],s.vertices[f[3]]]);else if(f.length>=5){var v=s.newVertex(new e.XYZ(0,0,0));v.markers.push(e.Vertex.Markers.polygonCenter),p=1/f.length;for(var y=[s.vertices[f[0]]],b=[y[0].position],x=[p],w=[s.vertices[f[0]]],T=1;T<f.length;T++)y.push(s.vertices[f[T]]),b.push(y[T].position),x.push(p),w.push(s.vertices[f[T]]);s.faces.push(w),e.geo.baryCenter(b,x,v.position);for(T=0;T<f.length;T++)s.addATriangle(y[T],y[(T+1)%f.length],v)}}return this.makeLinks&&new e.linkModule.LinkCreatorSorterAndBorderDetectorByPolygons(s).goChanging(),s},t.prototype.go=function(e){void 0===e&&(e=null);var t=[];t.tetrahedron={vertices:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],faces:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},t.cube={vertices:[[-.86602540378,-.86602540378,-.86602540378],[.86602540378,-.86602540378,-.86602540378],[-.86602540378,.86602540378,-.86602540378],[-.86602540378,-.86602540378,.86602540378],[.86602540378,.86602540378,-.86602540378],[.86602540378,-.86602540378,.86602540378],[-.86602540378,.86602540378,.86602540378],[.86602540378,.86602540378,.86602540378]],faces:[[0,1,4,2],[0,2,6,3],[0,3,5,1],[1,5,7,4],[2,4,7,6],[3,6,7,5]]},t.octahedron={vertices:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},t.dodecahedron={vertices:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],faces:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},t.icosahedron={vertices:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},t["truncated tetrahedron"]={vertices:[[0,0,1.105542],[.8528029,0,.7035265],[-.7106691,.4714045,.7035265],[.3316456,-.7856742,.7035265],[.9949367,.4714045,-.1005038],[-1.089693,.1571348,-.1005038],[-.5685352,.942809,-.1005038],[-.04737794,-1.099944,-.1005038],[.6159132,.1571348,-.904534],[.2842676,.942809,-.5025189],[-.758047,-.6285394,-.5025189],[.09475587,-.6285394,-.904534]],faces:[[0,3,1],[2,6,5],[4,8,9],[7,10,11],[0,1,4,9,6,2],[0,2,5,10,7,3],[1,3,7,11,8,4],[5,6,9,8,11,10]]},t["truncated cube"]={vertices:[[0,0,1.042011],[.5621693,0,.8773552],[-.4798415,.2928932,.8773552],[.2569714,-.5,.8773552],[.8773552,.2928932,.4798415],[-.9014684,.2071068,.4798415],[-.5962706,.7071068,.4798415],[.1405423,-.9142136,.4798415],[1.017898,.2071068,-.08232778],[.7609261,.7071068,.08232778],[-1.017898,-.2071068,.08232778],[-.2810846,1,.08232778],[-.2810846,-1,.08232778],[.2810846,-1,-.08232778],[.9014684,-.2071068,-.4798415],[.2810846,1,-.08232778],[-.7609261,-.7071068,-.08232778],[-.8773552,-.2928932,-.4798415],[-.1405423,.9142136,-.4798415],[.5962706,-.7071068,-.4798415],[.4798415,-.2928932,-.8773552],[-.5621693,0,-.8773552],[-.2569714,.5,-.8773552],[0,0,-1.042011]],faces:[[0,3,1],[2,6,5],[4,8,9],[7,12,13],[10,17,16],[11,15,18],[14,19,20],[21,22,23],[0,1,4,9,15,11,6,2],[0,2,5,10,16,12,7,3],[1,3,7,13,19,14,8,4],[5,6,11,18,22,21,17,10],[8,14,20,23,22,18,15,9],[12,16,17,21,23,20,19,13]]},t["truncated octahedron"]={vertices:[[0,0,1.054093],[.6324555,0,.843274],[-.421637,.4714045,.843274],[-.07027284,-.6285394,.843274],[.843274,.4714045,.421637],[.5621827,-.6285394,.6324555],[-.9135469,.3142697,.421637],[-.2108185,.942809,.421637],[-.5621827,-.7856742,.421637],[.9838197,.3142697,-.2108185],[.421637,.942809,.2108185],[.7027284,-.7856742,0],[-.7027284,.7856742,0],[-.9838197,-.3142697,.2108185],[-.421637,-.942809,-.2108185],[.5621827,.7856742,-.421637],[.9135469,-.3142697,-.421637],[.2108185,-.942809,-.421637],[-.5621827,.6285394,-.6324555],[-.843274,-.4714045,-.421637],[.07027284,.6285394,-.843274],[.421637,-.4714045,-.843274],[-.6324555,0,-.843274],[0,0,-1.054093]],faces:[[0,3,5,1],[2,7,12,6],[4,9,15,10],[8,13,19,14],[11,17,21,16],[18,20,23,22],[0,1,4,10,7,2],[0,2,6,13,8,3],[1,5,11,16,9,4],[3,8,14,17,11,5],[6,12,18,22,19,13],[7,10,15,20,18,12],[9,16,21,23,20,15],[14,19,22,23,21,17]]},t["truncated dodecahedron"]={vertices:[[0,0,1.014485],[.3367628,0,.9569589],[-.2902233,.1708204,.9569589],[.1634681,-.2944272,.9569589],[.5914332,.1708204,.806354],[-.5963465,.1527864,.806354],[-.4230517,.4472136,.806354],[.1377417,-.6,.806354],[.8302037,.1527864,.5626702],[.6667356,.4472136,.6201961],[-.8014407,-.0472136,.6201961],[-.3477493,.7236068,.6201961],[-.06735256,-.8,.6201961],[.2694102,-.8,.5626702],[.9618722,-.0472136,.3189863],[.5339072,.7236068,.4695912],[-.8271671,-.3527864,.4695912],[-.9599955,-.0763932,.3189863],[-.3992021,.8763932,.3189863],[-.09307895,.8944272,.4695912],[-.3734757,-.818034,.4695912],[.5081808,-.818034,.3189863],[.9361459,-.3527864,.1683814],[1.011448,-.0763932,-.0177765],[.4824544,.8763932,.1683814],[.2436839,.8944272,.4120653],[-.663699,-.6472136,.4120653],[-1.011448,.0763932,.0177765],[-.5577569,.8472136,.0177765],[-.5320305,-.8472136,.1683814],[.5577569,-.8472136,-.0177765],[.7628511,-.6472136,.1683814],[.9599955,.0763932,-.3189863],[.5320305,.8472136,-.1683814],[-.9618722,.0472136,-.3189863],[-.9361459,.3527864,-.1683814],[-.7628511,.6472136,-.1683814],[-.5081808,.818034,-.3189863],[-.4824544,-.8763932,-.1683814],[.3992021,-.8763932,-.3189863],[.8014407,.0472136,-.6201961],[.8271671,.3527864,-.4695912],[.663699,.6472136,-.4120653],[.3734757,.818034,-.4695912],[-.8302037,-.1527864,-.5626702],[-.2694102,.8,-.5626702],[-.5339072,-.7236068,-.4695912],[-.2436839,-.8944272,-.4120653],[.09307895,-.8944272,-.4695912],[.3477493,-.7236068,-.6201961],[.5963465,-.1527864,-.806354],[.06735256,.8,-.6201961],[-.6667356,-.4472136,-.6201961],[-.5914332,-.1708204,-.806354],[-.1377417,.6,-.806354],[.4230517,-.4472136,-.806354],[.2902233,-.1708204,-.9569589],[-.3367628,0,-.9569589],[-.1634681,.2944272,-.9569589],[0,0,-1.014485]],faces:[[0,3,1],[2,6,5],[4,8,9],[7,12,13],[10,17,16],[11,19,18],[14,22,23],[15,24,25],[20,26,29],[21,30,31],[27,35,34],[28,37,36],[32,40,41],[33,42,43],[38,46,47],[39,48,49],[44,53,52],[45,51,54],[50,55,56],[57,58,59],[0,1,4,9,15,25,19,11,6,2],[0,2,5,10,16,26,20,12,7,3],[1,3,7,13,21,31,22,14,8,4],[5,6,11,18,28,36,35,27,17,10],[8,14,23,32,41,42,33,24,15,9],[12,20,29,38,47,48,39,30,21,13],[16,17,27,34,44,52,46,38,29,26],[18,19,25,24,33,43,51,45,37,28],[22,31,30,39,49,55,50,40,32,23],[34,35,36,37,45,54,58,57,53,44],[40,50,56,59,58,54,51,43,42,41],[46,52,53,57,59,56,55,49,48,47]]},t["truncated icosahedron"]={vertices:[[0,0,1.021],[.4035482,0,.9378643],[-.2274644,.3333333,.9378643],[-.1471226,-.375774,.9378643],[.579632,.3333333,.7715933],[.5058321,-.375774,.8033483],[-.6020514,.2908927,.7715933],[-.05138057,.6666667,.7715933],[.1654988,-.6080151,.8033483],[-.5217096,-.4182147,.7715933],[.8579998,.2908927,.4708062],[.3521676,.6666667,.6884578],[.7841999,-.4182147,.5025612],[-.657475,.5979962,.5025612],[-.749174,-.08488134,.6884578],[-.3171418,.8302373,.5025612],[.1035333,-.8826969,.5025612],[-.5836751,-.6928964,.4708062],[.8025761,.5979962,.2017741],[.9602837,-.08488134,.3362902],[.4899547,.8302373,.3362902],[.7222343,-.6928964,.2017741],[-.8600213,.5293258,.1503935],[-.9517203,-.1535518,.3362902],[-.1793548,.993808,.1503935],[.381901,-.9251375,.2017741],[-.2710537,-.9251375,.3362902],[-.8494363,-.5293258,.2017741],[.8494363,.5293258,-.2017741],[1.007144,-.1535518,-.06725804],[.2241935,.993808,.06725804],[.8600213,-.5293258,-.1503935],[-.7222343,.6928964,-.2017741],[-1.007144,.1535518,.06725804],[-.381901,.9251375,-.2017741],[.1793548,-.993808,-.1503935],[-.2241935,-.993808,-.06725804],[-.8025761,-.5979962,-.2017741],[.5836751,.6928964,-.4708062],[.9517203,.1535518,-.3362902],[.2710537,.9251375,-.3362902],[.657475,-.5979962,-.5025612],[-.7841999,.4182147,-.5025612],[-.9602837,.08488134,-.3362902],[-.1035333,.8826969,-.5025612],[.3171418,-.8302373,-.5025612],[-.4899547,-.8302373,-.3362902],[-.8579998,-.2908927,-.4708062],[.5217096,.4182147,-.7715933],[.749174,.08488134,-.6884578],[.6020514,-.2908927,-.7715933],[-.5058321,.375774,-.8033483],[-.1654988,.6080151,-.8033483],[.05138057,-.6666667,-.7715933],[-.3521676,-.6666667,-.6884578],[-.579632,-.3333333,-.7715933],[.1471226,.375774,-.9378643],[.2274644,-.3333333,-.9378643],[-.4035482,0,-.9378643],[0,0,-1.021]],faces:[[0,3,8,5,1],[2,7,15,13,6],[4,10,18,20,11],[9,14,23,27,17],[12,21,31,29,19],[16,26,36,35,25],[22,32,42,43,33],[24,30,40,44,34],[28,39,49,48,38],[37,47,55,54,46],[41,45,53,57,50],[51,52,56,59,58],[0,1,4,11,7,2],[0,2,6,14,9,3],[1,5,12,19,10,4],[3,9,17,26,16,8],[5,8,16,25,21,12],[6,13,22,33,23,14],[7,11,20,30,24,15],[10,19,29,39,28,18],[13,15,24,34,32,22],[17,27,37,46,36,26],[18,28,38,40,30,20],[21,25,35,45,41,31],[23,33,43,47,37,27],[29,31,41,50,49,39],[32,34,44,52,51,42],[35,36,46,54,53,45],[38,48,56,52,44,40],[42,51,58,55,47,43],[48,49,50,57,59,56],[53,54,55,58,59,57]]},t.cuboctahedron={vertices:[[0,0,1.154701],[1,0,.5773503],[.3333333,.942809,.5773503],[-1,0,.5773503],[-.3333333,-.942809,.5773503],[1,0,-.5773503],[.6666667,-.942809,0],[-.6666667,.942809,0],[.3333333,.942809,-.5773503],[-1,0,-.5773503],[-.3333333,-.942809,-.5773503],[0,0,-1.154701]],faces:[[0,1,2],[0,3,4],[1,6,5],[2,8,7],[3,7,9],[4,10,6],[5,11,8],[9,11,10],[0,2,7,3],[0,4,6,1],[1,5,8,2],[3,9,10,4],[5,6,10,11],[7,8,11,9]]},t["truncated cuboctahedron"]={vertices:[[0,0,1.024117],[.4314788,0,.928785],[-.02106287,.4309644,.928785],[-.3410582,-.2642977,.928785],[.4104159,.4309644,.833453],[.7006238,-.2642977,.6986333],[-.3831839,.5976311,.7381211],[-.3919084,-.6380712,.6986333],[-.7031792,-.09763107,.7381211],[.6584981,.5976311,.5079694],[.6497736,-.6380712,.4684816],[.948706,-.09763107,.3731496],[-.4638216,.8333333,.3731496],[-.7242421,.3333333,.6427891],[-.7540295,-.4714045,.5079694],[-.1227634,-.9023689,.4684816],[.5778604,.8333333,.1429979],[.9276431,.3333333,.2778177],[.8978557,-.4714045,.1429979],[.3087154,-.9023689,.3731496],[-.8048797,.5690356,.2778177],[-.2157394,1,.04766598],[-.8470055,-.5690356,.08715377],[-.2157394,-1,.04766598],[.8470055,.5690356,-.08715377],[.2157394,1,-.04766598],[.8048797,-.5690356,-.2778177],[.2157394,-1,-.04766598],[-.8978557,.4714045,-.1429979],[-.3087154,.9023689,-.3731496],[-.9276431,-.3333333,-.2778177],[-.5778604,-.8333333,-.1429979],[.7540295,.4714045,-.5079694],[.1227634,.9023689,-.4684816],[.7242421,-.3333333,-.6427891],[.4638216,-.8333333,-.3731496],[-.948706,.09763107,-.3731496],[-.6497736,.6380712,-.4684816],[-.6584981,-.5976311,-.5079694],[.7031792,.09763107,-.7381211],[.3919084,.6380712,-.6986333],[.3831839,-.5976311,-.7381211],[-.7006238,.2642977,-.6986333],[-.4104159,-.4309644,-.833453],[.3410582,.2642977,-.928785],[.02106287,-.4309644,-.928785],[-.4314788,0,-.928785],[0,0,-1.024117]],faces:[[0,1,4,2],[3,8,14,7],[5,10,18,11],[6,12,20,13],[9,17,24,16],[15,23,27,19],[21,25,33,29],[22,30,38,31],[26,35,41,34],[28,37,42,36],[32,39,44,40],[43,46,47,45],[0,2,6,13,8,3],[1,5,11,17,9,4],[7,14,22,31,23,15],[10,19,27,35,26,18],[12,21,29,37,28,20],[16,24,32,40,33,25],[30,36,42,46,43,38],[34,41,45,47,44,39],[0,3,7,15,19,10,5,1],[2,4,9,16,25,21,12,6],[8,13,20,28,36,30,22,14],[11,18,26,34,39,32,24,17],[23,31,38,43,45,41,35,27],[29,33,40,44,47,46,42,37]]},t.rhombicuboctahedron={vertices:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],faces:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},t["snub cube"]={vertices:[[0,0,1.077364],[.7442063,0,.7790187],[.3123013,.6755079,.7790187],[-.482096,.5669449,.7790187],[-.7169181,-.1996786,.7790187],[-.1196038,-.7345325,.7790187],[.6246025,-.7345325,.4806734],[1.056508,-.1996786,.06806912],[.8867128,.5669449,.2302762],[.2621103,1.042774,.06806912],[-.532287,.9342111,.06806912],[-1.006317,.3082417,.2302762],[-.7020817,-.784071,.2302762],[.02728827,-1.074865,.06806912],[.6667271,-.784071,-.3184664],[.8216855,-.09111555,-.6908285],[.6518908,.6755079,-.5286215],[-.1196038,.8751866,-.6168117],[-.8092336,.4758293,-.5286215],[-.9914803,-.2761507,-.3184664],[-.4467414,-.825648,-.5286215],[.1926974,-.5348539,-.915157],[.1846311,.2587032,-1.029416],[-.5049987,-.1406541,-.9412258]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[1,6,7],[1,7,8],[1,8,2],[2,8,9],[3,10,11],[3,11,4],[4,12,5],[5,12,13],[5,13,6],[6,13,14],[6,14,7],[7,14,15],[8,16,9],[9,16,17],[9,17,10],[10,17,18],[10,18,11],[11,18,19],[12,19,20],[12,20,13],[14,21,15],[15,21,22],[15,22,16],[16,22,17],[18,23,19],[19,23,20],[20,23,21],[21,23,22],[0,5,6,1],[2,9,10,3],[4,11,19,12],[7,15,16,8],[13,20,21,14],[17,22,23,18]]},t.icosidodecahedron={vertices:[[0,0,1.051462],[.618034,0,.8506508],[.2763932,.5527864,.8506508],[-.618034,0,.8506508],[-.2763932,-.5527864,.8506508],[1,0,.3249197],[.7236068,-.5527864,.5257311],[-.1708204,.8944272,.5257311],[.4472136,.8944272,.3249197],[-1,0,.3249197],[-.7236068,.5527864,.5257311],[.1708204,-.8944272,.5257311],[-.4472136,-.8944272,.3249197],[1,0,-.3249197],[.8944272,.5527864,0],[.5527864,-.8944272,0],[-.5527864,.8944272,0],[.4472136,.8944272,-.3249197],[-1,0,-.3249197],[-.8944272,-.5527864,0],[-.4472136,-.8944272,-.3249197],[.618034,0,-.8506508],[.7236068,-.5527864,-.5257311],[.1708204,-.8944272,-.5257311],[-.7236068,.5527864,-.5257311],[-.1708204,.8944272,-.5257311],[.2763932,.5527864,-.8506508],[-.618034,0,-.8506508],[-.2763932,-.5527864,-.8506508],[0,0,-1.051462]],faces:[[0,1,2],[0,3,4],[1,6,5],[2,8,7],[3,10,9],[4,12,11],[5,13,14],[6,11,15],[7,16,10],[8,14,17],[9,18,19],[12,19,20],[13,22,21],[15,23,22],[16,25,24],[17,26,25],[18,24,27],[20,28,23],[21,29,26],[27,29,28],[0,2,7,10,3],[0,4,11,6,1],[1,5,14,8,2],[3,9,19,12,4],[5,6,15,22,13],[7,8,17,25,16],[9,10,16,24,18],[11,12,20,23,15],[13,21,26,17,14],[18,27,28,20,19],[21,22,23,28,29],[24,25,26,29,27]]},t["truncated icosidodecahedron"]={vertices:[[0,0,1.008759],[.2629922,0,.973874],[-.00462747,.2629515,.973874],[-.2211363,-.1423503,.973874],[.2583647,.2629515,.9389886],[.4673861,-.1423503,.8825429],[-.2303913,.3835526,.9041033],[-.3159502,-.372678,.8825429],[-.4469001,-.02174919,.9041033],[.4581312,.3835526,.8127722],[.5351104,-.372678,.7696515],[.6671526,-.02174919,.7563265],[-.3326926,.5786893,.7563265],[-.4515276,.2412023,.8692179],[-.541714,-.2520769,.8127722],[-.248226,-.6030057,.7696515],[.518368,.5786893,.6434351],[.6625252,.2412023,.7214412],[.7348768,-.2520769,.6434351],[.4402965,-.6030057,.6783205],[-.5538289,.436339,.7214412],[-.2724557,.7738261,.5869894],[-.6997536,-.3618034,.6301101],[-.04383203,-.745356,.6783205],[-.4062656,-.7127322,.5869894],[.722762,.436339,.552104],[.4160667,.7738261,.4956583],[.8398294,-.3618034,.4258876],[.2191601,-.745356,.6434351],[.5452491,-.7127322,.460773],[-.7147284,.4891254,.5172187],[-.07268925,.8944272,.460773],[-.4333553,.8266125,.3827669],[-.8606531,-.309017,.4258876],[-.6320294,-.5921311,.5172187],[-.2018716,-.8550825,.4956583],[.8248546,.4891254,.3129962],[.1903029,.8944272,.4258876],[.5181594,.8266125,.2565505],[.9419221,-.309017,.1867798],[.7450156,-.5921311,.3345566],[.3241127,-.8550825,.4258876],[-.8727679,.3793989,.3345566],[-.6544916,.6842621,.3478816],[-.2335888,.9472136,.2565505],[-.7929289,-.5393447,.3129962],[-.9629544,-.1138803,.2781109],[-.096919,-.9648091,.2781109],[.9298072,.3793989,.09544872],[.7225533,.6842621,.1652194],[.2923956,.9472136,.1867798],[.8471082,-.5393447,.09544872],[1.002159,-.1138803,.01744268],[.1660732,-.9648091,.2432255],[-.8125311,.5745356,.1652194],[-.9675818,.1490712,.2432255],[-.1314961,1,.01744268],[-.8275059,-.5745356,.05232804],[-.9975315,-.1490712,.01744268],[-.1314961,-1,.01744268],[.8275059,.5745356,-.05232804],[.9975315,.1490712,-.01744268],[.1314961,1,-.01744268],[.8125311,-.5745356,-.1652194],[.9675818,-.1490712,-.2432255],[.1314961,-1,-.01744268],[-.8471082,.5393447,-.09544872],[-1.002159,.1138803,-.01744268],[-.1660732,.9648091,-.2432255],[-.7225533,-.6842621,-.1652194],[-.9298072,-.3793989,-.09544872],[-.2923956,-.9472136,-.1867798],[.7929289,.5393447,-.3129962],[.9629544,.1138803,-.2781109],[.096919,.9648091,-.2781109],[.6544916,-.6842621,-.3478816],[.8727679,-.3793989,-.3345566],[.2335888,-.9472136,-.2565505],[-.7450156,.5921311,-.3345566],[-.9419221,.309017,-.1867798],[-.3241127,.8550825,-.4258876],[-.8248546,-.4891254,-.3129962],[-.5181594,-.8266125,-.2565505],[-.1903029,-.8944272,-.4258876],[.6320294,.5921311,-.5172187],[.8606531,.309017,-.4258876],[.2018716,.8550825,-.4956583],[.7147284,-.4891254,-.5172187],[.4333553,-.8266125,-.3827669],[.07268925,-.8944272,-.460773],[-.8398294,.3618034,-.4258876],[-.5452491,.7127322,-.460773],[-.2191601,.745356,-.6434351],[-.722762,-.436339,-.552104],[-.4160667,-.7738261,-.4956583],[.6997536,.3618034,-.6301101],[.4062656,.7127322,-.5869894],[.04383203,.745356,-.6783205],[.5538289,-.436339,-.7214412],[.2724557,-.7738261,-.5869894],[-.7348768,.2520769,-.6434351],[-.4402965,.6030057,-.6783205],[-.6625252,-.2412023,-.7214412],[-.518368,-.5786893,-.6434351],[.541714,.2520769,-.8127722],[.248226,.6030057,-.7696515],[.4515276,-.2412023,-.8692179],[.3326926,-.5786893,-.7563265],[-.6671526,.02174919,-.7563265],[-.5351104,.372678,-.7696515],[-.4581312,-.3835526,-.8127722],[.4469001,.02174919,-.9041033],[.3159502,.372678,-.8825429],[.2303913,-.3835526,-.9041033],[-.4673861,.1423503,-.8825429],[-.2583647,-.2629515,-.9389886],[.2211363,.1423503,-.973874],[.00462747,-.2629515,-.973874],[-.2629922,0,-.973874],[0,0,-1.008759]],faces:[[0,1,4,2],[3,8,14,7],[5,10,18,11],[6,12,20,13],[9,17,25,16],[15,24,35,23],[19,28,41,29],[21,31,44,32],[22,33,45,34],[26,38,50,37],[27,40,51,39],[30,43,54,42],[36,48,60,49],[46,55,67,58],[47,59,65,53],[52,64,73,61],[56,62,74,68],[57,70,81,69],[63,75,87,76],[66,78,90,79],[71,82,94,83],[72,85,95,84],[77,89,99,88],[80,92,101,91],[86,96,105,97],[93,102,110,103],[98,107,113,106],[100,109,114,108],[104,111,116,112],[115,118,119,117],[0,2,6,13,8,3],[1,5,11,17,9,4],[7,14,22,34,24,15],[10,19,29,40,27,18],[12,21,32,43,30,20],[16,25,36,49,38,26],[23,35,47,53,41,28],[31,37,50,62,56,44],[33,46,58,70,57,45],[39,51,63,76,64,52],[42,54,66,79,67,55],[48,61,73,85,72,60],[59,71,83,89,77,65],[68,74,86,97,92,80],[69,81,93,103,94,82],[75,88,99,107,98,87],[78,91,101,109,100,90],[84,95,104,112,105,96],[102,108,114,118,115,110],[106,113,117,119,116,111],[0,3,7,15,23,28,19,10,5,1],[2,4,9,16,26,37,31,21,12,6],[8,13,20,30,42,55,46,33,22,14],[11,18,27,39,52,61,48,36,25,17],[24,34,45,57,69,82,71,59,47,35],[29,41,53,65,77,88,75,63,51,40],[32,44,56,68,80,91,78,66,54,43],[38,49,60,72,84,96,86,74,62,50],[58,67,79,90,100,108,102,93,81,70],[64,76,87,98,106,111,104,95,85,73],[83,94,103,110,115,117,113,107,99,89],[92,97,105,112,116,119,118,114,109,101]]},t.rhombicosidodecahedron={vertices:[[0,0,1.026054],[.447838,0,.9231617],[-.02363976,.4472136,.9231617],[-.4050732,.190983,.9231617],[-.1693344,-.4145898,.9231617],[.4241982,.4472136,.8202696],[.7673818,.190983,.6537868],[.5552827,-.4145898,.7566788],[-.2312241,.7562306,.6537868],[-.5744076,-.2236068,.8202696],[-.6126576,.5,.6537868],[.1738492,-.6708204,.7566788],[-.4669629,-.6381966,.6537868],[.493393,.7562306,.4873039],[.8748265,-.2236068,.4873039],[.8365765,.5,.320821],[.7054921,-.6381966,.3844118],[.08831973,.9472136,.3844118],[-.5434628,.809017,.320821],[-.8866463,-.1708204,.4873039],[-.9102861,.2763932,.3844118],[-.1237794,-.8944272,.4873039],[.3240586,-.8944272,.3844118],[-.7792016,-.5854102,.320821],[.6289922,.809017,.05144604],[1.010426,-.1708204,.05144604],[.9867859,.2763932,-.05144604],[.8410913,-.5854102,-.05144604],[-.223919,1,.05144604],[.223919,1,-.05144604],[-.8410913,.5854102,.05144604],[-.9867859,-.2763932,.05144604],[-1.010426,.1708204,-.05144604],[-.223919,-1,.05144604],[.223919,-1,-.05144604],[-.6289922,-.809017,-.05144604],[.7792016,.5854102,-.320821],[.9102861,-.2763932,-.3844118],[.8866463,.1708204,-.4873039],[.5434628,-.809017,-.320821],[-.3240586,.8944272,-.3844118],[.1237794,.8944272,-.4873039],[-.7054921,.6381966,-.3844118],[-.8365765,-.5,-.320821],[-.8748265,.2236068,-.4873039],[-.08831973,-.9472136,-.3844118],[-.493393,-.7562306,-.4873039],[.4669629,.6381966,-.6537868],[.6126576,-.5,-.6537868],[.5744076,.2236068,-.8202696],[.2312241,-.7562306,-.6537868],[-.1738492,.6708204,-.7566788],[-.5552827,.4145898,-.7566788],[-.7673818,-.190983,-.6537868],[-.4241982,-.4472136,-.8202696],[.1693344,.4145898,-.9231617],[.4050732,-.190983,-.9231617],[.02363976,-.4472136,-.9231617],[-.447838,0,-.9231617],[0,0,-1.026054]],faces:[[0,2,3],[1,6,5],[4,9,12],[7,16,14],[8,18,10],[11,21,22],[13,15,24],[17,29,28],[19,31,23],[20,30,32],[25,27,37],[26,38,36],[33,45,34],[35,43,46],[39,50,48],[40,41,51],[42,52,44],[47,49,55],[53,58,54],[56,57,59],[0,1,5,2],[0,3,9,4],[1,7,14,6],[2,8,10,3],[4,12,21,11],[5,6,15,13],[7,11,22,16],[8,17,28,18],[9,19,23,12],[10,18,30,20],[13,24,29,17],[14,16,27,25],[15,26,36,24],[19,20,32,31],[21,33,34,22],[23,31,43,35],[25,37,38,26],[27,39,48,37],[28,29,41,40],[30,42,44,32],[33,35,46,45],[34,45,50,39],[36,38,49,47],[40,51,52,42],[41,47,55,51],[43,53,54,46],[44,52,58,53],[48,50,57,56],[49,56,59,55],[54,58,59,57],[0,4,11,7,1],[2,5,13,17,8],[3,10,20,19,9],[6,14,25,26,15],[12,23,35,33,21],[16,22,34,39,27],[18,28,40,42,30],[24,36,47,41,29],[31,32,44,53,43],[37,48,56,49,38],[45,46,54,57,50],[51,55,59,58,52]]},t["snub dodecahedron"]={vertices:[[0,0,1.028031],[.4638569,0,.9174342],[.2187436,.4090409,.9174342],[-.2575486,.3857874,.9174342],[-.4616509,-.04518499,.9174342],[-.177858,-.4284037,.9174342],[.5726782,-.4284037,.7384841],[.8259401,-.04518499,.6104342],[.6437955,.3857874,.702527],[.349648,.7496433,.6104342],[-.421009,.7120184,.6104342],[-.6783139,.3212396,.702527],[-.6031536,-.4466658,.702527],[-.2749612,-.7801379,.6104342],[.1760766,-.6931717,.7384841],[.5208138,-.7801379,.4206978],[.8552518,-.4466658,.3547998],[1.01294,-.03548596,.1718776],[.7182239,.661842,.3208868],[.3633691,.9454568,.1758496],[-.04574087,.9368937,.4206978],[-.4537394,.905564,.1758496],[-.7792791,.5887312,.3208868],[-.9537217,.1462217,.3547998],[-.9072701,-.3283699,.3547998],[-.6503371,-.7286577,.3208868],[.08459482,-.9611501,.3547998],[.3949153,-.9491262,-.007072558],[.9360473,-.409557,-.1136978],[.9829382,.02692292,-.2999274],[.9463677,.4014808,-.007072558],[.6704578,.7662826,-.1419366],[-.05007646,1.025698,-.04779978],[-.4294337,.8845784,-.2999274],[-.9561681,.3719321,-.06525234],[-1.022036,-.1000338,-.04779978],[-.8659056,-.5502712,-.06525234],[-.5227761,-.8778535,-.1136978],[-.06856319,-1.021542,-.09273844],[.2232046,-.8974878,-.4489366],[.6515438,-.7200947,-.3373472],[.7969535,-.3253959,-.5619888],[.8066872,.4395354,-.461425],[.4468035,.735788,-.5619888],[.001488801,.8961155,-.503809],[-.3535403,.6537658,-.7102452],[-.7399517,.5547758,-.4489366],[-.9120238,.1102196,-.461425],[-.6593998,-.6182798,-.4896639],[-.2490651,-.8608088,-.503809],[.4301047,-.5764987,-.734512],[.5057577,-.1305283,-.8854492],[.5117735,.3422252,-.8232973],[.09739587,.5771941,-.8451093],[-.6018946,.2552591,-.7933564],[-.6879024,-.2100741,-.734512],[-.3340437,-.5171509,-.8232973],[.08570633,-.3414376,-.9658797],[.1277354,.1313635,-1.011571],[-.3044499,-.06760332,-.979586]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[1,6,7],[1,7,8],[1,8,2],[2,8,9],[3,10,11],[3,11,4],[4,12,5],[5,12,13],[5,13,14],[6,14,15],[6,15,16],[6,16,7],[7,16,17],[8,18,9],[9,18,19],[9,19,20],[10,20,21],[10,21,22],[10,22,11],[11,22,23],[12,24,25],[12,25,13],[13,26,14],[14,26,15],[15,26,27],[16,28,17],[17,28,29],[17,29,30],[18,30,31],[18,31,19],[19,32,20],[20,32,21],[21,32,33],[22,34,23],[23,34,35],[23,35,24],[24,35,36],[24,36,25],[25,36,37],[26,38,27],[27,38,39],[27,39,40],[28,40,41],[28,41,29],[29,42,30],[30,42,31],[31,42,43],[32,44,33],[33,44,45],[33,45,46],[34,46,47],[34,47,35],[36,48,37],[37,48,49],[37,49,38],[38,49,39],[39,50,40],[40,50,41],[41,50,51],[42,52,43],[43,52,53],[43,53,44],[44,53,45],[45,54,46],[46,54,47],[47,54,55],[48,55,56],[48,56,49],[50,57,51],[51,57,58],[51,58,52],[52,58,53],[54,59,55],[55,59,56],[56,59,57],[57,59,58],[0,5,14,6,1],[2,9,20,10,3],[4,11,23,24,12],[7,17,30,18,8],[13,25,37,38,26],[15,27,40,28,16],[19,31,43,44,32],[21,33,46,34,22],[29,41,51,52,42],[35,47,55,48,36],[39,49,56,57,50],[45,53,58,59,54]]},t["triangular prism"]={vertices:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],faces:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},t["pentagonal prism"]={vertices:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],faces:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},t["hexagonal prism"]={vertices:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],faces:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},t["square pyramid"]={vertices:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],faces:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},t["pentagonal pyramid"]={vertices:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],faces:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},t["triangular bipyramid"]={vertices:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],faces:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},t["pentagonal bipyramid"]={vertices:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],faces:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]};var s=t[this.type];if(null!=s){var i=this.dataToMamesh(s);return null!=e&&e(i),i}if(null==e)throw"the data for the polyhedron:"+this.type+"are not localy stored. They are downloaded, so you must give a callback method in the go-method";var r=new XMLHttpRequest,n=this;r.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=n.dataToMamesh(JSON.parse(this.responseText));e(t)}};var o=n.type.replace(/\s+/g,"-").toLowerCase();r.open("GET","TS/polyhedron/polyhedra/"+o+".json",!0),r.send()},t}();t.Polyhedron=s}(e.polyhedron||(e.polyhedron={}))}(mathis||(mathis={}));